<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Calculo - Trading Rechner</title>
  <style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,Segoe UI,Arial,sans-serif}

/* Dark Theme (Default) */
:root{--bg:#000000;--panel:#0a0a0a;--muted:#9aa4b2;--accent:#10b981;--danger:#ef4444;--blue:#3b82f6;--purple:#a855f7;--text:#e6eef6;--border:rgba(255,255,255,0.05);--input-bg:rgba(255,255,255,0.03);--input-border:rgba(255,255,255,0.06)}

/* Light Theme */
:root[data-theme="light"]{--bg:#f5f7fa;--panel:#ffffff;--muted:#2d3748;--accent:#10b981;--danger:#ef4444;--blue:#3b82f6;--purple:#a855f7;--text:#000000;--border:rgba(0,0,0,0.08);--input-bg:rgba(0,0,0,0.02);--input-border:rgba(0,0,0,0.08)}

/* System Theme */
:root[data-theme="system"]{
  --bg:#000000;--panel:#0a0a0a;--muted:#9aa4b2;--accent:#10b981;--danger:#ef4444;--blue:#3b82f6;--purple:#a855f7;--text:#e6eef6;--border:rgba(255,255,255,0.05);--input-bg:rgba(255,255,255,0.03);--input-border:rgba(255,255,255,0.06)
}
:root[data-theme="system"] {
  @media (prefers-color-scheme: light) {
    --bg:#f5f7fa;--panel:#ffffff;--muted:#2d3748;--text:#000000;--border:rgba(0,0,0,0.08);--input-bg:rgba(0,0,0,0.02);--input-border:rgba(0,0,0,0.08)
  }
}
@media (prefers-color-scheme: light) {
  :root[data-theme="system"] {
    --bg:#f5f7fa;--panel:#ffffff;--muted:#2d3748;--text:#000000;--border:rgba(0,0,0,0.08);--input-bg:rgba(0,0,0,0.02);--input-border:rgba(0,0,0,0.08)
  }
}

html,body{height:100%;background:var(--bg);color:var(--text);transition:background 0.3s, color 0.3s}
.site-header{height:80px;display:flex;align-items:center;justify-content:space-between;padding:10px 20px;background:var(--panel);border-bottom:1px solid var(--border);position:fixed;top:0;left:0;right:0;z-index:100}
.header-spacer{height:80px}
.logo-section{display:flex;align-items:center;gap:12px}
.logo-image{height:40px;width:auto;display:block}
.logo-image.logo-light{display:none}
:root[data-theme="light"] .logo-image.logo-light{display:block}
:root[data-theme="light"] .logo-image.logo-dark{display:none}
:root[data-theme="system"] .logo-image.logo-light{display:none}
:root[data-theme="system"] .logo-image.logo-dark{display:block}
@media (prefers-color-scheme: light) {
  :root[data-theme="system"] .logo-image.logo-light{display:block}
  :root[data-theme="system"] .logo-image.logo-dark{display:none}
}
.site-title{font-size:1.2rem;font-weight:700;color:var(--text)}
.nav-section{display:flex;gap:12px;align-items:center}
.tab{padding:10px 16px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer;font-size:14px;transition:all 0.2s}
.tab:hover{background:var(--input-bg)}
.tab.active{background:var(--accent);border:2px solid var(--accent);border-color:var(--accent);color:#072017;font-weight:700;box-shadow:0 0 12px rgba(16,185,129,0.35)}
.section{display:none;padding:20px;padding-bottom:100px;min-height:calc(100vh - 180px)}
.section.active{display:block}
.container{max-width:950px;margin:0 auto}
.chart{background:var(--panel);padding:32px 24px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.1)}
h2{font-size:1.5rem;margin-bottom:24px;text-align:center;color:var(--text)}
h3{color:var(--text)}
label{display:block;margin-bottom:20px}
.label-text{font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px;text-transform:uppercase}
.input-wrapper{position:relative}
input[type=number],input[type=text]{width:100%;padding:16px;padding-right:50px;font-size:20px;font-weight:700;background:var(--input-bg);border:1px solid var(--input-border);border-radius:12px;color:inherit}
.input-unit{position:absolute;right:16px;top:50%;transform:translateY(-50%);color:var(--blue);font-weight:600;font-size:16px}
input[type=range]{width:100%;height:12px;border-radius:8px;background:linear-gradient(90deg, var(--accent) 0%, var(--accent) 0%, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.1) 100%);outline:none;-webkit-appearance:none;appearance:none}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;background:#fff;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.3)}
input[type=range]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#fff;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.3)}
.result-display{text-align:center;margin:24px 0}
.result-label{font-size:13px;color:var(--muted);letter-spacing:2px;margin-bottom:12px}
.result-value{font-size:52px;font-weight:800;color:var(--accent);line-height:1.1}
.result-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(16,185,129,0.2);color:var(--accent);padding:8px 16px;border-radius:20px;font-size:16px;font-weight:700;margin-top:16px}
.btn{padding:14px 24px;border-radius:10px;border:0;font-weight:700;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;gap:8px;transition:transform 0.1s}
.btn:active{transform:translateY(1px)}
.btn-primary{width:100%;background:linear-gradient(90deg,var(--accent),#34d399);color:#072017}
.btn-blue{background:linear-gradient(90deg,var(--blue),#60a5fa);color:#fff}
.btn-purple{background:linear-gradient(90deg,var(--purple),#c084fc);color:#fff}
.btn-row{display:flex;gap:12px;margin-top:24px}
.btn-row .btn{flex:1}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--panel);backdrop-filter:blur(10px);border-top:1px solid var(--border);padding:12px 20px;display:flex;justify-content:space-around;z-index:100;box-shadow:0 -2px 10px rgba(0,0,0,0.1)}
.bottom-nav-item{display:flex;flex-direction:column;align-items:center;gap:4px;color:var(--muted);cursor:pointer;padding:8px 16px;border-radius:8px;font-size:11px;font-weight:600;transition:all 0.2s}
.bottom-nav-item:hover{background:var(--input-bg)}
.bottom-nav-item.active{color:var(--accent);background:rgba(16,185,129,0.1)}
.bottom-nav-item svg{width:24px;height:24px}
.info-card{background:rgba(16,185,129,0.05);border:1px solid rgba(16,185,129,0.2);border-radius:12px;padding:20px;margin:20px 0}
.info-row{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border);color:var(--text)}
.info-row:last-child{border-bottom:none}
.toggle{position:relative;display:inline-block;width:56px;height:32px}
.toggle input{opacity:0;width:0;height:0}
.toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:var(--input-bg);border:1px solid var(--border);border-radius:34px;transition:0.3s}
.toggle-slider:before{position:absolute;content:"";height:24px;width:24px;left:4px;bottom:4px;background:white;border-radius:50%;transition:0.3s}
.toggle input:checked+.toggle-slider{background:var(--accent)}
.toggle input:checked+.toggle-slider:before{transform:translateX(24px)}
.theme-selector{display:flex;gap:8px}
.theme-btn{flex:1;padding:12px;border-radius:10px;border:1px solid var(--border);background:var(--input-bg);color:var(--muted);cursor:pointer;font-size:14px;font-weight:600;transition:all 0.2s}
.theme-btn.active{background:var(--accent);border-color:var(--accent);color:#fff}
:root[data-theme="light"] .theme-btn.active{color:#fff}
@media (prefers-color-scheme: light) {
  :root[data-theme="system"] .theme-btn.active{color:#fff}
}
 #termsLinkText:hover,#privacyLinkText:hover{color:#34d399;text-decoration:underline}
select{background:var(--input-bg);border:1px solid var(--input-border);color:var(--text);cursor:pointer;transition:all 0.2s}
select:hover{background:rgba(255,255,255,0.08);border-color:rgba(255,255,255,0.15)}
select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(16,185,129,0.1)}
select option{background:var(--panel);color:var(--text);padding:12px;font-size:14px;font-weight:600}
select option:hover{background:rgba(16,185,129,0.1)}
select option:checked{background:linear-gradient(90deg,rgba(16,185,129,0.2),rgba(16,185,129,0.1));color:var(--accent);font-weight:700}
:root[data-theme="light"] select option{background:#fff;color:#000}
:root[data-theme="light"] select option:checked{background:rgba(16,185,129,0.15);color:var(--accent)}
button{color:inherit}
strong{color:var(--text)}
.modal{display:none;position:fixed;z-index:200;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.8);backdrop-filter:blur(8px)}
.modal.active{display:flex;align-items:center;justify-content:center}
.modal-content{background:var(--panel);border-radius:16px;padding:24px;max-width:500px;width:90%;box-shadow:0 8px 32px rgba(0,0,0,0.6)}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
.modal-title{font-size:20px;font-weight:700}
.modal-close{background:rgba(255,255,255,0.05);border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;color:var(--muted);font-size:20px}
.modal-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px}
.modal-result{background:rgba(255,255,255,0.02);border-radius:12px;padding:20px;margin:24px 0;text-align:center}

@media (max-width:1024px){
  .site-header{height:72px;padding:10px 14px}
  .header-spacer{height:72px}
  .logo-image{height:34px}
  .site-title{font-size:1rem}
  .nav-section{gap:8px;min-width:0}
  .nav-section .tab{display:inline-flex}
  #loginBtn,#userBtn{margin-left:0 !important;padding:8px 12px !important;font-size:13px;max-width:48vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .section{padding:16px;padding-bottom:120px;min-height:calc(100vh - 160px)}
  .chart{padding:22px 16px}
  .result-value{font-size:40px}
  .modal-content{width:94%;padding:18px}
  .modal-grid{grid-template-columns:1fr}
  .bottom-nav{display:flex;padding:10px 8px calc(10px + env(safe-area-inset-bottom, 0px))}
  .bottom-nav-item{flex:1;min-width:0;padding:8px 4px}
  .bottom-nav-item svg{width:22px;height:22px}
  .bottom-nav-item .nav-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:10px;line-height:1.2;max-width:100%}
  .mobile-home{display:flex}
}

@media (min-width:1025px){
  .mobile-home{display:none}
}

@media (max-width:640px){
  .nav-section .tab{display:none}
  .bottom-nav{display:flex}
  h2{font-size:1.25rem;margin-bottom:18px}
  .label-text{font-size:10px;margin-bottom:6px}
  input[type=number],input[type=text]{padding:13px;padding-right:42px;font-size:17px}
  .input-unit{right:12px;font-size:14px}
  .btn-row{flex-direction:column}
  .btn-row .btn{width:100%}
  .result-value{font-size:34px}
  .result-badge{font-size:14px;padding:7px 12px}
  .info-card{padding:14px}
  .info-row{gap:12px;align-items:flex-start}
  .modal-content{width:96%;padding:16px;max-height:88vh;overflow-y:auto}
}

@media (max-width:380px){
  .site-header{padding:8px 10px}
  .logo-image{height:30px}
  .site-title{font-size:0.9rem}
  #loginBtn,#userBtn{padding:6px 10px !important;font-size:12px}
  .bottom-nav{padding:8px 4px calc(8px + env(safe-area-inset-bottom, 0px))}
  .bottom-nav-item{padding:6px 2px;font-size:9px;gap:2px}
  .bottom-nav-item svg{width:20px;height:20px}
  .bottom-nav-item .nav-text{font-size:9px}
  h2{font-size:1.1rem;margin-bottom:14px}
  .label-text{font-size:9px}
  input[type=number],input[type=text]{padding:11px;padding-right:38px;font-size:16px}
  .input-unit{font-size:13px;right:10px}
  .btn{padding:12px 16px;font-size:13px}
  .result-value{font-size:30px}
  .result-label{font-size:11px}
  .result-badge{font-size:12px;padding:6px 10px}
  .info-card{padding:12px}
  .modal-content{width:98%;padding:14px;max-height:90vh}
  .modal-title{font-size:18px}
  .modal-close{width:36px;height:36px;font-size:18px}
}
  </style>
  <script>
/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Chart=e()}(this,(function(){"use strict";var t=Object.freeze({__proto__:null,get Colors(){return Jo},get Decimation(){return ta},get Filler(){return ba},get Legend(){return Ma},get SubTitle(){return Pa},get Title(){return ka},get Tooltip(){return Na}});function e(){}const i=(()=>{let t=0;return()=>t++})();function s(t){return null==t}function n(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return"[object"===e.slice(0,7)&&"Array]"===e.slice(-6)}function o(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}function a(t){return("number"==typeof t||t instanceof Number)&&isFinite(+t)}function r(t,e){return a(t)?t:e}function l(t,e){return void 0===t?e:t}const h=(t,e)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100:+t/e,c=(t,e)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100*e:+t;function d(t,e,i){if(t&&"function"==typeof t.call)return t.apply(i,e)}function u(t,e,i,s){let a,r,l;if(n(t))if(r=t.length,s)for(a=r-1;a>=0;a--)e.call(i,t[a],a);else for(a=0;a<r;a++)e.call(i,t[a],a);else if(o(t))for(l=Object.keys(t),r=l.length,a=0;a<r;a++)e.call(i,t[l[a]],l[a])}function f(t,e){let i,s,n,o;if(!t||!e||t.length!==e.length)return!1;for(i=0,s=t.length;i<s;++i)if(n=t[i],o=e[i],n.datasetIndex!==o.datasetIndex||n.index!==o.index)return!1;return!0}function g(t){if(n(t))return t.map(g);if(o(t)){const e=Object.create(null),i=Object.keys(t),s=i.length;let n=0;for(;n<s;++n)e[i[n]]=g(t[i[n]]);return e}return t}function p(t){return-1===["__proto__","prototype","constructor"].indexOf(t)}function m(t,e,i,s){if(!p(t))return;const n=e[t],a=i[t];o(n)&&o(a)?x(n,a,s):e[t]=g(a)}function x(t,e,i){const s=n(e)?e:[e],a=s.length;if(!o(t))return t;const r=(i=i||{}).merger||m;let l;for(let e=0;e<a;++e){if(l=s[e],!o(l))continue;const n=Object.keys(l);for(let e=0,s=n.length;e<s;++e)r(n[e],t,l,i)}return t}function b(t,e){return x(t,e,{merger:_})}function _(t,e,i){if(!p(t))return;const s=e[t],n=i[t];o(s)&&o(n)?b(s,n):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=g(n))}const y={"":t=>t,x:t=>t.x,y:t=>t.y};function v(t){const e=t.split("."),i=[];let s="";for(const t of e)s+=t,s.endsWith("\\")?s=s.slice(0,-1)+".":(i.push(s),s="");return i}function M(t,e){const i=y[e]||(y[e]=function(t){const e=v(t);return t=>{for(const i of e){if(""===i)break;t=t&&t[i]}return t}}(e));return i(t)}function w(t){return t.charAt(0).toUpperCase()+t.slice(1)}const k=t=>void 0!==t,S=t=>"function"==typeof t,P=(t,e)=>{if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0};function D(t){return"mouseup"===t.type||"click"===t.type||"contextmenu"===t.type}const C=Math.PI,O=2*C,A=O+C,T=Number.POSITIVE_INFINITY,L=C/180,E=C/2,R=C/4,I=2*C/3,z=Math.log10,F=Math.sign;function V(t,e,i){return Math.abs(t-e)<i}function B(t){const e=Math.round(t);t=V(t,e,t/1e3)?e:t;const i=Math.pow(10,Math.floor(z(t))),s=t/i;return(s<=1?1:s<=2?2:s<=5?5:10)*i}function W(t){const e=[],i=Math.sqrt(t);let s;for(s=1;s<i;s++)t%s==0&&(e.push(s),e.push(t/s));return i===(0|i)&&e.push(i),e.sort(((t,e)=>t-e)).pop(),e}function N(t){return!function(t){return"symbol"==typeof t||"object"==typeof t&&null!==t&&!(Symbol.toPrimitive in t||"toString"in t||"valueOf"in t)}(t)&&!isNaN(parseFloat(t))&&isFinite(t)}function H(t,e){const i=Math.round(t);return i-e<=t&&i+e>=t}function j(t,e,i){let s,n,o;for(s=0,n=t.length;s<n;s++)o=t[s][i],isNaN(o)||(e.min=Math.min(e.min,o),e.max=Math.max(e.max,o))}function $(t){return t*(C/180)}function Y(t){return t*(180/C)}function U(t){if(!a(t))return;let e=1,i=0;for(;Math.round(t*e)/e!==t;)e*=10,i++;return i}function X(t,e){const i=e.x-t.x,s=e.y-t.y,n=Math.sqrt(i*i+s*s);let o=Math.atan2(s,i);return o<-.5*C&&(o+=O),{angle:o,distance:n}}function q(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function K(t,e){return(t-e+A)%O-C}function G(t){return(t%O+O)%O}function J(t,e,i,s){const n=G(t),o=G(e),a=G(i),r=G(o-n),l=G(a-n),h=G(n-o),c=G(n-a);return n===o||n===a||s&&o===a||r>l&&h<c}function Z(t,e,i){return Math.max(e,Math.min(i,t))}function Q(t){return Z(t,-32768,32767)}function tt(t,e,i,s=1e-6){return t>=Math.min(e,i)-s&&t<=Math.max(e,i)+s}function et(t,e,i){i=i||(i=>t[i]<e);let s,n=t.length-1,o=0;for(;n-o>1;)s=o+n>>1,i(s)?o=s:n=s;return{lo:o,hi:n}}const it=(t,e,i,s)=>et(t,i,s?s=>{const n=t[s][e];return n<i||n===i&&t[s+1][e]===i}:s=>t[s][e]<i),st=(t,e,i)=>et(t,i,(s=>t[s][e]>=i));function nt(t,e,i){let s=0,n=t.length;for(;s<n&&t[s]<e;)s++;for(;n>s&&t[n-1]>i;)n--;return s>0||n<t.length?t.slice(s,n):t}const ot=["push","pop","shift","splice","unshift"];function at(t,e){t._chartjs?t._chartjs.listeners.push(e):(Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),ot.forEach((e=>{const i="_onData"+w(e),s=t[e];Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value(...e){const n=s.apply(this,e);return t._chartjs.listeners.forEach((t=>{"function"==typeof t[i]&&t[i](...e)})),n}})})))}function rt(t,e){const i=t._chartjs;if(!i)return;const s=i.listeners,n=s.indexOf(e);-1!==n&&s.splice(n,1),s.length>0||(ot.forEach((e=>{delete t[e]})),delete t._chartjs)}function lt(t){const e=new Set(t);return e.size===t.length?t:Array.from(e)}const ht="undefined"==typeof window?function(t){return t()}:window.requestAnimationFrame;function ct(t,e){let i=[],s=!1;return function(...n){i=n,s||(s=!0,ht.call(window,(()=>{s=!1,t.apply(e,i)})))}}function dt(t,e){let i;return function(...s){return e?(clearTimeout(i),i=setTimeout(t,e,s)):t.apply(this,s),e}}const ut=t=>"start"===t?"left":"end"===t?"right":"center",ft=(t,e,i)=>"start"===t?e:"end"===t?i:(e+i)/2,gt=(t,e,i,s)=>t===(s?"left":"right")?i:"center"===t?(e+i)/2:e;function pt(t,e,i){const n=e.length;let o=0,a=n;if(t._sorted){const{iScale:r,vScale:l,_parsed:h}=t,c=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null,d=r.axis,{min:u,max:f,minDefined:g,maxDefined:p}=r.getUserBounds();if(g){if(o=Math.min(it(h,d,u).lo,i?n:it(e,d,r.getPixelForValue(u)).lo),c){const t=h.slice(0,o+1).reverse().findIndex((t=>!s(t[l.axis])));o-=Math.max(0,t)}o=Z(o,0,n-1)}if(p){let t=Math.max(it(h,r.axis,f,!0).hi+1,i?0:it(e,d,r.getPixelForValue(f),!0).hi+1);if(c){const e=h.slice(t-1).findIndex((t=>!s(t[l.axis])));t+=Math.max(0,e)}a=Z(t,o,n)-o}else a=n-o}return{start:o,count:a}}function mt(t){const{xScale:e,yScale:i,_scaleRanges:s}=t,n={xmin:e.min,xmax:e.max,ymin:i.min,ymax:i.max};if(!s)return t._scaleRanges=n,!0;const o=s.xmin!==e.min||s.xmax!==e.max||s.ymin!==i.min||s.ymax!==i.max;return Object.assign(s,n),o}class xt{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,s){const n=e.listeners[s],o=e.duration;n.forEach((s=>s({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(i-e.start,o)})))}_refresh(){this._request||(this._running=!0,this._request=ht.call(window,(()=>{this._update(),this._request=null,this._running&&this._refresh()})))}_update(t=Date.now()){let e=0;this._charts.forEach(((i,s)=>{if(!i.running||!i.items.length)return;const n=i.items;let o,a=n.length-1,r=!1;for(;a>=0;--a)o=n[a],o._active?(o._total>i.duration&&(i.duration=o._total),o.tick(t),r=!0):(n[a]=n[n.length-1],n.pop());r&&(s.draw(),this._notify(s,i,t,"progress")),n.length||(i.running=!1,this._notify(s,i,t,"complete"),i.initial=!1),e+=n.length})),this._lastDate=t,0===e&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){e&&e.length&&this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce(((t,e)=>Math.max(t,e._duration)),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!!(e&&e.running&&e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let s=i.length-1;for(;s>=0;--s)i[s].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var bt=new xt;
/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function _t(t){return t+.5|0}const yt=(t,e,i)=>Math.max(Math.min(t,i),e);function vt(t){return yt(_t(2.55*t),0,255)}function Mt(t){return yt(_t(255*t),0,255)}function wt(t){return yt(_t(t/2.55)/100,0,1)}function kt(t){return yt(_t(100*t),0,100)}const St={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Pt=[..."0123456789ABCDEF"],Dt=t=>Pt[15&t],Ct=t=>Pt[(240&t)>>4]+Pt[15&t],Ot=t=>(240&t)>>4==(15&t);function At(t){var e=(t=>Ot(t.r)&&Ot(t.g)&&Ot(t.b)&&Ot(t.a))(t)?Dt:Ct;return t?"#"+e(t.r)+e(t.g)+e(t.b)+((t,e)=>t<255?e(t):"")(t.a,e):void 0}const Tt=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Lt(t,e,i){const s=e*Math.min(i,1-i),n=(e,n=(e+t/30)%12)=>i-s*Math.max(Math.min(n-3,9-n,1),-1);return[n(0),n(8),n(4)]}function Et(t,e,i){const s=(s,n=(s+t/60)%6)=>i-i*e*Math.max(Math.min(n,4-n,1),0);return[s(5),s(3),s(1)]}function Rt(t,e,i){const s=Lt(t,1,.5);let n;for(e+i>1&&(n=1/(e+i),e*=n,i*=n),n=0;n<3;n++)s[n]*=1-e-i,s[n]+=e;return s}function It(t){const e=t.r/255,i=t.g/255,s=t.b/255,n=Math.max(e,i,s),o=Math.min(e,i,s),a=(n+o)/2;let r,l,h;return n!==o&&(h=n-o,l=a>.5?h/(2-n-o):h/(n+o),r=function(t,e,i,s,n){return t===n?(e-i)/s+(e<i?6:0):e===n?(i-t)/s+2:(t-e)/s+4}(e,i,s,h,n),r=60*r+.5),[0|r,l||0,a]}function zt(t,e,i,s){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,i,s)).map(Mt)}function Ft(t,e,i){return zt(Lt,t,e,i)}function Vt(t){return(t%360+360)%360}function Bt(t){const e=Tt.exec(t);let i,s=255;if(!e)return;e[5]!==i&&(s=e[6]?vt(+e[5]):Mt(+e[5]));const n=Vt(+e[2]),o=+e[3]/100,a=+e[4]/100;return i="hwb"===e[1]?function(t,e,i){return zt(Rt,t,e,i)}(n,o,a):"hsv"===e[1]?function(t,e,i){return zt(Et,t,e,i)}(n,o,a):Ft(n,o,a),{r:i[0],g:i[1],b:i[2],a:s}}const Wt={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Nt={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let Ht;function jt(t){Ht||(Ht=function(){const t={},e=Object.keys(Nt),i=Object.keys(Wt);let s,n,o,a,r;for(s=0;s<e.length;s++){for(a=r=e[s],n=0;n<i.length;n++)o=i[n],r=r.replace(o,Wt[o]);o=parseInt(Nt[a],16),t[r]=[o>>16&255,o>>8&255,255&o]}return t}(),Ht.transparent=[0,0,0,0]);const e=Ht[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}const $t=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const Yt=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,Ut=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function Xt(t,e,i){if(t){let s=It(t);s[e]=Math.max(0,Math.min(s[e]+s[e]*i,0===e?360:1)),s=Ft(s),t.r=s[0],t.g=s[1],t.b=s[2]}}function qt(t,e){return t?Object.assign(e||{},t):t}function Kt(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=Mt(t[3]))):(e=qt(t,{r:0,g:0,b:0,a:1})).a=Mt(e.a),e}function Gt(t){return"r"===t.charAt(0)?function(t){const e=$t.exec(t);let i,s,n,o=255;if(e){if(e[7]!==i){const t=+e[7];o=e[8]?vt(t):yt(255*t,0,255)}return i=+e[1],s=+e[3],n=+e[5],i=255&(e[2]?vt(i):yt(i,0,255)),s=255&(e[4]?vt(s):yt(s,0,255)),n=255&(e[6]?vt(n):yt(n,0,255)),{r:i,g:s,b:n,a:o}}}(t):Bt(t)}class Jt{constructor(t){if(t instanceof Jt)return t;const e=typeof t;let i;var s,n,o;"object"===e?i=Kt(t):"string"===e&&(o=(s=t).length,"#"===s[0]&&(4===o||5===o?n={r:255&17*St[s[1]],g:255&17*St[s[2]],b:255&17*St[s[3]],a:5===o?17*St[s[4]]:255}:7!==o&&9!==o||(n={r:St[s[1]]<<4|St[s[2]],g:St[s[3]]<<4|St[s[4]],b:St[s[5]]<<4|St[s[6]],a:9===o?St[s[7]]<<4|St[s[8]]:255})),i=n||jt(t)||Gt(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=qt(this._rgb);return t&&(t.a=wt(t.a)),t}set rgb(t){this._rgb=Kt(t)}rgbString(){return this._valid?(t=this._rgb)&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${wt(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`):void 0;var t}hexString(){return this._valid?At(this._rgb):void 0}hslString(){return this._valid?function(t){if(!t)return;const e=It(t),i=e[0],s=kt(e[1]),n=kt(e[2]);return t.a<255?`hsla(${i}, ${s}%, ${n}%, ${wt(t.a)})`:`hsl(${i}, ${s}%, ${n}%)`}(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,s=t.rgb;let n;const o=e===n?.5:e,a=2*o-1,r=i.a-s.a,l=((a*r==-1?a:(a+r)/(1+a*r))+1)/2;n=1-l,i.r=255&l*i.r+n*s.r+.5,i.g=255&l*i.g+n*s.g+.5,i.b=255&l*i.b+n*s.b+.5,i.a=o*i.a+(1-o)*s.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=function(t,e,i){const s=Ut(wt(t.r)),n=Ut(wt(t.g)),o=Ut(wt(t.b));return{r:Mt(Yt(s+i*(Ut(wt(e.r))-s))),g:Mt(Yt(n+i*(Ut(wt(e.g))-n))),b:Mt(Yt(o+i*(Ut(wt(e.b))-o))),a:t.a+i*(e.a-t.a)}}(this._rgb,t._rgb,e)),this}clone(){return new Jt(this.rgb)}alpha(t){return this._rgb.a=Mt(t),this}clearer(t){return this._rgb.a*=1-t,this}greyscale(){const t=this._rgb,e=_t(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=e,this}opaquer(t){return this._rgb.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Xt(this._rgb,2,t),this}darken(t){return Xt(this._rgb,2,-t),this}saturate(t){return Xt(this._rgb,1,t),this}desaturate(t){return Xt(this._rgb,1,-t),this}rotate(t){return function(t,e){var i=It(t);i[0]=Vt(i[0]+e),i=Ft(i),t.r=i[0],t.g=i[1],t.b=i[2]}(this._rgb,t),this}}function Zt(t){if(t&&"object"==typeof t){const e=t.toString();return"[object CanvasPattern]"===e||"[object CanvasGradient]"===e}return!1}function Qt(t){return Zt(t)?t:new Jt(t)}function te(t){return Zt(t)?t:new Jt(t).saturate(.5).darken(.1).hexString()}const ee=["x","y","borderWidth","radius","tension"],ie=["color","borderColor","backgroundColor"];const se=new Map;function ne(t,e,i){return function(t,e){e=e||{};const i=t+JSON.stringify(e);let s=se.get(i);return s||(s=new Intl.NumberFormat(t,e),se.set(i,s)),s}(e,i).format(t)}const oe={values:t=>n(t)?t:""+t,numeric(t,e,i){if(0===t)return"0";const s=this.chart.options.locale;let n,o=t;if(i.length>1){const e=Math.max(Math.abs(i[0].value),Math.abs(i[i.length-1].value));(e<1e-4||e>1e15)&&(n="scientific"),o=function(t,e){let i=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;Math.abs(i)>=1&&t!==Math.floor(t)&&(i=t-Math.floor(t));return i}(t,i)}const a=z(Math.abs(o)),r=isNaN(a)?1:Math.max(Math.min(-1*Math.floor(a),20),0),l={notation:n,minimumFractionDigits:r,maximumFractionDigits:r};return Object.assign(l,this.options.ticks.format),ne(t,s,l)},logarithmic(t,e,i){if(0===t)return"0";const s=i[e].significand||t/Math.pow(10,Math.floor(z(t)));return[1,2,3,5,10,15].includes(s)||e>.8*i.length?oe.numeric.call(this,t,e,i):""}};var ae={formatters:oe};const re=Object.create(null),le=Object.create(null);function he(t,e){if(!e)return t;const i=e.split(".");for(let e=0,s=i.length;e<s;++e){const s=i[e];t=t[s]||(t[s]=Object.create(null))}return t}function ce(t,e,i){return"string"==typeof e?x(he(t,e),i):x(he(t,""),e)}class de{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,e)=>te(e.backgroundColor),this.hoverBorderColor=(t,e)=>te(e.borderColor),this.hoverColor=(t,e)=>te(e.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return ce(this,t,e)}get(t){return he(this,t)}describe(t,e){return ce(le,t,e)}override(t,e){return ce(re,t,e)}route(t,e,i,s){const n=he(this,t),a=he(this,i),r="_"+e;Object.defineProperties(n,{[r]:{value:n[e],writable:!0},[e]:{enumerable:!0,get(){const t=this[r],e=a[s];return o(t)?Object.assign({},e,t):l(t,e)},set(t){this[r]=t}}})}apply(t){t.forEach((t=>t(this)))}}var ue=new de({_scriptable:t=>!t.startsWith("on"),_indexable:t=>"events"!==t,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>"onProgress"!==t&&"onComplete"!==t&&"fn"!==t}),t.set("animations",{colors:{type:"color",properties:ie},numbers:{type:"number",properties:ee}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>0|t}}}})},function(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:ae.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&"callback"!==t&&"parser"!==t,_indexable:t=>"borderDash"!==t&&"tickBorderDash"!==t&&"dash"!==t}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:t=>"backdropPadding"!==t&&"callback"!==t,_indexable:t=>"backdropPadding"!==t})}]);function fe(){return"undefined"!=typeof window&&"undefined"!=typeof document}function ge(t){let e=t.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function pe(t,e,i){let s;return"string"==typeof t?(s=parseInt(t,10),-1!==t.indexOf("%")&&(s=s/100*e.parentNode[i])):s=t,s}const me=t=>t.ownerDocument.defaultView.getComputedStyle(t,null);function xe(t,e){return me(t).getPropertyValue(e)}const be=["top","right","bottom","left"];function _e(t,e,i){const s={};i=i?"-"+i:"";for(let n=0;n<4;n++){const o=be[n];s[o]=parseFloat(t[e+"-"+o+i])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}const ye=(t,e,i)=>(t>0||e>0)&&(!i||!i.shadowRoot);function ve(t,e){if("native"in t)return t;const{canvas:i,currentDevicePixelRatio:s}=e,n=me(i),o="border-box"===n.boxSizing,a=_e(n,"padding"),r=_e(n,"border","width"),{x:l,y:h,box:c}=function(t,e){const i=t.touches,s=i&&i.length?i[0]:t,{offsetX:n,offsetY:o}=s;let a,r,l=!1;if(ye(n,o,t.target))a=n,r=o;else{const t=e.getBoundingClientRect();a=s.clientX-t.left,r=s.clientY-t.top,l=!0}return{x:a,y:r,box:l}}(t,i),d=a.left+(c&&r.left),u=a.top+(c&&r.top);let{width:f,height:g}=e;return o&&(f-=a.width+r.width,g-=a.height+r.height),{x:Math.round((l-d)/f*i.width/s),y:Math.round((h-u)/g*i.height/s)}}const Me=t=>Math.round(10*t)/10;function we(t,e,i,s){const n=me(t),o=_e(n,"margin"),a=pe(n.maxWidth,t,"clientWidth")||T,r=pe(n.maxHeight,t,"clientHeight")||T,l=function(t,e,i){let s,n;if(void 0===e||void 0===i){const o=t&&ge(t);if(o){const t=o.getBoundingClientRect(),a=me(o),r=_e(a,"border","width"),l=_e(a,"padding");e=t.width-l.width-r.width,i=t.height-l.height-r.height,s=pe(a.maxWidth,o,"clientWidth"),n=pe(a.maxHeight,o,"clientHeight")}else e=t.clientWidth,i=t.clientHeight}return{width:e,height:i,maxWidth:s||T,maxHeight:n||T}}(t,e,i);let{width:h,height:c}=l;if("content-box"===n.boxSizing){const t=_e(n,"border","width"),e=_e(n,"padding");h-=e.width+t.width,c-=e.height+t.height}h=Math.max(0,h-o.width),c=Math.max(0,s?h/s:c-o.height),h=Me(Math.min(h,a,l.maxWidth)),c=Me(Math.min(c,r,l.maxHeight)),h&&!c&&(c=Me(h/2));return(void 0!==e||void 0!==i)&&s&&l.height&&c>l.height&&(c=l.height,h=Me(Math.floor(c*s))),{width:h,height:c}}function ke(t,e,i){const s=e||1,n=Me(t.height*s),o=Me(t.width*s);t.height=Me(t.height),t.width=Me(t.width);const a=t.canvas;return a.style&&(i||!a.style.height&&!a.style.width)&&(a.style.height=`${t.height}px`,a.style.width=`${t.width}px`),(t.currentDevicePixelRatio!==s||a.height!==n||a.width!==o)&&(t.currentDevicePixelRatio=s,a.height=n,a.width=o,t.ctx.setTransform(s,0,0,s,0,0),!0)}const Se=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};fe()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch(t){}return t}();function Pe(t,e){const i=xe(t,e),s=i&&i.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function De(t){return!t||s(t.size)||s(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function Ce(t,e,i,s,n){let o=e[n];return o||(o=e[n]=t.measureText(n).width,i.push(n)),o>s&&(s=o),s}function Oe(t,e,i,s){let o=(s=s||{}).data=s.data||{},a=s.garbageCollect=s.garbageCollect||[];s.font!==e&&(o=s.data={},a=s.garbageCollect=[],s.font=e),t.save(),t.font=e;let r=0;const l=i.length;let h,c,d,u,f;for(h=0;h<l;h++)if(u=i[h],null==u||n(u)){if(n(u))for(c=0,d=u.length;c<d;c++)f=u[c],null==f||n(f)||(r=Ce(t,o,a,r,f))}else r=Ce(t,o,a,r,u);t.restore();const g=a.length/2;if(g>i.length){for(h=0;h<g;h++)delete o[a[h]];a.splice(0,g)}return r}function Ae(t,e,i){const s=t.currentDevicePixelRatio,n=0!==i?Math.max(i/2,.5):0;return Math.round((e-n)*s)/s+n}function Te(t,e){(e||t)&&((e=e||t.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore())}function Le(t,e,i,s){Ee(t,e,i,s,null)}function Ee(t,e,i,s,n){let o,a,r,l,h,c,d,u;const f=e.pointStyle,g=e.rotation,p=e.radius;let m=(g||0)*L;if(f&&"object"==typeof f&&(o=f.toString(),"[object HTMLImageElement]"===o||"[object HTMLCanvasElement]"===o))return t.save(),t.translate(i,s),t.rotate(m),t.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),void t.restore();if(!(isNaN(p)||p<=0)){switch(t.beginPath(),f){default:n?t.ellipse(i,s,n/2,p,0,0,O):t.arc(i,s,p,0,O),t.closePath();break;case"triangle":c=n?n/2:p,t.moveTo(i+Math.sin(m)*c,s-Math.cos(m)*p),m+=I,t.lineTo(i+Math.sin(m)*c,s-Math.cos(m)*p),m+=I,t.lineTo(i+Math.sin(m)*c,s-Math.cos(m)*p),t.closePath();break;case"rectRounded":h=.516*p,l=p-h,a=Math.cos(m+R)*l,d=Math.cos(m+R)*(n?n/2-h:l),r=Math.sin(m+R)*l,u=Math.sin(m+R)*(n?n/2-h:l),t.arc(i-d,s-r,h,m-C,m-E),t.arc(i+u,s-a,h,m-E,m),t.arc(i+d,s+r,h,m,m+E),t.arc(i-u,s+a,h,m+E,m+C),t.closePath();break;case"rect":if(!g){l=Math.SQRT1_2*p,c=n?n/2:l,t.rect(i-c,s-l,2*c,2*l);break}m+=R;case"rectRot":d=Math.cos(m)*(n?n/2:p),a=Math.cos(m)*p,r=Math.sin(m)*p,u=Math.sin(m)*(n?n/2:p),t.moveTo(i-d,s-r),t.lineTo(i+u,s-a),t.lineTo(i+d,s+r),t.lineTo(i-u,s+a),t.closePath();break;case"crossRot":m+=R;case"cross":d=Math.cos(m)*(n?n/2:p),a=Math.cos(m)*p,r=Math.sin(m)*p,u=Math.sin(m)*(n?n/2:p),t.moveTo(i-d,s-r),t.lineTo(i+d,s+r),t.moveTo(i+u,s-a),t.lineTo(i-u,s+a);break;case"star":d=Math.cos(m)*(n?n/2:p),a=Math.cos(m)*p,r=Math.sin(m)*p,u=Math.sin(m)*(n?n/2:p),t.moveTo(i-d,s-r),t.lineTo(i+d,s+r),t.moveTo(i+u,s-a),t.lineTo(i-u,s+a),m+=R,d=Math.cos(m)*(n?n/2:p),a=Math.cos(m)*p,r=Math.sin(m)*p,u=Math.sin(m)*(n?n/2:p),t.moveTo(i-d,s-r),t.lineTo(i+d,s+r),t.moveTo(i+u,s-a),t.lineTo(i-u,s+a);break;case"line":a=n?n/2:Math.cos(m)*p,r=Math.sin(m)*p,t.moveTo(i-a,s-r),t.lineTo(i+a,s+r);break;case"dash":t.moveTo(i,s),t.lineTo(i+Math.cos(m)*(n?n/2:p),s+Math.sin(m)*p);break;case!1:t.closePath()}t.fill(),e.borderWidth>0&&t.stroke()}}function Re(t,e,i){return i=i||.5,!e||t&&t.x>e.left-i&&t.x<e.right+i&&t.y>e.top-i&&t.y<e.bottom+i}function Ie(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function ze(t){t.restore()}function Fe(t,e,i,s,n){if(!e)return t.lineTo(i.x,i.y);if("middle"===n){const s=(e.x+i.x)/2;t.lineTo(s,e.y),t.lineTo(s,i.y)}else"after"===n!=!!s?t.lineTo(e.x,i.y):t.lineTo(i.x,e.y);t.lineTo(i.x,i.y)}function Ve(t,e,i,s){if(!e)return t.lineTo(i.x,i.y);t.bezierCurveTo(s?e.cp1x:e.cp2x,s?e.cp1y:e.cp2y,s?i.cp2x:i.cp1x,s?i.cp2y:i.cp1y,i.x,i.y)}function Be(t,e,i,s,n){if(n.strikethrough||n.underline){const o=t.measureText(s),a=e-o.actualBoundingBoxLeft,r=e+o.actualBoundingBoxRight,l=i-o.actualBoundingBoxAscent,h=i+o.actualBoundingBoxDescent,c=n.strikethrough?(l+h)/2:h;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=n.decorationWidth||2,t.moveTo(a,c),t.lineTo(r,c),t.stroke()}}function We(t,e){const i=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=i}function Ne(t,e,i,o,a,r={}){const l=n(e)?e:[e],h=r.strokeWidth>0&&""!==r.strokeColor;let c,d;for(t.save(),t.font=a.string,function(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),s(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}(t,r),c=0;c<l.length;++c)d=l[c],r.backdrop&&We(t,r.backdrop),h&&(r.strokeColor&&(t.strokeStyle=r.strokeColor),s(r.strokeWidth)||(t.lineWidth=r.strokeWidth),t.strokeText(d,i,o,r.maxWidth)),t.fillText(d,i,o,r.maxWidth),Be(t,i,o,d,r),o+=Number(a.lineHeight);t.restore()}function He(t,e){const{x:i,y:s,w:n,h:o,radius:a}=e;t.arc(i+a.topLeft,s+a.topLeft,a.topLeft,1.5*C,C,!0),t.lineTo(i,s+o-a.bottomLeft),t.arc(i+a.bottomLeft,s+o-a.bottomLeft,a.bottomLeft,C,E,!0),t.lineTo(i+n-a.bottomRight,s+o),t.arc(i+n-a.bottomRight,s+o-a.bottomRight,a.bottomRight,E,0,!0),t.lineTo(i+n,s+a.topRight),t.arc(i+n-a.topRight,s+a.topRight,a.topRight,0,-E,!0),t.lineTo(i+a.topLeft,s)}function je(t,e=[""],i,s,n=(()=>t[0])){const o=i||t;void 0===s&&(s=ti("_fallback",t));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:o,_fallback:s,_getTarget:n,override:i=>je([i,...t],e,o,s)};return new Proxy(a,{deleteProperty:(e,i)=>(delete e[i],delete e._keys,delete t[0][i],!0),get:(i,s)=>qe(i,s,(()=>function(t,e,i,s){let n;for(const o of e)if(n=ti(Ue(o,t),i),void 0!==n)return Xe(t,n)?Ze(i,s,t,n):n}(s,e,t,i))),getOwnPropertyDescriptor:(t,e)=>Reflect.getOwnPropertyDescriptor(t._scopes[0],e),getPrototypeOf:()=>Reflect.getPrototypeOf(t[0]),has:(t,e)=>ei(t).includes(e),ownKeys:t=>ei(t),set(t,e,i){const s=t._storage||(t._storage=n());return t[e]=s[e]=i,delete t._keys,!0}})}function $e(t,e,i,s){const a={_cacheable:!1,_proxy:t,_context:e,_subProxy:i,_stack:new Set,_descriptors:Ye(t,s),setContext:e=>$e(t,e,i,s),override:n=>$e(t.override(n),e,i,s)};return new Proxy(a,{deleteProperty:(e,i)=>(delete e[i],delete t[i],!0),get:(t,e,i)=>qe(t,e,(()=>function(t,e,i){const{_proxy:s,_context:a,_subProxy:r,_descriptors:l}=t;let h=s[e];S(h)&&l.isScriptable(e)&&(h=function(t,e,i,s){const{_proxy:n,_context:o,_subProxy:a,_stack:r}=i;if(r.has(t))throw new Error("Recursion detected: "+Array.from(r).join("->")+"->"+t);r.add(t);let l=e(o,a||s);r.delete(t),Xe(t,l)&&(l=Ze(n._scopes,n,t,l));return l}(e,h,t,i));n(h)&&h.length&&(h=function(t,e,i,s){const{_proxy:n,_context:a,_subProxy:r,_descriptors:l}=i;if(void 0!==a.index&&s(t))return e[a.index%e.length];if(o(e[0])){const i=e,s=n._scopes.filter((t=>t!==i));e=[];for(const o of i){const i=Ze(s,n,t,o);e.push($e(i,a,r&&r[t],l))}}return e}(e,h,t,l.isIndexable));Xe(e,h)&&(h=$e(h,a,r&&r[e],l));return h}(t,e,i))),getOwnPropertyDescriptor:(e,i)=>e._descriptors.allKeys?Reflect.has(t,i)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,i),getPrototypeOf:()=>Reflect.getPrototypeOf(t),has:(e,i)=>Reflect.has(t,i),ownKeys:()=>Reflect.ownKeys(t),set:(e,i,s)=>(t[i]=s,delete e[i],!0)})}function Ye(t,e={scriptable:!0,indexable:!0}){const{_scriptable:i=e.scriptable,_indexable:s=e.indexable,_allKeys:n=e.allKeys}=t;return{allKeys:n,scriptable:i,indexable:s,isScriptable:S(i)?i:()=>i,isIndexable:S(s)?s:()=>s}}const Ue=(t,e)=>t?t+w(e):e,Xe=(t,e)=>o(e)&&"adapters"!==t&&(null===Object.getPrototypeOf(e)||e.constructor===Object);function qe(t,e,i){if(Object.prototype.hasOwnProperty.call(t,e)||"constructor"===e)return t[e];const s=i();return t[e]=s,s}function Ke(t,e,i){return S(t)?t(e,i):t}const Ge=(t,e)=>!0===t?e:"string"==typeof t?M(e,t):void 0;function Je(t,e,i,s,n){for(const o of e){const e=Ge(i,o);if(e){t.add(e);const o=Ke(e._fallback,i,n);if(void 0!==o&&o!==i&&o!==s)return o}else if(!1===e&&void 0!==s&&i!==s)return null}return!1}function Ze(t,e,i,s){const a=e._rootScopes,r=Ke(e._fallback,i,s),l=[...t,...a],h=new Set;h.add(s);let c=Qe(h,l,i,r||i,s);return null!==c&&((void 0===r||r===i||(c=Qe(h,l,r,c,s),null!==c))&&je(Array.from(h),[""],a,r,(()=>function(t,e,i){const s=t._getTarget();e in s||(s[e]={});const a=s[e];if(n(a)&&o(i))return i;return a||{}}(e,i,s))))}function Qe(t,e,i,s,n){for(;i;)i=Je(t,e,i,s,n);return i}function ti(t,e){for(const i of e){if(!i)continue;const e=i[t];if(void 0!==e)return e}}function ei(t){let e=t._keys;return e||(e=t._keys=function(t){const e=new Set;for(const i of t)for(const t of Object.keys(i).filter((t=>!t.startsWith("_"))))e.add(t);return Array.from(e)}(t._scopes)),e}function ii(t,e,i,s){const{iScale:n}=t,{key:o="r"}=this._parsing,a=new Array(s);let r,l,h,c;for(r=0,l=s;r<l;++r)h=r+i,c=e[h],a[r]={r:n.parse(M(c,o),h)};return a}const si=Number.EPSILON||1e-14,ni=(t,e)=>e<t.length&&!t[e].skip&&t[e],oi=t=>"x"===t?"y":"x";function ai(t,e,i,s){const n=t.skip?e:t,o=e,a=i.skip?e:i,r=q(o,n),l=q(a,o);let h=r/(r+l),c=l/(r+l);h=isNaN(h)?0:h,c=isNaN(c)?0:c;const d=s*h,u=s*c;return{previous:{x:o.x-d*(a.x-n.x),y:o.y-d*(a.y-n.y)},next:{x:o.x+u*(a.x-n.x),y:o.y+u*(a.y-n.y)}}}function ri(t,e="x"){const i=oi(e),s=t.length,n=Array(s).fill(0),o=Array(s);let a,r,l,h=ni(t,0);for(a=0;a<s;++a)if(r=l,l=h,h=ni(t,a+1),l){if(h){const t=h[e]-l[e];n[a]=0!==t?(h[i]-l[i])/t:0}o[a]=r?h?F(n[a-1])!==F(n[a])?0:(n[a-1]+n[a])/2:n[a-1]:n[a]}!function(t,e,i){const s=t.length;let n,o,a,r,l,h=ni(t,0);for(let c=0;c<s-1;++c)l=h,h=ni(t,c+1),l&&h&&(V(e[c],0,si)?i[c]=i[c+1]=0:(n=i[c]/e[c],o=i[c+1]/e[c],r=Math.pow(n,2)+Math.pow(o,2),r<=9||(a=3/Math.sqrt(r),i[c]=n*a*e[c],i[c+1]=o*a*e[c])))}(t,n,o),function(t,e,i="x"){const s=oi(i),n=t.length;let o,a,r,l=ni(t,0);for(let h=0;h<n;++h){if(a=r,r=l,l=ni(t,h+1),!r)continue;const n=r[i],c=r[s];a&&(o=(n-a[i])/3,r[`cp1${i}`]=n-o,r[`cp1${s}`]=c-o*e[h]),l&&(o=(l[i]-n)/3,r[`cp2${i}`]=n+o,r[`cp2${s}`]=c+o*e[h])}}(t,o,e)}function li(t,e,i){return Math.max(Math.min(t,i),e)}function hi(t,e,i,s,n){let o,a,r,l;if(e.spanGaps&&(t=t.filter((t=>!t.skip))),"monotone"===e.cubicInterpolationMode)ri(t,n);else{let i=s?t[t.length-1]:t[0];for(o=0,a=t.length;o<a;++o)r=t[o],l=ai(i,r,t[Math.min(o+1,a-(s?0:1))%a],e.tension),r.cp1x=l.previous.x,r.cp1y=l.previous.y,r.cp2x=l.next.x,r.cp2y=l.next.y,i=r}e.capBezierPoints&&function(t,e){let i,s,n,o,a,r=Re(t[0],e);for(i=0,s=t.length;i<s;++i)a=o,o=r,r=i<s-1&&Re(t[i+1],e),o&&(n=t[i],a&&(n.cp1x=li(n.cp1x,e.left,e.right),n.cp1y=li(n.cp1y,e.top,e.bottom)),r&&(n.cp2x=li(n.cp2x,e.left,e.right),n.cp2y=li(n.cp2y,e.top,e.bottom)))}(t,i)}const ci=t=>0===t||1===t,di=(t,e,i)=>-Math.pow(2,10*(t-=1))*Math.sin((t-e)*O/i),ui=(t,e,i)=>Math.pow(2,-10*t)*Math.sin((t-e)*O/i)+1,fi={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>1-Math.cos(t*E),easeOutSine:t=>Math.sin(t*E),easeInOutSine:t=>-.5*(Math.cos(C*t)-1),easeInExpo:t=>0===t?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>ci(t)?t:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,-10*(2*t-1))),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>ci(t)?t:di(t,.075,.3),easeOutElastic:t=>ci(t)?t:ui(t,.075,.3),easeInOutElastic(t){const e=.1125;return ci(t)?t:t<.5?.5*di(2*t,e,.45):.5+.5*ui(2*t-1,e,.45)},easeInBack(t){const e=1.70158;return t*t*((e+1)*t-e)},easeOutBack(t){const e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},easeInBounce:t=>1-fi.easeOutBounce(1-t),easeOutBounce(t){const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375},easeInOutBounce:t=>t<.5?.5*fi.easeInBounce(2*t):.5*fi.easeOutBounce(2*t-1)+.5};function gi(t,e,i,s){return{x:t.x+i*(e.x-t.x),y:t.y+i*(e.y-t.y)}}function pi(t,e,i,s){return{x:t.x+i*(e.x-t.x),y:"middle"===s?i<.5?t.y:e.y:"after"===s?i<1?t.y:e.y:i>0?e.y:t.y}}function mi(t,e,i,s){const n={x:t.cp2x,y:t.cp2y},o={x:e.cp1x,y:e.cp1y},a=gi(t,n,i),r=gi(n,o,i),l=gi(o,e,i),h=gi(a,r,i),c=gi(r,l,i);return gi(h,c,i)}const xi=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,bi=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function _i(t,e){const i=(""+t).match(xi);if(!i||"normal"===i[1])return 1.2*e;switch(t=+i[2],i[3]){case"px":return t;case"%":t/=100}return e*t}const yi=t=>+t||0;function vi(t,e){const i={},s=o(e),n=s?Object.keys(e):e,a=o(t)?s?i=>l(t[i],t[e[i]]):e=>t[e]:()=>t;for(const t of n)i[t]=yi(a(t));return i}function Mi(t){return vi(t,{top:"y",right:"x",bottom:"y",left:"x"})}function wi(t){return vi(t,["topLeft","topRight","bottomLeft","bottomRight"])}function ki(t){const e=Mi(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Si(t,e){t=t||{},e=e||ue.font;let i=l(t.size,e.size);"string"==typeof i&&(i=parseInt(i,10));let s=l(t.style,e.style);s&&!(""+s).match(bi)&&(console.warn('Invalid font style specified: "'+s+'"'),s=void 0);const n={family:l(t.family,e.family),lineHeight:_i(l(t.lineHeight,e.lineHeight),i),size:i,style:s,weight:l(t.weight,e.weight),string:""};return n.string=De(n),n}function Pi(t,e,i,s){let o,a,r,l=!0;for(o=0,a=t.length;o<a;++o)if(r=t[o],void 0!==r&&(void 0!==e&&"function"==typeof r&&(r=r(e),l=!1),void 0!==i&&n(r)&&(r=r[i%r.length],l=!1),void 0!==r))return s&&!l&&(s.cacheable=!1),r}function Di(t,e,i){const{min:s,max:n}=t,o=c(e,(n-s)/2),a=(t,e)=>i&&0===t?0:t+e;return{min:a(s,-Math.abs(o)),max:a(n,o)}}function Ci(t,e){return Object.assign(Object.create(t),e)}function Oi(t,e,i){return t?function(t,e){return{x:i=>t+t+e-i,setWidth(t){e=t},textAlign:t=>"center"===t?t:"right"===t?"left":"right",xPlus:(t,e)=>t-e,leftForLtr:(t,e)=>t-e}}(e,i):{x:t=>t,setWidth(t){},textAlign:t=>t,xPlus:(t,e)=>t+e,leftForLtr:(t,e)=>t}}function Ai(t,e){let i,s;"ltr"!==e&&"rtl"!==e||(i=t.canvas.style,s=[i.getPropertyValue("direction"),i.getPropertyPriority("direction")],i.setProperty("direction",e,"important"),t.prevTextDirection=s)}function Ti(t,e){void 0!==e&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function Li(t){return"angle"===t?{between:J,compare:K,normalize:G}:{between:tt,compare:(t,e)=>t-e,normalize:t=>t}}function Ei({start:t,end:e,count:i,loop:s,style:n}){return{start:t%i,end:e%i,loop:s&&(e-t+1)%i==0,style:n}}function Ri(t,e,i){if(!i)return[t];const{property:s,start:n,end:o}=i,a=e.length,{compare:r,between:l,normalize:h}=Li(s),{start:c,end:d,loop:u,style:f}=function(t,e,i){const{property:s,start:n,end:o}=i,{between:a,normalize:r}=Li(s),l=e.length;let h,c,{start:d,end:u,loop:f}=t;if(f){for(d+=l,u+=l,h=0,c=l;h<c&&a(r(e[d%l][s]),n,o);++h)d--,u--;d%=l,u%=l}return u<d&&(u+=l),{start:d,end:u,loop:f,style:t.style}}(t,e,i),g=[];let p,m,x,b=!1,_=null;const y=()=>b||l(n,x,p)&&0!==r(n,x),v=()=>!b||0===r(o,p)||l(o,x,p);for(let t=c,i=c;t<=d;++t)m=e[t%a],m.skip||(p=h(m[s]),p!==x&&(b=l(p,n,o),null===_&&y()&&(_=0===r(p,n)?t:i),null!==_&&v()&&(g.push(Ei({start:_,end:t,loop:u,count:a,style:f})),_=null),i=t,x=p));return null!==_&&g.push(Ei({start:_,end:d,loop:u,count:a,style:f})),g}function Ii(t,e){const i=[],s=t.segments;for(let n=0;n<s.length;n++){const o=Ri(s[n],t.points,e);o.length&&i.push(...o)}return i}function zi(t,e){const i=t.points,s=t.options.spanGaps,n=i.length;if(!n)return[];const o=!!t._loop,{start:a,end:r}=function(t,e,i,s){let n=0,o=e-1;if(i&&!s)for(;n<e&&!t[n].skip;)n++;for(;n<e&&t[n].skip;)n++;for(n%=e,i&&(o+=n);o>n&&t[o%e].skip;)o--;return o%=e,{start:n,end:o}}(i,n,o,s);if(!0===s)return Fi(t,[{start:a,end:r,loop:o}],i,e);return Fi(t,function(t,e,i,s){const n=t.length,o=[];let a,r=e,l=t[e];for(a=e+1;a<=i;++a){const i=t[a%n];i.skip||i.stop?l.skip||(s=!1,o.push({start:e%n,end:(a-1)%n,loop:s}),e=r=i.stop?a:null):(r=a,l.skip&&(e=a)),l=i}return null!==r&&o.push({start:e%n,end:r%n,loop:s}),o}(i,a,r<a?r+n:r,!!t._fullLoop&&0===a&&r===n-1),i,e)}function Fi(t,e,i,s){return s&&s.setContext&&i?function(t,e,i,s){const n=t._chart.getContext(),o=Vi(t.options),{_datasetIndex:a,options:{spanGaps:r}}=t,l=i.length,h=[];let c=o,d=e[0].start,u=d;function f(t,e,s,n){const o=r?-1:1;if(t!==e){for(t+=l;i[t%l].skip;)t-=o;for(;i[e%l].skip;)e+=o;t%l!=e%l&&(h.push({start:t%l,end:e%l,loop:s,style:n}),c=n,d=e%l)}}for(const t of e){d=r?d:t.start;let e,o=i[d%l];for(u=d+1;u<=t.end;u++){const r=i[u%l];e=Vi(s.setContext(Ci(n,{type:"segment",p0:o,p1:r,p0DataIndex:(u-1)%l,p1DataIndex:u%l,datasetIndex:a}))),Bi(e,c)&&f(d,u-1,t.loop,c),o=r,c=e}d<u-1&&f(d,u-1,t.loop,c)}return h}(t,e,i,s):e}function Vi(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function Bi(t,e){if(!e)return!1;const i=[],s=function(t,e){return Zt(e)?(i.includes(e)||i.push(e),i.indexOf(e)):e};return JSON.stringify(t,s)!==JSON.stringify(e,s)}function Wi(t,e,i){return t.options.clip?t[i]:e[i]}function Ni(t,e){const i=e._clip;if(i.disabled)return!1;const s=function(t,e){const{xScale:i,yScale:s}=t;return i&&s?{left:Wi(i,e,"left"),right:Wi(i,e,"right"),top:Wi(s,e,"top"),bottom:Wi(s,e,"bottom")}:e}(e,t.chartArea);return{left:!1===i.left?0:s.left-(!0===i.left?0:i.left),right:!1===i.right?t.width:s.right+(!0===i.right?0:i.right),top:!1===i.top?0:s.top-(!0===i.top?0:i.top),bottom:!1===i.bottom?t.height:s.bottom+(!0===i.bottom?0:i.bottom)}}var Hi=Object.freeze({__proto__:null,HALF_PI:E,INFINITY:T,PI:C,PITAU:A,QUARTER_PI:R,RAD_PER_DEG:L,TAU:O,TWO_THIRDS_PI:I,_addGrace:Di,_alignPixel:Ae,_alignStartEnd:ft,_angleBetween:J,_angleDiff:K,_arrayUnique:lt,_attachContext:$e,_bezierCurveTo:Ve,_bezierInterpolation:mi,_boundSegment:Ri,_boundSegments:Ii,_capitalize:w,_computeSegments:zi,_createResolver:je,_decimalPlaces:U,_deprecated:function(t,e,i,s){void 0!==e&&console.warn(t+': "'+i+'" is deprecated. Please use "'+s+'" instead')},_descriptors:Ye,_elementsEqual:f,_factorize:W,_filterBetween:nt,_getParentNode:ge,_getStartAndCountOfVisiblePoints:pt,_int16Range:Q,_isBetween:tt,_isClickEvent:D,_isDomSupported:fe,_isPointInArea:Re,_limitValue:Z,_longestText:Oe,_lookup:et,_lookupByKey:it,_measureText:Ce,_merger:m,_mergerIf:_,_normalizeAngle:G,_parseObjectDataRadialScale:ii,_pointInLine:gi,_readValueToProps:vi,_rlookupByKey:st,_scaleRangesChanged:mt,_setMinAndMaxByKey:j,_splitKey:v,_steppedInterpolation:pi,_steppedLineTo:Fe,_textX:gt,_toLeftRightCenter:ut,_updateBezierControlPoints:hi,addRoundedRectPath:He,almostEquals:V,almostWhole:H,callback:d,clearCanvas:Te,clipArea:Ie,clone:g,color:Qt,createContext:Ci,debounce:dt,defined:k,distanceBetweenPoints:q,drawPoint:Le,drawPointLegend:Ee,each:u,easingEffects:fi,finiteOrDefault:r,fontString:function(t,e,i){return e+" "+t+"px "+i},formatNumber:ne,getAngleFromPoint:X,getDatasetClipArea:Ni,getHoverColor:te,getMaximumSize:we,getRelativePosition:ve,getRtlAdapter:Oi,getStyle:xe,isArray:n,isFinite:a,isFunction:S,isNullOrUndef:s,isNumber:N,isObject:o,isPatternOrGradient:Zt,listenArrayEvents:at,log10:z,merge:x,mergeIf:b,niceNum:B,noop:e,overrideTextDirection:Ai,readUsedSize:Pe,renderText:Ne,requestAnimFrame:ht,resolve:Pi,resolveObjectKey:M,restoreTextDirection:Ti,retinaScale:ke,setsEqual:P,sign:F,splineCurve:ai,splineCurveMonotone:ri,supportsEventListenerOptions:Se,throttled:ct,toDegrees:Y,toDimension:c,toFont:Si,toFontString:De,toLineHeight:_i,toPadding:ki,toPercentage:h,toRadians:$,toTRBL:Mi,toTRBLCorners:wi,uid:i,unclipArea:ze,unlistenArrayEvents:rt,valueOrDefault:l});function ji(t,e,i,n){const{controller:o,data:a,_sorted:r}=t,l=o._cachedMeta.iScale,h=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null;if(l&&e===l.axis&&"r"!==e&&r&&a.length){const r=l._reversePixels?st:it;if(!n){const n=r(a,e,i);if(h){const{vScale:e}=o._cachedMeta,{_parsed:i}=t,a=i.slice(0,n.lo+1).reverse().findIndex((t=>!s(t[e.axis])));n.lo-=Math.max(0,a);const r=i.slice(n.hi).findIndex((t=>!s(t[e.axis])));n.hi+=Math.max(0,r)}return n}if(o._sharedOptions){const t=a[0],s="function"==typeof t.getRange&&t.getRange(e);if(s){const t=r(a,e,i-s),n=r(a,e,i+s);return{lo:t.lo,hi:n.hi}}}}return{lo:0,hi:a.length-1}}function $i(t,e,i,s,n){const o=t.getSortedVisibleDatasetMetas(),a=i[e];for(let t=0,i=o.length;t<i;++t){const{index:i,data:r}=o[t],{lo:l,hi:h}=ji(o[t],e,a,n);for(let t=l;t<=h;++t){const e=r[t];e.skip||s(e,i,t)}}}function Yi(t,e,i,s,n){const o=[];if(!n&&!t.isPointInArea(e))return o;return $i(t,i,e,(function(i,a,r){(n||Re(i,t.chartArea,0))&&i.inRange(e.x,e.y,s)&&o.push({element:i,datasetIndex:a,index:r})}),!0),o}function Ui(t,e,i,s,n,o){let a=[];const r=function(t){const e=-1!==t.indexOf("x"),i=-1!==t.indexOf("y");return function(t,s){const n=e?Math.abs(t.x-s.x):0,o=i?Math.abs(t.y-s.y):0;return Math.sqrt(Math.pow(n,2)+Math.pow(o,2))}}(i);let l=Number.POSITIVE_INFINITY;return $i(t,i,e,(function(i,h,c){const d=i.inRange(e.x,e.y,n);if(s&&!d)return;const u=i.getCenterPoint(n);if(!(!!o||t.isPointInArea(u))&&!d)return;const f=r(e,u);f<l?(a=[{element:i,datasetIndex:h,index:c}],l=f):f===l&&a.push({element:i,datasetIndex:h,index:c})})),a}function Xi(t,e,i,s,n,o){return o||t.isPointInArea(e)?"r"!==i||s?Ui(t,e,i,s,n,o):function(t,e,i,s){let n=[];return $i(t,i,e,(function(t,i,o){const{startAngle:a,endAngle:r}=t.getProps(["startAngle","endAngle"],s),{angle:l}=X(t,{x:e.x,y:e.y});J(l,a,r)&&n.push({element:t,datasetIndex:i,index:o})})),n}(t,e,i,n):[]}function qi(t,e,i,s,n){const o=[],a="x"===i?"inXRange":"inYRange";let r=!1;return $i(t,i,e,((t,s,l)=>{t[a]&&t[a](e[i],n)&&(o.push({element:t,datasetIndex:s,index:l}),r=r||t.inRange(e.x,e.y,n))})),s&&!r?[]:o}var Ki={evaluateInteractionItems:$i,modes:{index(t,e,i,s){const n=ve(e,t),o=i.axis||"x",a=i.includeInvisible||!1,r=i.intersect?Yi(t,n,o,s,a):Xi(t,n,o,!1,s,a),l=[];return r.length?(t.getSortedVisibleDatasetMetas().forEach((t=>{const e=r[0].index,i=t.data[e];i&&!i.skip&&l.push({element:i,datasetIndex:t.index,index:e})})),l):[]},dataset(t,e,i,s){const n=ve(e,t),o=i.axis||"xy",a=i.includeInvisible||!1;let r=i.intersect?Yi(t,n,o,s,a):Xi(t,n,o,!1,s,a);if(r.length>0){const e=r[0].datasetIndex,i=t.getDatasetMeta(e).data;r=[];for(let t=0;t<i.length;++t)r.push({element:i[t],datasetIndex:e,index:t})}return r},point:(t,e,i,s)=>Yi(t,ve(e,t),i.axis||"xy",s,i.includeInvisible||!1),nearest(t,e,i,s){const n=ve(e,t),o=i.axis||"xy",a=i.includeInvisible||!1;return Xi(t,n,o,i.intersect,s,a)},x:(t,e,i,s)=>qi(t,ve(e,t),"x",i.intersect,s),y:(t,e,i,s)=>qi(t,ve(e,t),"y",i.intersect,s)}};const Gi=["left","top","right","bottom"];function Ji(t,e){return t.filter((t=>t.pos===e))}function Zi(t,e){return t.filter((t=>-1===Gi.indexOf(t.pos)&&t.box.axis===e))}function Qi(t,e){return t.sort(((t,i)=>{const s=e?i:t,n=e?t:i;return s.weight===n.weight?s.index-n.index:s.weight-n.weight}))}function ts(t,e){const i=function(t){const e={};for(const i of t){const{stack:t,pos:s,stackWeight:n}=i;if(!t||!Gi.includes(s))continue;const o=e[t]||(e[t]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=n}return e}(t),{vBoxMaxWidth:s,hBoxMaxHeight:n}=e;let o,a,r;for(o=0,a=t.length;o<a;++o){r=t[o];const{fullSize:a}=r.box,l=i[r.stack],h=l&&r.stackWeight/l.weight;r.horizontal?(r.width=h?h*s:a&&e.availableWidth,r.height=n):(r.width=s,r.height=h?h*n:a&&e.availableHeight)}return i}function es(t,e,i,s){return Math.max(t[i],e[i])+Math.max(t[s],e[s])}function is(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function ss(t,e,i,s){const{pos:n,box:a}=i,r=t.maxPadding;if(!o(n)){i.size&&(t[n]-=i.size);const e=s[i.stack]||{size:0,count:1};e.size=Math.max(e.size,i.horizontal?a.height:a.width),i.size=e.size/e.count,t[n]+=i.size}a.getPadding&&is(r,a.getPadding());const l=Math.max(0,e.outerWidth-es(r,t,"left","right")),h=Math.max(0,e.outerHeight-es(r,t,"top","bottom")),c=l!==t.w,d=h!==t.h;return t.w=l,t.h=h,i.horizontal?{same:c,other:d}:{same:d,other:c}}function ns(t,e){const i=e.maxPadding;function s(t){const s={left:0,top:0,right:0,bottom:0};return t.forEach((t=>{s[t]=Math.max(e[t],i[t])})),s}return s(t?["left","right"]:["top","bottom"])}function os(t,e,i,s){const n=[];let o,a,r,l,h,c;for(o=0,a=t.length,h=0;o<a;++o){r=t[o],l=r.box,l.update(r.width||e.w,r.height||e.h,ns(r.horizontal,e));const{same:a,other:d}=ss(e,i,r,s);h|=a&&n.length,c=c||d,l.fullSize||n.push(r)}return h&&os(n,e,i,s)||c}function as(t,e,i,s,n){t.top=i,t.left=e,t.right=e+s,t.bottom=i+n,t.width=s,t.height=n}function rs(t,e,i,s){const n=i.padding;let{x:o,y:a}=e;for(const r of t){const t=r.box,l=s[r.stack]||{count:1,placed:0,weight:1},h=r.stackWeight/l.weight||1;if(r.horizontal){const s=e.w*h,o=l.size||t.height;k(l.start)&&(a=l.start),t.fullSize?as(t,n.left,a,i.outerWidth-n.right-n.left,o):as(t,e.left+l.placed,a,s,o),l.start=a,l.placed+=s,a=t.bottom}else{const s=e.h*h,a=l.size||t.width;k(l.start)&&(o=l.start),t.fullSize?as(t,o,n.top,a,i.outerHeight-n.bottom-n.top):as(t,o,e.top+l.placed,a,s),l.start=o,l.placed+=s,o=t.right}}e.x=o,e.y=a}var ls={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},t.boxes.push(e)},removeBox(t,e){const i=t.boxes?t.boxes.indexOf(e):-1;-1!==i&&t.boxes.splice(i,1)},configure(t,e,i){e.fullSize=i.fullSize,e.position=i.position,e.weight=i.weight},update(t,e,i,s){if(!t)return;const n=ki(t.options.layout.padding),o=Math.max(e-n.width,0),a=Math.max(i-n.height,0),r=function(t){const e=function(t){const e=[];let i,s,n,o,a,r;for(i=0,s=(t||[]).length;i<s;++i)n=t[i],({position:o,options:{stack:a,stackWeight:r=1}}=n),e.push({index:i,box:n,pos:o,horizontal:n.isHorizontal(),weight:n.weight,stack:a&&o+a,stackWeight:r});return e}(t),i=Qi(e.filter((t=>t.box.fullSize)),!0),s=Qi(Ji(e,"left"),!0),n=Qi(Ji(e,"right")),o=Qi(Ji(e,"top"),!0),a=Qi(Ji(e,"bottom")),r=Zi(e,"x"),l=Zi(e,"y");return{fullSize:i,leftAndTop:s.concat(o),rightAndBottom:n.concat(l).concat(a).concat(r),chartArea:Ji(e,"chartArea"),vertical:s.concat(n).concat(l),horizontal:o.concat(a).concat(r)}}(t.boxes),l=r.vertical,h=r.horizontal;u(t.boxes,(t=>{"function"==typeof t.beforeLayout&&t.beforeLayout()}));const c=l.reduce(((t,e)=>e.box.options&&!1===e.box.options.display?t:t+1),0)||1,d=Object.freeze({outerWidth:e,outerHeight:i,padding:n,availableWidth:o,availableHeight:a,vBoxMaxWidth:o/2/c,hBoxMaxHeight:a/2}),f=Object.assign({},n);is(f,ki(s));const g=Object.assign({maxPadding:f,w:o,h:a,x:n.left,y:n.top},n),p=ts(l.concat(h),d);os(r.fullSize,g,d,p),os(l,g,d,p),os(h,g,d,p)&&os(l,g,d,p),function(t){const e=t.maxPadding;function i(i){const s=Math.max(e[i]-t[i],0);return t[i]+=s,s}t.y+=i("top"),t.x+=i("left"),i("right"),i("bottom")}(g),rs(r.leftAndTop,g,d,p),g.x+=g.w,g.y+=g.h,rs(r.rightAndBottom,g,d,p),t.chartArea={left:g.left,top:g.top,right:g.left+g.w,bottom:g.top+g.h,height:g.h,width:g.w},u(r.chartArea,(e=>{const i=e.box;Object.assign(i,t.chartArea),i.update(g.w,g.h,{left:0,top:0,right:0,bottom:0})}))}};class hs{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,s){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,s?Math.floor(e/s):i)}}isAttached(t){return!0}updateConfig(t){}}class cs extends hs{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const ds="$chartjs",us={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},fs=t=>null===t||""===t;const gs=!!Se&&{passive:!0};function ps(t,e,i){t&&t.canvas&&t.canvas.removeEventListener(e,i,gs)}function ms(t,e){for(const i of t)if(i===e||i.contains(e))return!0}function xs(t,e,i){const s=t.canvas,n=new MutationObserver((t=>{let e=!1;for(const i of t)e=e||ms(i.addedNodes,s),e=e&&!ms(i.removedNodes,s);e&&i()}));return n.observe(document,{childList:!0,subtree:!0}),n}function bs(t,e,i){const s=t.canvas,n=new MutationObserver((t=>{let e=!1;for(const i of t)e=e||ms(i.removedNodes,s),e=e&&!ms(i.addedNodes,s);e&&i()}));return n.observe(document,{childList:!0,subtree:!0}),n}const _s=new Map;let ys=0;function vs(){const t=window.devicePixelRatio;t!==ys&&(ys=t,_s.forEach(((e,i)=>{i.currentDevicePixelRatio!==t&&e()})))}function Ms(t,e,i){const s=t.canvas,n=s&&ge(s);if(!n)return;const o=ct(((t,e)=>{const s=n.clientWidth;i(t,e),s<n.clientWidth&&i()}),window),a=new ResizeObserver((t=>{const e=t[0],i=e.contentRect.width,s=e.contentRect.height;0===i&&0===s||o(i,s)}));return a.observe(n),function(t,e){_s.size||window.addEventListener("resize",vs),_s.set(t,e)}(t,o),a}function ws(t,e,i){i&&i.disconnect(),"resize"===e&&function(t){_s.delete(t),_s.size||window.removeEventListener("resize",vs)}(t)}function ks(t,e,i){const s=t.canvas,n=ct((e=>{null!==t.ctx&&i(function(t,e){const i=us[t.type]||t.type,{x:s,y:n}=ve(t,e);return{type:i,chart:e,native:t,x:void 0!==s?s:null,y:void 0!==n?n:null}}(e,t))}),t);return function(t,e,i){t&&t.addEventListener(e,i,gs)}(s,e,n),n}class Ss extends hs{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(function(t,e){const i=t.style,s=t.getAttribute("height"),n=t.getAttribute("width");if(t[ds]={initial:{height:s,width:n,style:{display:i.display,height:i.height,width:i.width}}},i.display=i.display||"block",i.boxSizing=i.boxSizing||"border-box",fs(n)){const e=Pe(t,"width");void 0!==e&&(t.width=e)}if(fs(s))if(""===t.style.height)t.height=t.width/(e||2);else{const e=Pe(t,"height");void 0!==e&&(t.height=e)}}(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e[ds])return!1;const i=e[ds].initial;["height","width"].forEach((t=>{const n=i[t];s(n)?e.removeAttribute(t):e.setAttribute(t,n)}));const n=i.style||{};return Object.keys(n).forEach((t=>{e.style[t]=n[t]})),e.width=e.width,delete e[ds],!0}addEventListener(t,e,i){this.removeEventListener(t,e);const s=t.$proxies||(t.$proxies={}),n={attach:xs,detach:bs,resize:Ms}[e]||ks;s[e]=n(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),s=i[e];if(!s)return;({attach:ws,detach:ws,resize:ws}[e]||ps)(t,e,s),i[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,s){return we(t,e,i,s)}isAttached(t){const e=t&&ge(t);return!(!e||!e.isConnected)}}function Ps(t){return!fe()||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas?cs:Ss}var Ds=Object.freeze({__proto__:null,BasePlatform:hs,BasicPlatform:cs,DomPlatform:Ss,_detectPlatform:Ps});const Cs="transparent",Os={boolean:(t,e,i)=>i>.5?e:t,color(t,e,i){const s=Qt(t||Cs),n=s.valid&&Qt(e||Cs);return n&&n.valid?n.mix(s,i).hexString():e},number:(t,e,i)=>t+(e-t)*i};class As{constructor(t,e,i,s){const n=e[i];s=Pi([t.to,s,n,t.from]);const o=Pi([t.from,n,s]);this._active=!0,this._fn=t.fn||Os[t.type||typeof o],this._easing=fi[t.easing]||fi.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=o,this._to=s,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const s=this._target[this._prop],n=i-this._start,o=this._duration-n;this._start=i,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=n,this._loop=!!t.loop,this._to=Pi([t.to,e,s,t.from]),this._from=Pi([t.from,s,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,s=this._prop,n=this._from,o=this._loop,a=this._to;let r;if(this._active=n!==a&&(o||e<i),!this._active)return this._target[s]=a,void this._notify(!0);e<0?this._target[s]=n:(r=e/i%2,r=o&&r>1?2-r:r,r=this._easing(Math.min(1,Math.max(0,r))),this._target[s]=this._fn(n,a,r))}wait(){const t=this._promises||(this._promises=[]);return new Promise(((e,i)=>{t.push({res:e,rej:i})}))}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let t=0;t<i.length;t++)i[t][e]()}}class Ts{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!o(t))return;const e=Object.keys(ue.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach((s=>{const a=t[s];if(!o(a))return;const r={};for(const t of e)r[t]=a[t];(n(a.properties)&&a.properties||[s]).forEach((t=>{t!==s&&i.has(t)||i.set(t,r)}))}))}_animateOptions(t,e){const i=e.options,s=function(t,e){if(!e)return;let i=t.options;if(!i)return void(t.options=e);i.$shared&&(t.options=i=Object.assign({},i,{$shared:!1,$animations:{}}));return i}(t,i);if(!s)return[];const n=this._createAnimations(s,i);return i.$shared&&function(t,e){const i=[],s=Object.keys(e);for(let e=0;e<s.length;e++){const n=t[s[e]];n&&n.active()&&i.push(n.wait())}return Promise.all(i)}(t.options.$animations,i).then((()=>{t.options=i}),(()=>{})),n}_createAnimations(t,e){const i=this._properties,s=[],n=t.$animations||(t.$animations={}),o=Object.keys(e),a=Date.now();let r;for(r=o.length-1;r>=0;--r){const l=o[r];if("$"===l.charAt(0))continue;if("options"===l){s.push(...this._animateOptions(t,e));continue}const h=e[l];let c=n[l];const d=i.get(l);if(c){if(d&&c.active()){c.update(d,h,a);continue}c.cancel()}d&&d.duration?(n[l]=c=new As(d,t,l,h),s.push(c)):t[l]=h}return s}update(t,e){if(0===this._properties.size)return void Object.assign(t,e);const i=this._createAnimations(t,e);return i.length?(bt.add(this._chart,i),!0):void 0}}function Ls(t,e){const i=t&&t.options||{},s=i.reverse,n=void 0===i.min?e:0,o=void 0===i.max?e:0;return{start:s?o:n,end:s?n:o}}function Es(t,e){const i=[],s=t._getSortedDatasetMetas(e);let n,o;for(n=0,o=s.length;n<o;++n)i.push(s[n].index);return i}function Rs(t,e,i,s={}){const n=t.keys,o="single"===s.mode;let r,l,h,c;if(null===e)return;let d=!1;for(r=0,l=n.length;r<l;++r){if(h=+n[r],h===i){if(d=!0,s.all)continue;break}c=t.values[h],a(c)&&(o||0===e||F(e)===F(c))&&(e+=c)}return d||s.all?e:0}function Is(t,e){const i=t&&t.options.stacked;return i||void 0===i&&void 0!==e.stack}function zs(t,e,i){const s=t[e]||(t[e]={});return s[i]||(s[i]={})}function Fs(t,e,i,s){for(const n of e.getMatchingVisibleMetas(s).reverse()){const e=t[n.index];if(i&&e>0||!i&&e<0)return n.index}return null}function Vs(t,e){const{chart:i,_cachedMeta:s}=t,n=i._stacks||(i._stacks={}),{iScale:o,vScale:a,index:r}=s,l=o.axis,h=a.axis,c=function(t,e,i){return`${t.id}.${e.id}.${i.stack||i.type}`}(o,a,s),d=e.length;let u;for(let t=0;t<d;++t){const i=e[t],{[l]:o,[h]:d}=i;u=(i._stacks||(i._stacks={}))[h]=zs(n,c,o),u[r]=d,u._top=Fs(u,a,!0,s.type),u._bottom=Fs(u,a,!1,s.type);(u._visualValues||(u._visualValues={}))[r]=d}}function Bs(t,e){const i=t.scales;return Object.keys(i).filter((t=>i[t].axis===e)).shift()}function Ws(t,e){const i=t.controller.index,s=t.vScale&&t.vScale.axis;if(s){e=e||t._parsed;for(const t of e){const e=t._stacks;if(!e||void 0===e[s]||void 0===e[s][i])return;delete e[s][i],void 0!==e[s]._visualValues&&void 0!==e[s]._visualValues[i]&&delete e[s]._visualValues[i]}}}const Ns=t=>"reset"===t||"none"===t,Hs=(t,e)=>e?t:Object.assign({},t);class js{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=Is(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&Ws(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),s=(t,e,i,s)=>"x"===t?e:"r"===t?s:i,n=e.xAxisID=l(i.xAxisID,Bs(t,"x")),o=e.yAxisID=l(i.yAxisID,Bs(t,"y")),a=e.rAxisID=l(i.rAxisID,Bs(t,"r")),r=e.indexAxis,h=e.iAxisID=s(r,n,o,a),c=e.vAxisID=s(r,o,n,a);e.xScale=this.getScaleForId(n),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(h),e.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&rt(this._data,this),t._stacked&&Ws(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(o(e)){const t=this._cachedMeta;this._data=function(t,e){const{iScale:i,vScale:s}=e,n="x"===i.axis?"x":"y",o="x"===s.axis?"x":"y",a=Object.keys(t),r=new Array(a.length);let l,h,c;for(l=0,h=a.length;l<h;++l)c=a[l],r[l]={[n]:c,[o]:t[c]};return r}(e,t)}else if(i!==e){if(i){rt(i,this);const t=this._cachedMeta;Ws(t),t._parsed=[]}e&&Object.isExtensible(e)&&at(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let s=!1;this._dataCheck();const n=e._stacked;e._stacked=Is(e.vScale,e),e.stack!==i.stack&&(s=!0,Ws(e),e.stack=i.stack),this._resyncElements(t),(s||n!==e._stacked)&&(Vs(this,e._parsed),e._stacked=Is(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:s}=this,{iScale:a,_stacked:r}=i,l=a.axis;let h,c,d,u=0===t&&e===s.length||i._sorted,f=t>0&&i._parsed[t-1];if(!1===this._parsing)i._parsed=s,i._sorted=!0,d=s;else{d=n(s[t])?this.parseArrayData(i,s,t,e):o(s[t])?this.parseObjectData(i,s,t,e):this.parsePrimitiveData(i,s,t,e);const a=()=>null===c[l]||f&&c[l]<f[l];for(h=0;h<e;++h)i._parsed[h+t]=c=d[h],u&&(a()&&(u=!1),f=c);i._sorted=u}r&&Vs(this,d)}parsePrimitiveData(t,e,i,s){const{iScale:n,vScale:o}=t,a=n.axis,r=o.axis,l=n.getLabels(),h=n===o,c=new Array(s);let d,u,f;for(d=0,u=s;d<u;++d)f=d+i,c[d]={[a]:h||n.parse(l[f],f),[r]:o.parse(e[f],f)};return c}parseArrayData(t,e,i,s){const{xScale:n,yScale:o}=t,a=new Array(s);let r,l,h,c;for(r=0,l=s;r<l;++r)h=r+i,c=e[h],a[r]={x:n.parse(c[0],h),y:o.parse(c[1],h)};return a}parseObjectData(t,e,i,s){const{xScale:n,yScale:o}=t,{xAxisKey:a="x",yAxisKey:r="y"}=this._parsing,l=new Array(s);let h,c,d,u;for(h=0,c=s;h<c;++h)d=h+i,u=e[d],l[h]={x:n.parse(M(u,a),d),y:o.parse(M(u,r),d)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const s=this.chart,n=this._cachedMeta,o=e[t.axis];return Rs({keys:Es(s,!0),values:e._stacks[t.axis]._visualValues},o,n.index,{mode:i})}updateRangeFromParsed(t,e,i,s){const n=i[e.axis];let o=null===n?NaN:n;const a=s&&i._stacks[e.axis];s&&a&&(s.values=a,o=Rs(s,n,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const i=this._cachedMeta,s=i._parsed,n=i._sorted&&t===i.iScale,o=s.length,r=this._getOtherScale(t),l=((t,e,i)=>t&&!e.hidden&&e._stacked&&{keys:Es(i,!0),values:null})(e,i,this.chart),h={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:d}=function(t){const{min:e,max:i,minDefined:s,maxDefined:n}=t.getUserBounds();return{min:s?e:Number.NEGATIVE_INFINITY,max:n?i:Number.POSITIVE_INFINITY}}(r);let u,f;function g(){f=s[u];const e=f[r.axis];return!a(f[t.axis])||c>e||d<e}for(u=0;u<o&&(g()||(this.updateRangeFromParsed(h,t,f,l),!n));++u);if(n)for(u=o-1;u>=0;--u)if(!g()){this.updateRangeFromParsed(h,t,f,l);break}return h}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let s,n,o;for(s=0,n=e.length;s<n;++s)o=e[s][t.axis],a(o)&&i.push(o);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,s=e.vScale,n=this.getParsed(t);return{label:i?""+i.getLabelForValue(n[i.axis]):"",value:s?""+s.getLabelForValue(n[s.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=function(t){let e,i,s,n;return o(t)?(e=t.top,i=t.right,s=t.bottom,n=t.left):e=i=s=n=t,{top:e,right:i,bottom:s,left:n,disabled:!1===t}}(l(this.options.clip,function(t,e,i){if(!1===i)return!1;const s=Ls(t,i),n=Ls(e,i);return{top:n.end,right:s.end,bottom:n.start,left:s.start}}(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,s=i.data||[],n=e.chartArea,o=[],a=this._drawStart||0,r=this._drawCount||s.length-a,l=this.options.drawActiveElementsOnTop;let h;for(i.dataset&&i.dataset.draw(t,n,a,r),h=a;h<a+r;++h){const e=s[h];e.hidden||(e.active&&l?o.push(e):e.draw(t,n))}for(h=0;h<o.length;++h)o[h].draw(t,n)}getStyle(t,e){const i=e?"active":"default";return void 0===t&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const s=this.getDataset();let n;if(t>=0&&t<this._cachedMeta.data.length){const e=this._cachedMeta.data[t];n=e.$context||(e.$context=function(t,e,i){return Ci(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:i,index:e,mode:"default",type:"data"})}(this.getContext(),t,e)),n.parsed=this.getParsed(t),n.raw=s.data[t],n.index=n.dataIndex=t}else n=this.$context||(this.$context=function(t,e){return Ci(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),n.dataset=s,n.index=n.datasetIndex=this.index;return n.active=!!e,n.mode=i,n}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const s="active"===e,n=this._cachedDataOpts,o=t+"-"+e,a=n[o],r=this.enableOptionSharing&&k(i);if(a)return Hs(a,r);const l=this.chart.config,h=l.datasetElementScopeKeys(this._type,t),c=s?[`${t}Hover`,"hover",t,""]:[t,""],d=l.getOptionScopes(this.getDataset(),h),u=Object.keys(ue.elements[t]),f=l.resolveNamedOptions(d,u,(()=>this.getContext(i,s,e)),c);return f.$shared&&(f.$shared=r,n[o]=Object.freeze(Hs(f,r))),f}_resolveAnimations(t,e,i){const s=this.chart,n=this._cachedDataOpts,o=`animation-${e}`,a=n[o];if(a)return a;let r;if(!1!==s.options.animation){const s=this.chart.config,n=s.datasetAnimationScopeKeys(this._type,e),o=s.getOptionScopes(this.getDataset(),n);r=s.createResolver(o,this.getContext(t,i,e))}const l=new Ts(s,r&&r.animations);return r&&r._cacheable&&(n[o]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||Ns(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),s=this._sharedOptions,n=this.getSharedOptions(i),o=this.includeOptions(e,n)||n!==s;return this.updateSharedOptions(n,e,i),{sharedOptions:n,includeOptions:o}}updateElement(t,e,i,s){Ns(s)?Object.assign(t,i):this._resolveAnimations(e,s).update(t,i)}updateSharedOptions(t,e,i){t&&!Ns(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,s){t.active=s;const n=this.getStyle(e,s);this._resolveAnimations(e,i,s).update(t,{options:!s&&this.getSharedOptions(n)||n})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[t,e,i]of this._syncList)this[t](e,i);this._syncList=[];const s=i.length,n=e.length,o=Math.min(n,s);o&&this.parse(0,o),n>s?this._insertElements(s,n-s,t):n<s&&this._removeElements(n,s-n)}_insertElements(t,e,i=!0){const s=this._cachedMeta,n=s.data,o=t+e;let a;const r=t=>{for(t.length+=e,a=t.length-1;a>=o;a--)t[a]=t[a-e]};for(r(n),a=t;a<o;++a)n[a]=new this.dataElementType;this._parsing&&r(s._parsed),this.parse(t,e),i&&this.updateElements(n,t,e,"reset")}updateElements(t,e,i,s){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const s=i._parsed.splice(t,e);i._stacked&&Ws(i,s)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,s]=t;this[e](i,s)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}class $s{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return N(this.x)&&N(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const s={};return t.forEach((t=>{s[t]=i[t]&&i[t].active()?i[t]._to:this[t]})),s}}function Ys(t,e){const i=t.options.ticks,n=function(t){const e=t.options.offset,i=t._tickSize(),s=t._length/i+(e?0:1),n=t._maxLength/i;return Math.floor(Math.min(s,n))}(t),o=Math.min(i.maxTicksLimit||n,n),a=i.major.enabled?function(t){const e=[];let i,s;for(i=0,s=t.length;i<s;i++)t[i].major&&e.push(i);return e}(e):[],r=a.length,l=a[0],h=a[r-1],c=[];if(r>o)return function(t,e,i,s){let n,o=0,a=i[0];for(s=Math.ceil(s),n=0;n<t.length;n++)n===a&&(e.push(t[n]),o++,a=i[o*s])}(e,c,a,r/o),c;const d=function(t,e,i){const s=function(t){const e=t.length;let i,s;if(e<2)return!1;for(s=t[0],i=1;i<e;++i)if(t[i]-t[i-1]!==s)return!1;return s}(t),n=e.length/i;if(!s)return Math.max(n,1);const o=W(s);for(let t=0,e=o.length-1;t<e;t++){const e=o[t];if(e>n)return e}return Math.max(n,1)}(a,e,o);if(r>0){let t,i;const n=r>1?Math.round((h-l)/(r-1)):null;for(Us(e,c,d,s(n)?0:l-n,l),t=0,i=r-1;t<i;t++)Us(e,c,d,a[t],a[t+1]);return Us(e,c,d,h,s(n)?e.length:h+n),c}return Us(e,c,d),c}function Us(t,e,i,s,n){const o=l(s,0),a=Math.min(l(n,t.length),t.length);let r,h,c,d=0;for(i=Math.ceil(i),n&&(r=n-s,i=r/Math.floor(r/i)),c=o;c<0;)d++,c=Math.round(o+d*i);for(h=Math.max(o,0);h<a;h++)h===c&&(e.push(t[h]),d++,c=Math.round(o+d*i))}const Xs=(t,e,i)=>"top"===e||"left"===e?t[e]+i:t[e]-i,qs=(t,e)=>Math.min(e||t,t);function Ks(t,e){const i=[],s=t.length/e,n=t.length;let o=0;for(;o<n;o+=s)i.push(t[Math.floor(o)]);return i}function Gs(t,e,i){const s=t.ticks.length,n=Math.min(e,s-1),o=t._startPixel,a=t._endPixel,r=1e-6;let l,h=t.getPixelForTick(n);if(!(i&&(l=1===s?Math.max(h-o,a-h):0===e?(t.getPixelForTick(1)-h)/2:(h-t.getPixelForTick(n-1))/2,h+=n<e?l:-l,h<o-r||h>a+r)))return h}function Js(t){return t.drawTicks?t.tickLength:0}function Zs(t,e){if(!t.display)return 0;const i=Si(t.font,e),s=ki(t.padding);return(n(t.text)?t.text.length:1)*i.lineHeight+s.height}function Qs(t,e,i){let s=ut(t);return(i&&"right"!==e||!i&&"right"===e)&&(s=(t=>"left"===t?"right":"right"===t?"left":t)(s)),s}class tn extends $s{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:s}=this;return t=r(t,Number.POSITIVE_INFINITY),e=r(e,Number.NEGATIVE_INFINITY),i=r(i,Number.POSITIVE_INFINITY),s=r(s,Number.NEGATIVE_INFINITY),{min:r(t,i),max:r(e,s),minDefined:a(t),maxDefined:a(e)}}getMinMax(t){let e,{min:i,max:s,minDefined:n,maxDefined:o}=this.getUserBounds();if(n&&o)return{min:i,max:s};const a=this.getMatchingVisibleMetas();for(let r=0,l=a.length;r<l;++r)e=a[r].controller.getMinMax(this,t),n||(i=Math.min(i,e.min)),o||(s=Math.max(s,e.max));return i=o&&i>s?s:i,s=n&&i>s?i:s,{min:r(i,r(s,i)),max:r(s,r(i,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){d(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:s,grace:n,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Di(this,n,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const r=a<this.ticks.length;this._convertTicksToLabels(r?Ks(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||"auto"===o.source)&&(this.ticks=Ys(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),r&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t,e,i=this.options.reverse;this.isHorizontal()?(t=this.left,e=this.right):(t=this.top,e=this.bottom,i=!i),this._startPixel=t,this._endPixel=e,this._reversePixels=i,this._length=e-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){d(this.options.afterUpdate,[this])}beforeSetDimensions(){d(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){d(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),d(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){d(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,s,n;for(i=0,s=t.length;i<s;i++)n=t[i],n.label=d(e.callback,[n.value,i,t],this)}afterTickToLabelConversion(){d(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){d(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=qs(this.ticks.length,t.ticks.maxTicksLimit),s=e.minRotation||0,n=e.maxRotation;let o,a,r,l=s;if(!this._isVisible()||!e.display||s>=n||i<=1||!this.isHorizontal())return void(this.labelRotation=s);const h=this._getLabelSizes(),c=h.widest.width,d=h.highest.height,u=Z(this.chart.width-c,0,this.maxWidth);o=t.offset?this.maxWidth/i:u/(i-1),c+6>o&&(o=u/(i-(t.offset?.5:1)),a=this.maxHeight-Js(t.grid)-e.padding-Zs(t.title,this.chart.options.font),r=Math.sqrt(c*c+d*d),l=Y(Math.min(Math.asin(Z((h.highest.height+6)/o,-1,1)),Math.asin(Z(a/r,-1,1))-Math.asin(Z(d/r,-1,1)))),l=Math.max(s,Math.min(n,l))),this.labelRotation=l}afterCalculateLabelRotation(){d(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){d(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:s,grid:n}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const o=Zs(s,e.options.font);if(a?(t.width=this.maxWidth,t.height=Js(n)+o):(t.height=this.maxHeight,t.width=Js(n)+o),i.display&&this.ticks.length){const{first:e,last:s,widest:n,highest:o}=this._getLabelSizes(),r=2*i.padding,l=$(this.labelRotation),h=Math.cos(l),c=Math.sin(l);if(a){const e=i.mirror?0:c*n.width+h*o.height;t.height=Math.min(this.maxHeight,t.height+e+r)}else{const e=i.mirror?0:h*n.width+c*o.height;t.width=Math.min(this.maxWidth,t.width+e+r)}this._calculatePadding(e,s,c,h)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,s){const{ticks:{align:n,padding:o},position:a}=this.options,r=0!==this.labelRotation,l="top"!==a&&"x"===this.axis;if(this.isHorizontal()){const a=this.getPixelForTick(0)-this.left,h=this.right-this.getPixelForTick(this.ticks.length-1);let c=0,d=0;r?l?(c=s*t.width,d=i*e.height):(c=i*t.height,d=s*e.width):"start"===n?d=e.width:"end"===n?c=t.width:"inner"!==n&&(c=t.width/2,d=e.width/2),this.paddingLeft=Math.max((c-a+o)*this.width/(this.width-a),0),this.paddingRight=Math.max((d-h+o)*this.width/(this.width-h),0)}else{let i=e.height/2,s=t.height/2;"start"===n?(i=0,s=t.height):"end"===n&&(i=e.height,s=0),this.paddingTop=i+o,this.paddingBottom=s+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){d(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return"top"===e||"bottom"===e||"x"===t}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){let e,i;for(this.beforeTickToLabelConversion(),this.generateTickLabels(t),e=0,i=t.length;e<i;e++)s(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=Ks(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,i){const{ctx:o,_longestTextCache:a}=this,r=[],l=[],h=Math.floor(e/qs(e,i));let c,d,f,g,p,m,x,b,_,y,v,M=0,w=0;for(c=0;c<e;c+=h){if(g=t[c].label,p=this._resolveTickFontOptions(c),o.font=m=p.string,x=a[m]=a[m]||{data:{},gc:[]},b=p.lineHeight,_=y=0,s(g)||n(g)){if(n(g))for(d=0,f=g.length;d<f;++d)v=g[d],s(v)||n(v)||(_=Ce(o,x.data,x.gc,_,v),y+=b)}else _=Ce(o,x.data,x.gc,_,g),y=b;r.push(_),l.push(y),M=Math.max(_,M),w=Math.max(y,w)}!function(t,e){u(t,(t=>{const i=t.gc,s=i.length/2;let n;if(s>e){for(n=0;n<s;++n)delete t.data[i[n]];i.splice(0,s)}}))}(a,e);const k=r.indexOf(M),S=l.indexOf(w),P=t=>({width:r[t]||0,height:l[t]||0});return{first:P(0),last:P(e-1),widest:P(k),highest:P(S),widths:r,heights:l}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Q(this._alignToPixels?Ae(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=function(t,e,i){return Ci(t,{tick:i,index:e,type:"tick"})}(this.getContext(),t,i))}return this.$context||(this.$context=Ci(this.chart.getContext(),{scale:this,type:"scale"}))}_tickSize(){const t=this.options.ticks,e=$(this.labelRotation),i=Math.abs(Math.cos(e)),s=Math.abs(Math.sin(e)),n=this._getLabelSizes(),o=t.autoSkipPadding||0,a=n?n.widest.width+o:0,r=n?n.highest.height+o:0;return this.isHorizontal()?r*i>a*s?a/i:r/s:r*s<a*i?r/i:a/s}_isVisible(){const t=this.options.display;return"auto"!==t?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,s=this.options,{grid:n,position:a,border:r}=s,h=n.offset,c=this.isHorizontal(),d=this.ticks.length+(h?1:0),u=Js(n),f=[],g=r.setContext(this.getContext()),p=g.display?g.width:0,m=p/2,x=function(t){return Ae(i,t,p)};let b,_,y,v,M,w,k,S,P,D,C,O;if("top"===a)b=x(this.bottom),w=this.bottom-u,S=b-m,D=x(t.top)+m,O=t.bottom;else if("bottom"===a)b=x(this.top),D=t.top,O=x(t.bottom)-m,w=b+m,S=this.top+u;else if("left"===a)b=x(this.right),M=this.right-u,k=b-m,P=x(t.left)+m,C=t.right;else if("right"===a)b=x(this.left),P=t.left,C=x(t.right)-m,M=b+m,k=this.left+u;else if("x"===e){if("center"===a)b=x((t.top+t.bottom)/2+.5);else if(o(a)){const t=Object.keys(a)[0],e=a[t];b=x(this.chart.scales[t].getPixelForValue(e))}D=t.top,O=t.bottom,w=b+m,S=w+u}else if("y"===e){if("center"===a)b=x((t.left+t.right)/2);else if(o(a)){const t=Object.keys(a)[0],e=a[t];b=x(this.chart.scales[t].getPixelForValue(e))}M=b-m,k=M-u,P=t.left,C=t.right}const A=l(s.ticks.maxTicksLimit,d),T=Math.max(1,Math.ceil(d/A));for(_=0;_<d;_+=T){const t=this.getContext(_),e=n.setContext(t),s=r.setContext(t),o=e.lineWidth,a=e.color,l=s.dash||[],d=s.dashOffset,u=e.tickWidth,g=e.tickColor,p=e.tickBorderDash||[],m=e.tickBorderDashOffset;y=Gs(this,_,h),void 0!==y&&(v=Ae(i,y,o),c?M=k=P=C=v:w=S=D=O=v,f.push({tx1:M,ty1:w,tx2:k,ty2:S,x1:P,y1:D,x2:C,y2:O,width:o,color:a,borderDash:l,borderDashOffset:d,tickWidth:u,tickColor:g,tickBorderDash:p,tickBorderDashOffset:m}))}return this._ticksLength=d,this._borderValue=b,f}_computeLabelItems(t){const e=this.axis,i=this.options,{position:s,ticks:a}=i,r=this.isHorizontal(),l=this.ticks,{align:h,crossAlign:c,padding:d,mirror:u}=a,f=Js(i.grid),g=f+d,p=u?-d:g,m=-$(this.labelRotation),x=[];let b,_,y,v,M,w,k,S,P,D,C,O,A="middle";if("top"===s)w=this.bottom-p,k=this._getXAxisLabelAlignment();else if("bottom"===s)w=this.top+p,k=this._getXAxisLabelAlignment();else if("left"===s){const t=this._getYAxisLabelAlignment(f);k=t.textAlign,M=t.x}else if("right"===s){const t=this._getYAxisLabelAlignment(f);k=t.textAlign,M=t.x}else if("x"===e){if("center"===s)w=(t.top+t.bottom)/2+g;else if(o(s)){const t=Object.keys(s)[0],e=s[t];w=this.chart.scales[t].getPixelForValue(e)+g}k=this._getXAxisLabelAlignment()}else if("y"===e){if("center"===s)M=(t.left+t.right)/2-g;else if(o(s)){const t=Object.keys(s)[0],e=s[t];M=this.chart.scales[t].getPixelForValue(e)}k=this._getYAxisLabelAlignment(f).textAlign}"y"===e&&("start"===h?A="top":"end"===h&&(A="bottom"));const T=this._getLabelSizes();for(b=0,_=l.length;b<_;++b){y=l[b],v=y.label;const t=a.setContext(this.getContext(b));S=this.getPixelForTick(b)+a.labelOffset,P=this._resolveTickFontOptions(b),D=P.lineHeight,C=n(v)?v.length:1;const e=C/2,i=t.color,o=t.textStrokeColor,h=t.textStrokeWidth;let d,f=k;if(r?(M=S,"inner"===k&&(f=b===_-1?this.options.reverse?"left":"right":0===b?this.options.reverse?"right":"left":"center"),O="top"===s?"near"===c||0!==m?-C*D+D/2:"center"===c?-T.highest.height/2-e*D+D:-T.highest.height+D/2:"near"===c||0!==m?D/2:"center"===c?T.highest.height/2-e*D:T.highest.height-C*D,u&&(O*=-1),0===m||t.showLabelBackdrop||(M+=D/2*Math.sin(m))):(w=S,O=(1-C)*D/2),t.showLabelBackdrop){const e=ki(t.backdropPadding),i=T.heights[b],s=T.widths[b];let n=O-e.top,o=0-e.left;switch(A){case"middle":n-=i/2;break;case"bottom":n-=i}switch(k){case"center":o-=s/2;break;case"right":o-=s;break;case"inner":b===_-1?o-=s:b>0&&(o-=s/2)}d={left:o,top:n,width:s+e.width,height:i+e.height,color:t.backdropColor}}x.push({label:v,font:P,textOffset:O,options:{rotation:m,color:i,strokeColor:o,strokeWidth:h,textAlign:f,textBaseline:A,translation:[M,w],backdrop:d}})}return x}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-$(this.labelRotation))return"top"===t?"left":"right";let i="center";return"start"===e.align?i="left":"end"===e.align?i="right":"inner"===e.align&&(i="inner"),i}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:s,padding:n}}=this.options,o=t+n,a=this._getLabelSizes().widest.width;let r,l;return"left"===e?s?(l=this.right+n,"near"===i?r="left":"center"===i?(r="center",l+=a/2):(r="right",l+=a)):(l=this.right-o,"near"===i?r="right":"center"===i?(r="center",l-=a/2):(r="left",l=this.left)):"right"===e?s?(l=this.left+n,"near"===i?r="right":"center"===i?(r="center",l-=a/2):(r="left",l-=a)):(l=this.left+o,"near"===i?r="left":"center"===i?(r="center",l+=a/2):(r="right",l=this.right)):r="right",{textAlign:r,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;return"left"===e||"right"===e?{top:0,left:this.left,bottom:t.height,right:this.right}:"top"===e||"bottom"===e?{top:this.top,left:0,bottom:this.bottom,right:t.width}:void 0}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:s,width:n,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,s,n,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const i=this.ticks.findIndex((e=>e.value===t));if(i>=0){return e.setContext(this.getContext(i)).lineWidth}return 0}drawGrid(t){const e=this.options.grid,i=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let n,o;const a=(t,e,s)=>{s.width&&s.color&&(i.save(),i.lineWidth=s.width,i.strokeStyle=s.color,i.setLineDash(s.borderDash||[]),i.lineDashOffset=s.borderDashOffset,i.beginPath(),i.moveTo(t.x,t.y),i.lineTo(e.x,e.y),i.stroke(),i.restore())};if(e.display)for(n=0,o=s.length;n<o;++n){const t=s[n];e.drawOnChartArea&&a({x:t.x1,y:t.y1},{x:t.x2,y:t.y2},t),e.drawTicks&&a({x:t.tx1,y:t.ty1},{x:t.tx2,y:t.ty2},{color:t.tickColor,width:t.tickWidth,borderDash:t.tickBorderDash,borderDashOffset:t.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:i,grid:s}}=this,n=i.setContext(this.getContext()),o=i.display?n.width:0;if(!o)return;const a=s.setContext(this.getContext(0)).lineWidth,r=this._borderValue;let l,h,c,d;this.isHorizontal()?(l=Ae(t,this.left,o)-o/2,h=Ae(t,this.right,a)+a/2,c=d=r):(c=Ae(t,this.top,o)-o/2,d=Ae(t,this.bottom,a)+a/2,l=h=r),e.save(),e.lineWidth=n.width,e.strokeStyle=n.color,e.beginPath(),e.moveTo(l,c),e.lineTo(h,d),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const e=this.ctx,i=this._computeLabelArea();i&&Ie(e,i);const s=this.getLabelItems(t);for(const t of s){const i=t.options,s=t.font;Ne(e,t.label,0,t.textOffset,s,i)}i&&ze(e)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:s}}=this;if(!i.display)return;const a=Si(i.font),r=ki(i.padding),l=i.align;let h=a.lineHeight/2;"bottom"===e||"center"===e||o(e)?(h+=r.bottom,n(i.text)&&(h+=a.lineHeight*(i.text.length-1))):h+=r.top;const{titleX:c,titleY:d,maxWidth:u,rotation:f}=function(t,e,i,s){const{top:n,left:a,bottom:r,right:l,chart:h}=t,{chartArea:c,scales:d}=h;let u,f,g,p=0;const m=r-n,x=l-a;if(t.isHorizontal()){if(f=ft(s,a,l),o(i)){const t=Object.keys(i)[0],s=i[t];g=d[t].getPixelForValue(s)+m-e}else g="center"===i?(c.bottom+c.top)/2+m-e:Xs(t,i,e);u=l-a}else{if(o(i)){const t=Object.keys(i)[0],s=i[t];f=d[t].getPixelForValue(s)-x+e}else f="center"===i?(c.left+c.right)/2-x+e:Xs(t,i,e);g=ft(s,r,n),p="left"===i?-E:E}return{titleX:f,titleY:g,maxWidth:u,rotation:p}}(this,h,e,l);Ne(t,i.text,0,0,a,{color:i.color,maxWidth:u,rotation:f,textAlign:Qs(l,e,s),textBaseline:"middle",translation:[c,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=l(t.grid&&t.grid.z,-1),s=l(t.border&&t.border.z,0);return this._isVisible()&&this.draw===tn.prototype.draw?[{z:i,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:e,draw:t=>{this.drawLabels(t)}}]:[{z:e,draw:t=>{this.draw(t)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",s=[];let n,o;for(n=0,o=e.length;n<o;++n){const o=e[n];o[i]!==this.id||t&&o.type!==t||s.push(o)}return s}_resolveTickFontOptions(t){return Si(this.options.ticks.setContext(this.getContext(t)).font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class en{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;(function(t){return"id"in t&&"defaults"in t})(e)&&(i=this.register(e));const s=this.items,n=t.id,o=this.scope+"."+n;if(!n)throw new Error("class does not have id: "+t);return n in s||(s[n]=t,function(t,e,i){const s=x(Object.create(null),[i?ue.get(i):{},ue.get(e),t.defaults]);ue.set(e,s),t.defaultRoutes&&function(t,e){Object.keys(e).forEach((i=>{const s=i.split("."),n=s.pop(),o=[t].concat(s).join("."),a=e[i].split("."),r=a.pop(),l=a.join(".");ue.route(o,n,l,r)}))}(e,t.defaultRoutes);t.descriptors&&ue.describe(e,t.descriptors)}(t,o,i),this.override&&ue.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,s=this.scope;i in e&&delete e[i],s&&i in ue[s]&&(delete ue[s][i],this.override&&delete re[i])}}class sn{constructor(){this.controllers=new en(js,"datasets",!0),this.elements=new en($s,"elements"),this.plugins=new en(Object,"plugins"),this.scales=new en(tn,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach((e=>{const s=i||this._getRegistryForType(e);i||s.isForType(e)||s===this.plugins&&e.id?this._exec(t,s,e):u(e,(e=>{const s=i||this._getRegistryForType(e);this._exec(t,s,e)}))}))}_exec(t,e,i){const s=w(t);d(i["before"+s],[],i),e[t](i),d(i["after"+s],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const s=e.get(t);if(void 0===s)throw new Error('"'+t+'" is not a registered '+i+".");return s}}var nn=new sn;class on{constructor(){this._init=void 0}notify(t,e,i,s){if("beforeInit"===e&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),void 0===this._init)return;const n=s?this._descriptors(t).filter(s):this._descriptors(t),o=this._notify(n,t,e,i);return"afterDestroy"===e&&(this._notify(n,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),o}_notify(t,e,i,s){s=s||{};for(const n of t){const t=n.plugin;if(!1===d(t[i],[e,s,n.options],t)&&s.cancelable)return!1}return!0}invalidate(){s(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,s=l(i.options&&i.options.plugins,{}),n=function(t){const e={},i=[],s=Object.keys(nn.plugins.items);for(let t=0;t<s.length;t++)i.push(nn.getPlugin(s[t]));const n=t.plugins||[];for(let t=0;t<n.length;t++){const s=n[t];-1===i.indexOf(s)&&(i.push(s),e[s.id]=!0)}return{plugins:i,localIds:e}}(i);return!1!==s||e?function(t,{plugins:e,localIds:i},s,n){const o=[],a=t.getContext();for(const r of e){const e=r.id,l=an(s[e],n);null!==l&&o.push({plugin:r,options:rn(t.config,{plugin:r,local:i[e]},l,a)})}return o}(t,n,s,e):[]}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,s=(t,e)=>t.filter((t=>!e.some((e=>t.plugin.id===e.plugin.id))));this._notify(s(e,i),t,"stop"),this._notify(s(i,e),t,"start")}}function an(t,e){return e||!1!==t?!0===t?{}:t:null}function rn(t,{plugin:e,local:i},s,n){const o=t.pluginScopeKeys(e),a=t.getOptionScopes(s,o);return i&&e.defaults&&a.push(e.defaults),t.createResolver(a,n,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function ln(t,e){const i=ue.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||i.indexAxis||"x"}function hn(t){if("x"===t||"y"===t||"r"===t)return t}function cn(t,...e){if(hn(t))return t;for(const s of e){const e=s.axis||("top"===(i=s.position)||"bottom"===i?"x":"left"===i||"right"===i?"y":void 0)||t.length>1&&hn(t[0].toLowerCase());if(e)return e}var i;throw new Error(`Cannot determine type of '${t}' axis. Please provide 'axis' or 'position' option.`)}function dn(t,e,i){if(i[e+"AxisID"]===t)return{axis:e}}function un(t,e){const i=re[t.type]||{scales:{}},s=e.scales||{},n=ln(t.type,e),a=Object.create(null);return Object.keys(s).forEach((e=>{const r=s[e];if(!o(r))return console.error(`Invalid scale configuration for scale: ${e}`);if(r._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${e}`);const l=cn(e,r,function(t,e){if(e.data&&e.data.datasets){const i=e.data.datasets.filter((e=>e.xAxisID===t||e.yAxisID===t));if(i.length)return dn(t,"x",i[0])||dn(t,"y",i[0])}return{}}(e,t),ue.scales[r.type]),h=function(t,e){return t===e?"_index_":"_value_"}(l,n),c=i.scales||{};a[e]=b(Object.create(null),[{axis:l},r,c[l],c[h]])})),t.data.datasets.forEach((i=>{const n=i.type||t.type,o=i.indexAxis||ln(n,e),r=(re[n]||{}).scales||{};Object.keys(r).forEach((t=>{const e=function(t,e){let i=t;return"_index_"===t?i=e:"_value_"===t&&(i="x"===e?"y":"x"),i}(t,o),n=i[e+"AxisID"]||e;a[n]=a[n]||Object.create(null),b(a[n],[{axis:e},s[n],r[t]])}))})),Object.keys(a).forEach((t=>{const e=a[t];b(e,[ue.scales[e.type],ue.scale])})),a}function fn(t){const e=t.options||(t.options={});e.plugins=l(e.plugins,{}),e.scales=un(t,e)}function gn(t){return(t=t||{}).datasets=t.datasets||[],t.labels=t.labels||[],t}const pn=new Map,mn=new Set;function xn(t,e){let i=pn.get(t);return i||(i=e(),pn.set(t,i),mn.add(i)),i}const bn=(t,e,i)=>{const s=M(e,i);void 0!==s&&t.add(s)};class _n{constructor(t){this._config=function(t){return(t=t||{}).data=gn(t.data),fn(t),t}(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=gn(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),fn(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return xn(t,(()=>[[`datasets.${t}`,""]]))}datasetAnimationScopeKeys(t,e){return xn(`${t}.transition.${e}`,(()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]]))}datasetElementScopeKeys(t,e){return xn(`${t}-${e}`,(()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]]))}pluginScopeKeys(t){const e=t.id;return xn(`${this.type}-plugin-${e}`,(()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]]))}_cachedScopes(t,e){const i=this._scopeCache;let s=i.get(t);return s&&!e||(s=new Map,i.set(t,s)),s}getOptionScopes(t,e,i){const{options:s,type:n}=this,o=this._cachedScopes(t,i),a=o.get(e);if(a)return a;const r=new Set;e.forEach((e=>{t&&(r.add(t),e.forEach((e=>bn(r,t,e)))),e.forEach((t=>bn(r,s,t))),e.forEach((t=>bn(r,re[n]||{},t))),e.forEach((t=>bn(r,ue,t))),e.forEach((t=>bn(r,le,t)))}));const l=Array.from(r);return 0===l.length&&l.push(Object.create(null)),mn.has(e)&&o.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,re[e]||{},ue.datasets[e]||{},{type:e},ue,le]}resolveNamedOptions(t,e,i,s=[""]){const o={$shared:!0},{resolver:a,subPrefixes:r}=yn(this._resolverCache,t,s);let l=a;if(function(t,e){const{isScriptable:i,isIndexable:s}=Ye(t);for(const o of e){const e=i(o),a=s(o),r=(a||e)&&t[o];if(e&&(S(r)||vn(r))||a&&n(r))return!0}return!1}(a,e)){o.$shared=!1;l=$e(a,i=S(i)?i():i,this.createResolver(t,i,r))}for(const t of e)o[t]=l[t];return o}createResolver(t,e,i=[""],s){const{resolver:n}=yn(this._resolverCache,t,i);return o(e)?$e(n,e,void 0,s):n}}function yn(t,e,i){let s=t.get(e);s||(s=new Map,t.set(e,s));const n=i.join();let o=s.get(n);if(!o){o={resolver:je(e,i),subPrefixes:i.filter((t=>!t.toLowerCase().includes("hover")))},s.set(n,o)}return o}const vn=t=>o(t)&&Object.getOwnPropertyNames(t).some((e=>S(t[e])));const Mn=["top","bottom","left","right","chartArea"];function wn(t,e){return"top"===t||"bottom"===t||-1===Mn.indexOf(t)&&"x"===e}function kn(t,e){return function(i,s){return i[t]===s[t]?i[e]-s[e]:i[t]-s[t]}}function Sn(t){const e=t.chart,i=e.options.animation;e.notifyPlugins("afterRender"),d(i&&i.onComplete,[t],e)}function Pn(t){const e=t.chart,i=e.options.animation;d(i&&i.onProgress,[t],e)}function Dn(t){return fe()&&"string"==typeof t?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const Cn={},On=t=>{const e=Dn(t);return Object.values(Cn).filter((t=>t.canvas===e)).pop()};function An(t,e,i){const s=Object.keys(t);for(const n of s){const s=+n;if(s>=e){const o=t[n];delete t[n],(i>0||s>e)&&(t[s+i]=o)}}}class Tn{static defaults=ue;static instances=Cn;static overrides=re;static registry=nn;static version="4.5.1";static getChart=On;static register(...t){nn.add(...t),Ln()}static unregister(...t){nn.remove(...t),Ln()}constructor(t,e){const s=this.config=new _n(e),n=Dn(t),o=On(n);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");const a=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||Ps(n)),this.platform.updateConfig(s);const r=this.platform.acquireContext(n,a.aspectRatio),l=r&&r.canvas,h=l&&l.height,c=l&&l.width;this.id=i(),this.ctx=r,this.canvas=l,this.width=c,this.height=h,this._options=a,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new on,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=dt((t=>this.update(t)),a.resizeDelay||0),this._dataChanges=[],Cn[this.id]=this,r&&l?(bt.listen(this,"complete",Sn),bt.listen(this,"progress",Pn),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:n,_aspectRatio:o}=this;return s(t)?e&&o?o:n?i/n:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return nn}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():ke(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Te(this.canvas,this.ctx),this}stop(){return bt.stop(this),this}resize(t,e){bt.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,s=this.canvas,n=i.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(s,t,e,n),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),r=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,ke(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),d(i.onResize,[this,o],this),this.attached&&this._doResize(r)&&this.render())}ensureScalesHaveIDs(){u(this.options.scales||{},((t,e)=>{t.id=e}))}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,s=Object.keys(i).reduce(((t,e)=>(t[e]=!1,t)),{});let n=[];e&&(n=n.concat(Object.keys(e).map((t=>{const i=e[t],s=cn(t,i),n="r"===s,o="x"===s;return{options:i,dposition:n?"chartArea":o?"bottom":"left",dtype:n?"radialLinear":o?"category":"linear"}})))),u(n,(e=>{const n=e.options,o=n.id,a=cn(o,n),r=l(n.type,e.dtype);void 0!==n.position&&wn(n.position,a)===wn(e.dposition)||(n.position=e.dposition),s[o]=!0;let h=null;if(o in i&&i[o].type===r)h=i[o];else{h=new(nn.getScale(r))({id:o,type:r,ctx:this.ctx,chart:this}),i[h.id]=h}h.init(n,t)})),u(s,((t,e)=>{t||delete i[e]})),u(i,(t=>{ls.configure(this,t,t.options),ls.addBox(this,t)}))}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort(((t,e)=>t.index-e.index)),i>e){for(let t=e;t<i;++t)this._destroyDatasetMeta(t);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(kn("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach(((t,i)=>{0===e.filter((e=>e===t._dataset)).length&&this._destroyDatasetMeta(i)}))}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,s;for(this._removeUnreferencedMetasets(),i=0,s=e.length;i<s;i++){const s=e[i];let n=this.getDatasetMeta(i);const o=s.type||this.config.type;if(n.type&&n.type!==o&&(this._destroyDatasetMeta(i),n=this.getDatasetMeta(i)),n.type=o,n.indexAxis=s.indexAxis||ln(o,this.options),n.order=s.order||0,n.index=i,n.label=""+s.label,n.visible=this.isDatasetVisible(i),n.controller)n.controller.updateIndex(i),n.controller.linkScales();else{const e=nn.getController(o),{datasetElementType:s,dataElementType:a}=ue.datasets[o];Object.assign(e,{dataElementType:nn.getElement(a),datasetElementType:s&&nn.getElement(s)}),n.controller=new e(this,i),t.push(n.controller)}}return this._updateMetasets(),t}_resetElements(){u(this.data.datasets,((t,e)=>{this.getDatasetMeta(e).controller.reset()}),this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0}))return;const n=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let t=0,e=this.data.datasets.length;t<e;t++){const{controller:e}=this.getDatasetMeta(t),i=!s&&-1===n.indexOf(e);e.buildOrUpdateElements(i),o=Math.max(+e.getMaxOverflow(),o)}o=this._minPadding=i.layout.autoPadding?o:0,this._updateLayout(o),s||u(n,(t=>{t.reset()})),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(kn("z","_idx"));const{_active:a,_lastEvent:r}=this;r?this._eventHandler(r,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){u(this.scales,(t=>{ls.removeBox(this,t)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);P(e,i)&&!!this._responsiveListeners===t.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:s,count:n}of e){An(t,s,"_removeElements"===i?-n:n)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=e=>new Set(t.filter((t=>t[0]===e)).map(((t,e)=>e+","+t.splice(1).join(",")))),s=i(0);for(let t=1;t<e;t++)if(!P(s,i(t)))return;return Array.from(s).map((t=>t.split(","))).map((t=>({method:t[1],start:+t[2],count:+t[3]})))}_updateLayout(t){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;ls.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],u(this.boxes,(t=>{i&&"chartArea"===t.position||(t.configure&&t.configure(),this._layers.push(...t._layers()))}),this),this._layers.forEach(((t,e)=>{t._idx=e})),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})){for(let t=0,e=this.data.datasets.length;t<e;++t)this.getDatasetMeta(t).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,S(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),s={meta:i,index:t,mode:e,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",s)&&(i.controller._update(e),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(bt.has(this)?this.attached&&!bt.running(this)&&bt.start(this):(this.draw(),Sn({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:t,height:e}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(t,e)}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let s,n;for(s=0,n=e.length;s<n;++s){const n=e[s];t&&!n.visible||i.push(n)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i={meta:t,index:t.index,cancelable:!0},s=Ni(this,t);!1!==this.notifyPlugins("beforeDatasetDraw",i)&&(s&&Ie(e,s),t.controller.draw(),s&&ze(e),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return Re(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,s){const n=Ki.modes[e];return"function"==typeof n?n(this,t,i,s):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let s=i.filter((t=>t&&t._dataset===e)).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(s)),s}getContext(){return this.$context||(this.$context=Ci(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return"boolean"==typeof i.hidden?!i.hidden:!e.hidden}setDatasetVisibility(t,e){this.getDatasetMeta(t).hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const s=i?"show":"hide",n=this.getDatasetMeta(t),o=n.controller._resolveAnimations(void 0,s);k(e)?(n.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),o.update(n,{visible:i}),this.update((e=>e.datasetIndex===t?s:void 0)))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),bt.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Te(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete Cn[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(i,s)=>{e.addEventListener(this,i,s),t[i]=s},s=(t,e,i)=>{t.offsetX=e,t.offsetY=i,this._eventHandler(t)};u(this.options.events,(t=>i(t,s)))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(i,s)=>{e.addEventListener(this,i,s),t[i]=s},s=(i,s)=>{t[i]&&(e.removeEventListener(this,i,s),delete t[i])},n=(t,e)=>{this.canvas&&this.resize(t,e)};let o;const a=()=>{s("attach",a),this.attached=!0,this.resize(),i("resize",n),i("detach",o)};o=()=>{this.attached=!1,s("resize",n),this._stop(),this._resize(0,0),i("attach",a)},e.isAttached(this.canvas)?a():o()}unbindEvents(){u(this._listeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._listeners={},u(this._responsiveListeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const s=i?"set":"remove";let n,o,a,r;for("dataset"===e&&(n=this.getDatasetMeta(t[0].datasetIndex),n.controller["_"+s+"DatasetHoverStyle"]()),a=0,r=t.length;a<r;++a){o=t[a];const e=o&&this.getDatasetMeta(o.datasetIndex).controller;e&&e[s+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map((({datasetIndex:t,index:e})=>{const i=this.getDatasetMeta(t);if(!i)throw new Error("No dataset found at index "+t);return{datasetIndex:t,element:i.data[e],index:e}}));!f(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}isPluginEnabled(t){return 1===this._plugins._cache.filter((e=>e.plugin.id===t)).length}_updateHoverStyles(t,e,i){const s=this.options.hover,n=(t,e)=>t.filter((t=>!e.some((e=>t.datasetIndex===e.datasetIndex&&t.index===e.index)))),o=n(e,t),a=i?t:n(t,e);o.length&&this.updateHoverStyle(o,s.mode,!1),a.length&&s.mode&&this.updateHoverStyle(a,s.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},s=e=>(e.options.events||this.options.events).includes(t.native.type);if(!1===this.notifyPlugins("beforeEvent",i,s))return;const n=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,s),(n||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:s=[],options:n}=this,o=e,a=this._getActiveElements(t,s,i,o),r=D(t),l=function(t,e,i,s){return i&&"mouseout"!==t.type?s?e:t:null}(t,this._lastEvent,i,r);i&&(this._lastEvent=null,d(n.onHover,[t,a,this],this),r&&d(n.onClick,[t,a,this],this));const h=!f(a,s);return(h||e)&&(this._active=a,this._updateHoverStyles(a,s,e)),this._lastEvent=l,h}_getActiveElements(t,e,i,s){if("mouseout"===t.type)return[];if(!i)return e;const n=this.options.hover;return this.getElementsAtEventForMode(t,n.mode,n,s)}}function Ln(){return u(Tn.instances,(t=>t._plugins.invalidate()))}function En(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Rn{static override(t){Object.assign(Rn.prototype,t)}options;constructor(t){this.options=t||{}}init(){}formats(){return En()}parse(){return En()}format(){return En()}add(){return En()}diff(){return En()}startOf(){return En()}endOf(){return En()}}var In={_date:Rn};function zn(t){const e=t.iScale,i=function(t,e){if(!t._cache.$bar){const i=t.getMatchingVisibleMetas(e);let s=[];for(let e=0,n=i.length;e<n;e++)s=s.concat(i[e].controller.getAllParsedValues(t));t._cache.$bar=lt(s.sort(((t,e)=>t-e)))}return t._cache.$bar}(e,t.type);let s,n,o,a,r=e._length;const l=()=>{32767!==o&&-32768!==o&&(k(a)&&(r=Math.min(r,Math.abs(o-a)||r)),a=o)};for(s=0,n=i.length;s<n;++s)o=e.getPixelForValue(i[s]),l();for(a=void 0,s=0,n=e.ticks.length;s<n;++s)o=e.getPixelForTick(s),l();return r}function Fn(t,e,i,s){return n(t)?function(t,e,i,s){const n=i.parse(t[0],s),o=i.parse(t[1],s),a=Math.min(n,o),r=Math.max(n,o);let l=a,h=r;Math.abs(a)>Math.abs(r)&&(l=r,h=a),e[i.axis]=h,e._custom={barStart:l,barEnd:h,start:n,end:o,min:a,max:r}}(t,e,i,s):e[i.axis]=i.parse(t,s),e}function Vn(t,e,i,s){const n=t.iScale,o=t.vScale,a=n.getLabels(),r=n===o,l=[];let h,c,d,u;for(h=i,c=i+s;h<c;++h)u=e[h],d={},d[n.axis]=r||n.parse(a[h],h),l.push(Fn(u,d,o,h));return l}function Bn(t){return t&&void 0!==t.barStart&&void 0!==t.barEnd}function Wn(t,e,i,s){let n=e.borderSkipped;const o={};if(!n)return void(t.borderSkipped=o);if(!0===n)return void(t.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:a,end:r,reverse:l,top:h,bottom:c}=function(t){let e,i,s,n,o;return t.horizontal?(e=t.base>t.x,i="left",s="right"):(e=t.base<t.y,i="bottom",s="top"),e?(n="end",o="start"):(n="start",o="end"),{start:i,end:s,reverse:e,top:n,bottom:o}}(t);"middle"===n&&i&&(t.enableBorderRadius=!0,(i._top||0)===s?n=h:(i._bottom||0)===s?n=c:(o[Nn(c,a,r,l)]=!0,n=h)),o[Nn(n,a,r,l)]=!0,t.borderSkipped=o}function Nn(t,e,i,s){var n,o,a;return s?(a=i,t=Hn(t=(n=t)===(o=e)?a:n===a?o:n,i,e)):t=Hn(t,e,i),t}function Hn(t,e,i){return"start"===t?e:"end"===t?i:t}function jn(t,{inflateAmount:e},i){t.inflateAmount="auto"===e?1===i?.33:0:e}class $n extends js{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:t=>"spacing"!==t,_indexable:t=>"spacing"!==t&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data,{labels:{pointStyle:i,textAlign:s,color:n,useBorderRadius:o,borderRadius:a}}=t.legend.options;return e.labels.length&&e.datasets.length?e.labels.map(((e,r)=>{const l=t.getDatasetMeta(0).controller.getStyle(r);return{text:e,fillStyle:l.backgroundColor,fontColor:n,hidden:!t.getDataVisibility(r),lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:l.borderWidth,strokeStyle:l.borderColor,textAlign:s,pointStyle:i,borderRadius:o&&(a||l.borderRadius),index:r}})):[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}}};constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,s=this._cachedMeta;if(!1===this._parsing)s._parsed=i;else{let n,a,r=t=>+i[t];if(o(i[t])){const{key:t="value"}=this._parsing;r=e=>+M(i[e],t)}for(n=t,a=t+e;n<a;++n)s._parsed[n]=r(n)}}_getRotation(){return $(this.options.rotation-90)}_getCircumference(){return $(this.options.circumference)}_getRotationExtents(){let t=O,e=-O;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const s=this.chart.getDatasetMeta(i).controller,n=s._getRotation(),o=s._getCircumference();t=Math.min(t,n),e=Math.max(e,n+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,s=this._cachedMeta,n=s.data,o=this.getMaxBorderWidth()+this.getMaxOffset(n)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-o)/2,0),r=Math.min(h(this.options.cutout,a),1),l=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:f,ratioY:g,offsetX:p,offsetY:m}=function(t,e,i){let s=1,n=1,o=0,a=0;if(e<O){const r=t,l=r+e,h=Math.cos(r),c=Math.sin(r),d=Math.cos(l),u=Math.sin(l),f=(t,e,s)=>J(t,r,l,!0)?1:Math.max(e,e*i,s,s*i),g=(t,e,s)=>J(t,r,l,!0)?-1:Math.min(e,e*i,s,s*i),p=f(0,h,d),m=f(E,c,u),x=g(C,h,d),b=g(C+E,c,u);s=(p-x)/2,n=(m-b)/2,o=-(p+x)/2,a=-(m+b)/2}return{ratioX:s,ratioY:n,offsetX:o,offsetY:a}}(u,d,r),x=(i.width-o)/f,b=(i.height-o)/g,_=Math.max(Math.min(x,b)/2,0),y=c(this.options.radius,_),v=(y-Math.max(y*r,0))/this._getVisibleDatasetWeightTotal();this.offsetX=p*y,this.offsetY=m*y,s.total=this.calculateTotal(),this.outerRadius=y-v*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-v*l,0),this.updateElements(n,0,n.length,t)}_circumference(t,e){const i=this.options,s=this._cachedMeta,n=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||null===s._parsed[t]||s.data[t].hidden?0:this.calculateCircumference(s._parsed[t]*n/O)}updateElements(t,e,i,s){const n="reset"===s,o=this.chart,a=o.chartArea,r=o.options.animation,l=(a.left+a.right)/2,h=(a.top+a.bottom)/2,c=n&&r.animateScale,d=c?0:this.innerRadius,u=c?0:this.outerRadius,{sharedOptions:f,includeOptions:g}=this._getSharedOptions(e,s);let p,m=this._getRotation();for(p=0;p<e;++p)m+=this._circumference(p,n);for(p=e;p<e+i;++p){const e=this._circumference(p,n),i=t[p],o={x:l+this.offsetX,y:h+this.offsetY,startAngle:m,endAngle:m+e,circumference:e,outerRadius:u,innerRadius:d};g&&(o.options=f||this.resolveDataElementOptions(p,i.active?"active":s)),m+=e,this.updateElement(i,p,o,s)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let i,s=0;for(i=0;i<e.length;i++){const n=t._parsed[i];null===n||isNaN(n)||!this.chart.getDataVisibility(i)||e[i].hidden||(s+=Math.abs(n))}return s}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?O*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,s=i.data.labels||[],n=ne(e._parsed[t],i.options.locale);return{label:s[t]||"",value:n}}getMaxBorderWidth(t){let e=0;const i=this.chart;let s,n,o,a,r;if(!t)for(s=0,n=i.data.datasets.length;s<n;++s)if(i.isDatasetVisible(s)){o=i.getDatasetMeta(s),t=o.data,a=o.controller;break}if(!t)return 0;for(s=0,n=t.length;s<n;++s)r=a.resolveDataElementOptions(s),"inner"!==r.borderAlign&&(e=Math.max(e,r.borderWidth||0,r.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,s=t.length;i<s;++i){const t=this.resolveDataElementOptions(i);e=Math.max(e,t.offset||0,t.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(l(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class Yn extends js{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:s}}=t.legend.options;return e.labels.map(((e,n)=>{const o=t.getDatasetMeta(0).controller.getStyle(n);return{text:e,fillStyle:o.backgroundColor,strokeStyle:o.borderColor,fontColor:s,lineWidth:o.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(n),index:n}}))}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,s=i.data.labels||[],n=ne(e._parsed[t].r,i.options.locale);return{label:s[t]||"",value:n}}parseObjectData(t,e,i,s){return ii.bind(this)(t,e,i,s)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach(((t,i)=>{const s=this.getParsed(i).r;!isNaN(s)&&this.chart.getDataVisibility(i)&&(s<e.min&&(e.min=s),s>e.max&&(e.max=s))})),e}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,s=Math.min(e.right-e.left,e.bottom-e.top),n=Math.max(s/2,0),o=(n-Math.max(i.cutoutPercentage?n/100*i.cutoutPercentage:1,0))/t.getVisibleDatasetCount();this.outerRadius=n-o*this.index,this.innerRadius=this.outerRadius-o}updateElements(t,e,i,s){const n="reset"===s,o=this.chart,a=o.options.animation,r=this._cachedMeta.rScale,l=r.xCenter,h=r.yCenter,c=r.getIndexAngle(0)-.5*C;let d,u=c;const f=360/this.countVisibleElements();for(d=0;d<e;++d)u+=this._computeAngle(d,s,f);for(d=e;d<e+i;d++){const e=t[d];let i=u,g=u+this._computeAngle(d,s,f),p=o.getDataVisibility(d)?r.getDistanceFromCenterForValue(this.getParsed(d).r):0;u=g,n&&(a.animateScale&&(p=0),a.animateRotate&&(i=g=c));const m={x:l,y:h,innerRadius:0,outerRadius:p,startAngle:i,endAngle:g,options:this.resolveDataElementOptions(d,e.active?"active":s)};this.updateElement(e,d,m,s)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach(((t,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&e++})),e}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?$(this.resolveDataElementOptions(t,e).angle||i):0}}var Un=Object.freeze({__proto__:null,BarController:class extends js{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(t,e,i,s){return Vn(t,e,i,s)}parseArrayData(t,e,i,s){return Vn(t,e,i,s)}parseObjectData(t,e,i,s){const{iScale:n,vScale:o}=t,{xAxisKey:a="x",yAxisKey:r="y"}=this._parsing,l="x"===n.axis?a:r,h="x"===o.axis?a:r,c=[];let d,u,f,g;for(d=i,u=i+s;d<u;++d)g=e[d],f={},f[n.axis]=n.parse(M(g,l),d),c.push(Fn(M(g,h),f,o,d));return c}updateRangeFromParsed(t,e,i,s){super.updateRangeFromParsed(t,e,i,s);const n=i._custom;n&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,n.min),t.max=Math.max(t.max,n.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:s}=e,n=this.getParsed(t),o=n._custom,a=Bn(o)?"["+o.start+", "+o.end+"]":""+s.getLabelForValue(n[s.axis]);return{label:""+i.getLabelForValue(n[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,i,n){const o="reset"===n,{index:a,_cachedMeta:{vScale:r}}=this,l=r.getBasePixel(),h=r.isHorizontal(),c=this._getRuler(),{sharedOptions:d,includeOptions:u}=this._getSharedOptions(e,n);for(let f=e;f<e+i;f++){const e=this.getParsed(f),i=o||s(e[r.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),g=this._calculateBarIndexPixels(f,c),p=(e._stacks||{})[r.axis],m={horizontal:h,base:i.base,enableBorderRadius:!p||Bn(e._custom)||a===p._top||a===p._bottom,x:h?i.head:g.center,y:h?g.center:i.head,height:h?g.size:Math.abs(i.size),width:h?Math.abs(i.size):g.size};u&&(m.options=d||this.resolveDataElementOptions(f,t[f].active?"active":n));const x=m.options||t[f].options;Wn(m,x,p,a),jn(m,x,c.ratio),this.updateElement(t[f],f,m,n)}}_getStacks(t,e){const{iScale:i}=this._cachedMeta,n=i.getMatchingVisibleMetas(this._type).filter((t=>t.controller.options.grouped)),o=i.options.stacked,a=[],r=this._cachedMeta.controller.getParsed(e),l=r&&r[i.axis],h=t=>{const e=t._parsed.find((t=>t[i.axis]===l)),n=e&&e[t.vScale.axis];if(s(n)||isNaN(n))return!0};for(const i of n)if((void 0===e||!h(i))&&((!1===o||-1===a.indexOf(i.stack)||void 0===o&&void 0===i.stack)&&a.push(i.stack),i.index===t))break;return a.length||a.push(void 0),a}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter((i=>t[i].axis===e)).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[l("x"===this.chart.options.indexAxis?i.xAxisID:i.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,i){const s=this._getStacks(t,i),n=void 0!==e?s.indexOf(e):-1;return-1===n?s.length-1:n}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,s=[];let n,o;for(n=0,o=e.data.length;n<o;++n)s.push(i.getPixelForValue(this.getParsed(n)[i.axis],n));const a=t.barThickness;return{min:a||zn(e),pixels:s,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:i,index:n},options:{base:o,minBarLength:a}}=this,r=o||0,l=this.getParsed(t),h=l._custom,c=Bn(h);let d,u,f=l[e.axis],g=0,p=i?this.applyStack(e,l,i):f;p!==f&&(g=p-f,p=f),c&&(f=h.barStart,p=h.barEnd-h.barStart,0!==f&&F(f)!==F(h.barEnd)&&(g=0),g+=f);const m=s(o)||c?g:o;let x=e.getPixelForValue(m);if(d=this.chart.getDataVisibility(t)?e.getPixelForValue(g+p):x,u=d-x,Math.abs(u)<a){u=function(t,e,i){return 0!==t?F(t):(e.isHorizontal()?1:-1)*(e.min>=i?1:-1)}(u,e,r)*a,f===r&&(x-=u/2);const t=e.getPixelForDecimal(0),s=e.getPixelForDecimal(1),o=Math.min(t,s),h=Math.max(t,s);x=Math.max(Math.min(x,h),o),d=x+u,i&&!c&&(l._stacks[e.axis]._visualValues[n]=e.getValueForPixel(d)-e.getValueForPixel(x))}if(x===e.getPixelForValue(r)){const t=F(u)*e.getLineWidthForValue(r)/2;x+=t,u-=t}return{size:u,base:x,head:d,center:d+u/2}}_calculateBarIndexPixels(t,e){const i=e.scale,n=this.options,o=n.skipNull,a=l(n.maxBarThickness,1/0);let r,h;const c=this._getAxisCount();if(e.grouped){const i=o?this._getStackCount(t):e.stackCount,d="flex"===n.barThickness?function(t,e,i,s){const n=e.pixels,o=n[t];let a=t>0?n[t-1]:null,r=t<n.length-1?n[t+1]:null;const l=i.categoryPercentage;null===a&&(a=o-(null===r?e.end-e.start:r-o)),null===r&&(r=o+o-a);const h=o-(o-Math.min(a,r))/2*l;return{chunk:Math.abs(r-a)/2*l/s,ratio:i.barPercentage,start:h}}(t,e,n,i*c):function(t,e,i,n){const o=i.barThickness;let a,r;return s(o)?(a=e.min*i.categoryPercentage,r=i.barPercentage):(a=o*n,r=1),{chunk:a/n,ratio:r,start:e.pixels[t]-a/2}}(t,e,n,i*c),u="x"===this.chart.options.indexAxis?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(l(u,this.getFirstScaleIdForIndexAxis())),g=this._getStackIndex(this.index,this._cachedMeta.stack,o?t:void 0)+f;r=d.start+d.chunk*g+d.chunk/2,h=Math.min(a,d.chunk*d.ratio)}else r=i.getPixelForValue(this.getParsed(t)[i.axis],t),h=Math.min(a,e.min*e.ratio);return{base:r-h/2,head:r+h/2,center:r,size:h}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,s=i.length;let n=0;for(;n<s;++n)null===this.getParsed(n)[e.axis]||i[n].hidden||i[n].draw(this._ctx)}},BubbleController:class extends js{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,s){const n=super.parsePrimitiveData(t,e,i,s);for(let t=0;t<n.length;t++)n[t]._custom=this.resolveDataElementOptions(t+i).radius;return n}parseArrayData(t,e,i,s){const n=super.parseArrayData(t,e,i,s);for(let t=0;t<n.length;t++){const s=e[i+t];n[t]._custom=l(s[2],this.resolveDataElementOptions(t+i).radius)}return n}parseObjectData(t,e,i,s){const n=super.parseObjectData(t,e,i,s);for(let t=0;t<n.length;t++){const s=e[i+t];n[t]._custom=l(s&&s.r&&+s.r,this.resolveDataElementOptions(t+i).radius)}return n}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:n}=e,o=this.getParsed(t),a=s.getLabelForValue(o.x),r=n.getLabelForValue(o.y),l=o._custom;return{label:i[t]||"",value:"("+a+", "+r+(l?", "+l:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,s){const n="reset"===s,{iScale:o,vScale:a}=this._cachedMeta,{sharedOptions:r,includeOptions:l}=this._getSharedOptions(e,s),h=o.axis,c=a.axis;for(let d=e;d<e+i;d++){const e=t[d],i=!n&&this.getParsed(d),u={},f=u[h]=n?o.getPixelForDecimal(.5):o.getPixelForValue(i[h]),g=u[c]=n?a.getBasePixel():a.getPixelForValue(i[c]);u.skip=isNaN(f)||isNaN(g),l&&(u.options=r||this.resolveDataElementOptions(d,e.active?"active":s),n&&(u.options.radius=0)),this.updateElement(e,d,u,s)}}resolveDataElementOptions(t,e){const i=this.getParsed(t);let s=super.resolveDataElementOptions(t,e);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const n=s.radius;return"active"!==e&&(s.radius=0),s.radius+=l(i&&i._custom,n),s}},DoughnutController:$n,LineController:class extends js{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:s=[],_dataset:n}=e,o=this.chart._animationsDisabled;let{start:a,count:r}=pt(e,s,o);this._drawStart=a,this._drawCount=r,mt(e)&&(a=0,r=s.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!n._decimated,i.points=s;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(i,void 0,{animated:!o,options:l},t),this.updateElements(s,a,r,t)}updateElements(t,e,i,n){const o="reset"===n,{iScale:a,vScale:r,_stacked:l,_dataset:h}=this._cachedMeta,{sharedOptions:c,includeOptions:d}=this._getSharedOptions(e,n),u=a.axis,f=r.axis,{spanGaps:g,segment:p}=this.options,m=N(g)?g:Number.POSITIVE_INFINITY,x=this.chart._animationsDisabled||o||"none"===n,b=e+i,_=t.length;let y=e>0&&this.getParsed(e-1);for(let i=0;i<_;++i){const g=t[i],_=x?g:{};if(i<e||i>=b){_.skip=!0;continue}const v=this.getParsed(i),M=s(v[f]),w=_[u]=a.getPixelForValue(v[u],i),k=_[f]=o||M?r.getBasePixel():r.getPixelForValue(l?this.applyStack(r,v,l):v[f],i);_.skip=isNaN(w)||isNaN(k)||M,_.stop=i>0&&Math.abs(v[u]-y[u])>m,p&&(_.parsed=v,_.raw=h.data[i]),d&&(_.options=c||this.resolveDataElementOptions(i,g.active?"active":n)),x||this.updateElement(g,i,_,n),y=v}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,s=t.data||[];if(!s.length)return i;const n=s[0].size(this.resolveDataElementOptions(0)),o=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(i,n,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}},PieController:class extends $n{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}},PolarAreaController:Yn,RadarController:class extends js{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}parseObjectData(t,e,i,s){return ii.bind(this)(t,e,i,s)}update(t){const e=this._cachedMeta,i=e.dataset,s=e.data||[],n=e.iScale.getLabels();if(i.points=s,"resize"!==t){const e=this.resolveDatasetElementOptions(t);this.options.showLine||(e.borderWidth=0);const o={_loop:!0,_fullLoop:n.length===s.length,options:e};this.updateElement(i,void 0,o,t)}this.updateElements(s,0,s.length,t)}updateElements(t,e,i,s){const n=this._cachedMeta.rScale,o="reset"===s;for(let a=e;a<e+i;a++){const e=t[a],i=this.resolveDataElementOptions(a,e.active?"active":s),r=n.getPointPositionForValue(a,this.getParsed(a).r),l=o?n.xCenter:r.x,h=o?n.yCenter:r.y,c={x:l,y:h,angle:r.angle,skip:isNaN(l)||isNaN(h),options:i};this.updateElement(e,a,c,s)}}},ScatterController:class extends js{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:n}=e,o=this.getParsed(t),a=s.getLabelForValue(o.x),r=n.getLabelForValue(o.y);return{label:i[t]||"",value:"("+a+", "+r+")"}}update(t){const e=this._cachedMeta,{data:i=[]}=e,s=this.chart._animationsDisabled;let{start:n,count:o}=pt(e,i,s);if(this._drawStart=n,this._drawCount=o,mt(e)&&(n=0,o=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:n,_dataset:o}=e;n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!o._decimated,n.points=i;const a=this.resolveDatasetElementOptions(t);a.segment=this.options.segment,this.updateElement(n,void 0,{animated:!s,options:a},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(i,n,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,i,n){const o="reset"===n,{iScale:a,vScale:r,_stacked:l,_dataset:h}=this._cachedMeta,c=this.resolveDataElementOptions(e,n),d=this.getSharedOptions(c),u=this.includeOptions(n,d),f=a.axis,g=r.axis,{spanGaps:p,segment:m}=this.options,x=N(p)?p:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||o||"none"===n;let _=e>0&&this.getParsed(e-1);for(let c=e;c<e+i;++c){const e=t[c],i=this.getParsed(c),p=b?e:{},y=s(i[g]),v=p[f]=a.getPixelForValue(i[f],c),M=p[g]=o||y?r.getBasePixel():r.getPixelForValue(l?this.applyStack(r,i,l):i[g],c);p.skip=isNaN(v)||isNaN(M)||y,p.stop=c>0&&Math.abs(i[f]-_[f])>x,m&&(p.parsed=i,p.raw=h.data[c]),u&&(p.options=d||this.resolveDataElementOptions(c,e.active?"active":n)),b||this.updateElement(e,c,p,n),_=i}this.updateSharedOptions(d,n,c)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let t=0;for(let i=e.length-1;i>=0;--i)t=Math.max(t,e[i].size(this.resolveDataElementOptions(i))/2);return t>0&&t}const i=t.dataset,s=i.options&&i.options.borderWidth||0;if(!e.length)return s;const n=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(s,n,o)/2}}});function Xn(t,e,i,s){const n=vi(t.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]);const o=(i-e)/2,a=Math.min(o,s*e/2),r=t=>{const e=(i-Math.min(o,t))*s/2;return Z(t,0,Math.min(o,e))};return{outerStart:r(n.outerStart),outerEnd:r(n.outerEnd),innerStart:Z(n.innerStart,0,a),innerEnd:Z(n.innerEnd,0,a)}}function qn(t,e,i,s){return{x:i+t*Math.cos(e),y:s+t*Math.sin(e)}}function Kn(t,e,i,s,n,o){const{x:a,y:r,startAngle:l,pixelMargin:h,innerRadius:c}=e,d=Math.max(e.outerRadius+s+i-h,0),u=c>0?c+s+i+h:0;let f=0;const g=n-l;if(s){const t=((c>0?c-s:0)+(d>0?d-s:0))/2;f=(g-(0!==t?g*t/(t+s):g))/2}const p=(g-Math.max(.001,g*d-i/C)/d)/2,m=l+p+f,x=n-p-f,{outerStart:b,outerEnd:_,innerStart:y,innerEnd:v}=Xn(e,u,d,x-m),M=d-b,w=d-_,k=m+b/M,S=x-_/w,P=u+y,D=u+v,O=m+y/P,A=x-v/D;if(t.beginPath(),o){const e=(k+S)/2;if(t.arc(a,r,d,k,e),t.arc(a,r,d,e,S),_>0){const e=qn(w,S,a,r);t.arc(e.x,e.y,_,S,x+E)}const i=qn(D,x,a,r);if(t.lineTo(i.x,i.y),v>0){const e=qn(D,A,a,r);t.arc(e.x,e.y,v,x+E,A+Math.PI)}const s=(x-v/u+(m+y/u))/2;if(t.arc(a,r,u,x-v/u,s,!0),t.arc(a,r,u,s,m+y/u,!0),y>0){const e=qn(P,O,a,r);t.arc(e.x,e.y,y,O+Math.PI,m-E)}const n=qn(M,m,a,r);if(t.lineTo(n.x,n.y),b>0){const e=qn(M,k,a,r);t.arc(e.x,e.y,b,m-E,k)}}else{t.moveTo(a,r);const e=Math.cos(k)*d+a,i=Math.sin(k)*d+r;t.lineTo(e,i);const s=Math.cos(S)*d+a,n=Math.sin(S)*d+r;t.lineTo(s,n)}t.closePath()}function Gn(t,e,i,s,n){const{fullCircles:o,startAngle:a,circumference:r,options:l}=e,{borderWidth:h,borderJoinStyle:c,borderDash:d,borderDashOffset:u,borderRadius:f}=l,g="inner"===l.borderAlign;if(!h)return;t.setLineDash(d||[]),t.lineDashOffset=u,g?(t.lineWidth=2*h,t.lineJoin=c||"round"):(t.lineWidth=h,t.lineJoin=c||"bevel");let p=e.endAngle;if(o){Kn(t,e,i,s,p,n);for(let e=0;e<o;++e)t.stroke();isNaN(r)||(p=a+(r%O||O))}g&&function(t,e,i){const{startAngle:s,pixelMargin:n,x:o,y:a,outerRadius:r,innerRadius:l}=e;let h=n/r;t.beginPath(),t.arc(o,a,r,s-h,i+h),l>n?(h=n/l,t.arc(o,a,l,i+h,s-h,!0)):t.arc(o,a,n,i+E,s-E),t.closePath(),t.clip()}(t,e,p),l.selfJoin&&p-a>=C&&0===f&&"miter"!==c&&function(t,e,i){const{startAngle:s,x:n,y:o,outerRadius:a,innerRadius:r,options:l}=e,{borderWidth:h,borderJoinStyle:c}=l,d=Math.min(h/a,G(s-i));if(t.beginPath(),t.arc(n,o,a-h/2,s+d/2,i-d/2),r>0){const e=Math.min(h/r,G(s-i));t.arc(n,o,r+h/2,i-e/2,s+e/2,!0)}else{const e=Math.min(h/2,a*G(s-i));if("round"===c)t.arc(n,o,e,i-C/2,s+C/2,!0);else if("bevel"===c){const a=2*e*e,r=-a*Math.cos(i+C/2)+n,l=-a*Math.sin(i+C/2)+o,h=a*Math.cos(s+C/2)+n,c=a*Math.sin(s+C/2)+o;t.lineTo(r,l),t.lineTo(h,c)}}t.closePath(),t.moveTo(0,0),t.rect(0,0,t.canvas.width,t.canvas.height),t.clip("evenodd")}(t,e,p),o||(Kn(t,e,i,s,p,n),t.stroke())}function Jn(t,e,i=e){t.lineCap=l(i.borderCapStyle,e.borderCapStyle),t.setLineDash(l(i.borderDash,e.borderDash)),t.lineDashOffset=l(i.borderDashOffset,e.borderDashOffset),t.lineJoin=l(i.borderJoinStyle,e.borderJoinStyle),t.lineWidth=l(i.borderWidth,e.borderWidth),t.strokeStyle=l(i.borderColor,e.borderColor)}function Zn(t,e,i){t.lineTo(i.x,i.y)}function Qn(t,e,i={}){const s=t.length,{start:n=0,end:o=s-1}=i,{start:a,end:r}=e,l=Math.max(n,a),h=Math.min(o,r),c=n<a&&o<a||n>r&&o>r;return{count:s,start:l,loop:e.loop,ilen:h<l&&!c?s+h-l:h-l}}function to(t,e,i,s){const{points:n,options:o}=e,{count:a,start:r,loop:l,ilen:h}=Qn(n,i,s),c=function(t){return t.stepped?Fe:t.tension||"monotone"===t.cubicInterpolationMode?Ve:Zn}(o);let d,u,f,{move:g=!0,reverse:p}=s||{};for(d=0;d<=h;++d)u=n[(r+(p?h-d:d))%a],u.skip||(g?(t.moveTo(u.x,u.y),g=!1):c(t,f,u,p,o.stepped),f=u);return l&&(u=n[(r+(p?h:0))%a],c(t,f,u,p,o.stepped)),!!l}function eo(t,e,i,s){const n=e.points,{count:o,start:a,ilen:r}=Qn(n,i,s),{move:l=!0,reverse:h}=s||{};let c,d,u,f,g,p,m=0,x=0;const b=t=>(a+(h?r-t:t))%o,_=()=>{f!==g&&(t.lineTo(m,g),t.lineTo(m,f),t.lineTo(m,p))};for(l&&(d=n[b(0)],t.moveTo(d.x,d.y)),c=0;c<=r;++c){if(d=n[b(c)],d.skip)continue;const e=d.x,i=d.y,s=0|e;s===u?(i<f?f=i:i>g&&(g=i),m=(x*m+e)/++x):(_(),t.lineTo(e,i),u=s,x=0,f=g=i),p=i}_()}function io(t){const e=t.options,i=e.borderDash&&e.borderDash.length;return!(t._decimated||t._loop||e.tension||"monotone"===e.cubicInterpolationMode||e.stepped||i)?eo:to}const so="function"==typeof Path2D;function no(t,e,i,s){so&&!e.options.segment?function(t,e,i,s){let n=e._path;n||(n=e._path=new Path2D,e.path(n,i,s)&&n.closePath()),Jn(t,e.options),t.stroke(n)}(t,e,i,s):function(t,e,i,s){const{segments:n,options:o}=e,a=io(e);for(const r of n)Jn(t,o,r.style),t.beginPath(),a(t,e,r,{start:i,end:i+s-1})&&t.closePath(),t.stroke()}(t,e,i,s)}class oo extends $s{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:t=>"borderDash"!==t&&"fill"!==t};constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||"monotone"===i.cubicInterpolationMode)&&!i.stepped&&!this._pointsUpdated){const s=i.spanGaps?this._loop:this._fullLoop;hi(this._points,i,t,s,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=zi(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,s=t[e],n=this.points,o=Ii(this,{property:e,start:s,end:s});if(!o.length)return;const a=[],r=function(t){return t.stepped?pi:t.tension||"monotone"===t.cubicInterpolationMode?mi:gi}(i);let l,h;for(l=0,h=o.length;l<h;++l){const{start:h,end:c}=o[l],d=n[h],u=n[c];if(d===u){a.push(d);continue}const f=r(d,u,Math.abs((s-d[e])/(u[e]-d[e])),i.stepped);f[e]=t[e],a.push(f)}return 1===a.length?a[0]:a}pathSegment(t,e,i){return io(this)(t,this,e,i)}path(t,e,i){const s=this.segments,n=io(this);let o=this._loop;e=e||0,i=i||this.points.length-e;for(const a of s)o&=n(t,this,a,{start:e,end:e+i-1});return!!o}draw(t,e,i,s){const n=this.options||{};(this.points||[]).length&&n.borderWidth&&(t.save(),no(t,this,i,s),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function ao(t,e,i,s){const n=t.options,{[i]:o}=t.getProps([i],s);return Math.abs(e-o)<n.radius+n.hitRadius}function ro(t,e){const{x:i,y:s,base:n,width:o,height:a}=t.getProps(["x","y","base","width","height"],e);let r,l,h,c,d;return t.horizontal?(d=a/2,r=Math.min(i,n),l=Math.max(i,n),h=s-d,c=s+d):(d=o/2,r=i-d,l=i+d,h=Math.min(s,n),c=Math.max(s,n)),{left:r,top:h,right:l,bottom:c}}function lo(t,e,i,s){return t?0:Z(e,i,s)}function ho(t){const e=ro(t),i=e.right-e.left,s=e.bottom-e.top,n=function(t,e,i){const s=t.options.borderWidth,n=t.borderSkipped,o=Mi(s);return{t:lo(n.top,o.top,0,i),r:lo(n.right,o.right,0,e),b:lo(n.bottom,o.bottom,0,i),l:lo(n.left,o.left,0,e)}}(t,i/2,s/2),a=function(t,e,i){const{enableBorderRadius:s}=t.getProps(["enableBorderRadius"]),n=t.options.borderRadius,a=wi(n),r=Math.min(e,i),l=t.borderSkipped,h=s||o(n);return{topLeft:lo(!h||l.top||l.left,a.topLeft,0,r),topRight:lo(!h||l.top||l.right,a.topRight,0,r),bottomLeft:lo(!h||l.bottom||l.left,a.bottomLeft,0,r),bottomRight:lo(!h||l.bottom||l.right,a.bottomRight,0,r)}}(t,i/2,s/2);return{outer:{x:e.left,y:e.top,w:i,h:s,radius:a},inner:{x:e.left+n.l,y:e.top+n.t,w:i-n.l-n.r,h:s-n.t-n.b,radius:{topLeft:Math.max(0,a.topLeft-Math.max(n.t,n.l)),topRight:Math.max(0,a.topRight-Math.max(n.t,n.r)),bottomLeft:Math.max(0,a.bottomLeft-Math.max(n.b,n.l)),bottomRight:Math.max(0,a.bottomRight-Math.max(n.b,n.r))}}}}function co(t,e,i,s){const n=null===e,o=null===i,a=t&&!(n&&o)&&ro(t,s);return a&&(n||tt(e,a.left,a.right))&&(o||tt(i,a.top,a.bottom))}function uo(t,e){t.rect(e.x,e.y,e.w,e.h)}function fo(t,e,i={}){const s=t.x!==i.x?-e:0,n=t.y!==i.y?-e:0,o=(t.x+t.w!==i.x+i.w?e:0)-s,a=(t.y+t.h!==i.y+i.h?e:0)-n;return{x:t.x+s,y:t.y+n,w:t.w+o,h:t.h+a,radius:t.radius}}var go=Object.freeze({__proto__:null,ArcElement:class extends $s{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:t=>"borderDash"!==t};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,i){const s=this.getProps(["x","y"],i),{angle:n,distance:o}=X(s,{x:t,y:e}),{startAngle:a,endAngle:r,innerRadius:h,outerRadius:c,circumference:d}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),u=(this.options.spacing+this.options.borderWidth)/2,f=l(d,r-a),g=J(n,a,r)&&a!==r,p=f>=O||g,m=tt(o,h+u,c+u);return p&&m}getCenterPoint(t){const{x:e,y:i,startAngle:s,endAngle:n,innerRadius:o,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:r,spacing:l}=this.options,h=(s+n)/2,c=(o+a+l+r)/2;return{x:e+Math.cos(h)*c,y:i+Math.sin(h)*c}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:i}=this,s=(e.offset||0)/4,n=(e.spacing||0)/2,o=e.circular;if(this.pixelMargin="inner"===e.borderAlign?.33:0,this.fullCircles=i>O?Math.floor(i/O):0,0===i||this.innerRadius<0||this.outerRadius<0)return;t.save();const a=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(a)*s,Math.sin(a)*s);const r=s*(1-Math.sin(Math.min(C,i||0)));t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor,function(t,e,i,s,n){const{fullCircles:o,startAngle:a,circumference:r}=e;let l=e.endAngle;if(o){Kn(t,e,i,s,l,n);for(let e=0;e<o;++e)t.fill();isNaN(r)||(l=a+(r%O||O))}Kn(t,e,i,s,l,n),t.fill()}(t,this,r,n,o),Gn(t,this,r,n,o),t.restore()}},BarElement:class extends $s{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:s}}=this,{inner:n,outer:o}=ho(this),a=(r=o.radius).topLeft||r.topRight||r.bottomLeft||r.bottomRight?He:uo;var r;t.save(),o.w===n.w&&o.h===n.h||(t.beginPath(),a(t,fo(o,e,n)),t.clip(),a(t,fo(n,-e,o)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,fo(n,e)),t.fillStyle=s,t.fill(),t.restore()}inRange(t,e,i){return co(this,t,e,i)}inXRange(t,e){return co(this,t,null,e)}inYRange(t,e){return co(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:s,horizontal:n}=this.getProps(["x","y","base","horizontal"],t);return{x:n?(e+s)/2:e,y:n?i:(i+s)/2}}getRange(t){return"x"===t?this.width/2:this.height/2}},LineElement:oo,PointElement:class extends $s{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,i){const s=this.options,{x:n,y:o}=this.getProps(["x","y"],i);return Math.pow(t-n,2)+Math.pow(e-o,2)<Math.pow(s.hitRadius+s.radius,2)}inXRange(t,e){return ao(this,t,"x",e)}inYRange(t,e){return ao(this,t,"y",e)}getCenterPoint(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}size(t){let e=(t=t||this.options||{}).radius||0;e=Math.max(e,e&&t.hoverRadius||0);return 2*(e+(e&&t.borderWidth||0))}draw(t,e){const i=this.options;this.skip||i.radius<.1||!Re(this,e,this.size(i)/2)||(t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.fillStyle=i.backgroundColor,Le(t,i,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}});function po(t,e,i,s){const n=t.indexOf(e);if(-1===n)return((t,e,i,s)=>("string"==typeof e?(i=t.push(e)-1,s.unshift({index:i,label:e})):isNaN(e)&&(i=null),i))(t,e,i,s);return n!==t.lastIndexOf(e)?i:n}function mo(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}function xo(t,e,{horizontal:i,minRotation:s}){const n=$(s),o=(i?Math.sin(n):Math.cos(n))||.001,a=.75*e*(""+t).length;return Math.min(e/o,a)}class bo extends tn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return s(t)||("number"==typeof t||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:s,max:n}=this;const o=t=>s=e?s:t,a=t=>n=i?n:t;if(t){const t=F(s),e=F(n);t<0&&e<0?a(0):t>0&&e>0&&o(0)}if(s===n){let e=0===n?1:Math.abs(.05*n);a(n+e),t||o(s-e)}this.min=s,this.max=n}getTickLimit(){const t=this.options.ticks;let e,{maxTicksLimit:i,stepSize:s}=t;return s?(e=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,e>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${e} ticks. Limiting to 1000.`),e=1e3)):(e=this.computeTickLimit(),i=i||11),i&&(e=Math.min(i,e)),e}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const n=function(t,e){const i=[],{bounds:n,step:o,min:a,max:r,precision:l,count:h,maxTicks:c,maxDigits:d,includeBounds:u}=t,f=o||1,g=c-1,{min:p,max:m}=e,x=!s(a),b=!s(r),_=!s(h),y=(m-p)/(d+1);let v,M,w,k,S=B((m-p)/g/f)*f;if(S<1e-14&&!x&&!b)return[{value:p},{value:m}];k=Math.ceil(m/S)-Math.floor(p/S),k>g&&(S=B(k*S/g/f)*f),s(l)||(v=Math.pow(10,l),S=Math.ceil(S*v)/v),"ticks"===n?(M=Math.floor(p/S)*S,w=Math.ceil(m/S)*S):(M=p,w=m),x&&b&&o&&H((r-a)/o,S/1e3)?(k=Math.round(Math.min((r-a)/S,c)),S=(r-a)/k,M=a,w=r):_?(M=x?a:M,w=b?r:w,k=h-1,S=(w-M)/k):(k=(w-M)/S,k=V(k,Math.round(k),S/1e3)?Math.round(k):Math.ceil(k));const P=Math.max(U(S),U(M));v=Math.pow(10,s(l)?P:l),M=Math.round(M*v)/v,w=Math.round(w*v)/v;let D=0;for(x&&(u&&M!==a?(i.push({value:a}),M<a&&D++,V(Math.round((M+D*S)*v)/v,a,xo(a,y,t))&&D++):M<a&&D++);D<k;++D){const t=Math.round((M+D*S)*v)/v;if(b&&t>r)break;i.push({value:t})}return b&&u&&w!==r?i.length&&V(i[i.length-1].value,r,xo(r,y,t))?i[i.length-1].value=r:i.push({value:r}):b&&w!==r||i.push({value:w}),i}({maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:!1!==e.includeBounds},this._range||this);return"ticks"===t.bounds&&j(n,this,"value"),t.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const s=(i-e)/Math.max(t.length-1,1)/2;e-=s,i+=s}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return ne(t,this.chart.options.locale,this.options.ticks.format)}}class _o extends bo{static id="linear";static defaults={ticks:{callback:ae.formatters.numeric}};determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=a(t)?t:0,this.max=a(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=$(this.options.ticks.minRotation),s=(t?Math.sin(i):Math.cos(i))||.001,n=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,n.lineHeight/s))}getPixelForValue(t){return null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}const yo=t=>Math.floor(z(t)),vo=(t,e)=>Math.pow(10,yo(t)+e);function Mo(t){return 1===t/Math.pow(10,yo(t))}function wo(t,e,i){const s=Math.pow(10,i),n=Math.floor(t/s);return Math.ceil(e/s)-n}function ko(t,{min:e,max:i}){e=r(t.min,e);const s=[],n=yo(e);let o=function(t,e){let i=yo(e-t);for(;wo(t,e,i)>10;)i++;for(;wo(t,e,i)<10;)i--;return Math.min(i,yo(t))}(e,i),a=o<0?Math.pow(10,Math.abs(o)):1;const l=Math.pow(10,o),h=n>o?Math.pow(10,n):0,c=Math.round((e-h)*a)/a,d=Math.floor((e-h)/l/10)*l*10;let u=Math.floor((c-d)/Math.pow(10,o)),f=r(t.min,Math.round((h+d+u*Math.pow(10,o))*a)/a);for(;f<i;)s.push({value:f,major:Mo(f),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(o++,u=2,a=o>=0?1:a),f=Math.round((h+d+u*Math.pow(10,o))*a)/a;const g=r(t.max,f);return s.push({value:g,major:Mo(g),significand:u}),s}class So extends tn{static id="logarithmic";static defaults={ticks:{callback:ae.formatters.logarithmic,major:{enabled:!0}}};constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=bo.prototype.parse.apply(this,[t,e]);if(0!==i)return a(i)&&i>0?i:null;this._zero=!0}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=a(t)?Math.max(0,t):null,this.max=a(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!a(this._userMin)&&(this.min=t===vo(this.min,0)?vo(this.min,-1):vo(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,s=this.max;const n=e=>i=t?i:e,o=t=>s=e?s:t;i===s&&(i<=0?(n(1),o(10)):(n(vo(i,-1)),o(vo(s,1)))),i<=0&&n(vo(s,-1)),s<=0&&o(vo(i,1)),this.min=i,this.max=s}buildTicks(){const t=this.options,e=ko({min:this._userMin,max:this._userMax},this);return"ticks"===t.bounds&&j(e,this,"value"),t.reverse?(e.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),e}getLabelForValue(t){return void 0===t?"0":ne(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=z(t),this._valueRange=z(this.max)-z(t)}getPixelForValue(t){return void 0!==t&&0!==t||(t=this.min),null===t||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(z(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function Po(t){const e=t.ticks;if(e.display&&t.display){const t=ki(e.backdropPadding);return l(e.font&&e.font.size,ue.font.size)+t.height}return 0}function Do(t,e,i,s,n){return t===s||t===n?{start:e-i/2,end:e+i/2}:t<s||t>n?{start:e-i,end:e}:{start:e,end:e+i}}function Co(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},i=Object.assign({},e),s=[],o=[],a=t._pointLabels.length,r=t.options.pointLabels,l=r.centerPointLabels?C/a:0;for(let u=0;u<a;u++){const a=r.setContext(t.getPointLabelContext(u));o[u]=a.padding;const f=t.getPointPosition(u,t.drawingArea+o[u],l),g=Si(a.font),p=(h=t.ctx,c=g,d=n(d=t._pointLabels[u])?d:[d],{w:Oe(h,c.string,d),h:d.length*c.lineHeight});s[u]=p;const m=G(t.getIndexAngle(u)+l),x=Math.round(Y(m));Oo(i,e,m,Do(x,f.x,p.w,0,180),Do(x,f.y,p.h,90,270))}var h,c,d;t.setCenterPoint(e.l-i.l,i.r-e.r,e.t-i.t,i.b-e.b),t._pointLabelItems=function(t,e,i){const s=[],n=t._pointLabels.length,o=t.options,{centerPointLabels:a,display:r}=o.pointLabels,l={extra:Po(o)/2,additionalAngle:a?C/n:0};let h;for(let o=0;o<n;o++){l.padding=i[o],l.size=e[o];const n=Ao(t,o,l);s.push(n),"auto"===r&&(n.visible=To(n,h),n.visible&&(h=n))}return s}(t,s,o)}function Oo(t,e,i,s,n){const o=Math.abs(Math.sin(i)),a=Math.abs(Math.cos(i));let r=0,l=0;s.start<e.l?(r=(e.l-s.start)/o,t.l=Math.min(t.l,e.l-r)):s.end>e.r&&(r=(s.end-e.r)/o,t.r=Math.max(t.r,e.r+r)),n.start<e.t?(l=(e.t-n.start)/a,t.t=Math.min(t.t,e.t-l)):n.end>e.b&&(l=(n.end-e.b)/a,t.b=Math.max(t.b,e.b+l))}function Ao(t,e,i){const s=t.drawingArea,{extra:n,additionalAngle:o,padding:a,size:r}=i,l=t.getPointPosition(e,s+n+a,o),h=Math.round(Y(G(l.angle+E))),c=function(t,e,i){90===i||270===i?t-=e/2:(i>270||i<90)&&(t-=e);return t}(l.y,r.h,h),d=function(t){if(0===t||180===t)return"center";if(t<180)return"left";return"right"}(h),u=function(t,e,i){"right"===i?t-=e:"center"===i&&(t-=e/2);return t}(l.x,r.w,d);return{visible:!0,x:l.x,y:c,textAlign:d,left:u,top:c,right:u+r.w,bottom:c+r.h}}function To(t,e){if(!e)return!0;const{left:i,top:s,right:n,bottom:o}=t;return!(Re({x:i,y:s},e)||Re({x:i,y:o},e)||Re({x:n,y:s},e)||Re({x:n,y:o},e))}function Lo(t,e,i){const{left:n,top:o,right:a,bottom:r}=i,{backdropColor:l}=e;if(!s(l)){const i=wi(e.borderRadius),s=ki(e.backdropPadding);t.fillStyle=l;const h=n-s.left,c=o-s.top,d=a-n+s.width,u=r-o+s.height;Object.values(i).some((t=>0!==t))?(t.beginPath(),He(t,{x:h,y:c,w:d,h:u,radius:i}),t.fill()):t.fillRect(h,c,d,u)}}function Eo(t,e,i,s){const{ctx:n}=t;if(i)n.arc(t.xCenter,t.yCenter,e,0,O);else{let i=t.getPointPosition(0,e);n.moveTo(i.x,i.y);for(let o=1;o<s;o++)i=t.getPointPosition(o,e),n.lineTo(i.x,i.y)}}class Ro extends bo{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:ae.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:t=>t,padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=ki(Po(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=a(t)&&!isNaN(t)?t:0,this.max=a(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Po(this.options))}generateTickLabels(t){bo.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map(((t,e)=>{const i=d(this.options.pointLabels.callback,[t,e],this);return i||0===i?i:""})).filter(((t,e)=>this.chart.getDataVisibility(e)))}fit(){const t=this.options;t.display&&t.pointLabels.display?Co(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,s){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,s))}getIndexAngle(t){return G(t*(O/(this._pointLabels.length||1))+$(this.options.startAngle||0))}getDistanceFromCenterForValue(t){if(s(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(s(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return function(t,e,i){return Ci(t,{label:i,index:e,type:"pointLabel"})}(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const s=this.getIndexAngle(t)-E+i;return{x:Math.cos(s)*e+this.xCenter,y:Math.sin(s)*e+this.yCenter,angle:s}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:s,bottom:n}=this._pointLabelItems[t];return{left:e,top:i,right:s,bottom:n}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),Eo(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:i,grid:s,border:n}=e,o=this._pointLabels.length;let a,r,l;if(e.pointLabels.display&&function(t,e){const{ctx:i,options:{pointLabels:s}}=t;for(let n=e-1;n>=0;n--){const e=t._pointLabelItems[n];if(!e.visible)continue;const o=s.setContext(t.getPointLabelContext(n));Lo(i,o,e);const a=Si(o.font),{x:r,y:l,textAlign:h}=e;Ne(i,t._pointLabels[n],r,l+a.lineHeight/2,a,{color:o.color,textAlign:h,textBaseline:"middle"})}}(this,o),s.display&&this.ticks.forEach(((t,e)=>{if(0!==e||0===e&&this.min<0){r=this.getDistanceFromCenterForValue(t.value);const i=this.getContext(e),a=s.setContext(i),l=n.setContext(i);!function(t,e,i,s,n){const o=t.ctx,a=e.circular,{color:r,lineWidth:l}=e;!a&&!s||!r||!l||i<0||(o.save(),o.strokeStyle=r,o.lineWidth=l,o.setLineDash(n.dash||[]),o.lineDashOffset=n.dashOffset,o.beginPath(),Eo(t,i,a,s),o.closePath(),o.stroke(),o.restore())}(this,a,r,o,l)}})),i.display){for(t.save(),a=o-1;a>=0;a--){const s=i.setContext(this.getPointLabelContext(a)),{color:n,lineWidth:o}=s;o&&n&&(t.lineWidth=o,t.strokeStyle=n,t.setLineDash(s.borderDash),t.lineDashOffset=s.borderDashOffset,r=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),l=this.getPointPosition(a,r),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(l.x,l.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const s=this.getIndexAngle(0);let n,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(s),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach(((s,a)=>{if(0===a&&this.min>=0&&!e.reverse)return;const r=i.setContext(this.getContext(a)),l=Si(r.font);if(n=this.getDistanceFromCenterForValue(this.ticks[a].value),r.showLabelBackdrop){t.font=l.string,o=t.measureText(s.label).width,t.fillStyle=r.backdropColor;const e=ki(r.backdropPadding);t.fillRect(-o/2-e.left,-n-l.size/2-e.top,o+e.width,l.size+e.height)}Ne(t,s.label,0,-n,l,{color:r.color,strokeColor:r.textStrokeColor,strokeWidth:r.textStrokeWidth})})),t.restore()}drawTitle(){}}const Io={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},zo=Object.keys(Io);function Fo(t,e){return t-e}function Vo(t,e){if(s(e))return null;const i=t._adapter,{parser:n,round:o,isoWeekday:r}=t._parseOpts;let l=e;return"function"==typeof n&&(l=n(l)),a(l)||(l="string"==typeof n?i.parse(l,n):i.parse(l)),null===l?null:(o&&(l="week"!==o||!N(r)&&!0!==r?i.startOf(l,o):i.startOf(l,"isoWeek",r)),+l)}function Bo(t,e,i,s){const n=zo.length;for(let o=zo.indexOf(t);o<n-1;++o){const t=Io[zo[o]],n=t.steps?t.steps:Number.MAX_SAFE_INTEGER;if(t.common&&Math.ceil((i-e)/(n*t.size))<=s)return zo[o]}return zo[n-1]}function Wo(t,e,i){if(i){if(i.length){const{lo:s,hi:n}=et(i,e);t[i[s]>=e?i[s]:i[n]]=!0}}else t[e]=!0}function No(t,e,i){const s=[],n={},o=e.length;let a,r;for(a=0;a<o;++a)r=e[a],n[r]=a,s.push({value:r,major:!1});return 0!==o&&i?function(t,e,i,s){const n=t._adapter,o=+n.startOf(e[0].value,s),a=e[e.length-1].value;let r,l;for(r=o;r<=a;r=+n.add(r,1,s))l=i[r],l>=0&&(e[l].major=!0);return e}(t,s,n,i):s}class Ho extends tn{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const i=t.time||(t.time={}),s=this._adapter=new In._date(t.adapters.date);s.init(e),b(i.displayFormats,s.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return void 0===t?null:Vo(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:s,max:n,minDefined:o,maxDefined:r}=this.getUserBounds();function l(t){o||isNaN(t.min)||(s=Math.min(s,t.min)),r||isNaN(t.max)||(n=Math.max(n,t.max))}o&&r||(l(this._getLabelBounds()),"ticks"===t.bounds&&"labels"===t.ticks.source||l(this.getMinMax(!1))),s=a(s)&&!isNaN(s)?s:+e.startOf(Date.now(),i),n=a(n)&&!isNaN(n)?n:+e.endOf(Date.now(),i)+1,this.min=Math.min(s,n-1),this.max=Math.max(s+1,n)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,s="labels"===i.source?this.getLabelTimestamps():this._generate();"ticks"===t.bounds&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const n=this.min,o=nt(s,n,this.max);return this._unit=e.unit||(i.autoSkip?Bo(e.minUnit,this.min,this.max,this._getLabelCapacity(n)):function(t,e,i,s,n){for(let o=zo.length-1;o>=zo.indexOf(i);o--){const i=zo[o];if(Io[i].common&&t._adapter.diff(n,s,i)>=e-1)return i}return zo[i?zo.indexOf(i):0]}(this,o.length,e.minUnit,this.min,this.max)),this._majorUnit=i.major.enabled&&"year"!==this._unit?function(t){for(let e=zo.indexOf(t)+1,i=zo.length;e<i;++e)if(Io[zo[e]].common)return zo[e]}(this._unit):void 0,this.initOffsets(s),t.reverse&&o.reverse(),No(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map((t=>+t.value)))}initOffsets(t=[]){let e,i,s=0,n=0;this.options.offset&&t.length&&(e=this.getDecimalForValue(t[0]),s=1===t.length?1-e:(this.getDecimalForValue(t[1])-e)/2,i=this.getDecimalForValue(t[t.length-1]),n=1===t.length?i:(i-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;s=Z(s,0,o),n=Z(n,0,o),this._offsets={start:s,end:n,factor:1/(s+1+n)}}_generate(){const t=this._adapter,e=this.min,i=this.max,s=this.options,n=s.time,o=n.unit||Bo(n.minUnit,e,i,this._getLabelCapacity(e)),a=l(s.ticks.stepSize,1),r="week"===o&&n.isoWeekday,h=N(r)||!0===r,c={};let d,u,f=e;if(h&&(f=+t.startOf(f,"isoWeek",r)),f=+t.startOf(f,h?"day":o),t.diff(i,e,o)>1e5*a)throw new Error(e+" and "+i+" are too far apart with stepSize of "+a+" "+o);const g="data"===s.ticks.source&&this.getDataTimestamps();for(d=f,u=0;d<i;d=+t.add(d,a,o),u++)Wo(c,d,g);return d!==i&&"ticks"!==s.bounds&&1!==u||Wo(c,d,g),Object.keys(c).sort(Fo).map((t=>+t))}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}format(t,e){const i=this.options.time.displayFormats,s=this._unit,n=e||i[s];return this._adapter.format(t,n)}_tickFormatFunction(t,e,i,s){const n=this.options,o=n.ticks.callback;if(o)return d(o,[t,e,i],this);const a=n.time.displayFormats,r=this._unit,l=this._majorUnit,h=r&&a[r],c=l&&a[l],u=i[e],f=l&&c&&u&&u.major;return this._adapter.format(t,s||(f?c:h))}generateTickLabels(t){let e,i,s;for(e=0,i=t.length;e<i;++e)s=t[e],s.label=this._tickFormatFunction(s.value,e,t)}getDecimalForValue(t){return null===t?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,s=$(this.isHorizontal()?e.maxRotation:e.minRotation),n=Math.cos(s),o=Math.sin(s),a=this._resolveTickFontOptions(0).size;return{w:i*n+a*o,h:i*o+a*n}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,s=i[e.unit]||i.millisecond,n=this._tickFormatFunction(t,0,No(this,[t],this._majorUnit),s),o=this._getLabelSize(n),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let t,e,i=this._cache.data||[];if(i.length)return i;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(t=0,e=s.length;t<e;++t)i=i.concat(s[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(i)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const s=this.getLabels();for(e=0,i=s.length;e<i;++e)t.push(Vo(this,s[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return lt(t.sort(Fo))}}function jo(t,e,i){let s,n,o,a,r=0,l=t.length-1;i?(e>=t[r].pos&&e<=t[l].pos&&({lo:r,hi:l}=it(t,"pos",e)),({pos:s,time:o}=t[r]),({pos:n,time:a}=t[l])):(e>=t[r].time&&e<=t[l].time&&({lo:r,hi:l}=it(t,"time",e)),({time:s,pos:o}=t[r]),({time:n,pos:a}=t[l]));const h=n-s;return h?o+(a-o)*(e-s)/h:o}var $o=Object.freeze({__proto__:null,CategoryScale:class extends tn{static id="category";static defaults={ticks:{callback:mo}};constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const t=this.getLabels();for(const{index:i,label:s}of e)t[i]===s&&t.splice(i,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(s(t))return null;const i=this.getLabels();return((t,e)=>null===t?null:Z(Math.round(t),0,e))(e=isFinite(e)&&i[e]===t?e:po(i,t,l(e,t),this._addedLabels),i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:s}=this.getMinMax(!0);"ticks"===this.options.bounds&&(t||(i=0),e||(s=this.getLabels().length-1)),this.min=i,this.max=s}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,s=[];let n=this.getLabels();n=0===t&&e===n.length-1?n:n.slice(t,e+1),this._valueRange=Math.max(n.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let i=t;i<=e;i++)s.push({value:i});return s}getLabelForValue(t){return mo.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return"number"!=typeof t&&(t=this.parse(t)),null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}},LinearScale:_o,LogarithmicScale:So,RadialLinearScale:Ro,TimeScale:Ho,TimeSeriesScale:class extends Ho{static id="timeseries";static defaults=Ho.defaults;constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=jo(e,this.min),this._tableRange=jo(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,s=[],n=[];let o,a,r,l,h;for(o=0,a=t.length;o<a;++o)l=t[o],l>=e&&l<=i&&s.push(l);if(s.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(o=0,a=s.length;o<a;++o)h=s[o+1],r=s[o-1],l=s[o],Math.round((h+r)/2)!==l&&n.push({time:l,pos:o/(a-1)});return n}_generate(){const t=this.min,e=this.max;let i=super.getDataTimestamps();return i.includes(t)&&i.length||i.splice(0,0,t),i.includes(e)&&1!==i.length||i.push(e),i.sort(((t,e)=>t-e))}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return t=e.length&&i.length?this.normalize(e.concat(i)):e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(jo(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return jo(this._table,i*this._tableRange+this._minPos,!0)}}});const Yo=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Uo=Yo.map((t=>t.replace("rgb(","rgba(").replace(")",", 0.5)")));function Xo(t){return Yo[t%Yo.length]}function qo(t){return Uo[t%Uo.length]}function Ko(t){let e=0;return(i,s)=>{const n=t.getDatasetMeta(s).controller;n instanceof $n?e=function(t,e){return t.backgroundColor=t.data.map((()=>Xo(e++))),e}(i,e):n instanceof Yn?e=function(t,e){return t.backgroundColor=t.data.map((()=>qo(e++))),e}(i,e):n&&(e=function(t,e){return t.borderColor=Xo(e),t.backgroundColor=qo(e),++e}(i,e))}}function Go(t){let e;for(e in t)if(t[e].borderColor||t[e].backgroundColor)return!0;return!1}var Jo={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(t,e,i){if(!i.enabled)return;const{data:{datasets:s},options:n}=t.config,{elements:o}=n,a=Go(s)||(r=n)&&(r.borderColor||r.backgroundColor)||o&&Go(o)||"rgba(0,0,0,0.1)"!==ue.borderColor||"rgba(0,0,0,0.1)"!==ue.backgroundColor;var r;if(!i.forceOverride&&a)return;const l=Ko(t);s.forEach(l)}};function Zo(t){if(t._decimated){const e=t._data;delete t._decimated,delete t._data,Object.defineProperty(t,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function Qo(t){t.data.datasets.forEach((t=>{Zo(t)}))}var ta={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(t,e,i)=>{if(!i.enabled)return void Qo(t);const n=t.width;t.data.datasets.forEach(((e,o)=>{const{_data:a,indexAxis:r}=e,l=t.getDatasetMeta(o),h=a||e.data;if("y"===Pi([r,t.options.indexAxis]))return;if(!l.controller.supportsDecimation)return;const c=t.scales[l.xAxisID];if("linear"!==c.type&&"time"!==c.type)return;if(t.options.parsing)return;let{start:d,count:u}=function(t,e){const i=e.length;let s,n=0;const{iScale:o}=t,{min:a,max:r,minDefined:l,maxDefined:h}=o.getUserBounds();return l&&(n=Z(it(e,o.axis,a).lo,0,i-1)),s=h?Z(it(e,o.axis,r).hi+1,n,i)-n:i-n,{start:n,count:s}}(l,h);if(u<=(i.threshold||4*n))return void Zo(e);let f;switch(s(a)&&(e._data=h,delete e.data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(t){this._data=t}})),i.algorithm){case"lttb":f=function(t,e,i,s,n){const o=n.samples||s;if(o>=i)return t.slice(e,e+i);const a=[],r=(i-2)/(o-2);let l=0;const h=e+i-1;let c,d,u,f,g,p=e;for(a[l++]=t[p],c=0;c<o-2;c++){let s,n=0,o=0;const h=Math.floor((c+1)*r)+1+e,m=Math.min(Math.floor((c+2)*r)+1,i)+e,x=m-h;for(s=h;s<m;s++)n+=t[s].x,o+=t[s].y;n/=x,o/=x;const b=Math.floor(c*r)+1+e,_=Math.min(Math.floor((c+1)*r)+1,i)+e,{x:y,y:v}=t[p];for(u=f=-1,s=b;s<_;s++)f=.5*Math.abs((y-n)*(t[s].y-v)-(y-t[s].x)*(o-v)),f>u&&(u=f,d=t[s],g=s);a[l++]=d,p=g}return a[l++]=t[h],a}(h,d,u,n,i);break;case"min-max":f=function(t,e,i,n){let o,a,r,l,h,c,d,u,f,g,p=0,m=0;const x=[],b=e+i-1,_=t[e].x,y=t[b].x-_;for(o=e;o<e+i;++o){a=t[o],r=(a.x-_)/y*n,l=a.y;const e=0|r;if(e===h)l<f?(f=l,c=o):l>g&&(g=l,d=o),p=(m*p+a.x)/++m;else{const i=o-1;if(!s(c)&&!s(d)){const e=Math.min(c,d),s=Math.max(c,d);e!==u&&e!==i&&x.push({...t[e],x:p}),s!==u&&s!==i&&x.push({...t[s],x:p})}o>0&&i!==u&&x.push(t[i]),x.push(a),h=e,m=0,f=g=l,c=d=u=o}}return x}(h,d,u,n);break;default:throw new Error(`Unsupported decimation algorithm '${i.algorithm}'`)}e._decimated=f}))},destroy(t){Qo(t)}};function ea(t,e,i,s){if(s)return;let n=e[t],o=i[t];return"angle"===t&&(n=G(n),o=G(o)),{property:t,start:n,end:o}}function ia(t,e,i){for(;e>t;e--){const t=i[e];if(!isNaN(t.x)&&!isNaN(t.y))break}return e}function sa(t,e,i,s){return t&&e?s(t[i],e[i]):t?t[i]:e?e[i]:0}function na(t,e){let i=[],s=!1;return n(t)?(s=!0,i=t):i=function(t,e){const{x:i=null,y:s=null}=t||{},n=e.points,o=[];return e.segments.forEach((({start:t,end:e})=>{e=ia(t,e,n);const a=n[t],r=n[e];null!==s?(o.push({x:a.x,y:s}),o.push({x:r.x,y:s})):null!==i&&(o.push({x:i,y:a.y}),o.push({x:i,y:r.y}))})),o}(t,e),i.length?new oo({points:i,options:{tension:0},_loop:s,_fullLoop:s}):null}function oa(t){return t&&!1!==t.fill}function aa(t,e,i){let s=t[e].fill;const n=[e];let o;if(!i)return s;for(;!1!==s&&-1===n.indexOf(s);){if(!a(s))return s;if(o=t[s],!o)return!1;if(o.visible)return s;n.push(s),s=o.fill}return!1}function ra(t,e,i){const s=function(t){const e=t.options,i=e.fill;let s=l(i&&i.target,i);void 0===s&&(s=!!e.backgroundColor);if(!1===s||null===s)return!1;if(!0===s)return"origin";return s}(t);if(o(s))return!isNaN(s.value)&&s;let n=parseFloat(s);return a(n)&&Math.floor(n)===n?function(t,e,i,s){"-"!==t&&"+"!==t||(i=e+i);if(i===e||i<0||i>=s)return!1;return i}(s[0],e,n,i):["origin","start","end","stack","shape"].indexOf(s)>=0&&s}function la(t,e,i){const s=[];for(let n=0;n<i.length;n++){const o=i[n],{first:a,last:r,point:l}=ha(o,e,"x");if(!(!l||a&&r))if(a)s.unshift(l);else if(t.push(l),!r)break}t.push(...s)}function ha(t,e,i){const s=t.interpolate(e,i);if(!s)return{};const n=s[i],o=t.segments,a=t.points;let r=!1,l=!1;for(let t=0;t<o.length;t++){const e=o[t],s=a[e.start][i],h=a[e.end][i];if(tt(n,s,h)){r=n===s,l=n===h;break}}return{first:r,last:l,point:s}}class ca{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:s,y:n,radius:o}=this;return e=e||{start:0,end:O},t.arc(s,n,o,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:s}=this,n=t.angle;return{x:e+Math.cos(n)*s,y:i+Math.sin(n)*s,angle:n}}}function da(t){const{chart:e,fill:i,line:s}=t;if(a(i))return function(t,e){const i=t.getDatasetMeta(e),s=i&&t.isDatasetVisible(e);return s?i.dataset:null}(e,i);if("stack"===i)return function(t){const{scale:e,index:i,line:s}=t,n=[],o=s.segments,a=s.points,r=function(t,e){const i=[],s=t.getMatchingVisibleMetas("line");for(let t=0;t<s.length;t++){const n=s[t];if(n.index===e)break;n.hidden||i.unshift(n.dataset)}return i}(e,i);r.push(na({x:null,y:e.bottom},s));for(let t=0;t<o.length;t++){const e=o[t];for(let t=e.start;t<=e.end;t++)la(n,a[t],r)}return new oo({points:n,options:{}})}(t);if("shape"===i)return!0;const n=function(t){const e=t.scale||{};if(e.getPointPositionForValue)return function(t){const{scale:e,fill:i}=t,s=e.options,n=e.getLabels().length,a=s.reverse?e.max:e.min,r=function(t,e,i){let s;return s="start"===t?i:"end"===t?e.options.reverse?e.min:e.max:o(t)?t.value:e.getBaseValue(),s}(i,e,a),l=[];if(s.grid.circular){const t=e.getPointPositionForValue(0,a);return new ca({x:t.x,y:t.y,radius:e.getDistanceFromCenterForValue(r)})}for(let t=0;t<n;++t)l.push(e.getPointPositionForValue(t,r));return l}(t);return function(t){const{scale:e={},fill:i}=t,s=function(t,e){let i=null;return"start"===t?i=e.bottom:"end"===t?i=e.top:o(t)?i=e.getPixelForValue(t.value):e.getBasePixel&&(i=e.getBasePixel()),i}(i,e);if(a(s)){const t=e.isHorizontal();return{x:t?s:null,y:t?null:s}}return null}(t)}(t);return n instanceof ca?n:na(n,s)}function ua(t,e,i){const s=da(e),{chart:n,index:o,line:a,scale:r,axis:l}=e,h=a.options,c=h.fill,d=h.backgroundColor,{above:u=d,below:f=d}=c||{},g=n.getDatasetMeta(o),p=Ni(n,g);s&&a.points.length&&(Ie(t,i),function(t,e){const{line:i,target:s,above:n,below:o,area:a,scale:r,clip:l}=e,h=i._loop?"angle":e.axis;t.save();let c=o;o!==n&&("x"===h?(fa(t,s,a.top),pa(t,{line:i,target:s,color:n,scale:r,property:h,clip:l}),t.restore(),t.save(),fa(t,s,a.bottom)):"y"===h&&(ga(t,s,a.left),pa(t,{line:i,target:s,color:o,scale:r,property:h,clip:l}),t.restore(),t.save(),ga(t,s,a.right),c=n));pa(t,{line:i,target:s,color:c,scale:r,property:h,clip:l}),t.restore()}(t,{line:a,target:s,above:u,below:f,area:i,scale:r,axis:l,clip:p}),ze(t))}function fa(t,e,i){const{segments:s,points:n}=e;let o=!0,a=!1;t.beginPath();for(const r of s){const{start:s,end:l}=r,h=n[s],c=n[ia(s,l,n)];o?(t.moveTo(h.x,h.y),o=!1):(t.lineTo(h.x,i),t.lineTo(h.x,h.y)),a=!!e.pathSegment(t,r,{move:a}),a?t.closePath():t.lineTo(c.x,i)}t.lineTo(e.first().x,i),t.closePath(),t.clip()}function ga(t,e,i){const{segments:s,points:n}=e;let o=!0,a=!1;t.beginPath();for(const r of s){const{start:s,end:l}=r,h=n[s],c=n[ia(s,l,n)];o?(t.moveTo(h.x,h.y),o=!1):(t.lineTo(i,h.y),t.lineTo(h.x,h.y)),a=!!e.pathSegment(t,r,{move:a}),a?t.closePath():t.lineTo(i,c.y)}t.lineTo(i,e.first().y),t.closePath(),t.clip()}function pa(t,e){const{line:i,target:s,property:n,color:o,scale:a,clip:r}=e,l=function(t,e,i){const s=t.segments,n=t.points,o=e.points,a=[];for(const t of s){let{start:s,end:r}=t;r=ia(s,r,n);const l=ea(i,n[s],n[r],t.loop);if(!e.segments){a.push({source:t,target:l,start:n[s],end:n[r]});continue}const h=Ii(e,l);for(const e of h){const s=ea(i,o[e.start],o[e.end],e.loop),r=Ri(t,n,s);for(const t of r)a.push({source:t,target:e,start:{[i]:sa(l,s,"start",Math.max)},end:{[i]:sa(l,s,"end",Math.min)}})}}return a}(i,s,n);for(const{source:e,target:h,start:c,end:d}of l){const{style:{backgroundColor:l=o}={}}=e,u=!0!==s;t.save(),t.fillStyle=l,ma(t,a,r,u&&ea(n,c,d)),t.beginPath();const f=!!i.pathSegment(t,e);let g;if(u){f?t.closePath():xa(t,s,d,n);const e=!!s.pathSegment(t,h,{move:f,reverse:!0});g=f&&e,g||xa(t,s,c,n)}t.closePath(),t.fill(g?"evenodd":"nonzero"),t.restore()}}function ma(t,e,i,s){const n=e.chart.chartArea,{property:o,start:a,end:r}=s||{};if("x"===o||"y"===o){let e,s,l,h;"x"===o?(e=a,s=n.top,l=r,h=n.bottom):(e=n.left,s=a,l=n.right,h=r),t.beginPath(),i&&(e=Math.max(e,i.left),l=Math.min(l,i.right),s=Math.max(s,i.top),h=Math.min(h,i.bottom)),t.rect(e,s,l-e,h-s),t.clip()}}function xa(t,e,i,s){const n=e.interpolate(i,s);n&&t.lineTo(n.x,n.y)}var ba={id:"filler",afterDatasetsUpdate(t,e,i){const s=(t.data.datasets||[]).length,n=[];let o,a,r,l;for(a=0;a<s;++a)o=t.getDatasetMeta(a),r=o.dataset,l=null,r&&r.options&&r instanceof oo&&(l={visible:t.isDatasetVisible(a),index:a,fill:ra(r,a,s),chart:t,axis:o.controller.options.indexAxis,scale:o.vScale,line:r}),o.$filler=l,n.push(l);for(a=0;a<s;++a)l=n[a],l&&!1!==l.fill&&(l.fill=aa(n,a,i.propagate))},beforeDraw(t,e,i){const s="beforeDraw"===i.drawTime,n=t.getSortedVisibleDatasetMetas(),o=t.chartArea;for(let e=n.length-1;e>=0;--e){const i=n[e].$filler;i&&(i.line.updateControlPoints(o,i.axis),s&&i.fill&&ua(t.ctx,i,o))}},beforeDatasetsDraw(t,e,i){if("beforeDatasetsDraw"!==i.drawTime)return;const s=t.getSortedVisibleDatasetMetas();for(let e=s.length-1;e>=0;--e){const i=s[e].$filler;oa(i)&&ua(t.ctx,i,t.chartArea)}},beforeDatasetDraw(t,e,i){const s=e.meta.$filler;oa(s)&&"beforeDatasetDraw"===i.drawTime&&ua(t.ctx,s,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const _a=(t,e)=>{let{boxHeight:i=e,boxWidth:s=e}=t;return t.usePointStyle&&(i=Math.min(i,e),s=t.pointStyleWidth||Math.min(s,e)),{boxWidth:s,boxHeight:i,itemHeight:Math.max(e,i)}};class ya extends $s{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=d(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter((e=>t.filter(e,this.chart.data)))),t.sort&&(e=e.sort(((e,i)=>t.sort(e,i,this.chart.data)))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display)return void(this.width=this.height=0);const i=t.labels,s=Si(i.font),n=s.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:r}=_a(i,n);let l,h;e.font=s.string,this.isHorizontal()?(l=this.maxWidth,h=this._fitRows(o,n,a,r)+10):(h=this.maxHeight,l=this._fitCols(o,s,a,r)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(h,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,s){const{ctx:n,maxWidth:o,options:{labels:{padding:a}}}=this,r=this.legendHitBoxes=[],l=this.lineWidths=[0],h=s+a;let c=t;n.textAlign="left",n.textBaseline="middle";let d=-1,u=-h;return this.legendItems.forEach(((t,f)=>{const g=i+e/2+n.measureText(t.text).width;(0===f||l[l.length-1]+g+2*a>o)&&(c+=h,l[l.length-(f>0?0:1)]=0,u+=h,d++),r[f]={left:0,top:u,row:d,width:g,height:s},l[l.length-1]+=g+a})),c}_fitCols(t,e,i,s){const{ctx:n,maxHeight:o,options:{labels:{padding:a}}}=this,r=this.legendHitBoxes=[],l=this.columnSizes=[],h=o-t;let c=a,d=0,u=0,f=0,g=0;return this.legendItems.forEach(((t,o)=>{const{itemWidth:p,itemHeight:m}=function(t,e,i,s,n){const o=function(t,e,i,s){let n=t.text;n&&"string"!=typeof n&&(n=n.reduce(((t,e)=>t.length>e.length?t:e)));return e+i.size/2+s.measureText(n).width}(s,t,e,i),a=function(t,e,i){let s=t;"string"!=typeof e.text&&(s=va(e,i));return s}(n,s,e.lineHeight);return{itemWidth:o,itemHeight:a}}(i,e,n,t,s);o>0&&u+m+2*a>h&&(c+=d+a,l.push({width:d,height:u}),f+=d+a,g++,d=u=0),r[o]={left:f,top:u,col:g,width:p,height:m},d=Math.max(d,p),u+=m+a})),c+=d,l.push({width:d,height:u}),c}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:s},rtl:n}}=this,o=Oi(n,this.left,this.width);if(this.isHorizontal()){let n=0,a=ft(i,this.left+s,this.right-this.lineWidths[n]);for(const r of e)n!==r.row&&(n=r.row,a=ft(i,this.left+s,this.right-this.lineWidths[n])),r.top+=this.top+t+s,r.left=o.leftForLtr(o.x(a),r.width),a+=r.width+s}else{let n=0,a=ft(i,this.top+t+s,this.bottom-this.columnSizes[n].height);for(const r of e)r.col!==n&&(n=r.col,a=ft(i,this.top+t+s,this.bottom-this.columnSizes[n].height)),r.top=a,r.left+=this.left+s,r.left=o.leftForLtr(o.x(r.left),r.width),a+=r.height+s}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const t=this.ctx;Ie(t,this),this._draw(),ze(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:s}=this,{align:n,labels:o}=t,a=ue.color,r=Oi(t.rtl,this.left,this.width),h=Si(o.font),{padding:c}=o,d=h.size,u=d/2;let f;this.drawTitle(),s.textAlign=r.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=h.string;const{boxWidth:g,boxHeight:p,itemHeight:m}=_a(o,d),x=this.isHorizontal(),b=this._computeTitleHeight();f=x?{x:ft(n,this.left+c,this.right-i[0]),y:this.top+c+b,line:0}:{x:this.left+c,y:ft(n,this.top+b+c,this.bottom-e[0].height),line:0},Ai(this.ctx,t.textDirection);const _=m+c;this.legendItems.forEach(((y,v)=>{s.strokeStyle=y.fontColor,s.fillStyle=y.fontColor;const M=s.measureText(y.text).width,w=r.textAlign(y.textAlign||(y.textAlign=o.textAlign)),k=g+u+M;let S=f.x,P=f.y;r.setWidth(this.width),x?v>0&&S+k+c>this.right&&(P=f.y+=_,f.line++,S=f.x=ft(n,this.left+c,this.right-i[f.line])):v>0&&P+_>this.bottom&&(S=f.x=S+e[f.line].width+c,f.line++,P=f.y=ft(n,this.top+b+c,this.bottom-e[f.line].height));if(function(t,e,i){if(isNaN(g)||g<=0||isNaN(p)||p<0)return;s.save();const n=l(i.lineWidth,1);if(s.fillStyle=l(i.fillStyle,a),s.lineCap=l(i.lineCap,"butt"),s.lineDashOffset=l(i.lineDashOffset,0),s.lineJoin=l(i.lineJoin,"miter"),s.lineWidth=n,s.strokeStyle=l(i.strokeStyle,a),s.setLineDash(l(i.lineDash,[])),o.usePointStyle){const a={radius:p*Math.SQRT2/2,pointStyle:i.pointStyle,rotation:i.rotation,borderWidth:n},l=r.xPlus(t,g/2);Ee(s,a,l,e+u,o.pointStyleWidth&&g)}else{const o=e+Math.max((d-p)/2,0),a=r.leftForLtr(t,g),l=wi(i.borderRadius);s.beginPath(),Object.values(l).some((t=>0!==t))?He(s,{x:a,y:o,w:g,h:p,radius:l}):s.rect(a,o,g,p),s.fill(),0!==n&&s.stroke()}s.restore()}(r.x(S),P,y),S=gt(w,S+g+u,x?S+k:this.right,t.rtl),function(t,e,i){Ne(s,i.text,t,e+m/2,h,{strikethrough:i.hidden,textAlign:r.textAlign(i.textAlign)})}(r.x(S),P,y),x)f.x+=k+c;else if("string"!=typeof y.text){const t=h.lineHeight;f.y+=va(y,t)+c}else f.y+=_})),Ti(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=Si(e.font),s=ki(e.padding);if(!e.display)return;const n=Oi(t.rtl,this.left,this.width),o=this.ctx,a=e.position,r=i.size/2,l=s.top+r;let h,c=this.left,d=this.width;if(this.isHorizontal())d=Math.max(...this.lineWidths),h=this.top+l,c=ft(t.align,c,this.right-d);else{const e=this.columnSizes.reduce(((t,e)=>Math.max(t,e.height)),0);h=l+ft(t.align,this.top,this.bottom-e-t.labels.padding-this._computeTitleHeight())}const u=ft(a,c,c+d);o.textAlign=n.textAlign(ut(a)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=i.string,Ne(o,e.text,u,h,i)}_computeTitleHeight(){const t=this.options.title,e=Si(t.font),i=ki(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,s,n;if(tt(t,this.left,this.right)&&tt(e,this.top,this.bottom))for(n=this.legendHitBoxes,i=0;i<n.length;++i)if(s=n[i],tt(t,s.left,s.left+s.width)&&tt(e,s.top,s.top+s.height))return this.legendItems[i];return null}handleEvent(t){const e=this.options;if(!function(t,e){if(("mousemove"===t||"mouseout"===t)&&(e.onHover||e.onLeave))return!0;if(e.onClick&&("click"===t||"mouseup"===t))return!0;return!1}(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if("mousemove"===t.type||"mouseout"===t.type){const o=this._hoveredItem,a=(n=i,null!==(s=o)&&null!==n&&s.datasetIndex===n.datasetIndex&&s.index===n.index);o&&!a&&d(e.onLeave,[t,o,this],this),this._hoveredItem=i,i&&!a&&d(e.onHover,[t,i,this],this)}else i&&d(e.onClick,[t,i,this],this);var s,n}}function va(t,e){return e*(t.text?t.text.length:0)}var Ma={id:"legend",_element:ya,start(t,e,i){const s=t.legend=new ya({ctx:t.ctx,options:i,chart:t});ls.configure(t,s,i),ls.addBox(t,s)},stop(t){ls.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,i){const s=t.legend;ls.configure(t,s,i),s.options=i},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,i){const s=e.datasetIndex,n=i.chart;n.isDatasetVisible(s)?(n.hide(s),e.hidden=!0):(n.show(s),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:i,pointStyle:s,textAlign:n,color:o,useBorderRadius:a,borderRadius:r}}=t.legend.options;return t._getSortedDatasetMetas().map((t=>{const l=t.controller.getStyle(i?0:void 0),h=ki(l.borderWidth);return{text:e[t.index].label,fillStyle:l.backgroundColor,fontColor:o,hidden:!t.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(h.width+h.height)/4,strokeStyle:l.borderColor,pointStyle:s||l.pointStyle,rotation:l.rotation,textAlign:n||l.textAlign,borderRadius:a&&(r||l.borderRadius),datasetIndex:t.index}}),this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class wa extends $s{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=t,this.height=this.bottom=e;const s=n(i.text)?i.text.length:1;this._padding=ki(i.padding);const o=s*Si(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const t=this.options.position;return"top"===t||"bottom"===t}_drawArgs(t){const{top:e,left:i,bottom:s,right:n,options:o}=this,a=o.align;let r,l,h,c=0;return this.isHorizontal()?(l=ft(a,i,n),h=e+t,r=n-i):("left"===o.position?(l=i+t,h=ft(a,s,e),c=-.5*C):(l=n-t,h=ft(a,e,s),c=.5*C),r=s-e),{titleX:l,titleY:h,maxWidth:r,rotation:c}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=Si(e.font),s=i.lineHeight/2+this._padding.top,{titleX:n,titleY:o,maxWidth:a,rotation:r}=this._drawArgs(s);Ne(t,e.text,0,0,i,{color:e.color,maxWidth:a,rotation:r,textAlign:ut(e.align),textBaseline:"middle",translation:[n,o]})}}var ka={id:"title",_element:wa,start(t,e,i){!function(t,e){const i=new wa({ctx:t.ctx,options:e,chart:t});ls.configure(t,i,e),ls.addBox(t,i),t.titleBlock=i}(t,i)},stop(t){const e=t.titleBlock;ls.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,i){const s=t.titleBlock;ls.configure(t,s,i),s.options=i},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Sa=new WeakMap;var Pa={id:"subtitle",start(t,e,i){const s=new wa({ctx:t.ctx,options:i,chart:t});ls.configure(t,s,i),ls.addBox(t,s),Sa.set(t,s)},stop(t){ls.removeBox(t,Sa.get(t)),Sa.delete(t)},beforeUpdate(t,e,i){const s=Sa.get(t);ls.configure(t,s,i),s.options=i},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Da={average(t){if(!t.length)return!1;let e,i,s=new Set,n=0,o=0;for(e=0,i=t.length;e<i;++e){const i=t[e].element;if(i&&i.hasValue()){const t=i.tooltipPosition();s.add(t.x),n+=t.y,++o}}if(0===o||0===s.size)return!1;return{x:[...s].reduce(((t,e)=>t+e))/s.size,y:n/o}},nearest(t,e){if(!t.length)return!1;let i,s,n,o=e.x,a=e.y,r=Number.POSITIVE_INFINITY;for(i=0,s=t.length;i<s;++i){const s=t[i].element;if(s&&s.hasValue()){const t=q(e,s.getCenterPoint());t<r&&(r=t,n=s)}}if(n){const t=n.tooltipPosition();o=t.x,a=t.y}return{x:o,y:a}}};function Ca(t,e){return e&&(n(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function Oa(t){return("string"==typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function Aa(t,e){const{element:i,datasetIndex:s,index:n}=e,o=t.getDatasetMeta(s).controller,{label:a,value:r}=o.getLabelAndValue(n);return{chart:t,label:a,parsed:o.getParsed(n),raw:t.data.datasets[s].data[n],formattedValue:r,dataset:o.getDataset(),dataIndex:n,datasetIndex:s,element:i}}function Ta(t,e){const i=t.chart.ctx,{body:s,footer:n,title:o}=t,{boxWidth:a,boxHeight:r}=e,l=Si(e.bodyFont),h=Si(e.titleFont),c=Si(e.footerFont),d=o.length,f=n.length,g=s.length,p=ki(e.padding);let m=p.height,x=0,b=s.reduce(((t,e)=>t+e.before.length+e.lines.length+e.after.length),0);if(b+=t.beforeBody.length+t.afterBody.length,d&&(m+=d*h.lineHeight+(d-1)*e.titleSpacing+e.titleMarginBottom),b){m+=g*(e.displayColors?Math.max(r,l.lineHeight):l.lineHeight)+(b-g)*l.lineHeight+(b-1)*e.bodySpacing}f&&(m+=e.footerMarginTop+f*c.lineHeight+(f-1)*e.footerSpacing);let _=0;const y=function(t){x=Math.max(x,i.measureText(t).width+_)};return i.save(),i.font=h.string,u(t.title,y),i.font=l.string,u(t.beforeBody.concat(t.afterBody),y),_=e.displayColors?a+2+e.boxPadding:0,u(s,(t=>{u(t.before,y),u(t.lines,y),u(t.after,y)})),_=0,i.font=c.string,u(t.footer,y),i.restore(),x+=p.width,{width:x,height:m}}function La(t,e,i,s){const{x:n,width:o}=i,{width:a,chartArea:{left:r,right:l}}=t;let h="center";return"center"===s?h=n<=(r+l)/2?"left":"right":n<=o/2?h="left":n>=a-o/2&&(h="right"),function(t,e,i,s){const{x:n,width:o}=s,a=i.caretSize+i.caretPadding;return"left"===t&&n+o+a>e.width||"right"===t&&n-o-a<0||void 0}(h,t,e,i)&&(h="center"),h}function Ea(t,e,i){const s=i.yAlign||e.yAlign||function(t,e){const{y:i,height:s}=e;return i<s/2?"top":i>t.height-s/2?"bottom":"center"}(t,i);return{xAlign:i.xAlign||e.xAlign||La(t,e,i,s),yAlign:s}}function Ra(t,e,i,s){const{caretSize:n,caretPadding:o,cornerRadius:a}=t,{xAlign:r,yAlign:l}=i,h=n+o,{topLeft:c,topRight:d,bottomLeft:u,bottomRight:f}=wi(a);let g=function(t,e){let{x:i,width:s}=t;return"right"===e?i-=s:"center"===e&&(i-=s/2),i}(e,r);const p=function(t,e,i){let{y:s,height:n}=t;return"top"===e?s+=i:s-="bottom"===e?n+i:n/2,s}(e,l,h);return"center"===l?"left"===r?g+=h:"right"===r&&(g-=h):"left"===r?g-=Math.max(c,u)+n:"right"===r&&(g+=Math.max(d,f)+n),{x:Z(g,0,s.width-e.width),y:Z(p,0,s.height-e.height)}}function Ia(t,e,i){const s=ki(i.padding);return"center"===e?t.x+t.width/2:"right"===e?t.x+t.width-s.right:t.x+s.left}function za(t){return Ca([],Oa(t))}function Fa(t,e){const i=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return i?t.override(i):t}const Va={beforeTitle:e,title(t){if(t.length>0){const e=t[0],i=e.chart.data.labels,s=i?i.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(s>0&&e.dataIndex<s)return i[e.dataIndex]}return""},afterTitle:e,beforeBody:e,beforeLabel:e,label(t){if(this&&this.options&&"dataset"===this.options.mode)return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const i=t.formattedValue;return s(i)||(e+=i),e},labelColor(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:e,afterBody:e,beforeFooter:e,footer:e,afterFooter:e};function Ba(t,e,i,s){const n=t[e].call(i,s);return void 0===n?Va[e].call(i,s):n}class Wa extends $s{static positioners=Da;constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),s=i.enabled&&e.options.animation&&i.animations,n=new Ts(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(n)),n}getContext(){return this.$context||(this.$context=(t=this.chart.getContext(),e=this,i=this._tooltipItems,Ci(t,{tooltip:e,tooltipItems:i,type:"tooltip"})));var t,e,i}getTitle(t,e){const{callbacks:i}=e,s=Ba(i,"beforeTitle",this,t),n=Ba(i,"title",this,t),o=Ba(i,"afterTitle",this,t);let a=[];return a=Ca(a,Oa(s)),a=Ca(a,Oa(n)),a=Ca(a,Oa(o)),a}getBeforeBody(t,e){return za(Ba(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:i}=e,s=[];return u(t,(t=>{const e={before:[],lines:[],after:[]},n=Fa(i,t);Ca(e.before,Oa(Ba(n,"beforeLabel",this,t))),Ca(e.lines,Ba(n,"label",this,t)),Ca(e.after,Oa(Ba(n,"afterLabel",this,t))),s.push(e)})),s}getAfterBody(t,e){return za(Ba(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:i}=e,s=Ba(i,"beforeFooter",this,t),n=Ba(i,"footer",this,t),o=Ba(i,"afterFooter",this,t);let a=[];return a=Ca(a,Oa(s)),a=Ca(a,Oa(n)),a=Ca(a,Oa(o)),a}_createItems(t){const e=this._active,i=this.chart.data,s=[],n=[],o=[];let a,r,l=[];for(a=0,r=e.length;a<r;++a)l.push(Aa(this.chart,e[a]));return t.filter&&(l=l.filter(((e,s,n)=>t.filter(e,s,n,i)))),t.itemSort&&(l=l.sort(((e,s)=>t.itemSort(e,s,i)))),u(l,(e=>{const i=Fa(t.callbacks,e);s.push(Ba(i,"labelColor",this,e)),n.push(Ba(i,"labelPointStyle",this,e)),o.push(Ba(i,"labelTextColor",this,e))})),this.labelColors=s,this.labelPointStyles=n,this.labelTextColors=o,this.dataPoints=l,l}update(t,e){const i=this.options.setContext(this.getContext()),s=this._active;let n,o=[];if(s.length){const t=Da[i.position].call(this,s,this._eventPosition);o=this._createItems(i),this.title=this.getTitle(o,i),this.beforeBody=this.getBeforeBody(o,i),this.body=this.getBody(o,i),this.afterBody=this.getAfterBody(o,i),this.footer=this.getFooter(o,i);const e=this._size=Ta(this,i),a=Object.assign({},t,e),r=Ea(this.chart,i,a),l=Ra(i,a,r,this.chart);this.xAlign=r.xAlign,this.yAlign=r.yAlign,n={opacity:1,x:l.x,y:l.y,width:e.width,height:e.height,caretX:t.x,caretY:t.y}}else 0!==this.opacity&&(n={opacity:0});this._tooltipItems=o,this.$context=void 0,n&&this._resolveAnimations().update(this,n),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,s){const n=this.getCaretPosition(t,i,s);e.lineTo(n.x1,n.y1),e.lineTo(n.x2,n.y2),e.lineTo(n.x3,n.y3)}getCaretPosition(t,e,i){const{xAlign:s,yAlign:n}=this,{caretSize:o,cornerRadius:a}=i,{topLeft:r,topRight:l,bottomLeft:h,bottomRight:c}=wi(a),{x:d,y:u}=t,{width:f,height:g}=e;let p,m,x,b,_,y;return"center"===n?(_=u+g/2,"left"===s?(p=d,m=p-o,b=_+o,y=_-o):(p=d+f,m=p+o,b=_-o,y=_+o),x=p):(m="left"===s?d+Math.max(r,h)+o:"right"===s?d+f-Math.max(l,c)-o:this.caretX,"top"===n?(b=u,_=b-o,p=m-o,x=m+o):(b=u+g,_=b+o,p=m+o,x=m-o),y=b),{x1:p,x2:m,x3:x,y1:b,y2:_,y3:y}}drawTitle(t,e,i){const s=this.title,n=s.length;let o,a,r;if(n){const l=Oi(i.rtl,this.x,this.width);for(t.x=Ia(this,i.titleAlign,i),e.textAlign=l.textAlign(i.titleAlign),e.textBaseline="middle",o=Si(i.titleFont),a=i.titleSpacing,e.fillStyle=i.titleColor,e.font=o.string,r=0;r<n;++r)e.fillText(s[r],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+a,r+1===n&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,e,i,s,n){const a=this.labelColors[i],r=this.labelPointStyles[i],{boxHeight:l,boxWidth:h}=n,c=Si(n.bodyFont),d=Ia(this,"left",n),u=s.x(d),f=l<c.lineHeight?(c.lineHeight-l)/2:0,g=e.y+f;if(n.usePointStyle){const e={radius:Math.min(h,l)/2,pointStyle:r.pointStyle,rotation:r.rotation,borderWidth:1},i=s.leftForLtr(u,h)+h/2,o=g+l/2;t.strokeStyle=n.multiKeyBackground,t.fillStyle=n.multiKeyBackground,Le(t,e,i,o),t.strokeStyle=a.borderColor,t.fillStyle=a.backgroundColor,Le(t,e,i,o)}else{t.lineWidth=o(a.borderWidth)?Math.max(...Object.values(a.borderWidth)):a.borderWidth||1,t.strokeStyle=a.borderColor,t.setLineDash(a.borderDash||[]),t.lineDashOffset=a.borderDashOffset||0;const e=s.leftForLtr(u,h),i=s.leftForLtr(s.xPlus(u,1),h-2),r=wi(a.borderRadius);Object.values(r).some((t=>0!==t))?(t.beginPath(),t.fillStyle=n.multiKeyBackground,He(t,{x:e,y:g,w:h,h:l,radius:r}),t.fill(),t.stroke(),t.fillStyle=a.backgroundColor,t.beginPath(),He(t,{x:i,y:g+1,w:h-2,h:l-2,radius:r}),t.fill()):(t.fillStyle=n.multiKeyBackground,t.fillRect(e,g,h,l),t.strokeRect(e,g,h,l),t.fillStyle=a.backgroundColor,t.fillRect(i,g+1,h-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:s}=this,{bodySpacing:n,bodyAlign:o,displayColors:a,boxHeight:r,boxWidth:l,boxPadding:h}=i,c=Si(i.bodyFont);let d=c.lineHeight,f=0;const g=Oi(i.rtl,this.x,this.width),p=function(i){e.fillText(i,g.x(t.x+f),t.y+d/2),t.y+=d+n},m=g.textAlign(o);let x,b,_,y,v,M,w;for(e.textAlign=o,e.textBaseline="middle",e.font=c.string,t.x=Ia(this,m,i),e.fillStyle=i.bodyColor,u(this.beforeBody,p),f=a&&"right"!==m?"center"===o?l/2+h:l+2+h:0,y=0,M=s.length;y<M;++y){for(x=s[y],b=this.labelTextColors[y],e.fillStyle=b,u(x.before,p),_=x.lines,a&&_.length&&(this._drawColorBox(e,t,y,g,i),d=Math.max(c.lineHeight,r)),v=0,w=_.length;v<w;++v)p(_[v]),d=c.lineHeight;u(x.after,p)}f=0,d=c.lineHeight,u(this.afterBody,p),t.y-=n}drawFooter(t,e,i){const s=this.footer,n=s.length;let o,a;if(n){const r=Oi(i.rtl,this.x,this.width);for(t.x=Ia(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=r.textAlign(i.footerAlign),e.textBaseline="middle",o=Si(i.footerFont),e.fillStyle=i.footerColor,e.font=o.string,a=0;a<n;++a)e.fillText(s[a],r.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+i.footerSpacing}}drawBackground(t,e,i,s){const{xAlign:n,yAlign:o}=this,{x:a,y:r}=t,{width:l,height:h}=i,{topLeft:c,topRight:d,bottomLeft:u,bottomRight:f}=wi(s.cornerRadius);e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,e.lineWidth=s.borderWidth,e.beginPath(),e.moveTo(a+c,r),"top"===o&&this.drawCaret(t,e,i,s),e.lineTo(a+l-d,r),e.quadraticCurveTo(a+l,r,a+l,r+d),"center"===o&&"right"===n&&this.drawCaret(t,e,i,s),e.lineTo(a+l,r+h-f),e.quadraticCurveTo(a+l,r+h,a+l-f,r+h),"bottom"===o&&this.drawCaret(t,e,i,s),e.lineTo(a+u,r+h),e.quadraticCurveTo(a,r+h,a,r+h-u),"center"===o&&"left"===n&&this.drawCaret(t,e,i,s),e.lineTo(a,r+c),e.quadraticCurveTo(a,r,a+c,r),e.closePath(),e.fill(),s.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,s=i&&i.x,n=i&&i.y;if(s||n){const i=Da[t.position].call(this,this._active,this._eventPosition);if(!i)return;const o=this._size=Ta(this,t),a=Object.assign({},i,this._size),r=Ea(e,t,a),l=Ra(t,a,r,e);s._to===l.x&&n._to===l.y||(this.xAlign=r.xAlign,this.yAlign=r.yAlign,this.width=o.width,this.height=o.height,this.caretX=i.x,this.caretY=i.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const s={width:this.width,height:this.height},n={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const o=ki(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(n,t,s,e),Ai(t,e.textDirection),n.y+=o.top,this.drawTitle(n,t,e),this.drawBody(n,t,e),this.drawFooter(n,t,e),Ti(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,s=t.map((({datasetIndex:t,index:e})=>{const i=this.chart.getDatasetMeta(t);if(!i)throw new Error("Cannot find a dataset at index "+t);return{datasetIndex:t,element:i.data[e],index:e}})),n=!f(i,s),o=this._positionChanged(s,e);(n||o)&&(this._active=s,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,n=this._active||[],o=this._getActiveElements(t,n,e,i),a=this._positionChanged(o,t),r=e||!f(o,n)||a;return r&&(this._active=o,(s.enabled||s.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),r}_getActiveElements(t,e,i,s){const n=this.options;if("mouseout"===t.type)return[];if(!s)return e.filter((t=>this.chart.data.datasets[t.datasetIndex]&&void 0!==this.chart.getDatasetMeta(t.datasetIndex).controller.getParsed(t.index)));const o=this.chart.getElementsAtEventForMode(t,n.mode,n,i);return n.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:i,caretY:s,options:n}=this,o=Da[n.position].call(this,t,e);return!1!==o&&(i!==o.x||s!==o.y)}}var Na={id:"tooltip",_element:Wa,positioners:Da,afterInit(t,e,i){i&&(t.tooltip=new Wa({chart:t,options:i}))},beforeUpdate(t,e,i){t.tooltip&&t.tooltip.initialize(i)},reset(t,e,i){t.tooltip&&t.tooltip.initialize(i)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const i={tooltip:e};if(!1===t.notifyPlugins("beforeTooltipDraw",{...i,cancelable:!0}))return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",i)}},afterEvent(t,e){if(t.tooltip){const i=e.replay;t.tooltip.handleEvent(e.event,i,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Va},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>"filter"!==t&&"itemSort"!==t&&"external"!==t,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};return Tn.register(Un,$o,go,t),Tn.helpers={...Hi},Tn._adapters=In,Tn.Animation=As,Tn.Animations=Ts,Tn.animator=bt,Tn.controllers=nn.controllers.items,Tn.DatasetController=js,Tn.Element=$s,Tn.elements=go,Tn.Interaction=Ki,Tn.layouts=ls,Tn.platforms=Ds,Tn.Scale=tn,Tn.Ticks=ae,Object.assign(Tn,Un,$o,go,t,Ds),Tn.Chart=Tn,"undefined"!=typeof window&&(window.Chart=Tn),Tn}));
//# sourceMappingURL=chart.umd.min.js.map

  </script>
  <script>
    // Fallbacks: ensure navigation functions exist early
    window.showSection = window.showSection || function(id) {
      try {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.bottom-nav-item').forEach(i => i.classList.remove('active'));

        const section = document.getElementById(id);
        if (section) section.classList.add('active');

        document.querySelectorAll('.tab, .bottom-nav-item').forEach(el => {
          const onclick = el.getAttribute('onclick') || '';
          if (onclick.includes("'" + id + "'") || onclick.includes('"' + id + '"')) {
            el.classList.add('active');
          }
        });

        window.scrollTo({ top: 0, behavior: 'smooth' });
      } catch (e) {
        console.error('showSection fallback failed', e);
      }
    };
    window.oeffneLoginModal = window.oeffneLoginModal || function() {};
    window.abmelden = window.abmelden || function() {};
    window.closeModal = window.closeModal || function() {};
    window.aendereSpracheSelect = window.aendereSpracheSelect || function() {
      try {
        const select = document.getElementById('spracheSelect');
        if (!select) return;
        const value = select.value || 'de';
        if (typeof window.aendereSprache === 'function') {
          window.aendereSprache(value);
        } else {
          // Fallback: only update localStorage and reload UI
          try { localStorage.setItem('sprache', value); } catch (_) {}
          if (typeof window.aktualisiereSprachAnzeige === 'function') {
            window.aktualisiereSprachAnzeige();
          }
        }
      } catch (e) {
        console.error('aendereSpracheSelect fallback failed', e);
      }
    };

    // Bind navigation clicks without relying on inline onclick
    function bindNavClicks() {
      const navEls = document.querySelectorAll('[data-section]');
      navEls.forEach(el => {
        const id = el.getAttribute('data-section');
        if (!id) return;
        el.removeAttribute('onclick');
        el.addEventListener('click', (e) => {
          e.preventDefault();
          window.showSection(id);
        });
      });
      // Mark the first tab as active by default
      window.showSection('home');
    }

    document.addEventListener('DOMContentLoaded', bindNavClicks);
  </script>
</head>
<body>
  <header class="site-header">
    <div class="logo-section">
      <img class="logo-image logo-dark" src="assets/logo-calculo-dark.png" alt="Calculo Logo">
      <img class="logo-image logo-light" src="assets/logo-calculo-light.png" alt="Calculo Logo">
    </div>
    <div class="nav-section">
      <button class="tab active" data-section="home" onclick="showSection('home')">Home</button>
      <button class="tab" data-section="trading" onclick="showSection('trading')">Trading</button>
      <button class="tab" data-section="sparen" onclick="showSection('sparen')">Sparen</button>
      <button id="etfTab" class="tab" data-section="etf" onclick="showSection('etf')" style="white-space:nowrap">ETF Vergleich</button>
      <button class="tab" data-section="settings" onclick="showSection('settings')">Einstellungen</button>
      <button id="loginBtn" class="btn btn-primary" onclick="oeffneLoginModal()" style="margin-left:12px;padding:10px 20px">
        <span id="loginBtnText">Anmelden</span>
      </button>
      <button id="userBtn" class="btn" onclick="abmelden()" style="margin-left:12px;padding:10px 20px;background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);color:var(--accent);display:none">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:6px"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
        <span id="userEmail"></span>
      </button>
    </div>
  </header>

  <div class="header-spacer"></div>

  <div id="launchCountdownBanner" style="display:none;max-width:1200px;margin:12px auto 0;padding:0 20px">
    <div style="background:linear-gradient(135deg, rgba(59,130,246,0.12), rgba(168,85,247,0.12));border:1px solid rgba(59,130,246,0.35);border-radius:14px;padding:14px 16px;text-align:center">
      <div id="launchBannerTitle" style="font-size:15px;font-weight:700;color:var(--text);margin-bottom:4px"></div>
      <div id="launchBannerTimer" style="font-size:13px;color:var(--muted)"></div>
    </div>
  </div>

  <!-- Home -->
  <section id="home" class="section active">
    <div class="container" style="max-width:900px">
      <!-- Hero Section -->
      <div style="text-align:center;padding:60px 20px 40px">
        <h1 style="font-size:clamp(2.5rem, 5vw, 4rem);font-weight:800;line-height:1.1;margin-bottom:24px;background:linear-gradient(135deg, var(--accent), var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">
          Professionelles Trading.<br>Einfach kalkuliert.
        </h1>
        <p style="font-size:1.2rem;color:var(--muted);max-width:600px;margin:0 auto 40px;line-height:1.6">
          Berechne deine Trades präzise, plane langfristig und maximiere deine Rendite - alles in einem Tool. Mit optionalem Pro-Account für erweiterte Features.
        </p>
        <div style="display:flex;gap:16px;justify-content:center;flex-wrap:wrap">
          <button class="btn btn-primary" onclick="starteApp()" style="padding:16px 32px;font-size:16px">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 5 5 12"></polyline></svg>
            Jetzt starten
          </button>
          <button class="btn" onclick="document.getElementById('wie-es-funktioniert').scrollIntoView({behavior:'smooth',block:'start'})" style="padding:16px 32px;font-size:16px;background:rgba(255,255,255,0.05);color:var(--text)">
            Mehr erfahren
          </button>
        </div>
      </div>

      <!-- Feature Grid -->
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-top:60px">
        <!-- Feature 1 -->
        <div onclick="starteApp()" style="background:linear-gradient(135deg, rgba(16,185,129,0.1), rgba(16,185,129,0.05));border:1px solid rgba(16,185,129,0.2);border-radius:16px;padding:32px;transition:transform 0.3s;cursor:pointer" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
          <div style="width:56px;height:56px;background:linear-gradient(135deg, var(--accent), #34d399);border-radius:12px;display:flex;align-items:center;justify-content:center;margin-bottom:20px">
            <svg width="28" height="28" fill="none" stroke="white" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 5 5 12"></polyline></svg>
          </div>
          <h3 id="featureTradingTitle" style="font-size:1.3rem;font-weight:700;margin-bottom:12px;color:var(--text)">Trading Rechner</h3>
          <p id="featureTradingDesc" style="color:var(--muted);line-height:1.6;font-size:14px">Berechne Gewinne, Renditen, Break-Even, CRV und mehr. Mit Hebel-Funktion, Stop-Loss und präzisen Steuer- und Gebührenberechnungen.</p>
        </div>

        <!-- Feature 2 -->
        <div onclick="showSection('sparen')" style="background:linear-gradient(135deg, rgba(59,130,246,0.1), rgba(59,130,246,0.05));border:1px solid rgba(59,130,246,0.2);border-radius:16px;padding:32px;transition:transform 0.3s;cursor:pointer" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
          <div style="width:56px;height:56px;background:linear-gradient(135deg, var(--blue), #60a5fa);border-radius:12px;display:flex;align-items:center;justify-content:center;margin-bottom:20px">
            <svg width="28" height="28" fill="none" stroke="white" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
          </div>
          <h3 id="featureSavingsTitle" style="font-size:1.3rem;font-weight:700;margin-bottom:12px;color:var(--text)">Sparrechner</h3>
          <p id="featureSavingsDesc" style="color:var(--muted);line-height:1.6;font-size:14px">Plane deine finanzielle Zukunft mit intelligenten Sparraten, Zinseszins-Berechnungen und Inflations-Analysen (Pro).</p>
        </div>

        <!-- Feature 3 -->
        <div onclick="showSection('settings')" style="background:linear-gradient(135deg, rgba(168,85,247,0.1), rgba(168,85,247,0.05));border:1px solid rgba(168,85,247,0.2);border-radius:16px;padding:32px;transition:transform 0.3s;cursor:pointer" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
          <div style="width:56px;height:56px;background:linear-gradient(135deg, var(--purple), #c084fc);border-radius:12px;display:flex;align-items:center;justify-content:center;margin-bottom:20px">
            <svg width="28" height="28" fill="none" stroke="white" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
          </div>
          <h3 id="featureProTitle" style="font-size:1.3rem;font-weight:700;margin-bottom:12px;color:var(--text)">Pro Account</h3>
          <p id="featureProDesc" style="color:var(--muted);line-height:1.6;font-size:14px">Unbegrenzte Trades, ETF-Datenbank, Inflations- & Steuerrechner, PDF/CSV Export und werbefrei - für nur 1,99€/Monat.</p>
        </div>
      </div>

      <!-- Stats Section -->
      <div id="statsSection" style="background:linear-gradient(135deg, rgba(16,185,129,0.05), rgba(59,130,246,0.05));border:1px solid var(--border);border-radius:20px;padding:48px 32px;margin-top:60px;text-align:center">
        <h2 id="statsTitle" style="font-size:2rem;font-weight:800;margin-bottom:16px;color:var(--text)">Finanzplanung neu gedacht</h2>
        <p id="statsDesc" style="color:var(--muted);font-size:1.1rem;max-width:700px;margin:0 auto 40px;line-height:1.6">
          Optimiert für Trading, Sparen und Investments. Mit automatischer Steuerberechnung nach deutschem Recht, Hebel-Trading, Stop-Loss Management und intuitiver Benutzeroberfläche.
        </p>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:32px;margin-top:48px">
          <div>
            <div style="font-size:2.5rem;font-weight:800;color:var(--accent);margin-bottom:8px" id="homeSteuersatz">26,375%</div>
            <div id="statLabel1" style="color:var(--muted);font-size:14px">Abgeltungssteuer</div>
          </div>
          <div id="homeFreibetragStat">
            <div id="homeFreibetrag" style="font-size:2.5rem;font-weight:800;color:var(--blue);margin-bottom:8px">1.000 €</div>
            <div id="statLabel2" style="color:var(--muted);font-size:14px">Steuerfreibetrag</div>
          </div>
          <div>
            <div style="font-size:2.5rem;font-weight:800;color:var(--purple);margin-bottom:8px">1,99€</div>
            <div id="statLabel3" style="color:var(--muted);font-size:14px">Pro / Monat</div>
          </div>
        </div>
      </div>

      <!-- Wie es funktioniert -->
      <div id="wie-es-funktioniert" style="margin-top:80px;scroll-margin-top:100px">
        <h2 style="font-size:2rem;font-weight:800;text-align:center;margin-bottom:48px;color:var(--text)">Wie es funktioniert</h2>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:32px">
          <div style="text-align:center">
            <div style="width:64px;height:64px;background:rgba(16,185,129,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;border:2px solid rgba(16,185,129,0.3)">
              <span style="font-size:24px;font-weight:800;color:var(--accent)">1</span>
            </div>
            <h3 style="font-size:1.2rem;font-weight:700;margin-bottom:12px;color:var(--text)">Werte eingeben</h3>
            <p style="color:var(--muted);line-height:1.6">Trage deine Trading-Daten ein: Einstiegskurs, Stückzahl und Zielkurs. Optional kannst du auch Nachkäufe und Teilverkäufe simulieren.</p>
          </div>
          <div style="text-align:center">
            <div style="width:64px;height:64px;background:rgba(59,130,246,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;border:2px solid rgba(59,130,246,0.3)">
              <span style="font-size:24px;font-weight:800;color:var(--blue)">2</span>
            </div>
            <h3 style="font-size:1.2rem;font-weight:700;margin-bottom:12px;color:var(--text)">Automatische Berechnung</h3>
            <p id="step2Desc" style="color:var(--muted);line-height:1.6">Das Tool berechnet automatisch deinen Netto-Gewinn unter Berücksichtigung von Broker-Gebühren und der deutschen Abgeltungssteuer.</p>
          </div>
          <div style="text-align:center">
            <div style="width:64px;height:64px;background:rgba(168,85,247,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;border:2px solid rgba(168,85,247,0.3)">
              <span style="font-size:24px;font-weight:800;color:var(--purple)">3</span>
            </div>
            <h3 style="font-size:1.2rem;font-weight:700;margin-bottom:12px;color:var(--text)">Position speichern</h3>
            <p style="color:var(--muted);line-height:1.6">Speichere deine Trades in der Historie und behalte den Überblick über deine Performance und den verbleibenden Steuerfreibetrag.</p>
          </div>
          <div style="text-align:center">
            <div style="width:64px;height:64px;background:rgba(251,146,60,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;border:2px solid rgba(251,146,60,0.3)">
              <span style="font-size:24px;font-weight:800;color:#fb923c">4</span>
            </div>
            <h3 style="font-size:1.2rem;font-weight:700;margin-bottom:12px;color:var(--text)">Performance verfolgen</h3>
            <p style="color:var(--muted);line-height:1.6">Analysiere deine Trading-Erfolge mit detaillierten Charts und behalte alle wichtigen Kennzahlen im Blick.</p>
          </div>
        </div>
      </div>

      <!-- Vorteile -->
      <div style="margin-top:80px">
        <h2 style="font-size:2rem;font-weight:800;text-align:center;margin-bottom:48px;color:var(--text)">Deine Vorteile</h2>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px">
          <div style="background:var(--input-bg);border:1px solid var(--border);border-radius:12px;padding:24px">
            <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px">
              <div style="width:48px;height:48px;background:linear-gradient(135deg, var(--accent), #34d399);border-radius:10px;display:flex;align-items:center;justify-content:center">
                <svg width="24" height="24" fill="none" stroke="white" stroke-width="2"><path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z"></path><path d="m9 12 2 2 4-4"></path></svg>
              </div>
              <h3 style="font-size:1.1rem;font-weight:700;color:var(--text)">Präzise Berechnungen</h3>
            </div>
            <p style="color:var(--muted);line-height:1.6">Exakte Gewinnberechnungen mit Berücksichtigung aller Gebühren und Steuern nach deutschem Recht.</p>
          </div>
          <div style="background:var(--input-bg);border:1px solid var(--border);border-radius:12px;padding:24px">
            <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px">
              <div style="width:48px;height:48px;background:linear-gradient(135deg, var(--blue), #60a5fa);border-radius:10px;display:flex;align-items:center;justify-content:center">
                <svg width="24" height="24" fill="none" stroke="white" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
              </div>
              <h3 style="font-size:1.1rem;font-weight:700;color:var(--text)">100% Datenschutz</h3>
            </div>
            <p style="color:var(--muted);line-height:1.6">Account-Daten werden sicher in der Cloud gespeichert (Firebase). Ohne Anmeldung bleiben Daten lokal im Browser.</p>
          </div>
          <div style="background:var(--input-bg);border:1px solid var(--border);border-radius:12px;padding:24px">
            <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px">
              <div style="width:48px;height:48px;background:linear-gradient(135deg, var(--purple), #c084fc);border-radius:10px;display:flex;align-items:center;justify-content:center">
                <svg width="24" height="24" fill="none" stroke="white" stroke-width="2"><path d="M13 2 3 14h9l-1 8 10-12h-9l1-8z"></path></svg>
              </div>
              <h3 style="font-size:1.1rem;font-weight:700;color:var(--text)">Blitzschnell</h3>
            </div>
            <p style="color:var(--muted);line-height:1.6">Keine Ladezeiten, sofortige Berechnungen. Arbeitet komplett offline nach dem ersten Laden.</p>
          </div>
          <div style="background:var(--input-bg);border:1px solid var(--border);border-radius:12px;padding:24px">
            <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px">
              <div style="width:48px;height:48px;background:linear-gradient(135deg, #f59e0b, #fbbf24);border-radius:10px;display:flex;align-items:center;justify-content:center">
                <svg width="24" height="24" fill="none" stroke="white" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
              </div>
              <h3 style="font-size:1.1rem;font-weight:700;color:var(--text)">Multi-Broker Support</h3>
            </div>
            <p style="color:var(--muted);line-height:1.6">Vorkonfigurierte Gebührenmodelle für Finanzen.net Zero, Smartbroker+, justTRADE, Trade Republic, Scalable Capital, Flatex, Comdirect, ING, Consorsbank, Commerzbank, DKB, Interactive Brokers und benutzerdefinierte Broker.</p>
          </div>
          <div style="background:var(--input-bg);border:1px solid var(--border);border-radius:12px;padding:24px">
            <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px">
              <div style="width:48px;height:48px;background:linear-gradient(135deg, #ef4444, #f87171);border-radius:10px;display:flex;align-items:center;justify-content:center">
                <svg width="24" height="24" fill="none" stroke="white" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6l4 2"></path></svg>
              </div>
              <h3 style="font-size:1.1rem;font-weight:700;color:var(--text)">Trading Historie</h3>
            </div>
            <p style="color:var(--muted);line-height:1.6">Speichere und verfolge all deine Trades mit detaillierten Informationen zu Gewinn, Rendite und Zeitpunkt.</p>
          </div>
          <div style="background:var(--input-bg);border:1px solid var(--border);border-radius:12px;padding:24px">
            <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px">
              <div style="width:48px;height:48px;background:linear-gradient(135deg, #06b6d4, #22d3ee);border-radius:10px;display:flex;align-items:center;justify-content:center">
                <svg width="24" height="24" fill="none" stroke="white" stroke-width="2"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg>
              </div>
              <h3 style="font-size:1.1rem;font-weight:700;color:var(--text)">Kostenlos starten</h3>
            </div>
            <p style="color:var(--muted);line-height:1.6">Komplett kostenlos nutzbar mit allen Basis-Features. Optional: Pro-Account für 1,99€/Monat mit erweiterten Funktionen.</p>
          </div>
        </div>
      </div>

      <!-- FAQ Sektion -->
      <div style="margin-top:80px;margin-bottom:60px">
        <h2 id="faqTitle" style="font-size:2rem;font-weight:800;text-align:center;margin-bottom:48px;color:var(--text)">Häufig gestellte Fragen</h2>
        <div style="max-width:700px;margin:0 auto">
          <div style="background:var(--input-bg);border:1px solid var(--border);border-radius:12px;padding:24px;margin-bottom:16px">
            <h3 id="faqQ1" style="font-size:1.1rem;font-weight:700;margin-bottom:12px;color:var(--text)">Wie werden meine Daten gespeichert?</h3>
            <p id="faqA1" style="color:var(--muted);line-height:1.6">Bei Anmeldung speichern wir Account-Daten sicher in der Cloud (Firebase/Firestore). Ohne Anmeldung bleiben Daten lokal im Browser.</p>
          </div>
          <div style="background:var(--input-bg);border:1px solid var(--border);border-radius:12px;padding:24px;margin-bottom:16px">
            <h3 id="faqQ2" style="font-size:1.1rem;font-weight:700;margin-bottom:12px;color:var(--text)">Welche Broker werden unterstützt?</h3>
            <p id="faqA2" style="color:var(--muted);line-height:1.6">Wir bieten vorkonfigurierte Gebührenmodelle für Finanzen.net Zero, Smartbroker+, justTRADE, Trade Republic, Scalable Capital, Flatex, Comdirect, ING, Consorsbank, Commerzbank, DKB und Interactive Brokers. Du kannst auch eigene Gebühren für jeden beliebigen Broker eingeben.</p>
          </div>
          <div style="background:var(--input-bg);border:1px solid var(--border);border-radius:12px;padding:24px;margin-bottom:16px">
            <h3 id="faqQ3" style="font-size:1.1rem;font-weight:700;margin-bottom:12px;color:var(--text)">Wie wird die Steuer berechnet?</h3>
            <p id="faqA3" style="color:var(--muted);line-height:1.6">Die Abgeltungssteuer in Deutschland beträgt 26,375% (25% Abgeltungssteuer + 5,5% Solidaritätszuschlag). Der Freibetrag von 1.000€ pro Jahr wird automatisch berücksichtigt.</p>
          </div>
          <div style="background:var(--input-bg);border:1px solid var(--border);border-radius:12px;padding:24px;margin-bottom:16px">
            <h3 id="faqQ4" style="font-size:1.1rem;font-weight:700;margin-bottom:12px;color:var(--text)">Kann ich zwischen Brutto und Netto wechseln?</h3>
            <p id="faqA4" style="color:var(--muted);line-height:1.6">Ja! Bei allen Berechnungen kannst du durch Klick auf die Gewinn-Anzeige zwischen Brutto (vor Steuern/Gebühren) und Netto (nach Abzug) wechseln.</p>
          </div>
          <div style="background:var(--input-bg);border:1px solid var(--border);border-radius:12px;padding:24px">
            <h3 id="faqQ5" style="font-size:1.1rem;font-weight:700;margin-bottom:12px;color:var(--text)">Brauche ich einen Account?</h3>
            <p id="faqA5" style="color:var(--muted);line-height:1.6">Ein Account ist optional. Ohne Anmeldung kannst du alle Rechner nutzen. Mit Account werden deine gespeicherten Positionen mit deinem Profil verknüpft.</p>
          </div>
        </div>
      </div>

      <!-- Feedback CTA -->
      <div style="margin-top:80px;margin-bottom:60px">
        <div onclick="showSection('feedback')" style="background:linear-gradient(135deg, rgba(16,185,129,0.15), rgba(16,185,129,0.05));border:2px solid rgba(16,185,129,0.3);border-radius:20px;padding:48px 32px;text-align:center;cursor:pointer;transition:all 0.3s" onmouseover="this.style.transform='translateY(-4px)';this.style.borderColor='rgba(16,185,129,0.5)'" onmouseout="this.style.transform='translateY(0)';this.style.borderColor='rgba(16,185,129,0.3)'">
          <div style="display:inline-flex;align-items:center;justify-content:center;width:64px;height:64px;background:var(--accent);border-radius:16px;margin-bottom:24px">
            <svg width="32" height="32" fill="none" stroke="white" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
          </div>
          <h2 id="feedbackCTATitle" style="font-size:1.8rem;font-weight:800;margin-bottom:16px;color:var(--text)">Deine Meinung zählt!</h2>
          <p id="feedbackCTADesc" style="color:var(--muted);font-size:1.1rem;max-width:600px;margin:0 auto 24px;line-height:1.6">
            Hilf uns, Trade noch besser zu machen. Teile deine Ideen, Wünsche oder melde Probleme - jedes Feedback wird geschätzt und berücksichtigt.
          </p>
          <div id="feedbackCTAButton" style="display:inline-flex;align-items:center;gap:8px;background:var(--accent);color:white;padding:14px 28px;border-radius:12px;font-weight:700;font-size:16px">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
            Feedback geben
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Trading -->
  <section id="trading" class="section">
    <div class="container">
      <div class="chart">
        <h2>Trading Rechner</h2>
        
        <div class="result-display">
          <div id="tradingGewinnLabel" class="result-label" style="cursor:pointer" onclick="toggleTradingAnzeige()">NETTO GEWINN 
            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-left:4px"><path d="M7 10l5 5 5-5M7 4l5 5 5-5"/></svg>
          </div>
          <div id="tradingGewinn" class="result-value" style="cursor:pointer" onclick="toggleTradingAnzeige()">0,00 €</div>
          <div id="tradingBadge" class="result-badge">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 5 5 12"></polyline></svg>
            <span id="tradingRendite">0,00%</span>
          </div>
          <div id="tradingSteuerInfo" style="display:none;margin-top:16px;padding:12px 16px;background:rgba(239,68,68,0.1);border-radius:10px;border:1px solid rgba(239,68,68,0.2)">
            <div id="tradingSteuerLabel" style="font-size:12px;color:var(--muted);margin-bottom:4px">Abgeltungssteuer (26,375%)</div>
            <div id="tradingSteuer" style="font-size:16px;font-weight:700;color:var(--danger)">0,00 €</div>
          </div>
        </div>

        <div id="analyseWerteContainer" style="margin-top:24px;margin-bottom:24px;display:flex;gap:12px">
          <div id="breakEvenContainer" style="flex:1;background:rgba(255,255,255,0.03);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.05);display:none">
            <div style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between">
              <span id="breakEvenLabel">BREAK-EVEN</span>
              <button onclick="zeigeBreakEvenInfo()" style="background:rgba(59,130,246,0.2);border:none;border-radius:50%;width:20px;height:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:0">
                <span style="color:var(--blue);font-weight:700;font-size:12px">i</span>
              </button>
            </div>
            <div id="breakEven" style="font-size:18px;font-weight:700;color:var(--blue)">0,00 €</div>
          </div>
          <div id="crvContainer" style="flex:1;background:rgba(255,255,255,0.03);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.05);position:relative;display:none">
            <div style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between">
              <span id="tradingCRVLabel">CRV (CHANCE/RISIKO)</span>
              <button onclick="zeigeCRVInfo()" style="background:rgba(168,85,247,0.2);border:none;border-radius:50%;width:20px;height:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:0">
                <span style="color:var(--purple);font-weight:700;font-size:12px">i</span>
              </button>
            </div>
            <div id="crv" style="font-size:18px;font-weight:700;color:var(--purple)">1:1</div>
          </div>
        </div>

        <label>
          <div class="label-text">Einstiegskurs</div>
          <div class="input-wrapper">
            <input id="einstieg" type="number" step="0.01" value="2.9" oninput="berechneTrading()">
            <span class="input-unit">€</span>
          </div>
        </label>

        <label>
          <div class="label-text">Stückzahl</div>
          <div class="input-wrapper">
            <input id="stueck" type="number" step="1" value="517" oninput="berechneTrading()">
            <span class="input-unit">Stk.</span>
          </div>
        </label>

        <label>
          <div class="label-text">Zielkurs</div>
          <div class="input-wrapper">
            <input id="ziel" type="number" step="0.01" value="3.25" oninput="berechneTrading()">
            <span class="input-unit">€</span>
          </div>
        </label>

        <label>
          <div class="label-text">Stop-Loss (Optional)</div>
          <div class="input-wrapper">
            <input id="stopLoss" type="number" step="0.01" value="" placeholder="Optional" oninput="berechneTrading()">
            <span class="input-unit">€</span>
          </div>
        </label>

        <label id="hebelFeld">
          <div class="label-text">Hebel (Leverage)</div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px;margin-bottom:8px">
            <input id="hebel" type="range" min="1" max="100" value="1" oninput="berechneTrading(); updateRangeSlider('hebel')" style="flex:1;margin-right:12px">
            <span style="color:var(--purple);font-weight:700;min-width:40px"><span id="hebelVal">1</span>x</span>
          </div>
        </label>

        <div class="btn-row">
          <button id="nachkaufBtn" class="btn btn-blue" onclick="nachkauf()">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>
            Nachkauf +
          </button>
          <button id="teilverkaufBtn" class="btn btn-purple" onclick="teilverkauf()">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="9" y1="9" x2="15" y2="15"></line><line x1="15" y1="9" x2="9" y2="15"></line></svg>
            Teilverkauf +
          </button>
        </div>

        <label style="margin-top:24px">
          <div id="positionNameLabel" class="label-text">Positions-Name (Optional)</div>
          <input id="posname" type="text" placeholder="z.B. Apple Long, Bitcoin Short..." style="font-size:14px;font-weight:400">
        </label>

        <button id="savePositionBtn" class="btn btn-primary" onclick="speicherePosition()" style="width:100%;margin-top:16px">
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
          Position speichern
        </button>

        <!-- Trading Historie -->
        <div style="margin-top:48px">
          <h3 id="tradingHistoryTitle" style="font-size:18px;font-weight:700;margin-bottom:20px;color:var(--text);display:flex;align-items:center;gap:12px">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3zM21 9H3M9 21V9"/></svg>
            Trading Historie
          </h3>
          
          <div id="gespeichertePositionen"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Sparen -->
  <section id="sparen" class="section">
    <div class="container">
      <div class="chart">
        <h2 id="sparenTitle">Sparrechner</h2>

        <div class="result-display">
          <div id="sparEndkapitalLabel" class="result-label" style="cursor:pointer" onclick="toggleSparAnzeige()">ENDKAPITAL (NETTO)
            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-left:4px"><path d="M7 10l5 5 5-5M7 4l5 5 5-5"/></svg>
          </div>
          <div id="sparEndkapital" class="result-value" style="cursor:pointer" onclick="toggleSparAnzeige()">0 €</div>
          <div id="sparBadge" class="result-badge">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 5 5 12"></polyline></svg>
            <span id="sparRendite">0,00%</span>
          </div>
        </div>

        <!-- Diagramm -->
        <div style="margin-top:24px;background:rgba(255,255,255,0.03);padding:20px;border-radius:12px;border:1px solid rgba(255,255,255,0.05)">
          <div id="sparVermogensentwicklungLabel" style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:16px">VERMÖGENSENTWICKLUNG</div>
          <canvas id="sparChart" style="max-height:300px"></canvas>
        </div>

        <div style="margin-top:24px;margin-bottom:24px;background:rgba(255,255,255,0.03);padding:20px;border-radius:12px;border:1px solid rgba(255,255,255,0.05)">
          <div id="sparBerechnungsmodusLabel" style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:12px">BERECHNUNGSMODUS</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <button id="btnEndkapital" class="btn" onclick="wechsleSparModus('endkapital')" style="background:linear-gradient(90deg,var(--accent),#34d399);color:#072017;padding:12px">
              Endkapital
            </button>
            <button id="btnZielRate" class="btn" onclick="wechsleSparModus('rate')" style="background:var(--input-bg);border:1px solid var(--border);color:var(--muted);padding:12px">
              Ziel-Rate
            </button>
          </div>
        </div>

        <label>
          <div class="label-text">Anfangskapital</div>
          <div class="input-wrapper">
            <input id="anfang" type="number" step="0.01" value="2000" oninput="berechneSpar()">
            <span class="input-unit">€</span>
          </div>
        </label>

        <div id="zielRateEingabe" style="display:none">
          <label>
            <div class="label-text">Gewünschtes Endkapital</div>
            <div class="input-wrapper">
              <input id="zielEndkapital" type="number" step="1" value="100000" oninput="berechneSpar()">
              <span class="input-unit">€</span>
            </div>
          </label>
        </div>

        <label id="sparrateLabel">
          <div class="label-text">Sparrate (Monatlich)</div>
          <div class="input-wrapper">
            <input id="rate" type="number" step="0.01" value="200" oninput="berechneSpar()">
            <span class="input-unit">€</span>
          </div>
        </label>

        <label>
          <div style="display:flex;justify-content:space-between;margin-bottom:8px">
            <span class="label-text" style="margin:0">Laufzeit: <span id="zeitVal" style="color:var(--accent);font-weight:700">15</span> Jahre</span>
          </div>
          <input id="zeit" type="range" min="1" max="50" value="15" oninput="berechneSpar(); updateRangeSlider('zeit')">
        </label>

        <label>
          <div class="label-text">Zinssatz p.a.</div>
          <div class="input-wrapper">
            <input id="zins" type="number" step="0.1" value="5.0" oninput="berechneSpar()">
            <span class="input-unit">%</span>
          </div>
        </label>

        <div style="margin-top:24px;display:flex;gap:12px">
          <div style="flex:1;background:rgba(255,255,255,0.03);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.05)">
            <div id="sparEinzahlungenLabel" style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between">
              Einzahlungen
              <button onclick="zeigeEinzahlungenInfo()" style="background:rgba(16,185,129,0.2);border:none;border-radius:50%;width:20px;height:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:0">
                <span style="color:var(--accent);font-weight:700;font-size:12px">i</span>
              </button>
            </div>
            <div id="sparEinzahlungen" style="font-size:18px;font-weight:700;color:var(--text)">0 €</div>
          </div>
          <div style="flex:1;background:rgba(255,255,255,0.03);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.05)">
            <div id="sparReinerZinsLabel" style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between">
              REINER ZINS
              <button onclick="zeigeReinerZinsInfo()" style="background:rgba(16,185,129,0.2);border:none;border-radius:50%;width:20px;height:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:0">
                <span style="color:var(--accent);font-weight:700;font-size:12px">i</span>
              </button>
            </div>
            <div id="sparZinsen" style="font-size:18px;font-weight:700;color:var(--accent)">0 €</div>
          </div>
        </div>
        
        <!-- Pro Features -->
        <div id="sparProFeatures" style="margin-top:12px;display:none;gap:12px">
          <div style="flex:1;background:rgba(168,85,247,0.05);padding:16px;border-radius:12px;border:1px solid rgba(168,85,247,0.2);position:relative">
            <div style="position:absolute;top:8px;right:8px;background:var(--purple);color:white;padding:2px 8px;border-radius:12px;font-size:9px;font-weight:700">PRO</div>
            <div style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">REALWERT (INFLATIONSBER.)</div>
            <div id="sparRealwert" style="font-size:18px;font-weight:700;color:var(--purple)">0 €</div>
          </div>
          <div style="flex:1;background:rgba(168,85,247,0.05);padding:16px;border-radius:12px;border:1px solid rgba(168,85,247,0.2);position:relative">
            <div style="position:absolute;top:8px;right:8px;background:var(--purple);color:white;padding:2px 8px;border-radius:12px;font-size:9px;font-weight:700">PRO</div>
            <div style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">STEUERN</div>
            <div id="sparSteuern" style="font-size:18px;font-weight:700;color:var(--purple)">0 €</div>
          </div>
        </div>
        
        <div id="sparProTeaser" style="margin-top:12px;background:rgba(168,85,247,0.05);border:1px solid rgba(168,85,247,0.2);border-radius:12px;padding:20px;text-align:center;display:block">
          <div style="font-size:14px;font-weight:600;color:var(--text);margin-bottom:8px">Mehr Details mit Calculo Pro</div>
          <div style="font-size:12px;color:var(--muted);margin-bottom:16px">Sieh Realwert und Steuern deiner Sparpläne</div>
          <div style="display:flex;justify-content:center">
            <button class="btn upgrade-pro" data-upgrade-target="" onclick="upgradeToPro()" style="background:linear-gradient(90deg,var(--purple),#c084fc);color:#fff;padding:10px 24px;font-size:14px">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:6px"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
              Upgrade für 1,99€/Monat
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ETF Vergleich -->
  <section id="etf" class="section">
    <div class="container" style="text-align:center">
      <div class="chart">
        <div style="text-align:center;padding:20px;background:rgba(168,85,247,0.05);border:1px solid rgba(168,85,247,0.2);border-radius:12px;margin-bottom:24px">
          <div style="display:inline-flex;align-items:center;gap:8px;background:var(--purple);color:white;padding:6px 16px;border-radius:20px;margin-bottom:12px">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
            <span style="font-weight:700;font-size:12px">PRO FEATURE</span>
          </div>
          <h2 id="etfCompareTitle" style="margin-bottom:8px">ETF Vergleich</h2>
          <p id="etfCompareSubtitle" style="color:var(--muted);font-size:14px">Vergleiche historische Durchschnittsrenditen beliebter ETFs</p>
        </div>

        <!-- Free User View -->
        <div id="etfFreeView" style="display:block">
          <!-- Main CTA Section -->
          <div style="background:linear-gradient(135deg,rgba(168,85,247,0.2),rgba(168,85,247,0.08),rgba(59,130,246,0.12));border:2px solid rgba(168,85,247,0.5);border-radius:28px;padding:clamp(40px,8vw,56px) clamp(28px,6vw,44px);margin-bottom:clamp(40px,8vw,56px);position:relative;overflow:hidden">
            <!-- Animated Gradient Orbs -->
            <div style="position:absolute;top:clamp(-80px,-20vw,-120px);right:clamp(-80px,-20vw,-120px);width:clamp(250px,50vw,500px);height:clamp(250px,50vw,500px);background:radial-gradient(circle,rgba(168,85,247,0.5),transparent);border-radius:50%;pointer-events:none;animation:pulse 5s ease-in-out infinite"></div>
            <div style="position:absolute;bottom:clamp(-50px,-18vw,-100px);left:clamp(-50px,-18vw,-100px);width:clamp(200px,40vw,350px);height:clamp(200px,40vw,350px);background:radial-gradient(circle,rgba(59,130,246,0.35),transparent);border-radius:50%;pointer-events:none;animation:pulse 6s ease-in-out infinite 0.8s"></div>
            
            <div style="position:relative;z-index:2;max-width:700px;margin:0 auto">
              <!-- Trust Badge -->
              <div style="display:inline-flex;align-items:center;gap:8px;background:rgba(16,185,129,0.2);border:1px solid rgba(16,185,129,0.4);border-radius:50px;padding:8px 14px;margin-bottom:clamp(16px,3vw,24px)">
                <svg width="16" height="16" fill="none" stroke="var(--accent)" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
                <span style="font-size:clamp(11px,2vw,12px);font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:0.8px">Vertraut von Tausenden</span>
              </div>
              
              <!-- Main Headline -->
              <h2 style="font-size:clamp(32px,8vw,48px);font-weight:900;color:var(--text);line-height:1.1;margin-bottom:clamp(16px,3vw,24px);background:linear-gradient(135deg,#fff,rgba(168,85,247,0.8),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">
                Pro-Features freischalten
              </h2>
              
              <!-- Subheading -->
              <p style="font-size:clamp(16px,3vw,18px);color:var(--muted);line-height:1.7;margin-bottom:clamp(28px,5vw,36px);font-weight:500">
                Nutze die volle Kraft von 1.247 professionellen ETFs mit 10 Jahren Daten, unbegrenzte Vergleiche und erweiterte Analysen – für weniger als ein Kaffee pro Monat.
              </p>
              
              <!-- Four Column Stats -->
              <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(clamp(130px,22vw,160px),1fr));gap:clamp(14px,2.2vw,18px);margin-bottom:clamp(36px,6vw,44px)">
                <div style="background:rgba(168,85,247,0.1);border:1.5px solid rgba(168,85,247,0.3);padding:clamp(18px,3vw,24px);border-radius:16px;text-align:center;backdrop-filter:blur(8px)">
                  <div id="etfStat10Value" style="font-size:clamp(22px,4.2vw,30px);font-weight:900;color:var(--purple)">10 Jahre</div>
                  <div id="etfStatHistoricalLabel" style="font-size:clamp(11px,1.8vw,12px);color:var(--muted);margin-top:8px;font-weight:600">Historische<br>Daten</div>
                </div>
                <div style="background:rgba(59,130,246,0.1);border:1.5px solid rgba(59,130,246,0.3);padding:clamp(18px,3vw,24px);border-radius:16px;text-align:center;backdrop-filter:blur(8px)">
                  <div style="font-size:clamp(24px,4.5vw,32px);font-weight:900;color:var(--blue)">1.247</div>
                  <div id="etfStatEtfsLabel" style="font-size:clamp(12px,2.2vw,14px);color:var(--muted);margin-top:12px;font-weight:600">Professionelle<br>ETFs</div>
                </div>
                <div style="background:rgba(16,185,129,0.1);border:1.5px solid rgba(16,185,129,0.3);padding:clamp(18px,3vw,24px);border-radius:16px;text-align:center;backdrop-filter:blur(8px)">
                  <div style="font-size:clamp(24px,4.5vw,32px);font-weight:900;color:var(--accent)">8</div>
                  <div id="etfStatCompareLabel" style="font-size:clamp(12px,2.2vw,14px);color:var(--muted);margin-top:12px;font-weight:600">Vergleiche<br>ohne Limit</div>
                </div>
                <div style="background:rgba(244,63,94,0.1);border:1.5px solid rgba(244,63,94,0.3);padding:clamp(18px,3vw,24px);border-radius:16px;text-align:center;backdrop-filter:blur(8px)">
                  <div style="font-size:clamp(24px,4.5vw,32px);font-weight:900;color:#f43f5e">📈</div>
                  <div id="etfStatProfitLabel" style="font-size:clamp(12px,2.2vw,14px);color:var(--muted);margin-top:12px;font-weight:600">Sichere<br>Rentabilität</div>
                </div>
              </div>
              
              <!-- CTA Button with Premium Look -->
              <button class="btn upgrade-pro" data-upgrade-target="" onclick="upgradeToPro()" style="background:linear-gradient(90deg,#a855f7,#d8b4fe);color:white;padding:clamp(14px,3vw,18px) clamp(32px,6vw,44px);font-size:clamp(15px,2.2vw,18px);font-weight:700;margin:0 auto clamp(24px,4vw,32px);box-shadow:0 16px 40px rgba(168,85,247,0.4);border:1px solid rgba(255,255,255,0.3);border-radius:14px;transition:all 0.3s ease;width:100%;max-width:400px;cursor:pointer;display:block" onmouseover="this.style.boxShadow='0 20px 50px rgba(168,85,247,0.5)';this.style.transform='translateY(-3px)'" onmouseout="this.style.boxShadow='0 16px 40px rgba(168,85,247,0.4)';this.style.transform='translateY(0)'">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" style="margin-right:10px"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                Jetzt upgraden – 1,99€/Monat
              </button>
              
              <!-- Trust Badges Grid -->
              <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(clamp(130px,22vw,150px),1fr));gap:clamp(12px,1.8vw,14px)">
                <div style="background:linear-gradient(135deg,rgba(16,185,129,0.15),rgba(16,185,129,0.05));border:1px solid rgba(16,185,129,0.3);border-radius:12px;padding:clamp(14px,2.2vw,16px);text-align:center;backdrop-filter:blur(8px)">
                  <div style="font-size:clamp(18px,3.5vw,22px);margin-bottom:6px">🔓</div>
                  <div id="etfTrustCancelableLabel" style="font-size:clamp(10px,1.8vw,12px);color:var(--muted);font-weight:600;line-height:1.3">Jederzeit<br>kündbar</div>
                </div>
                <div style="background:linear-gradient(135deg,rgba(59,130,246,0.15),rgba(59,130,246,0.05));border:1px solid rgba(59,130,246,0.3);border-radius:12px;padding:clamp(14px,2.2vw,16px);text-align:center;backdrop-filter:blur(8px)">
                  <div style="font-size:clamp(18px,3.5vw,22px);margin-bottom:6px">🎁</div>
                  <div id="etfTrustFreeDaysLabel" style="font-size:clamp(10px,1.8vw,12px);color:var(--muted);font-weight:600;line-height:1.3">3 Tage<br>kostenlos</div>
                </div>
                <div style="background:linear-gradient(135deg,rgba(168,85,247,0.15),rgba(168,85,247,0.05));border:1px solid rgba(168,85,247,0.3);border-radius:12px;padding:clamp(14px,2.2vw,16px);text-align:center;backdrop-filter:blur(8px)">
                  <div style="font-size:clamp(18px,3.5vw,22px);margin-bottom:6px">✨</div>
                  <div id="etfTrustAllFeaturesLabel" style="font-size:clamp(10px,1.8vw,12px);color:var(--muted);font-weight:600;line-height:1.3">Alle Features<br>sofort</div>
                </div>
                <div style="background:linear-gradient(135deg,rgba(244,63,94,0.15),rgba(244,63,94,0.05));border:1px solid rgba(244,63,94,0.3);border-radius:12px;padding:clamp(14px,2.2vw,16px);text-align:center;backdrop-filter:blur(8px)">
                  <div style="font-size:clamp(18px,3.5vw,22px);margin-bottom:6px">🔒</div>
                  <div id="etfTrustPrivacyLabel" style="font-size:clamp(10px,1.8vw,12px);color:var(--muted);font-weight:600;line-height:1.3">Sicherer<br>Datenschutz</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Feature Preview Section -->
          <div style="margin-bottom:clamp(48px,8vw,60px)">
            <h3 style="font-size:clamp(18px,4vw,24px);font-weight:900;color:#fbbf24;margin-bottom:clamp(24px,4vw,32px);text-transform:uppercase;letter-spacing:2px;display:flex;align-items:center;gap:12px;text-shadow:0 2px 12px rgba(251,191,36,0.15)">
              <span style="font-size:clamp(24px,5vw,32px)">✨</span>
              Das erwartet dich
            </h3>
            
            <!-- Feature Cards Grid -->
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(clamp(260px,100%,320px),1fr));gap:clamp(20px,3vw,28px)">
              <!-- Feature 1 -->
              <div style="background:linear-gradient(135deg,rgba(168,85,247,0.15),rgba(168,85,247,0.05));border:1.5px solid rgba(168,85,247,0.3);padding:clamp(24px,4vw,32px);border-radius:18px;transition:all 0.4s cubic-bezier(0.23,1,0.320,1);cursor:pointer;position:relative;overflow:hidden" onmouseover="this.style.background='linear-gradient(135deg,rgba(168,85,247,0.25),rgba(168,85,247,0.1))';this.style.boxShadow='0 20px 40px rgba(168,85,247,0.2)';this.style.transform='translateY(-8px)'" onmouseout="this.style.background='linear-gradient(135deg,rgba(168,85,247,0.15),rgba(168,85,247,0.05))';this.style.boxShadow='none';this.style.transform='translateY(0)'">
                <div style="position:absolute;top:0;right:0;width:120px;height:120px;background:radial-gradient(circle,rgba(168,85,247,0.3),transparent);border-radius:50%;transform:translate(40%,-40%)"></div>
                <div style="position:relative;z-index:2">
                  <div style="width:56px;height:56px;background:linear-gradient(135deg,var(--purple),#d8b4fe);border-radius:14px;display:flex;align-items:center;justify-content:center;margin:0 auto clamp(16px,3vw,20px) auto">
                    <svg width="28" height="28" fill="none" stroke="white" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                  </div>
                  <h4 id="etfFeature1Title" style="font-size:clamp(16px,2.5vw,18px);font-weight:800;color:var(--text);margin-bottom:clamp(10px,2vw,14px);text-align:center">📊 Rendite-Analysen</h4>
                  <p id="etfFeature1Desc" style="font-size:clamp(13px,2vw,15px);color:var(--muted);line-height:1.6;font-weight:500;text-align:center">Professionelle Charts mit 10 Jahren vollständiger Kurshistorie. Erkenne Trends und Muster auf den ersten Blick.</p>
                  <div style="margin-top:clamp(14px,2.5vw,18px);padding:clamp(10px,2vw,12px);background:rgba(168,85,247,0.1);border:1px solid rgba(168,85,247,0.3);border-radius:10px;text-align:center">
                    <div style="font-size:clamp(11px,2vw,12px);color:var(--purple);font-weight:700">✓ 10 Jahre Vollständige Daten</div>
                  </div>
                </div>
              </div>
              
              <!-- Feature 2 -->
              <div style="background:linear-gradient(135deg,rgba(59,130,246,0.15),rgba(59,130,246,0.05));border:1.5px solid rgba(59,130,246,0.3);padding:clamp(24px,4vw,32px);border-radius:18px;transition:all 0.4s cubic-bezier(0.23,1,0.320,1);cursor:pointer;position:relative;overflow:hidden" onmouseover="this.style.background='linear-gradient(135deg,rgba(59,130,246,0.25),rgba(59,130,246,0.1))';this.style.boxShadow='0 20px 40px rgba(59,130,246,0.2)';this.style.transform='translateY(-8px)'" onmouseout="this.style.background='linear-gradient(135deg,rgba(59,130,246,0.15),rgba(59,130,246,0.05))';this.style.boxShadow='none';this.style.transform='translateY(0)'">
                <div style="position:absolute;top:0;right:0;width:120px;height:120px;background:radial-gradient(circle,rgba(59,130,246,0.3),transparent);border-radius:50%;transform:translate(40%,-40%)"></div>
                <div style="position:relative;z-index:2">
                  <div style="width:56px;height:56px;background:linear-gradient(135deg,var(--blue),#60a5fa);border-radius:14px;display:flex;align-items:center;justify-content:center;margin:0 auto clamp(16px,3vw,20px) auto">
                    <svg width="28" height="28" fill="none" stroke="white" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/><circle cx="12" cy="12" r="10"/></svg>
                  </div>
                  <h4 id="etfFeature2Title" style="font-size:clamp(16px,2.5vw,18px);font-weight:800;color:var(--text);margin-bottom:clamp(10px,2vw,14px);text-align:center">⚖️ Vergleich-Tool</h4>
                  <p id="etfFeature2Desc" style="font-size:clamp(13px,2vw,15px);color:var(--muted);line-height:1.6;font-weight:500;text-align:center">Vergleiche unbegrenzt viele ETFs nebeneinander. Renditen, Gebühren, Risiken auf einen Blick.</p>
                  <div style="margin-top:clamp(14px,2.5vw,18px);padding:clamp(10px,2vw,12px);background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.3);border-radius:10px;text-align:center">
                    <div style="font-size:clamp(11px,2vw,12px);color:var(--blue);font-weight:700">✓ Alle 1.247 ETFs Freischalten</div>
                  </div>
                </div>
              </div>
              
              <!-- Feature 3 -->
              <div style="background:linear-gradient(135deg,rgba(16,185,129,0.15),rgba(16,185,129,0.05));border:1.5px solid rgba(16,185,129,0.3);padding:clamp(24px,4vw,32px);border-radius:18px;transition:all 0.4s cubic-bezier(0.23,1,0.320,1);cursor:pointer;position:relative;overflow:hidden" onmouseover="this.style.background='linear-gradient(135deg,rgba(16,185,129,0.25),rgba(16,185,129,0.1))';this.style.boxShadow='0 20px 40px rgba(16,185,129,0.2)';this.style.transform='translateY(-8px)'" onmouseout="this.style.background='linear-gradient(135deg,rgba(16,185,129,0.15),rgba(16,185,129,0.05))';this.style.boxShadow='none';this.style.transform='translateY(0)'">
                <div style="position:absolute;top:0;right:0;width:120px;height:120px;background:radial-gradient(circle,rgba(16,185,129,0.3),transparent);border-radius:50%;transform:translate(40%,-40%)"></div>
                <div style="position:relative;z-index:2">
                  <div style="width:56px;height:56px;background:linear-gradient(135deg,var(--accent),#34d399);border-radius:14px;display:flex;align-items:center;justify-content:center;margin:0 auto clamp(16px,3vw,20px) auto">
                    <svg width="28" height="28" fill="none" stroke="white" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                  </div>
                  <h4 id="etfFeature3Title" style="font-size:clamp(16px,2.5vw,18px);font-weight:800;color:var(--text);margin-bottom:clamp(10px,2vw,14px);text-align:center">💼 Sparplan-Simulator</h4>
                  <p id="etfFeature3Desc" style="font-size:clamp(13px,2vw,15px);color:var(--muted);line-height:1.6;font-weight:500;text-align:center">Teste Sparstrategien mit echten Daten. Sieh exakt, wohin dein Geld fließt und wie du profitierst.</p>
                  <div style="margin-top:clamp(14px,2.5vw,18px);padding:clamp(10px,2vw,12px);background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:10px;text-align:center">
                    <div style="font-size:clamp(11px,2vw,12px);color:var(--accent);font-weight:700">💡 Deine Individuelle Strategie</div>
                  </div>
                </div>
              </div>
              
              <!-- Feature 4 -->
              <div style="background:linear-gradient(135deg,rgba(244,63,94,0.15),rgba(244,63,94,0.05));border:1.5px solid rgba(244,63,94,0.3);padding:clamp(24px,4vw,32px);border-radius:18px;transition:all 0.4s cubic-bezier(0.23,1,0.320,1);cursor:pointer;position:relative;overflow:hidden" onmouseover="this.style.background='linear-gradient(135deg,rgba(244,63,94,0.25),rgba(244,63,94,0.1))';this.style.boxShadow='0 20px 40px rgba(244,63,94,0.2)';this.style.transform='translateY(-8px)'" onmouseout="this.style.background='linear-gradient(135deg,rgba(244,63,94,0.15),rgba(244,63,94,0.05))';this.style.boxShadow='none';this.style.transform='translateY(0)'">
                <div style="position:absolute;top:0;right:0;width:120px;height:120px;background:radial-gradient(circle,rgba(244,63,94,0.3),transparent);border-radius:50%;transform:translate(40%,-40%)"></div>
                <div style="position:relative;z-index:2">
                  <div style="width:56px;height:56px;background:linear-gradient(135deg,#f43f5e,#fb7185);border-radius:14px;display:flex;align-items:center;justify-content:center;margin:0 auto clamp(16px,3vw,20px) auto">
                    <svg width="28" height="28" fill="none" stroke="white" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 3v18M15 3v18M3 9h18M3 15h18"/></svg>
                  </div>
                  <h4 id="etfFeature4Title" style="font-size:clamp(16px,2.5vw,18px);font-weight:800;color:var(--text);margin-bottom:clamp(10px,2vw,14px);text-align:center">📊 Portfolio-Tracking</h4>
                  <p id="etfFeature4Desc" style="font-size:clamp(13px,2vw,15px);color:var(--muted);line-height:1.6;font-weight:500;text-align:center">Behalte deine Investments im Blick. Automatische Performance-Analyse und detaillierte Übersichten.</p>
                  <div style="margin-top:clamp(14px,2.5vw,18px);padding:clamp(10px,2vw,12px);background:rgba(244,63,94,0.1);border:1px solid rgba(244,63,94,0.3);border-radius:10px;text-align:center">
                    <div style="font-size:clamp(11px,2vw,12px);color:#f43f5e;font-weight:700">📈 Live Performance-Tracking</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Data Preview Section -->
          <div id="etfPreviewImage" style="background:linear-gradient(135deg,rgba(168,85,247,0.08),rgba(59,130,246,0.06));border:2px dashed rgba(168,85,247,0.3);border-radius:20px;padding:clamp(32px,5vw,44px);position:relative;overflow:hidden;backdrop-filter:blur(8px)">
            <div style="position:absolute;top:clamp(-60px,-12vw,-100px);right:clamp(-60px,-12vw,-100px);width:clamp(200px,35vw,300px);height:clamp(200px,35vw,300px);background:radial-gradient(circle,rgba(168,85,247,0.2),transparent);border-radius:50%"></div>
            
            <div style="position:relative;z-index:1">
              <h4 id="etfPreviewTitle" style="font-size:clamp(16px,3vw,20px);font-weight:800;color:var(--text);margin-bottom:clamp(20px,3vw,28px);display:flex;align-items:center;gap:10px">
                <span style="font-size:clamp(20px,4vw,24px)">🗂️</span>
                Vorschau: So sieht deine Datenbank aus (unscharfes Vorschaubild)
              </h4>
              
              <div style="filter:blur(3px);pointer-events:none;user-select:none">
                <div style="display:grid;gap:clamp(12px,2vw,16px)">
                  <!-- Sample 1 -->
                  <div style="background:rgba(255,255,255,0.05);padding:clamp(16px,3vw,20px);border-radius:14px;border:1px solid rgba(255,255,255,0.1)">
                    <div style="display:flex;justify-content:space-between;align-items:start;gap:16px">
                      <div>
                        <div style="font-weight:800;color:var(--text);font-size:clamp(14px,2.2vw,16px)">🌍 MSCI World (IE00B4L5Y983)</div>
                        <div id="etfSample1Desc" style="font-size:clamp(11px,2vw,12px);color:var(--muted);margin-top:6px">Weltweite Aktien – 3.500+ Unternehmen</div>
                      </div>
                      <div style="text-align:right">
                        <div style="font-size:clamp(20px,3vw,26px);font-weight:900;color:var(--accent)">+8,5%</div>
                        <div class="etf-avg-10y" style="font-size:clamp(10px,1.8vw,11px);color:var(--muted)">10 Jahre –</div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Sample 2 -->
                  <div style="background:rgba(255,255,255,0.05);padding:clamp(16px,3vw,20px);border-radius:14px;border:1px solid rgba(255,255,255,0.1)">
                    <div style="display:flex;justify-content:space-between;align-items:start;gap:16px">
                      <div>
                        <div style="font-weight:800;color:var(--text);font-size:clamp(14px,2.2vw,16px)">🇺🇸 S&P 500 (IE00B5BMR087)</div>
                        <div id="etfSample2Desc" style="font-size:clamp(11px,2vw,12px);color:var(--muted);margin-top:6px">US Tech & Growth – 500 Top-Unternehmen</div>
                      </div>
                      <div style="text-align:right">
                        <div style="font-size:clamp(20px,3vw,26px);font-weight:900;color:var(--accent)">+12,5%</div>
                        <div class="etf-avg-10y" style="font-size:clamp(10px,1.8vw,11px);color:var(--muted)">10 Jahre –</div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Sample 3 -->
                  <div style="background:rgba(255,255,255,0.05);padding:clamp(16px,3vw,20px);border-radius:14px;border:1px solid rgba(255,255,255,0.1)">
                    <div style="display:flex;justify-content:space-between;align-items:start;gap:16px">
                      <div>
                        <div style="font-weight:800;color:var(--text);font-size:clamp(14px,2.2vw,16px)">💻 NASDAQ 100 (IE00B53SZB19)</div>
                        <div id="etfSample3Desc" style="font-size:clamp(11px,2vw,12px);color:var(--muted);margin-top:6px">Tech-fokussiert – 100 größte Konzerne</div>
                      </div>
                      <div style="text-align:right">
                        <div style="font-size:clamp(20px,3vw,26px);font-weight:900;color:var(--accent)">+15,8%</div>
                        <div class="etf-avg-10y" style="font-size:clamp(10px,1.8vw,11px);color:var(--muted)">10 Jahre –</div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Info Field -->
                  <div style="background:linear-gradient(135deg,rgba(59,130,246,0.15),rgba(168,85,247,0.15));padding:clamp(20px,4vw,28px);border-radius:14px;border:2px solid rgba(59,130,246,0.4);position:relative;overflow:hidden">
                    <div style="position:absolute;top:-20px;right:-20px;width:100px;height:100px;background:radial-gradient(circle,rgba(168,85,247,0.4),transparent);border-radius:50%"></div>
                    <div style="position:relative;z-index:2">
                      <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
                        <div style="width:44px;height:44px;background:linear-gradient(135deg,var(--blue),var(--purple));border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0">
                          <svg width="24" height="24" fill="none" stroke="white" stroke-width="2.5"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
                        </div>
                        <div style="text-align:left">
                          <div id="etfInfoTitle" style="font-weight:800;color:var(--text);font-size:clamp(14px,2.5vw,17px);line-height:1.3">✨ Vollständige Analysen</div>
                          <div id="etfInfoDesc" style="font-size:clamp(11px,2vw,13px);color:var(--muted);margin-top:4px;line-height:1.4">Filter nach Kosten, Regionen, Branchen & mehr – alle 1.247 ETFs mit detaillierten Kennzahlen</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div style="text-align:center;margin-top:clamp(20px,3vw,28px);padding-top:clamp(20px,3vw,28px);border-top:1px solid rgba(168,85,247,0.2)">
                <div id="etfPreviewMore" style="font-size:clamp(14px,2.5vw,16px);font-weight:700;color:var(--blue)">+ 1.244 weitere ETFs mit vollständigen Daten</div>
                <div id="etfPreviewAvailableAfter" style="font-size:clamp(12px,2vw,13px);color:var(--muted);margin-top:6px">Alle verfügbar nach dem Upgrade</div>
              </div>
            </div>
          </div>
          
          <style>
            @keyframes pulse {
              0%, 100% { transform: scale(1); opacity: 0.5; }
              50% { transform: scale(1.15); opacity: 0.8; }
            }
          </style>
        </div>

        <!-- Pro User View -->
        <div id="etfProView" style="display:none">
          
          <!-- Überschrift -->
          <h2 id="etfDatabaseTitle" style="font-size:clamp(2rem, 5vw, 2.5rem);font-weight:800;margin-bottom:32px;text-align:left">ETF Datenbank</h2>
          
          <!-- Suchleiste -->
          <div style="margin-bottom:20px">
            <div style="position:relative">
              <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" style="position:absolute;left:16px;top:50%;transform:translateY(-50%);color:var(--muted);z-index:1"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
              <input id="etfSuche" type="text" placeholder="Suche nach ETFs..." oninput="filterETFs()" style="width:100%;padding:16px 16px 16px 52px;font-size:16px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);border-radius:16px;color:inherit;font-weight:400">
            </div>
          </div>
          
          <!-- Sortier- und Filter-Optionen -->
          <div style="display:grid;grid-template-columns:1fr 2fr auto;gap:12px;margin-bottom:32px">
            <!-- Feld 1: Reihenfolge -->
            <div>
              <select id="etfSortRichtung" onchange="sortETFs()" style="width:100%;background:var(--input-bg);border:1px solid var(--input-border);padding:10px 12px;border-radius:12px;color:var(--text);font-weight:600;font-size:11px">
                <option value="desc" selected>Absteigend</option>
                <option value="asc">Aufsteigend</option>
              </select>
            </div>
            
            <!-- Feld 2: Sortieren nach -->
            <div>
              <select id="etfSortKriterium" onchange="sortETFs()" style="width:100%;background:var(--input-bg);border:1px solid var(--input-border);padding:10px 12px;border-radius:12px;color:var(--text);font-weight:600;font-size:11px">
                <option value="name">Sortieren nach: Name</option>
                <option value="rendite1j">Sortieren nach: Rendite 1 Jahr</option>
                <option value="rendite3j">Sortieren nach: Rendite 3 Jahre</option>
                <option value="rendite5j" selected>Sortieren nach: Rendite 5 Jahre</option>
                <option value="rendite10j">Sortieren nach: Rendite 10 Jahre</option>
                <option value="ter">Sortieren nach: Kosten (TER)</option>
              </select>
            </div>
            
            <!-- Feld 3: Was ist TER? -->
            <div>
              <button onclick="zeigeTERInfo()" style="height:100%;padding:10px 16px;border-radius:12px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.05);color:var(--text);font-weight:700;font-size:11px;cursor:pointer;display:flex;align-items:center;gap:6px;white-space:nowrap">
                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                Was ist TER?
              </button>
            </div>
          </div>
          
          <!-- Erweiterte Sortierung (ausklappbar) -->
          <div id="erweiterteSort" style="display:none;background:rgba(255,255,255,0.02);border-radius:12px;padding:20px;margin-bottom:24px">
            <div style="display:grid;grid-template-columns:1fr auto;gap:12px">
              <div>
                <div class="label-text" style="margin-bottom:8px">SORTIEREN NACH</div>
                <select id="etfSortKriterium" onchange="sortETFs()" style="background:var(--input-bg);border:1px solid var(--input-border);padding:12px 16px;border-radius:12px;color:var(--text);font-weight:600;font-size:14px;width:100%">
                  <option value="name">Name</option>
                  <option value="rendite1j">Rendite 1 Jahr</option>
                  <option value="rendite3j">Rendite 3 Jahre</option>
                  <option value="rendite5j" selected>Rendite 5 Jahre</option>
                  <option value="ter">Kosten (TER)</option>
                </select>
              </div>
              <div>
                <div class="label-text" style="margin-bottom:8px">REIHENFOLGE</div>
                <select id="etfSortRichtung" onchange="sortETFs()" style="background:var(--input-bg);border:1px solid var(--input-border);padding:12px 16px;border-radius:12px;color:var(--text);font-weight:600;font-size:14px;min-width:140px">
                  <option value="desc" selected>Absteigend</option>
                  <option value="asc">Aufsteigend</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Diagramm -->
          <div id="etfChartContainer" style="display:none;margin-bottom:24px;background:rgba(255,255,255,0.03);padding:20px;border-radius:12px;border:1px solid rgba(255,255,255,0.05)">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
              <div id="etfChartTitle" style="font-size:11px;color:var(--muted);letter-spacing:1px">RENDITEN-VERGLEICH (10 JAHRE)</div>
              <div id="vergleichsInfo" style="font-size:12px;color:var(--muted)">
                <span id="ausgewaehlteAnzahl">0</span> <span id="ausgewaehlteText">von 2 ETFs ausgewählt</span>
              </div>
            </div>
            <canvas id="etfChart" style="max-height:300px"></canvas>
            <div id="vergleichsHinweis" style="margin-top:16px;text-align:center;padding:20px;color:var(--muted);font-size:14px">
              Wähle bis zu 2 ETFs aus der Liste unten aus, um sie zu vergleichen
            </div>
          </div>

          <!-- Detaillierter Vergleich -->
          <div id="detailVergleich" style="display:none;margin-bottom:24px;background:rgba(255,255,255,0.03);padding:24px;border-radius:12px;border:1px solid rgba(255,255,255,0.05)">
            <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:24px;align-items:center">
              <!-- ETF 1 -->
              <div id="vergleichETF1" style="text-align:center">
                <div id="v1_ticker" style="font-size:32px;font-weight:800;color:rgba(16,185,129,1);margin-bottom:8px">-</div>
                <div id="v1_name" style="font-size:14px;color:var(--text);font-weight:600;margin-bottom:24px;min-height:40px">-</div>
                
                <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:16px;margin-bottom:12px">
                  <div style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">TER</div>
                  <div id="v1_ter" style="font-size:24px;font-weight:700">-%</div>
                </div>
                
                <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:16px;margin-bottom:12px">
                  <div style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">1 JAHR</div>
                  <div id="v1_1j" style="font-size:24px;font-weight:700">-%</div>
                </div>
                
                <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:16px;margin-bottom:12px">
                  <div style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">5 JAHRE</div>
                  <div id="v1_5j" style="font-size:24px;font-weight:700">-%</div>
                </div>
                
                <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:16px">
                  <div style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">KAT.</div>
                  <div id="v1_kat" style="font-size:14px;font-weight:600;color:var(--text)">-</div>
                </div>
              </div>
              
              <!-- VS Separator -->
              <div style="text-align:center">
                <div style="font-size:28px;font-weight:800;color:var(--muted);padding:0 16px">VS</div>
              </div>
              
              <!-- ETF 2 -->
              <div id="vergleichETF2" style="text-align:center">
                <div id="v2_ticker" style="font-size:32px;font-weight:800;color:rgba(59,130,246,1);margin-bottom:8px">-</div>
                <div id="v2_name" style="font-size:14px;color:var(--text);font-weight:600;margin-bottom:24px;min-height:40px">-</div>
                
                <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:16px;margin-bottom:12px">
                  <div style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">TER</div>
                  <div id="v2_ter" style="font-size:24px;font-weight:700">-%</div>
                </div>
                
                <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:16px;margin-bottom:12px">
                  <div style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">1 JAHR</div>
                  <div id="v2_1j" style="font-size:24px;font-weight:700">-%</div>
                </div>
                
                <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:16px;margin-bottom:12px">
                  <div style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">5 JAHRE</div>
                  <div id="v2_5j" style="font-size:24px;font-weight:700">-%</div>
                </div>
                
                <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:16px">
                  <div style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">KAT.</div>
                  <div id="v2_kat" style="font-size:14px;font-weight:600;color:var(--text)">-</div>
                </div>
              </div>
            </div>
          </div>

          <div style="background:rgba(255,255,255,0.02);border-radius:12px;padding:24px;margin-bottom:24px">
            <h3 style="font-size:16px;font-weight:700;margin-bottom:16px;color:var(--text)">
              <span id="etfDatabaseListTitle">ETF Datenbank</span> <span id="etfAnzahl" style="color:var(--muted);font-size:14px;font-weight:400">(120 ETFs)</span>
            </h3>
            <div id="etfListe" style="display:grid;gap:12px">
              <!-- ETFs werden hier dynamisch eingefügt -->
            </div>
            <div id="keineErgebnisse" style="display:none;text-align:center;padding:40px;color:var(--muted)">
              <svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="2" style="margin:0 auto 16px"><circle cx="24" cy="24" r="20"/><line x1="24" y1="16" x2="24" y2="24"/><line x1="24" y1="32" x2="24.01" y2="32"/></svg>
              <div id="keineErgebnisseTitle" style="font-size:16px;font-weight:600;margin-bottom:8px">Keine ETFs gefunden</div>
              <div id="keineErgebnisseDesc" style="font-size:14px">Versuche einen anderen Suchbegriff</div>
            </div>
          </div>

          <div style="background:rgba(255,255,255,0.02);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:24px">
            <div style="font-size:12px;color:var(--muted);line-height:1.6">
              <strong style="color:var(--text)">Hinweis:</strong> Die angegebenen Renditen sind historische Durchschnittswerte und keine Garantie für zukünftige Entwicklungen. TER = Total Expense Ratio (Gesamtkostenquote). Alle Angaben ohne Gewähr.
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Settings -->
  <section id="settings" class="section">
    <div class="container">
      <div class="chart">
        <h2>Einstellungen</h2>
        
        <h3 style="font-size:11px;color:var(--muted);letter-spacing:1px;margin:24px 0 12px">PRO ACCOUNT</h3>
        <div id="proAccountFree" style="background:linear-gradient(135deg, rgba(168,85,247,0.1), rgba(168,85,247,0.05));border:1px solid rgba(168,85,247,0.3);border-radius:12px;padding:24px;margin-bottom:16px">
          <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px">
            <div style="width:56px;height:56px;background:linear-gradient(135deg, var(--purple), #c084fc);border-radius:12px;display:flex;align-items:center;justify-content:center">
              <svg width="28" height="28" fill="none" stroke="white" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
            </div>
            <div style="flex:1">
              <div style="color:var(--text);font-weight:700;font-size:18px;margin-bottom:4px">Calculo Pro</div>
              <div style="font-size:13px;color:var(--muted)">Erweiterte Funktionen für ernsthafte Trader</div>
            </div>
          </div>
          <div style="margin-bottom:20px">
            <div style="font-size:13px;color:var(--text);margin-bottom:8px">∞ Unbegrenzte Trades</div>
            <div style="font-size:11px;color:var(--muted);margin-left:16px;margin-bottom:10px">Speichere so viele Trades wie du möchtest</div>
            <div style="font-size:13px;color:var(--text);margin-bottom:8px">📚 ETF Datenbank</div>
            <div style="font-size:11px;color:var(--muted);margin-left:16px;margin-bottom:10px">Zugriff auf historische Durchschnittsrenditen</div>
            <div style="font-size:13px;color:var(--text);margin-bottom:8px">🧮 Inflations- & Steuerrechner</div>
            <div style="font-size:11px;color:var(--muted);margin-left:16px;margin-bottom:10px">Präzise Berechnung mit Steuern und Inflation</div>
            <div style="font-size:13px;color:var(--text);margin-bottom:8px">📄 PDF/CSV Export</div>
            <div style="font-size:11px;color:var(--muted);margin-left:16px;margin-bottom:10px">Exportiere deine Berechnungen</div>
            <div style="font-size:13px;color:var(--text);margin-bottom:8px">🚫 Werbefrei</div>
            <div style="font-size:11px;color:var(--muted);margin-left:16px">Keine störenden Werbebanner</div>
          </div>
          <div style="margin-bottom:20px">
            <div style="display:flex;gap:12px;margin-bottom:16px" id="pricingCards">
              <div style="flex:1;background:rgba(168,85,247,0.08);border:2px solid var(--purple);border-radius:12px;padding:16px;text-align:center">
                <div style="font-size:28px;font-weight:800;color:var(--purple)">1,99€</div>
                <div style="font-size:12px;color:var(--muted);margin-top:4px"><span class="pricing-per"></span> <span class="pricing-month"></span></div>
              </div>
              <div style="flex:1;background:rgba(168,85,247,0.08);border:1px solid rgba(168,85,247,0.3);border-radius:12px;padding:16px;text-align:center">
                <div style="font-size:28px;font-weight:800;color:var(--purple)">18,99€</div>
                <div style="font-size:12px;color:var(--muted);margin-top:4px"><span class="pricing-per"></span> <span class="pricing-year"></span></div>
                <div class="pricing-bonus" style="background:var(--accent);color:white;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:700;margin-top:6px;display:inline-block">2 Monate gratis</div>
              </div>
            </div>
            <div style="background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:8px;padding:12px;margin-bottom:16px;text-align:center" id="trialInfoBox">
              <div class="trial-title" style="font-size:13px;font-weight:600;color:var(--accent);margin-bottom:4px">🎁 3 Tage kostenlos testen</div>
              <div class="trial-desc" style="font-size:11px;color:var(--muted)">Keine Zahlung während der Testphase. Jederzeit kündbar.</div>
            </div>
          </div>
          <button class="btn upgrade-pro" data-upgrade-target="etfPreviewImage" onclick="upgradeToPro('etfPreviewImage')" style="width:100%;background:linear-gradient(90deg,var(--purple),#c084fc);color:#fff;margin-bottom:16px;position:relative">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
            <span class="upgrade-button-text">3 Tage kostenlos testen</span>
          </button>
          <div style="text-align:center;font-size:11px;color:var(--muted);padding:10px;background:rgba(168,85,247,0.08);border:1px solid rgba(168,85,247,0.2);border-radius:8px">
            <div style="margin-bottom:6px;font-weight:600">🎁 3 Tage kostenlos – Jederzeit kündbar</div>
            <div style="margin-bottom:4px">Nach der Testphase 1,99€/Monat oder 18,99€/Jahr</div>
            <div style="color:var(--accent);font-weight:600">ℹ️ Abo läuft automatisch nach 3 Tagen, wenn nicht gekündigt</div>
          </div>
        </div>
        
        <div id="proAccountActive" style="background:linear-gradient(135deg, rgba(168,85,247,0.1), rgba(168,85,247,0.05));border:1px solid rgba(168,85,247,0.3);border-radius:12px;padding:24px;margin-bottom:16px;display:none">
          <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px">
            <div style="width:56px;height:56px;background:linear-gradient(135deg, var(--purple), #c084fc);border-radius:12px;display:flex;align-items:center;justify-content:center">
              <svg width="28" height="28" fill="none" stroke="white" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
            </div>
            <div style="flex:1">
              <div style="display:flex;align-items:center;gap:8px">
                <div style="color:var(--text);font-weight:700;font-size:18px">Calculo Pro</div>
                <div style="background:var(--purple);color:white;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:700">AKTIV</div>
              </div>
              <div style="font-size:13px;color:var(--muted);margin-top:4px">Alle Premium-Features freigeschaltet</div>
            </div>
          </div>
          <button class="btn" onclick="cancelPro()" style="width:100%;background:rgba(255,255,255,0.05);border:1px solid var(--border);color:var(--muted)">
            Pro kündigen
          </button>
        </div>
        
        <h3 style="font-size:11px;color:var(--muted);letter-spacing:1px;margin:24px 0 12px">DATEN VERWALTEN</h3>
        <button class="btn btn-blue" style="width:100%">
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Daten exportieren
        </button>

        <h3 style="font-size:11px;color:var(--muted);letter-spacing:1px;margin:24px 0 12px">ERSCHEINUNGSBILD</h3>
        <div class="theme-selector">
          <button class="theme-btn" onclick="setTheme('system')">System</button>
          <button class="theme-btn" onclick="setTheme('light')">Hell</button>
          <button class="theme-btn active" onclick="setTheme('dark')">Dunkel</button>
        </div>
        <p style="color:var(--muted);font-size:12px;margin-top:12px;line-height:1.5">
          Wähle zwischen hellem, dunklem oder dem System-Modus.
        </p>

        <h3 style="font-size:11px;color:var(--muted);letter-spacing:1px;margin:24px 0 12px">WÄHRUNG & TOOLS</h3>
        <div style="background:rgba(255,255,255,0.02);border-radius:12px;padding:16px;margin-bottom:16px">
          <div class="info-row">
            <span style="color:var(--muted)" id="countryLabel">Land</span>
            <select id="landSelect" onchange="aendereLand()" style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);padding:8px 12px;border-radius:8px;color:inherit;font-weight:600;max-width:200px">
              <option value="DE">🇩🇪 Deutschland</option>
              <option value="AT">🇦🇹 Österreich</option>
              <option value="CH">🇨🇭 Schweiz</option>
              <option value="US">🇺🇸 USA</option>
              <option value="GB">🇬🇧 United Kingdom</option>
              <option value="FR">🇫🇷 France</option>
              <option value="ES">🇪🇸 España</option>
              <option value="IT">🇮🇹 Italia</option>
              <option value="NL">🇳🇱 Nederland</option>
              <option value="BE">🇧🇪 België</option>
              <option value="LU">🇱🇺 Luxembourg</option>
              <option value="SE">🇸🇪 Sverige</option>
              <option value="NO">🇳🇴 Norge</option>
              <option value="DK">🇩🇰 Danmark</option>
              <option value="FI">🇫🇮 Suomi</option>
              <option value="PL">🇵🇱 Polska</option>
              <option value="CZ">🇨🇿 Česko</option>
              <option value="HU">🇭🇺 Magyarország</option>
              <option value="RO">🇷🇴 România</option>
              <option value="BG">🇧🇬 България</option>
              <option value="GR">🇬🇷 Ελλάδα</option>
              <option value="PT">🇵🇹 Portugal</option>
              <option value="IE">🇮🇪 Ireland</option>
              <option value="HR">🇭🇷 Hrvatska</option>
              <option value="SI">🇸🇮 Slovenija</option>
              <option value="SK">🇸🇰 Slovensko</option>
              <option value="EE">🇪🇪 Eesti</option>
              <option value="LV">🇱🇻 Latvija</option>
              <option value="LT">🇱🇹 Lietuva</option>
              <option value="CA">🇨🇦 Canada</option>
              <option value="AU">🇦🇺 Australia</option>
              <option value="NZ">🇳🇿 New Zealand</option>
              <option value="JP">🇯🇵 日本</option>
              <option value="KR">🇰🇷 대한민국</option>
              <option value="SG">🇸🇬 Singapore</option>
              <option value="HK">🇭🇰 Hong Kong</option>
              <option value="IN">🇮🇳 India</option>
              <option value="BR">🇧🇷 Brasil</option>
              <option value="MX">🇲🇽 México</option>
              <option value="ZA">🇿🇦 South Africa</option>
              <option value="TR">🇹🇷 Türkiye</option>
              <option value="AE">🇦🇪 UAE</option>
              <option value="IL">🇮🇱 Israel</option>
              <option value="RU">🇷🇺 Россия</option>
              <option value="CN">🇨🇳 中国</option>
              <option value="TH">🇹🇭 ไทย</option>
              <option value="MY">🇲🇾 Malaysia</option>
              <option value="ID">🇮🇩 Indonesia</option>
              <option value="PH">🇵🇭 Philippines</option>
              <option value="VN">🇻🇳 Việt Nam</option>
              <option value="AR">🇦🇷 Argentina</option>
              <option value="CL">🇨🇱 Chile</option>
              <option value="CO">🇨🇴 Colombia</option>
            </select>
          </div>
          <div class="info-row" id="taxInfoRow" style="display:none;padding:12px 0;background:rgba(16,185,129,0.05);margin:8px -16px;padding:12px 16px;border-radius:8px">
            <span style="color:var(--muted);font-size:12px" id="taxInfoHintText"></span>
          </div>
          <div class="info-row">
            <span style="color:var(--muted)">Sprache</span>
            <select id="spracheSelect" onchange="aendereSpracheSelect()" style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);padding:8px 12px;border-radius:8px;color:inherit;font-weight:600">
              <option value="de">🇩🇪 Deutsch</option>
              <option value="en">🇬🇧 English</option>
              <option value="es">🇪🇸 Español</option>
              <option value="fr">🇫🇷 Français</option>
            </select>
          </div>
          <div class="info-row">
            <span style="color:var(--muted)">Währung</span>
            <select id="waehrungSelect" onchange="aendereWaehrung()" style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);padding:8px 12px;border-radius:8px;color:inherit;font-weight:600">
              <option value="EUR">EUR (€)</option>
              <option value="USD">USD ($)</option>
              <option value="GBP">GBP (£)</option>
              <option value="CHF">CHF (Fr)</option>
              <option value="JPY">JPY (¥)</option>
              <option value="AUD">AUD (A$)</option>
              <option value="CAD">CAD (C$)</option>
              <option value="NZD">NZD (NZ$)</option>
              <option value="SEK">SEK (kr)</option>
              <option value="NOK">NOK (kr)</option>
              <option value="DKK">DKK (kr)</option>
              <option value="PLN">PLN (zł)</option>
              <option value="CZK">CZK (Kč)</option>
              <option value="HUF">HUF (Ft)</option>
              <option value="RON">RON (lei)</option>
              <option value="BGN">BGN (лв)</option>
              <option value="HRK">HRK (kn)</option>
              <option value="TRY">TRY (₺)</option>
              <option value="INR">INR (₹)</option>
              <option value="BRL">BRL (R$)</option>
              <option value="MXN">MXN ($)</option>
              <option value="ZAR">ZAR (R)</option>
              <option value="KRW">KRW (₩)</option>
              <option value="SGD">SGD (S$)</option>
              <option value="HKD">HKD (HK$)</option>
              <option value="CNY">CNY (¥)</option>
              <option value="THB">THB (฿)</option>
              <option value="MYR">MYR (RM)</option>
              <option value="IDR">IDR (Rp)</option>
              <option value="PHP">PHP (₱)</option>
              <option value="VND">VND (₫)</option>
              <option value="AED">AED (د.إ)</option>
              <option value="ILS">ILS (₪)</option>
              <option value="RUB">RUB (₽)</option>
              <option value="ARS">ARS ($)</option>
              <option value="CLP">CLP ($)</option>
              <option value="COP">COP ($)</option>
            </select>
          </div>
          <div class="info-row">
            <div>
              <div style="color:var(--text);font-weight:600">Hebel-Funktion</div>
              <div style="font-size:12px;color:var(--muted);margin-top:4px">Die Hebel-Funktion ermöglicht die Berechnung von Derivaten (Long/Short).</div>
            </div>
            <label class="toggle">
              <input type="checkbox" id="hebelToggle" onchange="toggleHebelFunktion()">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <h3 style="font-size:11px;color:var(--muted);letter-spacing:1px;margin:24px 0 12px">ANALYSE-WERTE</h3>
        <div style="background:rgba(255,255,255,0.02);border-radius:12px;padding:16px;margin-bottom:16px">
          <div class="info-row">
            <span style="color:var(--muted)">Break-Even Kurs</span>
            <label class="toggle">
              <input type="checkbox" id="breakEvenToggle" onchange="toggleBreakEven()">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="info-row">
            <span style="color:var(--muted)">CRV (Chance-Risiko)</span>
            <label class="toggle">
              <input type="checkbox" id="crvToggle" onchange="toggleCRV()">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        <p style="color:var(--muted);font-size:12px;line-height:1.5;margin-bottom:24px">
          Break-Even zeigt den Kurs, ab dem du inkl. Gebühren im Plus bist. CRV bewertet das Verhältnis von Gewinnziel zu Stop-Loss.
        </p>

        <h3 id="steuernHeading" style="font-size:11px;color:var(--muted);letter-spacing:1px;margin:24px 0 12px">STEUERN (DE)</h3>
        <div class="info-card" id="freibetragCard">
          <div style="font-size:11px;color:var(--muted);letter-spacing:1px">VERBLEIBEND 2026</div>
          <div id="verbleibenderFreibetrag" style="font-size:36px;font-weight:800;color:var(--accent);margin:12px 0">1.000,00 €</div>
          <div id="freibetragLimit" style="font-size:13px;color:var(--muted)">/ 1.000 €</div>
          <div style="margin-top:16px;background:rgba(255,255,255,0.05);border-radius:8px;height:8px">
            <div id="freibetragProgress" style="background:var(--accent);height:100%;width:0%;border-radius:8px"></div>
          </div>
          <div id="freibetragProzent" style="font-size:11px;color:var(--muted);margin-top:6px">0% verbraucht</div>
        </div>

        <div id="freibetragDetailsBox" style="background:rgba(255,255,255,0.02);border-radius:12px;padding:16px;margin:16px 0">
          <div class="info-row">
            <span style="color:var(--muted)">Jahres-Freibetrag</span>
            <strong id="jahresFreibetrag">1.000 €</strong>
          </div>
          <div class="info-row" style="border-bottom:none">
            <div style="flex:1">
              <div class="label-text" style="margin-bottom:8px">Bereits verwendet</div>
              <div class="input-wrapper">
                <input id="verwendeterFreibetrag" type="number" step="0.01" min="0" value="0" oninput="aktualisiereFreibetrag()" style="font-size:16px;font-weight:600;padding:12px;padding-right:40px">
                <span class="input-unit">€</span>
              </div>
            </div>
          </div>
        </div>

        <div id="steuersatzDetailsBox" style="background:rgba(255,255,255,0.02);border-radius:12px;padding:16px;margin:16px 0">
          <div class="info-row" id="steuersatzRow" style="border-bottom:none">
            <span id="steuersatzLabel" style="color:var(--muted)">Steuersatz</span>
            <strong id="steuersatzWert">26,375 %</strong>
          </div>
        </div>

        <p id="taxInfoText" style="color:var(--muted);font-size:13px;line-height:1.6;margin-top:16px">
          In Deutschland liegt die Abgeltungssteuer inkl. Soli bei 26,375%. Der Freibetrag von <span id="freibetragText">1.000 €</span> erneuert sich automatisch am 1. Januar jeden Jahres. Gespeicherte Trades werden automatisch dem jeweiligen Jahr zugeordnet.
        </p>

        <h3 style="font-size:11px;color:var(--muted);letter-spacing:1px;margin:24px 0 12px">BROKER</h3>
        <div style="background:rgba(255,255,255,0.02);border-radius:12px;padding:16px;margin-bottom:16px">
          <div class="info-row" style="border-bottom:none">
            <span style="color:var(--muted)">Aktueller Broker</span>
            <select id="brokerAuswahl" onchange="aendereBroker()" style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);padding:8px 12px;border-radius:8px;color:inherit;font-weight:600">
              <option value="custom">Benutzerdefiniert</option>
              <option value="finanzenzero">Finanzen.net Zero</option>
              <option value="smartbrokerplus">Smartbroker+</option>
              <option value="justtrade">justTRADE</option>
              <option value="traderepublic">Trade Republic</option>
              <option value="scalablecapital">Scalable Capital</option>
              <option value="flatex">Flatex</option>
              <option value="comdirect">Comdirect</option>
              <option value="ing">ING</option>
              <option value="consorsbank">Consorsbank</option>
              <option value="commerzbank">Commerzbank</option>
              <option value="dkb">DKB</option>
              <option value="interactivebrokers">Interactive Brokers</option>
            </select>
          </div>
        </div>

        <h3 style="font-size:11px;color:var(--muted);letter-spacing:1px;margin:24px 0 12px">PROGNOSE PARAMETER</h3>
        <div style="background:rgba(255,255,255,0.02);border-radius:12px;padding:16px;margin-bottom:16px">
          <div class="info-row">
            <span style="color:var(--muted)">Inflationsrate</span>
            <div style="display:flex;align-items:center;gap:8px">
              <input id="inflationsrate" type="number" step="0.1" min="0" max="20" value="2.0" oninput="speicherePrognoseParameter()" style="width:80px;padding:8px;font-size:14px;font-weight:600;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;text-align:right">
              <span style="font-weight:600">%</span>
            </div>
          </div>
          <div class="info-row">
            <span style="color:var(--muted)">Jährliche Dynamik</span>
            <div style="display:flex;align-items:center;gap:8px">
              <input id="jaehrlicheDynamik" type="number" step="0.1" min="0" max="20" value="0" oninput="speicherePrognoseParameter()" style="width:80px;padding:8px;font-size:14px;font-weight:600;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;text-align:right">
              <span style="font-weight:600">%</span>
            </div>
          </div>
        </div>
        <p id="forecastDescription" style="color:var(--muted);font-size:12px;line-height:1.5;margin-bottom:24px">
          Die Inflationsrate wird für die Realwertberechnung im Sparrechner verwendet. Die jährliche Dynamik erhöht deine Sparrate automatisch um den angegebenen Prozentsatz pro Jahr.
        </p>

        <h3 style="font-size:11px;color:var(--muted);letter-spacing:1px;margin:24px 0 12px">GEBÜHREN</h3>
        <div style="background:rgba(255,255,255,0.02);border-radius:12px;padding:16px;margin-bottom:16px">
          <div class="info-row">
            <span style="color:var(--muted)">Fixkosten</span>
            <div style="display:flex;align-items:center;gap:8px">
              <input id="fixkosten" type="number" step="0.01" min="0" value="0" oninput="speichereGebuehren()" style="width:80px;padding:8px;font-size:14px;font-weight:600;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;text-align:right">
              <span style="font-weight:600">€</span>
            </div>
          </div>
          <div class="info-row">
            <span style="color:var(--muted)">Variable Gebühr</span>
            <div style="display:flex;align-items:center;gap:8px">
              <input id="variableGebuehr" type="number" step="0.01" min="0" value="0" oninput="speichereGebuehren()" style="width:80px;padding:8px;font-size:14px;font-weight:600;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;text-align:right">
              <span style="font-weight:600">%</span>
            </div>
          </div>
        </div>
        <p id="feesDescription" style="color:var(--muted);font-size:12px;line-height:1.5">
          Ordergebühren deines Brokers. Diese werden sowohl beim Kauf als auch beim Verkauf berücksichtigt.
        </p>

        <h3 style="font-size:11px;color:var(--muted);letter-spacing:1px;margin:24px 0 12px">RECHTLICHES</h3>
        <div style="background:rgba(255,255,255,0.02);border-radius:12px;padding:20px;margin-bottom:16px">
          <div style="display:flex;align-items:start;gap:12px;margin-bottom:16px">
            <div style="background:rgba(16,185,129,0.2);border-radius:8px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;flex-shrink:0">
              <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
            </div>
            <div>
              <div id="aboutTradeTitle" style="font-weight:600;color:var(--text);margin-bottom:8px">Über Trade</div>
              <p id="aboutTradeDesc" style="color:var(--muted);font-size:13px;line-height:1.6;margin-bottom:12px">
                Trade ist ein kostenloser Trading-Rechner für private Trader und Investoren. Die App bietet präzise Berechnungen für Trading, Sparen und Investments mit automatischer Steuerberechnung nach deutschem Recht.
              </p>
              <div style="color:var(--muted);font-size:12px">
                <strong style="color:var(--text)">Support:</strong> support@trade-app.de
              </div>
              <div style="color:var(--muted);font-size:12px;margin-top:4px">
                <strong style="color:var(--text)">Version:</strong> 1.0.0 (2026)
              </div>
            </div>
          </div>
        </div>

        <div style="display:grid;gap:12px;margin-bottom:24px">
          <button onclick="oeffneDatenschutz()" style="background:rgba(255,255,255,0.02);border:1px solid var(--border);border-radius:12px;padding:16px;text-align:left;cursor:pointer;color:var(--text);display:flex;align-items:center;justify-content:space-between;transition:background 0.2s" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='rgba(255,255,255,0.02)'">
            <div>
              <div style="font-weight:600;margin-bottom:4px">Datenschutzerklärung</div>
              <div style="font-size:12px;color:var(--muted)">Erfahre, wie wir deine Daten schützen</div>
            </div>
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
          </button>

          <button onclick="oeffneNutzungsbedingungen()" style="background:rgba(255,255,255,0.02);border:1px solid var(--border);border-radius:12px;padding:16px;text-align:left;cursor:pointer;color:var(--text);display:flex;align-items:center;justify-content:space-between;transition:background 0.2s" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='rgba(255,255,255,0.02)'">
            <div>
              <div style="font-weight:600;margin-bottom:4px">Nutzungsbedingungen</div>
              <div style="font-size:12px;color:var(--muted)">Lies unsere allgemeinen Geschäftsbedingungen</div>
            </div>
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
          </button>

          <button onclick="oeffneImpressum()" style="background:rgba(255,255,255,0.02);border:1px solid var(--border);border-radius:12px;padding:16px;text-align:left;cursor:pointer;color:var(--text);display:flex;align-items:center;justify-content:space-between;transition:background 0.2s" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='rgba(255,255,255,0.02)'">
            <div>
              <div style="font-weight:600;margin-bottom:4px">Impressum</div>
              <div style="font-size:12px;color:var(--muted)">Rechtliche Informationen zum Anbieter</div>
            </div>
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
          </button>
        </div>

        <h3 id="feedbackSupportHeading" style="font-size:11px;color:var(--muted);letter-spacing:1px;margin:24px 0 12px">FEEDBACK & SUPPORT</h3>
        <button onclick="oeffneFeedbackPortal()" style="width:100%;background:linear-gradient(135deg, rgba(16,185,129,0.1), rgba(16,185,129,0.05));border:1px solid rgba(16,185,129,0.3);border-radius:12px;padding:20px;text-align:left;cursor:pointer;color:var(--text);display:flex;align-items:center;gap:16px;transition:all 0.3s" onmouseover="this.style.transform='translateY(-2px)';this.style.borderColor='rgba(16,185,129,0.5)'" onmouseout="this.style.transform='translateY(0)';this.style.borderColor='rgba(16,185,129,0.3)'">
          <div style="background:var(--accent);border-radius:12px;width:48px;height:48px;display:flex;align-items:center;justify-content:center;flex-shrink:0">
            <svg width="24" height="24" fill="none" stroke="white" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
          </div>
          <div style="flex:1">
            <div style="font-weight:700;font-size:16px;margin-bottom:4px;color:var(--text)">Feedback Portal</div>
            <div style="font-size:13px;color:var(--muted)">Teile deine Ideen und hilf uns, Trade zu verbessern</div>
          </div>
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
        </button>

        <p id="copyright" style="color:var(--muted);font-size:11px;text-align:center;margin-top:32px">
          © 2026 Trade. Alle Rechte vorbehalten.
        </p>
      </div>
    </div>
  </section>

  <!-- Feedback Section -->
  <section id="feedback" class="section">
    <div class="container">
      <div class="chart">
        <div style="text-align:center;margin-bottom:32px">
          <div style="display:inline-flex;align-items:center;justify-content:center;width:72px;height:72px;background:linear-gradient(135deg, var(--accent), #34d399);border-radius:20px;margin-bottom:16px">
            <svg width="36" height="36" fill="none" stroke="white" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
          </div>
          <h2 style="margin-bottom:12px">Dein Feedback ist wertvoll</h2>
          <p style="color:var(--muted);font-size:14px;line-height:1.6;max-width:500px;margin:0 auto">
            Hilf uns, Trade zu verbessern. Teile deine Ideen, Wünsche oder melde Probleme. Jedes Feedback wird gelesen und berücksichtigt.
          </p>
        </div>

        <form id="feedbackForm" onsubmit="sendeFeedback(event)">
          <label>
            <div class="label-text">Name (optional)</div>
            <div class="input-wrapper">
              <input id="feedbackName" type="text" placeholder="Dein Name" style="font-size:16px;font-weight:600;padding:14px;background:var(--input-bg);border:1px solid var(--input-border);border-radius:12px;color:inherit">
            </div>
          </label>

          <label>
            <div class="label-text">E-Mail (optional)</div>
            <div class="input-wrapper">
              <input id="feedbackEmail" type="email" placeholder="deine@email.de" style="font-size:16px;font-weight:600;padding:14px;background:var(--input-bg);border:1px solid var(--input-border);border-radius:12px;color:inherit">
            </div>
          </label>

          <label>
            <div class="label-text">Kategorie</div>
            <select id="feedbackKategorie" style="width:100%;padding:14px;font-size:16px;font-weight:600;border-radius:12px">
              <option value="feature">💡 Feature-Wunsch</option>
              <option value="bug">🐞 Bug-Meldung</option>
              <option value="improvement">✨ Verbesserungsvorschlag</option>
              <option value="design">🎨 Design-Feedback</option>
              <option value="other">📌 Sonstiges</option>
            </select>
          </label>

          <label>
            <div class="label-text">Deine Nachricht</div>
            <textarea id="feedbackNachricht" placeholder="Beschreibe dein Feedback so detailliert wie möglich..." style="width:100%;min-height:180px;padding:16px;font-size:15px;line-height:1.6;background:var(--input-bg);border:1px solid var(--input-border);border-radius:12px;color:inherit;font-family:inherit;resize:vertical" required></textarea>
          </label>

          <div style="background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.2);border-radius:12px;padding:16px;margin:20px 0;display:flex;gap:12px">
            <svg width="20" height="20" fill="none" stroke="var(--accent)" stroke-width="2" style="flex-shrink:0;margin-top:2px"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
            <div id="feedbackPrivacy" style="font-size:13px;color:var(--text);line-height:1.5">
              <strong style="color:var(--accent)">Datenschutz:</strong> Deine Angaben werden vertraulich behandelt und nur zur Verbesserung von Trade verwendet. E-Mail und Name sind optional.
            </div>
          </div>

          <button type="submit" class="btn btn-primary" style="background:linear-gradient(90deg,var(--accent),#34d399)">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
            Feedback senden
          </button>
        </form>

        <div id="feedbackSuccess" style="display:none;text-align:center;padding:40px 20px">
          <div style="display:inline-flex;align-items:center;justify-content:center;width:64px;height:64px;background:rgba(16,185,129,0.2);border-radius:50%;margin-bottom:20px">
            <svg width="32" height="32" fill="none" stroke="var(--accent)" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
          </div>
          <h3 style="font-size:24px;font-weight:700;color:var(--text);margin-bottom:12px">Vielen Dank!</h3>
          <p style="color:var(--muted);font-size:14px;line-height:1.6;margin-bottom:24px">
            Dein Feedback wurde erfolgreich übermittelt. Wir schätzen deine Meinung sehr und werden sie bei der Weiterentwicklung berücksichtigen.
          </p>
          <div style="display:flex;justify-content:center">
            <button onclick="zurueckZuHome()" class="btn" style="background:linear-gradient(90deg,var(--accent),#34d399);color:white">
              <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
              Zurück zur Startseite
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Nachkauf Modal -->
  <div id="nachkaufModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="background:#ef4444;border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center">
            <svg width="24" height="24" fill="white" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
          </div>
          <span id="nachkaufTitle" class="modal-title" style="color:#ef4444">Nachkauf -</span>
        </div>
        <button class="modal-close" onclick="closeModal('nachkaufModal')">×</button>
      </div>
      
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px">
        <label>
          <div id="nachkaufKursLabel" class="label-text">Nachkauf Kurs</div>
          <div class="input-wrapper">
            <input id="nachkaufKurs" type="number" step="0.01" value="2.00">
            <span class="input-unit">€</span>
          </div>
        </label>
        <label>
          <div id="nachkaufMengeLabel" class="label-text">Menge</div>
          <div class="input-wrapper">
            <input id="nachkaufMenge" type="number" step="1" value="20">
            <span id="nachkaufMengeUnit" class="input-unit">Stk.</span>
          </div>
        </label>
      </div>

      <div class="modal-result">
        <div id="neuerDurchschnittLabel" style="font-size:14px;color:var(--muted);margin-bottom:12px;text-align:center">Neuer Durchschnitt</div>
        <div style="display:flex;justify-content:center;align-items:center;gap:12px;font-size:24px;font-weight:700;margin-bottom:16px">
          <span style="color:var(--muted)">Ø <span id="alterDurchschnitt" style="text-decoration:line-through">1,00</span></span>
          <span style="color:var(--muted)">→</span>
          <span id="neuerDurchschnitt" style="color:var(--blue)">1,50</span>
        </div>
        <div style="border-top:1px solid rgba(255,255,255,0.1);padding-top:16px;margin-top:16px">
          <div id="investiertLabel" style="font-size:14px;color:var(--muted);margin-bottom:8px">Investiert</div>
          <div id="nachkaufInvestiert" style="font-size:28px;font-weight:700;color:var(--accent)">+ 20,00 €</div>
        </div>
      </div>

      <button id="nachkaufBestaetigenBtn" class="btn btn-primary" onclick="bestaetigeNachkauf()" style="width:100%">
        Nachkauf bestätigen
      </button>
    </div>
  </div>

  <!-- Teilverkauf Modal -->
  <div id="teilverkaufModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="background:var(--blue);border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center">
            <svg width="24" height="24" fill="white" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="none" stroke="white" stroke-width="2"/><path d="M12 2a10 10 0 0 1 0 20" fill="white"/></svg>
          </div>
          <span id="teilverkaufTitle" class="modal-title" style="color:var(--blue)">Teilverkauf +</span>
        </div>
        <button class="modal-close" onclick="closeModal('teilverkaufModal')">×</button>
      </div>
      
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px">
        <label>
          <div id="verkaufspreisLabel" class="label-text">Verkaufspreis</div>
          <div class="input-wrapper">
            <input id="verkaufPreis" type="number" step="0.01" value="3.25">
            <span class="input-unit">€</span>
          </div>
        </label>
        <label>
          <div id="verkaufsMengeLabel" class="label-text">Verkaufs-Menge</div>
          <div class="input-wrapper">
            <input id="verkaufMenge" type="number" step="1" value="100">
            <span id="verkaufMengeUnit" class="input-unit">Stk.</span>
          </div>
        </label>
      </div>

      <div class="modal-result">
        <div id="verbleibendLabel" style="font-size:14px;color:var(--muted);margin-bottom:12px">Verbleibend</div>
        <div id="verbleibendeStueck" style="font-size:32px;font-weight:800;color:var(--accent);margin-bottom:16px">417 Stk.</div>
        <div style="border-top:1px solid rgba(255,255,255,0.1);padding-top:16px;margin-top:16px">
          <div id="verkaufGewinnLabel" style="font-size:14px;color:var(--muted);margin-bottom:8px">Gewinn aus Verkauf</div>
          <div id="verkaufGewinn" style="font-size:28px;font-weight:700;color:var(--accent)">+ 0,00 €</div>
        </div>
      </div>

      <button id="teilverkaufBestaetigenBtn" class="btn btn-blue" onclick="bestaetigeTeilverkauf()" style="width:100%">
        Teilverkauf bestätigen
      </button>
    </div>
  </div>

  <!-- Login/Registrierung Modal -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div id="loginModalTitle" class="modal-title">Anmelden</div>
        <button class="modal-close" onclick="closeModal('loginModal')">×</button>
      </div>
      
      <div style="margin-bottom:24px">
        <div style="display:flex;gap:8px;margin-bottom:24px;border-bottom:1px solid var(--border)">
          <button id="loginTabBtn" class="theme-btn active" onclick="wechsleLoginTab('login')" style="flex:1;border:none;border-bottom:2px solid var(--accent);border-radius:0">Anmelden</button>
          <button id="registerTabBtn" class="theme-btn" onclick="wechsleLoginTab('register')" style="flex:1;border:none;border-radius:0">Registrieren</button>
        </div>

        <label style="margin-bottom:16px">
          <div id="emailLabel" class="label-text">E-Mail Adresse</div>
          <input id="loginEmail" type="email" placeholder="deine@email.de" style="width:100%;padding:14px;font-size:16px;background:var(--input-bg);border:1px solid var(--input-border);border-radius:10px;color:inherit;margin-top:8px">
        </label>

        <label style="margin-bottom:16px">
          <div id="passwordLabel" class="label-text">Passwort</div>
          <input id="loginPassword" type="password" placeholder="••••••••" style="width:100%;padding:14px;font-size:16px;background:var(--input-bg);border:1px solid var(--input-border);border-radius:10px;color:inherit;margin-top:8px">
        </label>

        <label id="countrySelectLabel" style="margin-bottom:16px;display:none">
          <div id="countrySelectLabelText" class="label-text">Land (für Steuerberechnung)</div>
          <select id="registerCountrySelect" style="width:100%;padding:14px;font-size:16px;background:var(--input-bg);border:1px solid var(--input-border);border-radius:10px;color:inherit;margin-top:8px">
            <option value="DE">🇩🇪 Deutschland</option>
            <option value="AT">🇦🇹 Österreich</option>
            <option value="CH">🇨🇭 Schweiz</option>
            <option value="US">🇺🇸 USA</option>
            <option value="GB">🇬🇧 United Kingdom</option>
            <option value="FR">🇫🇷 France</option>
            <option value="ES">🇪🇸 España</option>
            <option value="IT">🇮🇹 Italia</option>
            <option value="NL">🇳🇱 Nederland</option>
            <option value="BE">🇧🇪 België</option>
            <option value="LU">🇱🇺 Luxembourg</option>
            <option value="SE">🇸🇪 Sverige</option>
            <option value="NO">🇳🇴 Norge</option>
            <option value="DK">🇩🇰 Danmark</option>
            <option value="FI">🇫🇮 Suomi</option>
            <option value="PL">🇵🇱 Polska</option>
            <option value="CZ">🇨🇿 Česko</option>
            <option value="HU">🇭🇺 Magyarország</option>
            <option value="RO">🇷🇴 România</option>
            <option value="BG">🇧🇬 България</option>
            <option value="GR">🇬🇷 Ελλάδα</option>
            <option value="PT">🇵🇹 Portugal</option>
            <option value="IE">🇮🇪 Ireland</option>
            <option value="HR">🇭🇷 Hrvatska</option>
            <option value="SI">🇸🇮 Slovenija</option>
            <option value="SK">🇸🇰 Slovensko</option>
            <option value="EE">🇪🇪 Eesti</option>
            <option value="LV">🇱🇻 Latvija</option>
            <option value="LT">🇱🇹 Lietuva</option>
            <option value="CA">🇨🇦 Canada</option>
            <option value="AU">🇦🇺 Australia</option>
            <option value="NZ">🇳🇿 New Zealand</option>
            <option value="JP">🇯🇵 日本</option>
            <option value="KR">🇰🇷 대한민국</option>
            <option value="SG">🇸🇬 Singapore</option>
            <option value="HK">🇭🇰 Hong Kong</option>
            <option value="IN">🇮🇳 India</option>
            <option value="BR">🇧🇷 Brasil</option>
            <option value="MX">🇲🇽 México</option>
            <option value="ZA">🇿🇦 South Africa</option>
            <option value="TR">🇹🇷 Türkiye</option>
            <option value="AE">🇦🇪 UAE</option>
            <option value="IL">🇮🇱 Israel</option>
            <option value="RU">🇷🇺 Россия</option>
            <option value="CN">🇨🇳 中国</option>
            <option value="TH">🇹🇭 ไทย</option>
            <option value="MY">🇲🇾 Malaysia</option>
            <option value="ID">🇮🇩 Indonesia</option>
            <option value="PH">🇵🇭 Philippines</option>
            <option value="VN">🇻🇳 Việt Nam</option>
            <option value="AR">🇦🇷 Argentina</option>
            <option value="CL">🇨🇱 Chile</option>
            <option value="CO">🇨🇴 Colombia</option>
          </select>
        </label>

        <div id="registerHinweis" style="display:none;margin-bottom:16px">
          <div style="display:flex;align-items:start;gap:12px;padding:16px;background:rgba(255,255,255,0.02);border:1px solid var(--border);border-radius:10px;transition:all 0.2s;margin-bottom:0">
            <label style="cursor:pointer;margin:0;padding:0;display:flex">
              <input type="checkbox" id="acceptTerms" style="margin-top:4px;width:18px;height:18px;cursor:pointer;accent-color:var(--accent)">
            </label>
            <div id="termsText" style="flex:1;font-size:13px;color:var(--muted);line-height:1.6">
              Ich akzeptiere die <span id="termsLinkText" style="color:var(--accent);text-decoration:underline;cursor:pointer" onclick="openModal('nutzungsbedingungenModal')">Nutzungsbedingungen</span> <span id="andTheText">und die</span> <span id="privacyLinkText" style="color:var(--accent);text-decoration:underline;cursor:pointer" onclick="openModal('datenschutzModal')">Datenschutzerklärung</span>
            </div>
          </div>
        </div>

        <div id="loginFehler" style="display:none;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:8px;padding:12px;margin-bottom:16px;color:var(--danger);font-size:14px"></div>
        
        <div id="loginErfolg" style="display:none;background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:8px;padding:12px;margin-bottom:16px;color:var(--accent);font-size:14px"></div>
      </div>

      <button id="loginSubmitBtn" class="btn btn-primary" onclick="login()" style="width:100%">
        Anmelden
      </button>
    </div>
  </div>

  <!-- Nutzungsbedingungen Modal -->
  <div id="nutzungsbedingungenModal" class="modal">
    <div class="modal-content" style="max-width:700px;max-height:80vh;overflow-y:auto">
      <div class="modal-header">
        <div class="modal-title" id="termsModalTitle">Nutzungsbedingungen</div>
        <button class="modal-close" onclick="closeModal('nutzungsbedingungenModal')">?</button>
      </div>
      
      <div id="termsContent" style="color:var(--text);line-height:1.8;font-size:14px">
        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Anbieter und Kontakt</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Anbieter dieser Website und des Tools ist LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG, Bizetstrasse 111, 13088 Berlin, Deutschland. Kontakt: [E-Mail Platzhalter], [Telefon Platzhalter]. Handelsregister: [Platzhalter], Vertretungsberechtigte: Leonard George Toader, Pepe Rene Cruz, Thomas Markendorf.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. Geltungsbereich</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Diese Nutzungsbedingungen regeln die Nutzung der Website "Calculo" und der darin enthaltenen Rechner und Funktionen (nachfolgend "Tool"). Mit der Nutzung des Tools akzeptierst du diese Bedingungen.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Leistungen des Tools</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Das Tool stellt Berechnungen und Informationen fuer Trading, Sparen und Investments bereit. Die Inhalte dienen ausschliesslich der Information und ersetzen keine individuelle Beratung.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. Keine Anlage-, Steuer- oder Rechtsberatung</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Alle Berechnungen erfolgen ohne Gewaehr. Das Tool stellt keine Anlageberatung, Steuerberatung oder Rechtsberatung dar. Fuer verbindliche Auskuenfte konsultiere bitte qualifizierte Fachleute.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. Registrierung und lokale Speicherung</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Sofern eine Registrierung angeboten wird, erfolgt diese ueber Firebase Auth. Dabei werden E-Mail und Passwort (verschluesselt) sowie Profilangaben wie das Land gespeichert. Weitere App-Daten koennen lokal im Browser gespeichert werden.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. Nutzerpflichten</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Du bist fuer die Richtigkeit deiner Eingaben verantwortlich und nutzt das Tool auf eigenes Risiko. Du darfst das Tool nicht missbraeuchlich nutzen, insbesondere nicht zur Stoerung, Manipulation oder Umgehung von Sicherheitsfunktionen.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Verfuegbarkeit und Aenderungen</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Wir bemuehen uns um eine hohe Verfuegbarkeit, garantieren diese jedoch nicht. Wir duerfen Funktionen jederzeit aendern, einschranken oder einstellen.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Pro-Account und Preise</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Ein Pro-Account ist optional und bietet erweiterte Funktionen. Der aktuelle Preis und die Konditionen werden im Tool angezeigt (z. B. 1,99 EUR/Monat). Ein Abonnement kann jederzeit gekuendigt werden; Pro-Funktionen werden danach deaktiviert.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">9. Haftung</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Wir haften nicht fuer Schaeden, die aus der Nutzung oder Nichtnutzung des Tools entstehen, insbesondere nicht fuer finanzielle Verluste aufgrund von Berechnungen oder Entscheidungen. Zwingende gesetzliche Haftung bleibt unberuehrt.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">10. Schlussbestimmungen</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Es gilt deutsches Recht. Sofern gesetzlich zulaessig, ist Gerichtsstand Berlin. Sollte eine Bestimmung unwirksam sein, bleibt die Wirksamkeit der uebrigen Regelungen unberuehrt.
        </p>
      </div>

      <button id="termsCloseBtn" class="btn btn-primary" onclick="closeModal('nutzungsbedingungenModal')" style="width:100%;margin-top:24px">
        Schließen
      </button>
    </div>
  </div>

  <!-- Datenschutzerklärung Modal -->
  <div id="datenschutzModal" class="modal">
    <div class="modal-content" style="max-width:700px;max-height:80vh;overflow-y:auto">
      <div class="modal-header">
        <div class="modal-title" id="privacyModalTitle">Datenschutzerklärung</div>
        <button class="modal-close" onclick="closeModal('datenschutzModal')">×</button>
      </div>
      
      <div id="privacyContent" style="color:var(--text);line-height:1.8;font-size:14px">
        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Verantwortlicher</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Verantwortlich fuer die Datenverarbeitung ist LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG, Bizetstrasse 111, 13088 Berlin, Deutschland. Kontakt: [E-Mail Platzhalter], [Telefon Platzhalter].
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. Allgemeine Hinweise</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Der Schutz deiner Daten ist uns wichtig. Diese Datenschutzerklaerung erklaert, welche Daten im Rahmen der Nutzung des Tools verarbeitet werden.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Verarbeitete Daten</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Verarbeitet werden die von dir eingegebenen Daten, die fuer Anmeldung und Profil noetig sind (z. B. E-Mail, Passwort-Hash, Land) sowie optional lokal gespeicherte Einstellungen.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. Lokale Speicherung</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Account-Daten werden in der Cloud (Firebase/Firestore) gespeichert. Lokale App-Daten koennen im Browser gespeichert werden.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. Keine Drittanbieter, kein Tracking</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Es werden keine Tracking- oder Analyse-Tools eingesetzt. Fuer Anmeldung und Profildaten nutzen wir Firebase (Google) als Dienstleister.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. Datensicherheit</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Wir setzen technische und organisatorische Massnahmen ein, um Account-Daten zu schuetzen. Bitte schuetze zusaetzlich dein Geraet und deine Zugangsdaten.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Deine Rechte</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Du kannst deine Account-Daten loeschen oder berichtigen lassen. Lokal gespeicherte Daten kannst du in den Browser-Einstellungen entfernen. Bei Fragen erreichst du uns ueber die genannten Kontaktdaten.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Aenderungen</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Diese Datenschutzerklaerung kann bei Bedarf aktualisiert werden. Aenderungen werden im Tool bekanntgegeben.
        </p>
      </div>

      <button id="privacyCloseBtn" class="btn btn-primary" onclick="closeModal('datenschutzModal')" style="width:100%;margin-top:24px">
        Schließen
      </button>
    </div>
  </div>

  <!-- Bottom Nav -->
  <nav class="bottom-nav">
    <div class="bottom-nav-item active" onclick="showSection('trading')">
      <svg fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"></rect><line x1="9" y1="9" x2="15" y2="9"></line><line x1="9" y1="15" x2="15" y2="15"></line></svg>
      <span class="nav-text">Rechner</span>
    </div>
    <div class="bottom-nav-item" onclick="showSection('sparen')">
      <svg fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
      <span class="nav-text">Sparen</span>
    </div>
    <div class="bottom-nav-item" onclick="showSection('etf')">
      <svg fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3v18M3 9h18M3 15h18M6 6h12v12H6z"/></svg>
      <span class="nav-text">ETF Vergleich</span>
    </div>
  </nav>

  <!-- Lösch-Bestätigung Modal (Einzelne Position) -->
  <div id="loeschModal" class="modal">
    <div class="modal-content" style="max-width:400px">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="background:var(--danger);border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center">
            <svg width="24" height="24" fill="none" stroke="white" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
          </div>
          <span class="modal-title" style="color:var(--danger)" id="deletePositionTitle">Position löschen</span>
        </div>
        <button class="modal-close" onclick="closeModal('loeschModal')">×</button>
      </div>
      
      <div style="padding:24px 0">
        <p style="color:var(--text);font-size:16px;line-height:1.6;text-align:center" id="deletePositionMessage">
          Bist du sicher, dass du diese Position unwiderruflich löschen möchtest?
        </p>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <button class="btn" onclick="closeModal('loeschModal')" style="background:var(--input-bg);border:1px solid var(--border)" id="cancelButton">
          Abbrechen
        </button>
        <button class="btn" onclick="bestaetigeLoeschen()" style="background:var(--danger);color:white" id="deleteButton">
          Löschen
        </button>
      </div>
    </div>
  </div>

  <!-- Break-Even Info Modal -->
  <div id="breakEvenInfoModal" class="modal">
    <div class="modal-content" style="max-width:450px">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="background:linear-gradient(135deg,var(--blue),#60a5fa);border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center">
            <span style="color:white;font-weight:700;font-size:20px">i</span>
          </div>
          <span id="breakEvenModalTitle" class="modal-title" style="color:var(--blue)">Break-Even</span>
        </div>
        <button class="modal-close" onclick="closeModal('breakEvenInfoModal')">?</button>
      </div>
      
      <div style="padding:24px 0">
        <p id="breakEvenModalDesc" style="color:var(--text);font-size:15px;line-height:1.7">
          Der Kurs, bei dem dein Trade unter Berücksichtigung aller Kauf- und Verkaufsgebühren genau bei 0€ Gewinn/Verlust landet. Ab diesem Punkt bist du in der Gewinnzone.
        </p>
      </div>

      <button id="breakEvenModalBtn" class="btn btn-primary" onclick="closeModal('breakEvenInfoModal')" style="width:100%">
        Verstanden
      </button>
    </div>
  </div>

  <!-- CRV Info Modal -->
  <div id="crvInfoModal" class="modal">
    <div class="modal-content" style="max-width:450px">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="background:linear-gradient(135deg,var(--purple),#c084fc);border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center">
            <span style="color:white;font-weight:700;font-size:20px">i</span>
          </div>
          <span id="crvModalTitle" class="modal-title" style="color:var(--purple)">CRV – Chance-Risiko-Verhältnis</span>
        </div>
        <button class="modal-close" onclick="closeModal('crvInfoModal')">?</button>
      </div>
      
      <div style="padding:24px 0">
        <p id="crvModalDesc" style="color:var(--text);font-size:15px;line-height:1.7">
          Das Verhältnis deines potenziellen Gewinns zum Risiko (Abstand zum Stop-Loss). Ein CRV von 2.0 bedeutet, dass dein Zielgewinn doppelt so hoch ist wie dein mögliches Verlustrisiko.
        </p>
      </div>

      <button id="crvModalBtn" class="btn btn-primary" onclick="closeModal('crvInfoModal')" style="width:100%">
        Verstanden
      </button>
    </div>
  </div>

  <!-- Einzahlungen Info Modal -->
  <div id="einzahlungenInfoModal" class="modal">
    <div class="modal-content" style="max-width:450px">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="background:linear-gradient(135deg,var(--accent),#34d399);border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center">
            <span style="color:white;font-weight:700;font-size:20px">i</span>
          </div>
          <span class="modal-title" style="color:var(--accent)" id="einzahlungenTitle">Einzahlungen</span>
        </div>
        <button class="modal-close" onclick="closeModal('einzahlungenInfoModal')">?</button>
      </div>
      
      <div style="padding:24px 0">
        <p style="color:var(--text);font-size:15px;line-height:1.7" id="einzahlungenText">
          Summe aus Startkapital und Sparraten inkl. Dynamik.
        </p>
      </div>

      <button class="btn btn-primary" onclick="closeModal('einzahlungenInfoModal')" style="width:100%" id="einzahlungenBtn">
        Verstanden
      </button>
    </div>
  </div>

  <!-- Reiner Zins Info Modal -->
  <div id="reinerZinsInfoModal" class="modal">
    <div class="modal-content" style="max-width:450px">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="background:linear-gradient(135deg,var(--accent),#34d399);border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center">
            <span style="color:white;font-weight:700;font-size:20px">i</span>
          </div>
          <span class="modal-title" style="color:var(--accent)" id="reinerZinsTitle">Reiner Zins</span>
        </div>
        <button class="modal-close" onclick="closeModal('reinerZinsInfoModal')">?</button>
      </div>
      
      <div style="padding:24px 0">
        <p style="color:var(--text);font-size:15px;line-height:1.7" id="reinerZinsText">
          Der gesamte Gewinn durch Verzinsung und Zinseszins.
        </p>
      </div>

      <button class="btn btn-primary" onclick="closeModal('reinerZinsInfoModal')" style="width:100%" id="reinerZinsBtn">
        Verstanden
      </button>
    </div>
  </div>

  <!-- Lösch-Bestätigung Modal (Alle Positionen) -->
  <div id="loeschAlleModal" class="modal">
    <div class="modal-content" style="max-width:400px">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="background:var(--danger);border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center">
            <svg width="24" height="24" fill="none" stroke="white" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
          </div>
          <span class="modal-title" style="color:var(--danger)" id="deleteAllPositionsTitle">Alle Positionen löschen</span>
        </div>
        <button class="modal-close" onclick="closeModal('loeschAlleModal')">×</button>
      </div>
      
      <div style="padding:24px 0">
        <p style="color:var(--text);font-size:16px;line-height:1.6;text-align:center;margin-bottom:16px" id="deleteAllWarningMessage">
          <strong style="color:var(--danger)">ACHTUNG:</strong> Du bist dabei, <strong id="anzahlPositionen">0</strong> Position(en) unwiderruflich zu löschen!
        </p>
        <p style="color:var(--muted);font-size:14px;line-height:1.5;text-align:center" id="irreversibleActionMessage">
          Diese Aktion kann nicht rückgängig gemacht werden.
        </p>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <button class="btn" onclick="closeModal('loeschAlleModal')" style="background:var(--input-bg);border:1px solid var(--border)" id="cancelAllButton">
          Abbrechen
        </button>
        <button class="btn" onclick="bestaetigeLoeschenAlle()" style="background:var(--danger);color:white" id="deleteAllButton">
          Alle löschen
        </button>
      </div>
    </div>
  </div>

  <!-- Datenschutzerklärung Modal -->
  <div id="datenschutzModal" class="modal">
    <div class="modal-content" style="max-width:700px;max-height:80vh;overflow-y:auto">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="background:linear-gradient(135deg,var(--blue),#60a5fa);border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center">
            <svg width="24" height="24" fill="none" stroke="white" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
          </div>
          <span class="modal-title">Datenschutzerklärung</span>
        </div>
        <button class="modal-close" onclick="closeModal('datenschutzModal')">×</button>
      </div>
      
      <div style="padding:24px 0">
        <h3 style="color:var(--text);font-size:16px;font-weight:700;margin-bottom:12px">1. Datenschutz auf einen Blick</h3>
        <p style="color:var(--text);font-size:14px;line-height:1.7;margin-bottom:20px">
          Diese Datenschutzerklärung informiert über die Verarbeitung personenbezogener Daten bei der Nutzung von Trade.
        </p>

        <h3 style="color:var(--text);font-size:16px;font-weight:700;margin-bottom:12px">2. Datenerfassung</h3>
        <p style="color:var(--text);font-size:14px;line-height:1.7;margin-bottom:20px">
          Trade speichert alle Berechnungen und Einstellungen lokal in Ihrem Browser (localStorage). Es werden keine personenbezogenen Daten an externe Server übertragen. Ihre Trading-Daten, Sparrechnungen und Einstellungen verbleiben ausschließlich auf Ihrem Gerät.
        </p>

        <h3 style="color:var(--text);font-size:16px;font-weight:700;margin-bottom:12px">3. Cookies</h3>
        <p style="color:var(--text);font-size:14px;line-height:1.7;margin-bottom:20px">
          Diese Website verwendet keine Cookies oder Tracking-Technologien. Die Speicherung erfolgt ausschließlich über den lokalen Speicher Ihres Browsers.
        </p>

        <h3 style="color:var(--text);font-size:16px;font-weight:700;margin-bottom:12px">4. Ihre Rechte</h3>
        <p style="color:var(--text);font-size:14px;line-height:1.7;margin-bottom:20px">
          Sie haben jederzeit das Recht, die gespeicherten Daten durch Löschen des Browser-Cache zu entfernen. Da keine Daten an externe Server übertragen werden, gibt es keine zentrale Datenhaltung.
        </p>

        <p style="color:var(--muted);font-size:12px;margin-top:24px">
          Stand: <span data-last-updated="true"></span>
        </p>
      </div>

      <button class="btn btn-primary" onclick="closeModal('datenschutzModal')" style="width:100%">
        Schließen
      </button>
    </div>
  </div>

  <!-- Nutzungsbedingungen Modal -->
  <div id="nutzungsbedingungenModal" class="modal">
    <div class="modal-content" style="max-width:700px;max-height:80vh;overflow-y:auto">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="background:linear-gradient(135deg,var(--purple),#c084fc);border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center">
            <svg width="24" height="24" fill="none" stroke="white" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
          </div>
          <span class="modal-title">Nutzungsbedingungen</span>
        </div>
        <button class="modal-close" onclick="closeModal('nutzungsbedingungenModal')">?</button>
      </div>
      
      <div style="padding:24px 0">
        <h3 style="color:var(--text);font-size:16px;font-weight:700;margin-bottom:12px">1. Geltungsbereich</h3>
        <p style="color:var(--text);font-size:14px;line-height:1.7;margin-bottom:20px">
          Diese Nutzungsbedingungen regeln die Nutzung der Web-App "Trade". Mit der Nutzung dieser App erklären Sie sich mit diesen Bedingungen einverstanden.
        </p>

        <h3 style="color:var(--text);font-size:16px;font-weight:700;margin-bottom:12px">2. Leistungsbeschreibung</h3>
        <p style="color:var(--text);font-size:14px;line-height:1.7;margin-bottom:20px">
          Trade ist ein kostenloser Rechner für Trading- und Investmentberechnungen. Die App bietet Werkzeuge zur Berechnung von Trades, Sparraten und Investmentrenditen. Alle Berechnungen erfolgen ohne Gewähr.
        </p>

        <h3 style="color:var(--text);font-size:16px;font-weight:700;margin-bottom:12px">3. Haftungsausschluss</h3>
        <p style="color:var(--text);font-size:14px;line-height:1.7;margin-bottom:20px">
          Die bereitgestellten Berechnungen dienen ausschließlich zu Informationszwecken und stellen keine Anlageberatung dar. Für die Richtigkeit der Berechnungen wird keine Haftung übernommen. Trading und Investments bergen Risiken - investieren Sie nur Kapital, dessen Verlust Sie sich leisten können.
        </p>

        <h3 style="color:var(--text);font-size:16px;font-weight:700;margin-bottom:12px">4. Eigenverantwortung</h3>
        <p style="color:var(--text);font-size:14px;line-height:1.7;margin-bottom:20px">
          Jede Investment- oder Trading-Entscheidung liegt in Ihrer alleinigen Verantwortung. Die App ersetzt keine professionelle Finanzberatung.
        </p>

        <h3 style="color:var(--text);font-size:16px;font-weight:700;margin-bottom:12px">5. Änderungen</h3>
        <p style="color:var(--text);font-size:14px;line-height:1.7;margin-bottom:20px">
          Wir behalten uns das Recht vor, diese Nutzungsbedingungen jederzeit zu ändern. Änderungen werden auf dieser Seite veröffentlicht.
        </p>

        <p style="color:var(--muted);font-size:12px;margin-top:24px">
          Stand: <span data-last-updated="true"></span>
        </p>
      </div>

      <button class="btn btn-primary" onclick="closeModal('nutzungsbedingungenModal')" style="width:100%">
        Schließen
      </button>
    </div>
  </div>

  <!-- Impressum Modal -->
  <div id="impressumModal" class="modal">
    <div class="modal-content" style="max-width:700px;max-height:80vh;overflow-y:auto">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="background:linear-gradient(135deg,var(--accent),#34d399);border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center">
            <svg width="24" height="24" fill="none" stroke="white" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          </div>
          <span class="modal-title" id="imprintModalTitle">Impressum</span>
        </div>
        <button class="modal-close" onclick="closeModal('impressumModal')">?</button>
      </div>
      
      <div id="imprintContent" style="color:var(--text);line-height:1.8;font-size:14px">
        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Angaben gemäß § 5 TMG</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG<br>
          Bizetstrasse 111<br>
          13088 Berlin<br>
          Deutschland
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. Kontakt</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          E-Mail: [E-Mail Platzhalter]<br>
          Telefon: [Telefon Platzhalter]
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Registereintrag</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Handelsregister: [Platzhalter]<br>
          Registergericht: [Platzhalter]
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. Vertretungsberechtigte</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Leonard George Toader, Pepe Rene Cruz, Thomas Markendorf
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. Umsatzsteuer-ID</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Umsatzsteuer-Identifikationsnummer gemäß § 27 a UStG: [Platzhalter]
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. Verantwortlich fuer den Inhalt</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          [Platzhalter gemäß § 18 Abs. 2 MStV]
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Haftung fuer Inhalte</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Die Inhalte unserer Seiten und der App wurden mit groesster Sorgfalt erstellt. Fuer die Richtigkeit, Vollstaendigkeit und Aktualitaet der Inhalte koennen wir jedoch keine Gewaehr uebernehmen.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Haftung fuer Links</h3>
        <p style="margin-bottom:16px;color:var(--muted)">
          Diese Website kann Links zu externen Webseiten Dritter enthalten. Auf deren Inhalte haben wir keinen Einfluss. Fuer die Inhalte der verlinkten Seiten ist stets der jeweilige Anbieter verantwortlich.
        </p>

        <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">9. Hinweis zu Finanzinformationen</h3>
        <div style="background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:12px;padding:20px;margin-bottom:16px">
          <p style="color:var(--text);font-size:14px;line-height:1.7;font-weight:600;margin-bottom:8px">
            Wichtiger Hinweis: Keine Finanz- oder Anlageberatung
          </p>
          <p style="color:var(--text);font-size:13px;line-height:1.7">
            Die auf dieser Website bereitgestellten Informationen und Tools dienen ausschliesslich Informationszwecken und stellen keine Empfehlung zum Kauf oder Verkauf von Finanzinstrumenten dar. Ebenso erfolgt keine Steuer- oder Rechtsberatung.
          </p>
        </div>

        <p style="color:var(--muted);font-size:12px;margin-top:24px">
          Stand: <span data-last-updated="true"></span>
        </p>
      </div>

      <button id="imprintCloseBtn" class="btn btn-primary" onclick="closeModal('impressumModal')" style="width:100%">
        Schließen
      </button>
    </div>
  </div>

  <!-- ETF Detail Modal -->
  <div id="etfDetailModal" class="modal">
    <div class="modal-content" style="max-width:700px">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="background:linear-gradient(135deg,var(--blue),#60a5fa);border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center">
            <svg width="24" height="24" fill="none" stroke="white" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><polyline points="17 6 12 1 7 6"/><polyline points="7 18 12 23 17 18"/></svg>
          </div>
          <div style="flex:1">
            <div id="etfDetailName" class="modal-title" style="margin-bottom:4px">ETF Details</div>
            <div id="etfDetailIsin" style="font-size:12px;color:var(--muted)">ISIN</div>
          </div>
        </div>
        <button class="modal-close" onclick="closeModal('etfDetailModal')">×</button>
      </div>
      
      <div style="padding:24px 0">
        <p id="etfDetailBeschreibung" style="color:var(--text);font-size:15px;line-height:1.7;margin-bottom:24px"></p>

        <!-- Kategorie und TER -->
        <div style="display:flex;gap:12px;margin-bottom:24px">
          <div style="flex:1;background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.3);border-radius:12px;padding:16px;text-align:center">
            <div id="etfDetailCategoryLabel" style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">KATEGORIE</div>
            <div id="etfDetailKategorie" style="font-size:16px;font-weight:700;color:var(--blue)">-</div>
          </div>
          <div style="flex:1;background:rgba(168,85,247,0.1);border:1px solid rgba(168,85,247,0.3);border-radius:12px;padding:16px;text-align:center">
            <div id="etfDetailTerLabel" style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">TER (KOSTEN P.A.)</div>
            <div id="etfDetailTER" style="font-size:16px;font-weight:700;color:var(--purple)">-</div>
          </div>
        </div>

        <!-- Performance Übersicht -->
        <div style="background:rgba(255,255,255,0.02);border-radius:12px;padding:20px;margin-bottom:20px">
          <h3 id="etfDetailAvgReturnsLabel" style="font-size:14px;font-weight:700;color:var(--text);margin-bottom:16px;text-align:center">DURCHSCHNITTLICHE RENDITEN</h3>
          
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
            <div style="background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:12px;padding:16px;text-align:center">
              <div id="etfDetail1YLabel" style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">1 JAHR</div>
              <div id="etfDetail1J" style="font-size:28px;font-weight:800;color:var(--accent)">-</div>
            </div>
            <div style="background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:12px;padding:16px;text-align:center">
              <div id="etfDetail3YLabel" style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">3 JAHRE</div>
              <div id="etfDetail3J" style="font-size:28px;font-weight:800;color:var(--accent)">-</div>
            </div>
            <div style="background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:12px;padding:16px;text-align:center">
              <div id="etfDetail5YLabel" style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">5 JAHRE</div>
              <div id="etfDetail5J" style="font-size:28px;font-weight:800;color:var(--accent)">-</div>
            </div>
            <div style="background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:12px;padding:16px;text-align:center">
              <div id="etfDetail10YLabel" style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">10 JAHRE</div>
              <div id="etfDetail10J" style="font-size:28px;font-weight:800;color:var(--accent)">-</div>
            </div>
          </div>
        </div>

        <p id="etfDetailDisclaimer" style="color:var(--muted);font-size:12px;text-align:center;line-height:1.5">
          Historische Renditen sind keine Garantie für zukünftige Entwicklungen. Alle Angaben ohne Gewähr.
        </p>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <button id="etfDetailCloseBtn" class="btn" onclick="closeModal('etfDetailModal')" style="background:var(--input-bg);border:1px solid var(--border)">
          Schließen
        </button>
        <button id="etfDetailVergleichBtn" class="btn btn-primary" onclick="closeModal('etfDetailModal')">
          Zum Vergleich
        </button>
      </div>
    </div>
  </div>

  <!-- TER Info Modal -->
  <div id="terInfoModal" class="modal">
    <div class="modal-content" style="max-width:500px">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="background:linear-gradient(135deg,var(--purple),#c084fc);border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center">
            <svg width="24" height="24" fill="none" stroke="white" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
          </div>
          <div class="modal-title" id="terModalTitle">Was ist TER?</div>
        </div>
        <button class="modal-close" onclick="closeModal('terInfoModal')">×</button>
      </div>
      
      <div style="padding:24px 0">
        <p id="terModalDesc" style="color:var(--text);font-size:16px;line-height:1.7;margin-bottom:20px;font-weight:600">
          Die Total Expense Ratio (Gesamtkostenquote) gibt die jährlichen laufenden Kosten eines ETFs an.
        </p>
        
        <div style="background:rgba(168,85,247,0.1);border:1px solid rgba(168,85,247,0.3);border-radius:12px;padding:20px;margin-bottom:20px">
          <div id="terExampleLabel" style="font-size:13px;color:var(--muted);margin-bottom:8px;font-weight:600">BEISPIEL</div>
          <p id="terExampleText" style="color:var(--text);font-size:14px;line-height:1.6">
            Bei einem TER von <strong style="color:var(--purple)">0,20%</strong> und einem Investment von <strong style="color:var(--purple)">10.000€</strong> zahlst du <strong style="color:var(--purple)">20€ pro Jahr</strong> an Gebühren.
          </p>
        </div>
        
        <div style="background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:12px;padding:16px;margin-bottom:20px">
          <p id="lowerTERBetterText" style="color:var(--text);font-size:13px;line-height:1.6;display:flex;align-items:center;gap:8px">
            <svg width="20" height="20" fill="none" stroke="var(--accent)" stroke-width="2.5"><path d="M9 12l2 2 4-4"/><circle cx="12" cy="12" r="10"/></svg>
            <strong>Niedriger TER = Besser für dich!</strong>
          </p>
        </div>
        
        <p id="terIncludesText" style="color:var(--muted);font-size:12px;line-height:1.6">
          Die TER umfasst Verwaltungsgebühren, Betriebskosten und andere laufende Ausgaben. Sie wird automatisch vom Fondsvermögen abgezogen und ist bereits in der Wertentwicklung berücksichtigt.
        </p>
      </div>

      <button id="terUnderstoodBtn" class="btn btn-primary" onclick="closeModal('terInfoModal')" style="width:100%">
        Verstanden
      </button>
    </div>
  </div>

  <script>
  const LAUNCH_SCHEDULE = {
    public: new Date('2026-03-15T00:00:00+01:00'),
    pro: new Date('2026-04-01T00:00:00+02:00')
  };

  let launchCountdownIntervalId = null;

  function isPublicLaunchLive() {
    return Date.now() >= LAUNCH_SCHEDULE.public.getTime();
  }

  function isProLaunchLive() {
    return Date.now() >= LAUNCH_SCHEDULE.pro.getTime();
  }

  function getActiveLanguage() {
    return (typeof aktuelleSprache === 'string' && aktuelleSprache)
      ? aktuelleSprache
      : (localStorage.getItem('sprache') || 'de');
  }

  function formatCountdown(ms) {
    const totalSeconds = Math.max(0, Math.floor(ms / 1000));
    const days = Math.floor(totalSeconds / 86400);
    const hours = Math.floor((totalSeconds % 86400) / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    return `${days}d ${String(hours).padStart(2, '0')}h ${String(minutes).padStart(2, '0')}m ${String(seconds).padStart(2, '0')}s`;
  }

  function getLaunchTexts(lang) {
    const texts = {
      de: {
        siteTitle: 'Calculo startet am 15.03.2026',
        siteTimer: 'Website-Launch in',
        proTitle: 'Calculo Pro ist ab 01.04.2026 verfügbar',
        proTimer: 'Pro-Start in',
        proLocked: 'Calculo Pro ist aktuell noch nicht verfügbar. Pro startet am 01.04.2026.'
      },
      en: {
        siteTitle: 'Calculo launches on 03/15/2026',
        siteTimer: 'Website launch in',
        proTitle: 'Calculo Pro is available from 04/01/2026',
        proTimer: 'Pro launch in',
        proLocked: 'Calculo Pro is not available yet. Pro launches on 04/01/2026.'
      },
      es: {
        siteTitle: 'Calculo se lanza el 15/03/2026',
        siteTimer: 'Lanzamiento del sitio en',
        proTitle: 'Calculo Pro estará disponible el 01/04/2026',
        proTimer: 'Lanzamiento Pro en',
        proLocked: 'Calculo Pro aún no está disponible. Pro se lanza el 01/04/2026.'
      },
      fr: {
        siteTitle: 'Calculo sera lancé le 15/03/2026',
        siteTimer: 'Lancement du site dans',
        proTitle: 'Calculo Pro sera disponible le 01/04/2026',
        proTimer: 'Lancement Pro dans',
        proLocked: 'Calculo Pro n’est pas encore disponible. Pro sera lancé le 01/04/2026.'
      }
    };
    return texts[lang] || texts.de;
  }

  function updateLaunchCountdownBanner() {
    const banner = document.getElementById('launchCountdownBanner');
    const title = document.getElementById('launchBannerTitle');
    const timer = document.getElementById('launchBannerTimer');
    if (!banner || !title || !timer) return;

    const now = Date.now();
    const lang = getActiveLanguage();
    const texts = getLaunchTexts(lang);

    if (now < LAUNCH_SCHEDULE.public.getTime()) {
      title.textContent = texts.siteTitle;
      timer.textContent = `${texts.siteTimer}: ${formatCountdown(LAUNCH_SCHEDULE.public.getTime() - now)}`;
      banner.style.display = 'block';
      return;
    }

    if (now < LAUNCH_SCHEDULE.pro.getTime()) {
      title.textContent = texts.proTitle;
      timer.textContent = `${texts.proTimer}: ${formatCountdown(LAUNCH_SCHEDULE.pro.getTime() - now)}`;
      banner.style.display = 'block';
      return;
    }

    banner.style.display = 'none';
  }

  function startLaunchCountdownBanner() {
    if (launchCountdownIntervalId) {
      clearInterval(launchCountdownIntervalId);
      launchCountdownIntervalId = null;
    }
    updateLaunchCountdownBanner();
    if (!isProLaunchLive()) {
      launchCountdownIntervalId = setInterval(updateLaunchCountdownBanner, 1000);
    }
  }

  function applyPrelaunchProUI() {
    const prelaunch = !isProLaunchLive();

    const proFeatureTitle = document.getElementById('featureProTitle');
    if (proFeatureTitle && proFeatureTitle.parentElement) {
      proFeatureTitle.parentElement.style.display = prelaunch ? 'none' : '';
    }

    const proStatLabel = document.getElementById('statLabel3');
    if (proStatLabel && proStatLabel.parentElement) {
      proStatLabel.parentElement.style.display = prelaunch ? 'none' : '';
    }

    const proAccountFree = document.getElementById('proAccountFree');
    if (proAccountFree) {
      proAccountFree.style.display = prelaunch ? 'none' : proAccountFree.style.display;
    }

    const proAccountActive = document.getElementById('proAccountActive');
    if (proAccountActive) {
      proAccountActive.style.display = prelaunch ? 'none' : proAccountActive.style.display;
    }

    const trialInfoBox = document.getElementById('trialInfoBox');
    if (trialInfoBox) {
      trialInfoBox.style.display = prelaunch ? 'none' : '';
    }

    const sparProTeaser = document.getElementById('sparProTeaser');
    if (sparProTeaser) {
      sparProTeaser.style.display = prelaunch ? 'none' : '';
    }

    document.querySelectorAll('.upgrade-pro').forEach(button => {
      button.style.display = prelaunch ? 'none' : '';
    });
  }

  function getProLockedMessage() {
    const lang = getActiveLanguage();
    return getLaunchTexts(lang).proLocked;
  }

// Navigation
function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.bottom-nav-item').forEach(i => i.classList.remove('active'));
  
  const section = document.getElementById(id);
  if (section) section.classList.add('active');
  
  document.querySelectorAll('.tab').forEach(t => {
    if (t.getAttribute('data-section') === id) {
      t.classList.add('active');
    }
  });
  
  document.querySelectorAll('.bottom-nav-item').forEach(i => {
    if (i.onclick && i.onclick.toString().includes(id)) i.classList.add('active');
  });
  
  // Scrolle zum Anfang der Seite
  window.scrollTo({ top: 0, behavior: 'smooth' });
  
  // Lade gespeicherte Positionen wenn Trading-Sektion geöffnet wird
  if (id === 'trading') {
    setTimeout(function() {
      zeigeGespeichertePositionen();
    }, 50);
  }
  
  // Aktualisiere Sparrechner wenn Sparen-Sektion geöffnet wird
  if (id === 'sparen') {
    setTimeout(function() {
      berechneSpar();
    }, 50);
  }
  
  // Aktualisiere ETF-Ansicht wenn ETF-Sektion geöffnet wird
  if (id === 'etf') {
    const isPro = isProLaunchLive() && localStorage.getItem('isPro') === 'true';
    if (isPro) {
      document.getElementById('etfFreeView').style.display = 'none';
      document.getElementById('etfProView').style.display = 'block';
      // ETF-Liste und Chart aktualisieren
      setTimeout(function() {
        if (gefiltereETFs.length === 0) {
          initETFDatenbank();
        }
      }, 50);
    } else {
      document.getElementById('etfFreeView').style.display = 'block';
      document.getElementById('etfProView').style.display = 'none';
    }
  }
}

// Trading
let zeigeTradingNetto = true;
let zeigeSparNetto = true;

// Länderspezifische Steuerdaten - Kapitalertragsteuer auf Aktien/ETF/Crypto/Trades
const laenderSteuerdaten = {
  DE: { name: 'Deutschland', steuersatz: 26.375, freibetrag: 1000, waehrung: 'EUR', flagge: '🇩🇪', hinweis: 'Sparer-Pauschbetrag 1.000€ (einzeln) / 2.000€ (verheiratet)' },
  AT: { name: 'Österreich', steuersatz: 27.5, freibetrag: 0, waehrung: 'EUR', flagge: '🇦🇹' },
  CH: { name: 'Schweiz', steuersatz: 0, freibetrag: 0, waehrung: 'CHF', flagge: '🇨🇭', hinweis: 'Keine Kapitalertragsteuer für private Kursgewinne (kantonal unterschiedlich)' },
  US: { name: 'USA', steuersatz: 20, freibetrag: 0, waehrung: 'USD', flagge: '🇺🇸', hinweis: 'Langfristig 0-20% (einkommensabhängig), kurzfristig höher' },
  GB: { name: 'United Kingdom', steuersatz: 20, freibetrag: 12300, waehrung: 'GBP', flagge: '🇬🇧', hinweis: 'Capital Gains Allowance: £12.300 pro Jahr' },
  FR: { name: 'France', steuersatz: 26, freibetrag: 0, waehrung: 'EUR', flagge: '🇫🇷', hinweis: 'PEA-Konten steuerfrei nach 5 Jahren Haltedauer' },
  ES: { name: 'España', steuersatz: 21, freibetrag: 0, waehrung: 'EUR', flagge: '🇪🇸', hinweis: '19-26% progressiv je nach Einkommen' },
  IT: { name: 'Italia', steuersatz: 26, freibetrag: 0, waehrung: 'EUR', flagge: '🇮🇹' },
  NL: { name: 'Nederland', steuersatz: 32, freibetrag: 0, waehrung: 'EUR', flagge: '🇳🇱', hinweis: 'Vermögenssteuer statt klassischer Kapitalertragsteuer' },
  BE: { name: 'België', steuersatz: 0, freibetrag: 0, waehrung: 'EUR', flagge: '🇧🇪', hinweis: 'Keine Kapitalgewinnsteuer für Privatanleger' },
  LU: { name: 'Luxembourg', steuersatz: 17, freibetrag: 0, waehrung: 'EUR', flagge: '🇱🇺' },
  SE: { name: 'Sverige', steuersatz: 30, freibetrag: 0, waehrung: 'SEK', flagge: '🇸🇪' },
  NO: { name: 'Norge', steuersatz: 22, freibetrag: 0, waehrung: 'NOK', flagge: '🇳🇴' },
  DK: { name: 'Danmark', steuersatz: 42, freibetrag: 0, waehrung: 'DKK', flagge: '🇩🇰' },
  FI: { name: 'Suomi', steuersatz: 30, freibetrag: 0, waehrung: 'EUR', flagge: '🇫🇮', hinweis: '30-34% je nach Einkommenshöhe' },
  PL: { name: 'Polska', steuersatz: 19, freibetrag: 0, waehrung: 'PLN', flagge: '🇵🇱' },
  CZ: { name: 'Česko', steuersatz: 0, freibetrag: 0, waehrung: 'CZK', flagge: '🇨🇿', hinweis: '0% Kapitalgewinnsteuer bei Privatveräußerung nach bestimmter Haltedauer' },
  HU: { name: 'Magyarország', steuersatz: 15, freibetrag: 0, waehrung: 'HUF', flagge: '🇭🇺' },
  RO: { name: 'România', steuersatz: 10, freibetrag: 0, waehrung: 'RON', flagge: '🇷🇴' },
  BG: { name: 'България', steuersatz: 10, freibetrag: 0, waehrung: 'BGN', flagge: '🇧🇬' },
  GR: { name: 'Ελλάδα', steuersatz: 15, freibetrag: 0, waehrung: 'EUR', flagge: '🇬🇷' },
  PT: { name: 'Portugal', steuersatz: 28, freibetrag: 0, waehrung: 'EUR', flagge: '🇵🇹' },
  IE: { name: 'Ireland', steuersatz: 33, freibetrag: 1270, waehrung: 'EUR', flagge: '🇮🇪' },
  HR: { name: 'Hrvatska', steuersatz: 11, freibetrag: 0, waehrung: 'EUR', flagge: '🇭🇷', hinweis: '10-12% je nach Haltedauer' },
  SI: { name: 'Slovenija', steuersatz: 25, freibetrag: 0, waehrung: 'EUR', flagge: '🇸🇮' },
  SK: { name: 'Slovensko', steuersatz: 19, freibetrag: 0, waehrung: 'EUR', flagge: '🇸🇰' },
  EE: { name: 'Eesti', steuersatz: 20, freibetrag: 0, waehrung: 'EUR', flagge: '🇪🇪' },
  LV: { name: 'Latvija', steuersatz: 20, freibetrag: 0, waehrung: 'EUR', flagge: '🇱🇻' },
  LT: { name: 'Lietuva', steuersatz: 18, freibetrag: 0, waehrung: 'EUR', flagge: '🇱🇹', hinweis: '15-20% je nach Einkommen' },
  CA: { name: 'Canada', steuersatz: 25, freibetrag: 0, waehrung: 'CAD', flagge: '🇨🇦', hinweis: '50% der Gewinne steuerpflichtig, kann je Provinz variieren' },
  AU: { name: 'Australia', steuersatz: 23.5, freibetrag: 0, waehrung: 'AUD', flagge: '🇦🇺', hinweis: '50% Rabatt für Gewinne >1 Jahr Haltedauer' },
  NZ: { name: 'New Zealand', steuersatz: 33, freibetrag: 0, waehrung: 'NZD', flagge: '🇳🇿', hinweis: 'Besteuert als Einkommen, zählt zur Einkommensteuer' },
  JP: { name: '日本', steuersatz: 20.315, freibetrag: 0, waehrung: 'JPY', flagge: '🇯🇵' },
  KR: { name: '대한민국', steuersatz: 20, freibetrag: 0, waehrung: 'KRW', flagge: '🇰🇷', hinweis: '20-22% je nach Bedingungen' },
  SG: { name: 'Singapore', steuersatz: 0, freibetrag: 0, waehrung: 'SGD', flagge: '🇸🇬', hinweis: 'Keine Kapitalertragsteuer für Privatanleger' },
  HK: { name: 'Hong Kong', steuersatz: 0, freibetrag: 0, waehrung: 'HKD', flagge: '🇭🇰', hinweis: 'Keine Kapitalertragsteuer für Privatanleger' },
  IN: { name: 'India', steuersatz: 15, freibetrag: 0, waehrung: 'INR', flagge: '🇮🇳', hinweis: '10-15% je nach Haltedauer (STCG/LTCG)' },
  BR: { name: 'Brasil', steuersatz: 15, freibetrag: 0, waehrung: 'BRL', flagge: '🇧🇷', hinweis: '15% Kurz- und Langfrist' },
  MX: { name: 'México', steuersatz: 12, freibetrag: 0, waehrung: 'MXN', flagge: '🇲🇽', hinweis: 'Variabel, keine signifikanten Freibeträge' },
  ZA: { name: 'South Africa', steuersatz: 22, freibetrag: 40000, waehrung: 'ZAR', flagge: '🇿🇦', hinweis: 'Effektiv 18-36% je nach Gesamteinkommen, Freibetrag 40.000 ZAR' },
  TR: { name: 'Türkiye', steuersatz: 12, freibetrag: 0, waehrung: 'TRY', flagge: '🇹🇷', hinweis: '0% für Aktien >2 Jahren Haltedauer' },
  AE: { name: 'UAE', steuersatz: 0, freibetrag: 0, waehrung: 'AED', flagge: '🇦🇪', hinweis: 'Keine Kapitalertragsteuer und kein Einkommensteuer-System' },
  IL: { name: 'Israel', steuersatz: 25, freibetrag: 0, waehrung: 'ILS', flagge: '🇮🇱' },
  RU: { name: 'Россия', steuersatz: 13, freibetrag: 0, waehrung: 'RUB', flagge: '🇷🇺' },
  CN: { name: '中国', steuersatz: 20, freibetrag: 0, waehrung: 'CNY', flagge: '🇨🇳', hinweis: '10-20% je nach Anlageart' },
  TH: { name: 'ไทย', steuersatz: 15, freibetrag: 0, waehrung: 'THB', flagge: '🇹🇭', hinweis: 'Variabel, meist als Einkommensteuer behandelt' },
  MY: { name: 'Malaysia', steuersatz: 0, freibetrag: 0, waehrung: 'MYR', flagge: '🇲🇾', hinweis: 'Viele Ausschlüsse, Dividenden/Gewinne oft niedrig/nicht besteuert' },
  ID: { name: 'Indonesia', steuersatz: 5, freibetrag: 0, waehrung: 'IDR', flagge: '🇮🇩', hinweis: 'Geringe Steuersätze auf Kapitalerträge' },
  PH: { name: 'Philippines', steuersatz: 20, freibetrag: 0, waehrung: 'PHP', flagge: '🇵🇭', hinweis: '15-25% je nach Anlageart' },
  VN: { name: 'Việt Nam', steuersatz: 10, freibetrag: 0, waehrung: 'VND', flagge: '🇻🇳', hinweis: '0-20% je nach Sektor' },
  AR: { name: 'Argentina', steuersatz: 15, freibetrag: 0, waehrung: 'ARS', flagge: '🇦🇷', hinweis: 'Progressiv besteuert nach Einkommenshöhe' },
  CL: { name: 'Chile', steuersatz: 35, freibetrag: 0, waehrung: 'CLP', flagge: '🇨🇱' },
  CO: { name: 'Colombia', steuersatz: 12, freibetrag: 0, waehrung: 'COP', flagge: '🇨🇴', hinweis: '10-15% je nach Haltedauer' }
};

// Lokalisierte Ländernamen für 4 Sprachen
const landNamen = {
  DE: { de: 'Deutschland', en: 'Germany', es: 'Alemania', fr: 'Allemagne' },
  AT: { de: 'Österreich', en: 'Austria', es: 'Austria', fr: 'Autriche' },
  CH: { de: 'Schweiz', en: 'Switzerland', es: 'Suiza', fr: 'Suisse' },
  US: { de: 'USA', en: 'USA', es: 'EE. UU.', fr: 'États-Unis' },
  GB: { de: 'Vereinigtes Königreich', en: 'United Kingdom', es: 'Reino Unido', fr: 'Royaume-Uni' },
  FR: { de: 'Frankreich', en: 'France', es: 'Francia', fr: 'France' },
  ES: { de: 'Spanien', en: 'Spain', es: 'España', fr: 'Espagne' },
  IT: { de: 'Italien', en: 'Italy', es: 'Italia', fr: 'Italie' },
  NL: { de: 'Niederlande', en: 'Netherlands', es: 'Países Bajos', fr: 'Pays-Bas' },
  BE: { de: 'Belgien', en: 'Belgium', es: 'Bélgica', fr: 'Belgique' },
  LU: { de: 'Luxemburg', en: 'Luxembourg', es: 'Luxemburgo', fr: 'Luxembourg' },
  SE: { de: 'Schweden', en: 'Sweden', es: 'Suecia', fr: 'Suède' },
  NO: { de: 'Norwegen', en: 'Norway', es: 'Noruega', fr: 'Norvège' },
  DK: { de: 'Dänemark', en: 'Denmark', es: 'Dinamarca', fr: 'Danemark' },
  FI: { de: 'Finnland', en: 'Finland', es: 'Finlandia', fr: 'Finlande' },
  PL: { de: 'Polen', en: 'Poland', es: 'Polonia', fr: 'Pologne' },
  CZ: { de: 'Tschechien', en: 'Czechia', es: 'Chequia', fr: 'Tchéquie' },
  HU: { de: 'Ungarn', en: 'Hungary', es: 'Hungría', fr: 'Hongrie' },
  RO: { de: 'Rumänien', en: 'Romania', es: 'Rumanía', fr: 'Roumanie' },
  BG: { de: 'Bulgarien', en: 'Bulgaria', es: 'Bulgaria', fr: 'Bulgarie' },
  GR: { de: 'Griechenland', en: 'Greece', es: 'Grecia', fr: 'Grèce' },
  PT: { de: 'Portugal', en: 'Portugal', es: 'Portugal', fr: 'Portugal' },
  IE: { de: 'Irland', en: 'Ireland', es: 'Irlanda', fr: 'Irlande' },
  HR: { de: 'Kroatien', en: 'Croatia', es: 'Croacia', fr: 'Croatie' },
  SI: { de: 'Slowenien', en: 'Slovenia', es: 'Eslovenia', fr: 'Slovénie' },
  SK: { de: 'Slowakei', en: 'Slovakia', es: 'Eslovaquia', fr: 'Slovaquie' },
  EE: { de: 'Estland', en: 'Estonia', es: 'Estonia', fr: 'Estonie' },
  LV: { de: 'Lettland', en: 'Latvia', es: 'Letonia', fr: 'Lettonie' },
  LT: { de: 'Litauen', en: 'Lithuania', es: 'Lituania', fr: 'Lituanie' },
  CA: { de: 'Kanada', en: 'Canada', es: 'Canadá', fr: 'Canada' },
  AU: { de: 'Australien', en: 'Australia', es: 'Australia', fr: 'Australie' },
  NZ: { de: 'Neuseeland', en: 'New Zealand', es: 'Nueva Zelanda', fr: 'Nouvelle-Zélande' },
  JP: { de: 'Japan', en: 'Japan', es: 'Japón', fr: 'Japon' },
  KR: { de: 'Südkorea', en: 'South Korea', es: 'Corea del Sur', fr: 'Corée du Sud' },
  SG: { de: 'Singapur', en: 'Singapore', es: 'Singapur', fr: 'Singapour' },
  HK: { de: 'Hongkong', en: 'Hong Kong', es: 'Hong Kong', fr: 'Hong Kong' },
  IN: { de: 'Indien', en: 'India', es: 'India', fr: 'Inde' },
  BR: { de: 'Brasilien', en: 'Brazil', es: 'Brasil', fr: 'Brésil' },
  MX: { de: 'Mexiko', en: 'Mexico', es: 'México', fr: 'Mexique' },
  ZA: { de: 'Südafrika', en: 'South Africa', es: 'Sudáfrica', fr: 'Afrique du Sud' },
  TR: { de: 'Türkei', en: 'Turkey', es: 'Turquía', fr: 'Turquie' },
  AE: { de: 'Vereinigte Arabische Emirate', en: 'United Arab Emirates', es: 'Emiratos Árabes Unidos', fr: 'Émirats arabes unis' },
  IL: { de: 'Israel', en: 'Israel', es: 'Israel', fr: 'Israël' },
  RU: { de: 'Russland', en: 'Russia', es: 'Rusia', fr: 'Russie' },
  CN: { de: 'China', en: 'China', es: 'China', fr: 'Chine' },
  TH: { de: 'Thailand', en: 'Thailand', es: 'Tailandia', fr: 'Thaïlande' },
  MY: { de: 'Malaysia', en: 'Malaysia', es: 'Malasia', fr: 'Malaisie' },
  ID: { de: 'Indonesien', en: 'Indonesia', es: 'Indonesia', fr: 'Indonésie' },
  PH: { de: 'Philippinen', en: 'Philippines', es: 'Filipinas', fr: 'Philippines' },
  VN: { de: 'Vietnam', en: 'Vietnam', es: 'Vietnam', fr: 'Vietnam' },
  AR: { de: 'Argentinien', en: 'Argentina', es: 'Argentina', fr: 'Argentine' },
  CL: { de: 'Chile', en: 'Chile', es: 'Chile', fr: 'Chili' },
  CO: { de: 'Kolumbien', en: 'Colombia', es: 'Colombia', fr: 'Colombie' }
};

function getLandNameLocalized(landCode, fallbackName) {
  const lang = aktuelleSprache || 'de';
  return (landNamen[landCode] && landNamen[landCode][lang]) || fallbackName;
}

function aktualisiereLandOptionen() {
  const selects = [
    document.getElementById('landSelect'),
    document.getElementById('registerCountrySelect')
  ].filter(Boolean);

  selects.forEach(select => {
    Array.from(select.options).forEach(option => {
      const code = option.value;
      const daten = laenderSteuerdaten[code];
      if (!daten) return;
      const landName = getLandNameLocalized(code, daten.name);
      const flagge = daten.flagge ? daten.flagge + ' ' : '';
      option.textContent = flagge + landName;
    });
  });
}

// Holt die aktuellen Steuerinformationen basierend auf dem ausgewählten Land
function getLandSteuerdaten() {
  const land = localStorage.getItem('selectedCountry') || 'DE';
  return laenderSteuerdaten[land] || laenderSteuerdaten.DE;
}

function getNumberLocale() {
  const localeMap = { de: 'de-DE', en: 'en-US', es: 'es-ES', fr: 'fr-FR' };
  return localeMap[aktuelleSprache] || 'de-DE';
}

// Generiert dynamische Steuertexte basierend auf dem Land
function aktualisiereDynamischeTexte() {
  const daten = getLandSteuerdaten();
  const symbol = getWaehrungsSymbol();
  const landCode = localStorage.getItem('selectedCountry') || 'DE';
  const landName = getLandNameLocalized(landCode, daten.name);
  const numberLocale = getNumberLocale();
  const steuersatzText = daten.steuersatz.toLocaleString(numberLocale, { minimumFractionDigits: 0, maximumFractionDigits: 3 });
  const hasFreibetrag = daten.freibetrag > 0;
  const taxLabel = t('capitalGainsTax');
  const taxLabelText = landCode === 'DE'
    ? t('capitalGainsTaxWithSoli')
    : taxLabel;
  
  // Tax Info Text in History
  const taxInfoTextEl = document.getElementById('taxInfoText');
  if (taxInfoTextEl && daten.steuersatz > 0) {
    const allowanceHtml = `<span id="freibetragText">${daten.freibetrag.toLocaleString(numberLocale)} ${symbol}</span>`;
    const taxInfoTemplate = hasFreibetrag ? t('taxInfoWithAllowance') : t('taxInfoNoAllowance');
    const text = taxInfoTemplate
      .replace('{country}', landName)
      .replace('{taxLabel}', taxLabelText)
      .replace('{rate}', steuersatzText)
      .replace('{allowance}', allowanceHtml);
    taxInfoTextEl.innerHTML = text;
  }
  
  // FAQ Antwort
  const faqA3 = document.getElementById('faqA3');
  if (faqA3) {
    let faqText = t('taxFaqBase')
      .replace('{taxLabel}', taxLabelText)
      .replace('{country}', landName)
      .replace('{rate}', steuersatzText);
    if (hasFreibetrag) {
      const allowanceText = `${daten.freibetrag.toLocaleString(numberLocale)} ${symbol}`;
      faqText += ' ' + t('taxFaqAllowance').replace('{allowance}', allowanceText);
    }
    if (daten.hinweis) {
      faqText += ` Hinweis: ${daten.hinweis}`;
    }
    faqA3.textContent = faqText;
  }
  
  // Step 2 Text (Automatische Berechnung)
  const step2Desc = document.getElementById('step2Desc');
  if (step2Desc) {
    const land = landName;
    step2Desc.textContent = t('step2Desc').replace('deutschen', land + 'er').replace('German', land);
  }
  
  // Description texts
  const statsDesc = document.getElementById('statsDesc');
  if (statsDesc) {
    statsDesc.textContent = t('financialPlanningDesc');
  }
}

// Aktualisiert alle Anzeigen nach Länderwechsel
function aktualisiereNachLandWechsel() {
  const daten = getLandSteuerdaten();
  const symbol = getWaehrungsSymbol();
  const numberLocale = getNumberLocale();
  const hasFreibetrag = daten.freibetrag > 0;
  const hasTax = daten.steuersatz > 0;
  const landCode = localStorage.getItem('selectedCountry') || 'DE';
  const landName = getLandNameLocalized(landCode, daten.name);
  const steuersatzText = daten.steuersatz.toLocaleString(numberLocale, { minimumFractionDigits: 0, maximumFractionDigits: 3 });
  
  // Update Steuersatz auf Homepage
  const homeSteuersatz = document.getElementById('homeSteuersatz');
  if (homeSteuersatz) {
    homeSteuersatz.textContent = steuersatzText + '%';
  }
  
  // Zeige/Verstecke Freibetrag-Bereiche (nur wenn Freibetrag vorhanden)
  const freibetragCard = document.getElementById('freibetragCard');
  if (freibetragCard) freibetragCard.style.display = hasFreibetrag ? 'block' : 'none';
  
  const freibetragDetailsBox = document.getElementById('freibetragDetailsBox');
  if (freibetragDetailsBox) freibetragDetailsBox.style.display = hasFreibetrag ? 'block' : 'none';
  
  // Steuersatz-Box anzeigen/verstecken
  const steuersatzDetailsBox = document.getElementById('steuersatzDetailsBox');
  if (steuersatzDetailsBox) steuersatzDetailsBox.style.display = hasTax ? 'block' : 'none';
  
  // Zeige Steuer-Heading wenn Steuern existieren (auch ohne Freibetrag)
  const steuernHeading = document.getElementById('steuernHeading');
  if (steuernHeading) {
    steuernHeading.style.display = hasTax ? 'block' : 'none';
    steuernHeading.textContent = t('taxes').toUpperCase() + ' (' + landName.toUpperCase() + ')';
  }
  
  const homeFreibetragStat = document.getElementById('homeFreibetragStat');
  if (homeFreibetragStat) homeFreibetragStat.style.display = hasFreibetrag ? 'block' : 'none';

  // Tax Info Text nur anzeigen wenn Steuern existieren
  const taxInfoTextEl = document.getElementById('taxInfoText');
  if (taxInfoTextEl) {
    taxInfoTextEl.style.display = hasTax ? 'block' : 'none';
    if (!hasTax) taxInfoTextEl.innerHTML = '';
  }
  
  // Update Freibetrag Anzeigen (nur wenn vorhanden)
  if (hasFreibetrag) {
    const freibetragAnzeigen = document.querySelectorAll('#homeFreibetrag, #jahresFreibetrag, #freibetragText, #freibetragLimit');
    freibetragAnzeigen.forEach(el => {
      if (el) {
        if (el.id === 'freibetragLimit') {
          el.textContent = '/ ' + daten.freibetrag.toLocaleString(numberLocale) + ' ' + symbol;
        } else {
          el.textContent = daten.freibetrag.toLocaleString(numberLocale) + ' ' + symbol;
        }
      }
    });
  }
  
  // Update Steuersatz Label im Trading
  const tradingSteuerLabel = document.getElementById('tradingSteuerLabel');
  if (tradingSteuerLabel) {
    tradingSteuerLabel.textContent = t('capitalGainsTax') + ' (' + steuersatzText + '%)';
  }

  // Update Steuersatz Wert im Steuer-Detailbereich
  const steuersatzWert = document.getElementById('steuersatzWert');
  if (steuersatzWert) {
    steuersatzWert.textContent = steuersatzText + ' %';
  }
  
  // Update Freibetrag Input mit Validierung
  const freibetragInput = document.getElementById('verwendeterFreibetrag');
  if (freibetragInput) {
    freibetragInput.max = daten.freibetrag;
    const currentValue = parseFloat(freibetragInput.value) || 0;
    if (currentValue > daten.freibetrag) {
      freibetragInput.value = daten.freibetrag;
    }
    // Bei Ländern ohne Freibetrag auf 0 setzen
    if (daten.freibetrag === 0) {
      freibetragInput.value = 0;
      freibetragInput.disabled = true;
    } else {
      freibetragInput.disabled = false;
    }
  }
  
  // Aktualisiere dynamische Texte basierend auf dem Land
  aktualisiereDynamischeTexte();
  
  // Berechnungen neu durchführen
  berechneTrading();
  berechneSpar();
  aktualisiereFreibetrag();
}


function berechneTrading() {
  const e = parseFloat(document.getElementById('einstieg').value) || 0;
  const s = parseFloat(document.getElementById('stueck').value) || 0;
  const z = parseFloat(document.getElementById('ziel').value) || 0;
  const hebel = parseFloat(document.getElementById('hebel').value) || 1;
  
  console.log('berechneTrading() aufgerufen, zeigeTradingNetto:', zeigeTradingNetto, 'e:', e, 's:', s, 'z:', z);
  
  const hebelValElement = document.getElementById('hebelVal');
  if (hebelValElement) {
    hebelValElement.textContent = hebel;
  }
  updateRangeSlider('hebel');
  
  // Brutto Gewinn (mit Hebel multipliziert)
  const bruttoGewinn = ((z - e) * s) * hebel;
  
  // Gebühren und Steuern
  const broker = localStorage.getItem('broker') || 'custom';
  const landDaten = getLandSteuerdaten();
  const steuersatz = landDaten.steuersatz;
  
  const gebuehren = berechneGesamtGebuehren(e, s, z, broker);
  
  let steuern = 0;
  const gewinnNachGebuehren = bruttoGewinn - gebuehren;
  if (gewinnNachGebuehren > 0) {
    steuern = gewinnNachGebuehren * (steuersatz / 100);
  }
  
  const nettoGewinn = bruttoGewinn - gebuehren - steuern;
  const gewinn = zeigeTradingNetto ? nettoGewinn : bruttoGewinn;
  const rendite = e > 0 ? (nettoGewinn / (e * s) * 100) : 0;
  
  const symbol = getWaehrungsSymbol();
  
  // Trading Gewinn aktualisieren
  const tradingGewinnEl = document.getElementById('tradingGewinn');
  if (tradingGewinnEl) {
    tradingGewinnEl.textContent = gewinn.toFixed(2) + ' ' + symbol;
    tradingGewinnEl.style.color = gewinn >= 0 ? 'var(--accent)' : 'var(--danger)';
  }
  
  // Update Label - Behalte SVG Icon
  const labelElement = document.getElementById('tradingGewinnLabel');
  if (labelElement) {
    const labelText = zeigeTradingNetto ? t('netProfit') : t('grossProfit');
    labelElement.innerHTML = labelText + ' \n            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-left:4px"><path d="M7 10l5 5 5-5M7 4l5 5 5-5"/></svg>';
  }
  
  const badge = document.getElementById('tradingBadge');
  if (badge) {
    badge.style.background = gewinn >= 0 ? 'rgba(16,185,129,0.2)' : 'rgba(239,68,68,0.2)';
    badge.style.color = gewinn >= 0 ? 'var(--accent)' : 'var(--danger)';
  }
  
  const tradingRenditeEl = document.getElementById('tradingRendite');
  if (tradingRenditeEl) {
    tradingRenditeEl.textContent = Math.abs(rendite).toFixed(2) + '%';
  }
  
  // Steuer-Info anzeigen wenn Netto ausgewählt ist
  const steuerInfo = document.getElementById('tradingSteuerInfo');
  if (steuerInfo) {
    if (zeigeTradingNetto && steuern > 0) {
      steuerInfo.style.display = 'block';
      const steuerEl = document.getElementById('tradingSteuer');
      if (steuerEl) {
        steuerEl.textContent = steuern.toFixed(2) + ' ' + symbol;
      }
    } else {
      steuerInfo.style.display = 'none';
    }
  }
  
  // Break-Even berechnen (Einstiegskurs + Gebühren pro Aktie)
  const breakEven = berechneBreakEvenKurs(e, s, broker);
  const breakEvenEl = document.getElementById('breakEven');
  if (breakEvenEl) {
    breakEvenEl.textContent = breakEven.toFixed(4) + ' ' + symbol;
  }
  
  // CRV berechnen (Chance-Risiko-Verhältnis)
  const stopLossEl = document.getElementById('stopLoss');
  const stopLoss = stopLossEl ? parseFloat(stopLossEl.value) : 0;
  const gewinnPotenzial = z - e;
  let verlustRisiko;
  
  if (stopLoss && stopLoss > 0) {
    // Verwende eingegebenen Stop-Loss
    verlustRisiko = e - stopLoss;
  } else {
    // Fallback: 10% unter Einstieg
    verlustRisiko = e * 0.1;
  }
  
  const crvWert = verlustRisiko > 0 ? (gewinnPotenzial / verlustRisiko) : 0;
  const crvEl = document.getElementById('crv');
  if (crvEl) {
    crvEl.textContent = '1:' + crvWert.toFixed(2);
  }
}

function toggleTradingAnzeige() {
  console.log('toggleTradingAnzeige() aufgerufen, zeigeTradingNetto:', zeigeTradingNetto);
  zeigeTradingNetto = !zeigeTradingNetto;
  console.log('zeigeTradingNetto nach Toggle:', zeigeTradingNetto);
  berechneTrading();
}

async function speicherePosition() {
  // Prüfe ob User angemeldet ist
  const aktuellerUser = window.firebaseCurrentUser;
  if (!aktuellerUser) {
    oeffneLoginModal();
    return;
  }
  
  const name = document.getElementById('posname').value || t('unnamedPosition');
  const e = parseFloat(document.getElementById('einstieg').value) || 0;
  const s = parseFloat(document.getElementById('stueck').value) || 0;
  const z = parseFloat(document.getElementById('ziel').value) || 0;
  const hebel = parseFloat(document.getElementById('hebel').value) || 1;
  
  if (e === 0 || s === 0 || z === 0) {
    const msgs = {
      de: 'Bitte fülle alle Felder aus (Einstieg, Stückzahl und Zielkurs).',
      en: 'Please fill in all fields (entry price, quantity and target price).',
      es: 'Por favor, rellena todos los campos (precio de entrada, cantidad y precio objetivo).',
      fr: 'Veuillez remplir tous les champs (prix d\'entrée, quantité et prix cible).'
    };
    alert(msgs[aktuelleSprache] || msgs.de);
    return;
  }
  
  // Brutto Gewinn (mit Hebel)
  const bruttoGewinn = ((z - e) * s) * hebel;
  
  // Gebühren und Steuern berechnen
  const broker = localStorage.getItem('broker') || 'custom';
  const landDaten = getLandSteuerdaten();
  const steuersatz = landDaten.steuersatz; // Länderspezifischer Steuersatz
  
  // Gebühren: Kauf + Verkauf
  const gebuehren = berechneGesamtGebuehren(e, s, z, broker);
  
  // Steuern auf den Gewinn (nur wenn positiv)
  let steuern = 0;
  const gewinnNachGebuehren = bruttoGewinn - gebuehren;
  if (gewinnNachGebuehren > 0) {
    steuern = gewinnNachGebuehren * (steuersatz / 100);
  }
  
  // Netto Gewinn
  const nettoGewinn = bruttoGewinn - gebuehren - steuern;
  const rendite = e > 0 ? (nettoGewinn / (e * s) * 100) : 0;
  
  const position = {
    id: Date.now(),
    name: name,
    einstieg: e,
    stueck: s,
    ziel: z,
    hebel: hebel,
    bruttoGewinn: bruttoGewinn,
    nettoGewinn: nettoGewinn,
    gebuehren: gebuehren,
    steuern: steuern,
    rendite: rendite,
    datum: new Date().toISOString(),
    zeigeNetto: true
  };
  
  // Speichere in localStorage
  let positionen = JSON.parse(localStorage.getItem('gespeichertePositionen') || '[]');
  positionen.unshift(position); // Am Anfang einfügen
  localStorage.setItem('gespeichertePositionen', JSON.stringify(positionen));

  if (window.firebaseSavePosition && aktuellerUser && aktuellerUser.uid) {
    try {
      await window.firebaseSavePosition(aktuellerUser.uid, position);
    } catch (err) {
      console.error('Firebase speichern fehlgeschlagen', err);
    }
  }
  
  console.log('Position gespeichert:', position);
  console.log('Gesamt Positionen:', positionen.length);
  
  document.getElementById('posname').value = '';
  
  // Liste aktualisieren
  zeigeGespeichertePositionen();
}

async function zeigeGespeichertePositionen() {
  console.log('zeigeGespeichertePositionen() aufgerufen');
  let positionen = JSON.parse(localStorage.getItem('gespeichertePositionen') || '[]');
  const aktuellerUser = window.firebaseCurrentUser;
  if (aktuellerUser && window.firebaseLoadPositions) {
    try {
      const remotePositionen = await window.firebaseLoadPositions(aktuellerUser.uid);
      if (Array.isArray(remotePositionen)) {
        positionen = remotePositionen.map((pos) => {
          const normalisiert = Object.assign({}, pos);
          if (normalisiert.createdAt && typeof normalisiert.createdAt.toDate === 'function') {
            normalisiert.datum = normalisiert.createdAt.toDate().toISOString();
          }
          if (typeof normalisiert.id === 'string' && !isNaN(Number(normalisiert.id))) {
            normalisiert.id = Number(normalisiert.id);
          }
          return normalisiert;
        });
        localStorage.setItem('gespeichertePositionen', JSON.stringify(positionen));
      }
    } catch (err) {
      console.error('Firebase laden fehlgeschlagen', err);
    }
  }
  console.log('Geladene Positionen aus localStorage:', positionen.length);
  
  const container = document.getElementById('gespeichertePositionen');
  
  if (!container) {
    console.error('Container gespeichertePositionen nicht gefunden!');
    return;
  }
  
  console.log('Container gefunden:', container);
  
  // Bestimme Locale basierend auf aktueller Sprache
  const localeMap = {
    'de': 'de-DE',
    'en': 'en-US',
    'es': 'es-ES',
    'fr': 'fr-FR'
  };
  const locale = localeMap[aktuelleSprache] || 'de-DE';
  
  if (positionen.length === 0) {
    container.innerHTML = '<div style="text-align:center;padding:40px 20px;color:var(--muted)"><svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5" style="margin:0 auto 16px;display:block"><rect x="3" y="3" width="18" height="18" rx="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line></svg><div style="font-size:14px">' + t('noPositionsSaved') + '</div><div style="font-size:12px;margin-top:8px">' + t('saveFirstPosition') + '</div></div>';
    console.log('Keine Positionen vorhanden - Platzhalter angezeigt');
    return;
  }
  
  console.log('Zeige ' + positionen.length + ' Positionen an');
  
  const symbol = getWaehrungsSymbol();
  let html = '<div style="display:flex;justify-content:flex-end;margin-bottom:12px"><button type="button" onclick="window.oeffneLoeschAlleModal()" style="background:transparent;border:none;color:var(--muted);font-size:12px;cursor:pointer;text-decoration:underline" onmouseover="this.style.color=\'var(--danger)\'" onmouseout="this.style.color=\'var(--muted)\'">'+t('deleteAllButtonText')+'</button></div>';
  
  positionen.forEach((pos, index) => {
    // Validiere Position-Daten
    if (!pos || typeof pos.id === 'undefined' || typeof pos.einstieg === 'undefined' || typeof pos.ziel === 'undefined') {
      console.warn('Überspringe ungültige Position:', pos);
      return;
    }
    
    const datum = new Date(pos.datum);
    const datumStr = datum.toLocaleDateString(locale, { day: '2-digit', month: '2-digit', year: 'numeric' });
    const zeitStr = datum.toLocaleTimeString(locale, { hour: '2-digit', minute: '2-digit' });
    
    // Initialisiere zeigeNetto falls nicht vorhanden
    if (typeof pos.zeigeNetto === 'undefined') {
      pos.zeigeNetto = true;
    }
    
    const gewinn = pos.zeigeNetto ? (pos.nettoGewinn || 0) : (pos.bruttoGewinn || 0);
    const gewinnLabel = pos.zeigeNetto ? t('net') : t('gross');
    const gewinnFarbe = gewinn >= 0 ? 'var(--accent)' : 'var(--danger)';
    const posName = pos.name || t('unnamedPosition');
    const stueck = pos.stueck || 0;
    const rendite = pos.rendite || 0;
    
    console.log('Generiere Button für Position:', pos.id);
    
    html += `
      <div style="background:var(--input-bg);border-left:3px solid ${gewinnFarbe};border-radius:8px;padding:16px;margin-bottom:12px;transition:all 0.2s" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='var(--input-bg)'">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div style="flex:1">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:6px">
              <span style="font-size:18px;font-weight:700;color:var(--text)">#${positionen.length - index}</span>
              <span style="font-size:16px;font-weight:600;color:var(--text)">${posName}</span>
            </div>
            <div style="font-size:12px;color:var(--muted)">
              <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-right:4px"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
              ${datumStr} – ${zeitStr}
            </div>
          </div>
          <button type="button" onclick="console.log('Button geklickt!'); window.oeffneLoeschModal(${pos.id})" style="background:transparent;border:1px solid rgba(239,68,68,0.3);border-radius:6px;padding:6px 12px;color:var(--danger);font-size:11px;cursor:pointer;font-weight:600;transition:all 0.2s" onmouseover="this.style.background='rgba(239,68,68,0.1)'" onmouseout="this.style.background='transparent'">
            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;pointer-events:none"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
          </button>
        </div>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:16px;padding:12px 0;border-top:1px solid var(--border);border-bottom:1px solid var(--border)">
          <div>
            <div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">${t('entry')}</div>
            <div style="font-size:14px;font-weight:600;color:var(--text)">${pos.einstieg.toFixed(2)} ${symbol}</div>
          </div>
          <div>
            <div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">${t('target')}</div>
            <div style="font-size:14px;font-weight:600;color:var(--text)">${pos.ziel.toFixed(2)} ${symbol}</div>
          </div>
          <div>
            <div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">${t('quantity')}</div>
            <div style="font-size:14px;font-weight:600;color:var(--text)">${stueck} ${t('pieces')}</div>
          </div>
          <div>
            <div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">${t('yield')}</div>
            <div style="font-size:14px;font-weight:700;color:${gewinnFarbe}">${rendite >= 0 ? '+' : ''}${rendite.toFixed(2)}%</div>
          </div>
        </div>
        
        <div onclick="toggleGewinnAnzeige(${pos.id})" style="margin-top:12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:6px;background:rgba(255,255,255,0.02)" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='rgba(255,255,255,0.02)'">
          <div style="pointer-events:none">
            <div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:2px">${t('profit')} (${gewinnLabel})</div>
            <div style="font-size:20px;font-weight:800;color:${gewinnFarbe}">${gewinn >= 0 ? '+' : ''}${gewinn.toFixed(2)} ${symbol}</div>
          </div>
          <div style="font-size:11px;color:var(--muted);display:flex;align-items:center;gap:4px;pointer-events:none">
            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 10l5 5 5-5M7 4l5 5 5-5"/></svg>
            ${t('toggle')}
          </div>
        </div>
      </div>
    `;
  });
  
  console.log('HTML generiert, Länge:', html.length);
  console.log('Setze innerHTML...');
  container.innerHTML = html;
  console.log('innerHTML gesetzt, fertig!');
}

let zuLoeschendePositionId = null;

function oeffneLoeschModal(posId) {
  zuLoeschendePositionId = posId;
  document.getElementById('loeschModal').classList.add('active');
}

function bestaetigeLoeschen() {
  if (zuLoeschendePositionId !== null) {
    loeschePosition(zuLoeschendePositionId);
    zuLoeschendePositionId = null;
  }
  closeModal('loeschModal');
}

function oeffneLoeschAlleModal() {
  const positionen = JSON.parse(localStorage.getItem('gespeichertePositionen') || '[]');
  if (positionen.length === 0) {
    return;
  }
  document.getElementById('anzahlPositionen').textContent = positionen.length;
  document.getElementById('loeschAlleModal').classList.add('active');
}

async function bestaetigeLoeschenAlle() {
  localStorage.removeItem('gespeichertePositionen');
  console.log('Alle Positionen gelöscht');
  const aktuellerUser = window.firebaseCurrentUser;
  if (window.firebaseDeleteAllPositions && aktuellerUser && aktuellerUser.uid) {
    try {
      await window.firebaseDeleteAllPositions(aktuellerUser.uid);
    } catch (err) {
      console.error('Firebase loeschen fehlgeschlagen', err);
    }
  }
  closeModal('loeschAlleModal');
  zeigeGespeichertePositionen();
}

async function toggleGewinnAnzeige(posId) {
  let positionen = JSON.parse(localStorage.getItem('gespeichertePositionen') || '[]');
  const pos = positionen.find(p => String(p.id) === String(posId));
  if (pos) {
    pos.zeigeNetto = !pos.zeigeNetto;
    localStorage.setItem('gespeichertePositionen', JSON.stringify(positionen));
    const aktuellerUser = window.firebaseCurrentUser;
    if (window.firebaseSavePosition && aktuellerUser && aktuellerUser.uid) {
      try {
        await window.firebaseSavePosition(aktuellerUser.uid, pos);
      } catch (err) {
        console.error('Firebase update fehlgeschlagen', err);
      }
    }
    zeigeGespeichertePositionen();
  }
}

async function loeschePosition(posId) {
  console.log('=== loeschePosition aufgerufen ===');
  console.log('Typ von posId:', typeof posId);
  console.log('Wert von posId:', posId);
  
  let positionen = JSON.parse(localStorage.getItem('gespeichertePositionen') || '[]');
  console.log('Alle Positionen:', positionen);
  const vorher = positionen.length;
  
  positionen = positionen.filter(p => {
    console.log('Vergleiche:', p.id, '!==', posId, '=', String(p.id) !== String(posId));
    return String(p.id) !== String(posId);
  });
  
  const nachher = positionen.length;
  console.log('Positionen vorher:', vorher, 'nachher:', nachher);
  
  localStorage.setItem('gespeichertePositionen', JSON.stringify(positionen));
  console.log('Position gelöscht, aktualisiere Anzeige');
  const aktuellerUser = window.firebaseCurrentUser;
  if (window.firebaseDeletePosition && aktuellerUser && aktuellerUser.uid) {
    try {
      await window.firebaseDeletePosition(aktuellerUser.uid, posId);
    } catch (err) {
      console.error('Firebase loeschen fehlgeschlagen', err);
    }
  }
  zeigeGespeichertePositionen();
}

// Mache Funktionen global verfügbar für onclick-Handler
window.loeschePosition = loeschePosition;
window.toggleGewinnAnzeige = toggleGewinnAnzeige;
window.oeffneLoeschModal = oeffneLoeschModal;
window.oeffneLoeschAlleModal = oeffneLoeschAlleModal;
window.bestaetigeLoeschen = bestaetigeLoeschen;
window.bestaetigeLoeschenAlle = bestaetigeLoeschenAlle;

async function loescheAllePositionen() {
  const positionen = JSON.parse(localStorage.getItem('gespeichertePositionen') || '[]');
  if (positionen.length === 0) {
    const msgs = {
      de: 'Keine Positionen vorhanden.',
      en: 'No positions available.',
      es: 'No hay posiciones disponibles.',
      fr: 'Aucune position disponible.'
    };
    alert(msgs[aktuelleSprache] || msgs.de);
    return;
  }
  
  if (confirm(t('deleteAllWarning').replace('{count}', positionen.length))) {
    localStorage.removeItem('gespeichertePositionen');
    console.log('Alle Positionen gelöscht');
    const aktuellerUser = window.firebaseCurrentUser;
    if (window.firebaseDeleteAllPositions && aktuellerUser && aktuellerUser.uid) {
      try {
        await window.firebaseDeleteAllPositions(aktuellerUser.uid);
      } catch (err) {
        console.error('Firebase loeschen fehlgeschlagen', err);
      }
    }
    zeigeGespeichertePositionen();
  }
}

function nachkauf() {
  const e = parseFloat(document.getElementById('einstieg').value) || 0;
  document.getElementById('nachkaufKurs').value = e.toFixed(2);
  document.getElementById('nachkaufModal').classList.add('active');
  updateNachkaufPreview();
}

function updateNachkaufPreview() {
  const e = parseFloat(document.getElementById('einstieg').value) || 0;
  const s = parseFloat(document.getElementById('stueck').value) || 0;
  const nk = parseFloat(document.getElementById('nachkaufKurs').value) || 0;
  const nm = parseFloat(document.getElementById('nachkaufMenge').value) || 0;
  
  // Alter und neuer Durchschnitt
  document.getElementById('alterDurchschnitt').textContent = e.toFixed(2);
  
  if (s + nm > 0) {
    const neuKurs = ((e * s) + (nk * nm)) / (s + nm);
    document.getElementById('neuerDurchschnitt').textContent = neuKurs.toFixed(2);
  }
  
  // Investierter Betrag
  const investiert = nk * nm;
  const symbol = getWaehrungsSymbol();
  document.getElementById('nachkaufInvestiert').textContent = '+ ' + investiert.toFixed(2) + ' ' + symbol;
}

function bestaetigeNachkauf() {
  const e = parseFloat(document.getElementById('einstieg').value) || 0;
  const s = parseFloat(document.getElementById('stueck').value) || 0;
  const nk = parseFloat(document.getElementById('nachkaufKurs').value) || 0;
  const nm = parseFloat(document.getElementById('nachkaufMenge').value) || 0;
  
  if (nm > 0) {
    const neuKurs = ((e * s) + (nk * nm)) / (s + nm);
    document.getElementById('einstieg').value = neuKurs.toFixed(2);
    document.getElementById('stueck').value = s + nm;
    closeModal('nachkaufModal');
    berechneTrading();
  }
}

function teilverkauf() {
  const s = parseFloat(document.getElementById('stueck').value) || 0;
  const z = parseFloat(document.getElementById('ziel').value) || 0;
  document.getElementById('verkaufMenge').value = Math.floor(s / 2);
  document.getElementById('verkaufPreis').value = z.toFixed(2);
  document.getElementById('teilverkaufModal').classList.add('active');
  updateTeilverkaufPreview();
}

function updateTeilverkaufPreview() {
  const e = parseFloat(document.getElementById('einstieg').value) || 0;
  const s = parseFloat(document.getElementById('stueck').value) || 0;
  const vp = parseFloat(document.getElementById('verkaufPreis').value) || 0;
  const vm = parseFloat(document.getElementById('verkaufMenge').value) || 0;
  
  // Verbleibende Stückzahl
  document.getElementById('verbleibendeStueck').textContent = Math.max(0, s - vm) + ' Stk.';
  
  // Gewinn aus Verkauf berechnen
  const gewinn = (vp - e) * vm;
  const gewinnEl = document.getElementById('verkaufGewinn');
  const symbol = getWaehrungsSymbol();
  gewinnEl.textContent = (gewinn >= 0 ? '+ ' : '- ') + Math.abs(gewinn).toFixed(2) + ' ' + symbol;
  gewinnEl.style.color = gewinn >= 0 ? 'var(--accent)' : 'var(--danger)';
}

function bestaetigeTeilverkauf() {
  const s = parseFloat(document.getElementById('stueck').value) || 0;
  const vm = parseFloat(document.getElementById('verkaufMenge').value) || 0;
  
  if (vm > 0 && vm <= s) {
    document.getElementById('stueck').value = s - vm;
    closeModal('teilverkaufModal');
    berechneTrading();
  }
}

function closeModal(id) {
  document.getElementById(id).classList.remove('active');
}

function openModal(id) {
  document.getElementById(id).classList.add('active');
}

function updateLastUpdated() {
  const now = new Date();
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const label = `${month}/${now.getFullYear()}`;
  document.querySelectorAll('[data-last-updated="true"]').forEach(el => {
    el.textContent = label;
  });
}

updateLastUpdated();

function zeigeBreakEvenInfo() {
  document.getElementById('breakEvenInfoModal').classList.add('active');
}

function zeigeCRVInfo() {
  document.getElementById('crvInfoModal').classList.add('active');
}

function zeigeEinzahlungenInfo() {
  document.getElementById('einzahlungenInfoModal').classList.add('active');
}

function zeigeReinerZinsInfo() {
  document.getElementById('reinerZinsInfoModal').classList.add('active');
}

function oeffneDatenschutz() {
  document.getElementById('datenschutzModal').classList.add('active');
}

function oeffneNutzungsbedingungen() {
  document.getElementById('nutzungsbedingungenModal').classList.add('active');
}

function oeffneImpressum() {
  document.getElementById('impressumModal').classList.add('active');
}

function oeffneFeedbackPortal() {
  showSection('feedback');
}

function sendeFeedback(event) {
  event.preventDefault();
  
  const name = document.getElementById('feedbackName').value || 'Anonym';
  const email = document.getElementById('feedbackEmail').value || 'Keine Angabe';
  const kategorie = document.getElementById('feedbackKategorie').value;
  const nachricht = document.getElementById('feedbackNachricht').value;
  
  // Feedback-Daten sammeln
  const feedbackData = {
    name: name,
    email: email,
    kategorie: kategorie,
    nachricht: nachricht,
    timestamp: new Date().toISOString(),
    userAgent: navigator.userAgent
  };
  
  // Feedback lokal speichern (alternativ könnte hier ein API-Call erfolgen)
  let alleFeedbacks = JSON.parse(localStorage.getItem('feedbacks') || '[]');
  alleFeedbacks.push(feedbackData);
  localStorage.setItem('feedbacks', JSON.stringify(alleFeedbacks));
  
  // Formular ausblenden und Erfolgsanzeige einblenden
  document.getElementById('feedbackForm').style.display = 'none';
  document.getElementById('feedbackSuccess').style.display = 'block';
  
  // Formular zurücksetzen
  document.getElementById('feedbackForm').reset();
  
  console.log('Feedback gesendet:', feedbackData);
}

function zurueckZuHome() {
  document.getElementById('feedbackForm').style.display = 'block';
  document.getElementById('feedbackSuccess').style.display = 'none';
  showSection('home');
}

function toggleHebelFunktion() {
  const hebelAktiv = document.getElementById('hebelToggle').checked;
  const hebelFeld = document.getElementById('hebelFeld');
  
  if (hebelAktiv) {
    hebelFeld.style.display = 'block';
  } else {
    hebelFeld.style.display = 'none';
    // Hebel auf 1 zurücksetzen wenn deaktiviert
    document.getElementById('hebel').value = 1;
  }
  
  // Speichere Zustand
  localStorage.setItem('hebelAktiv', hebelAktiv);
  berechneTrading();
}

function toggleBreakEven() {
  const breakEvenAktiv = document.getElementById('breakEvenToggle').checked;
  const breakEvenContainer = document.getElementById('breakEvenContainer');
  
  breakEvenContainer.style.display = breakEvenAktiv ? 'block' : 'none';
  
  // Container ausblenden wenn beide deaktiviert sind
  updateAnalyseWerteContainer();
  
  // Speichere Zustand
  localStorage.setItem('breakEvenAktiv', breakEvenAktiv);
}

function toggleCRV() {
  const crvAktiv = document.getElementById('crvToggle').checked;
  const crvContainer = document.getElementById('crvContainer');
  
  crvContainer.style.display = crvAktiv ? 'block' : 'none';
  
  // Container ausblenden wenn beide deaktiviert sind
  updateAnalyseWerteContainer();
  
  // Speichere Zustand
  localStorage.setItem('crvAktiv', crvAktiv);
}

function updateAnalyseWerteContainer() {
  const breakEvenAktiv = document.getElementById('breakEvenToggle').checked;
  const crvAktiv = document.getElementById('crvToggle').checked;
  const container = document.getElementById('analyseWerteContainer');
  
  // Container nur anzeigen wenn mindestens einer aktiv ist
  container.style.display = (breakEvenAktiv || crvAktiv) ? 'flex' : 'none';
}

function bindUpgradeButtons() {
  document.querySelectorAll('.upgrade-pro').forEach(btn => {
    const targetId = btn.getAttribute('data-upgrade-target') || '';
    btn.onclick = (event) => {
      event.preventDefault();
      upgradeToPro(targetId || undefined);
    };
  });
}

function upgradeToPro(targetId) {
  if (!isProLaunchLive()) {
    alert(getProLockedMessage());
    return;
  }

  // Simuliere Pro-Upgrade (in Produktion würde hier eine Zahlungsabwicklung erfolgen)
  const messages = {
    de: { confirm: 'Calculo Pro 3 Tage kostenlos testen?\n\n• Testphase: 3 Tage kostenlos\n• Keine Zahlung während der Testphase\n• Jederzeit kündbar\n\nℹ️ Nach 3 Tagen läuft das Abo automatisch, wenn du nicht kündigst.\n\nPreise nach der Testphase:\n• Monatlich: 1,99€/Monat\n• Jährlich: 18,99€/Jahr (2 Monate gratis)\n\n(Dies ist eine Demo - keine echte Zahlung)', success: 'Willkommen bei Calculo Pro! 🎉\n\nDeine 3-tägige kostenlose Testphase hat begonnen.\nAlle Premium-Features sind jetzt freigeschaltet.\n\nℹ️ Denk daran: Das Abo läuft nach 3 Tagen automatisch, wenn du nicht kündigst.' },
    en: { confirm: 'Try Calculo Pro free for 3 days?\n\n• Trial period: 3 days free\n• No payment during trial\n• Cancel anytime\n\nℹ️ After 3 days, subscription auto-renews if you don\'t cancel.\n\nPrices after trial:\n• Monthly: €1.99/month\n• Yearly: €18.99/year (2 months free)\n\n(This is a demo - no real payment)', success: 'Welcome to Calculo Pro! 🎉\n\nYour 3-day free trial has started.\nAll premium features are now unlocked.\n\nℹ️ Remember: Subscription auto-renews after 3 days if you don\'t cancel.' },
    es: { confirm: '¿Probar Calculo Pro gratis durante 3 días?\n\n• Período de prueba: 3 días gratis\n• Sin pago durante la prueba\n• Cancelar en cualquier momento\n\nℹ️ Después de 3 días, la suscripción se renueva automáticamente si no cancelas.\n\nPrecios después de la prueba:\n• Mensual: 1,99€/mes\n• Anual: 18,99€/año (2 meses gratis)\n\n(Esta es una demo - sin pago real)', success: '¡Bienvenido a Calculo Pro! 🎉\n\nTu prueba gratuita de 3 días ha comenzado.\nTodas las funciones premium están desbloqueadas.\n\nℹ️ Recuerda: La suscripción se renueva automáticamente después de 3 días si no cancelas.' },
    fr: { confirm: 'Essayer Calculo Pro gratuitement pendant 3 jours?\n\n• Période d\'essai: 3 jours gratuits\n• Aucun paiement pendant l\'essai\n• Annuler à tout moment\n\nℹ️ Après 3 jours, l\'abonnement se renouvelle automatiquement si vous n\'annulez pas.\n\nPrix après l\'essai:\n• Mensuel: 1,99€/mois\n• Annuel: 18,99€/an (2 mois gratuits)\n\n(Ceci est une démo - pas de paiement réel)', success: 'Bienvenue à Calculo Pro! 🎉\n\nVotre essai gratuit de 3 jours a commencé.\nToutes les fonctionnalités premium sont déverrouillées.\n\nℹ️ Rappel: L\'abonnement se renouvelle automatiquement après 3 jours si vous n\'annulez pas.' }
  };
  
  const lang = aktuelleSprache || 'de';
  const msg = messages[lang] || messages['de'];
  
  const confirmed = confirm(msg.confirm);
  
  if (confirmed) {
    localStorage.setItem('isPro', 'true');
    updateProStatus();
    alert(msg.success);
    
    // Aktualisiere alle Bereiche sofort
    berechneSpar(); // Aktualisiere Sparrechner
    
    // Zeige ETF Pro View falls auf ETF-Seite
    if (document.getElementById('etf').classList.contains('active')) {
      document.getElementById('etfFreeView').style.display = 'none';
      document.getElementById('etfProView').style.display = 'block';
    }
    
    // Navigiere zu Home-Seite
    setTimeout(function() {
      window.showSection('home');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }, 500);
  }
}

function cancelPro() {
  const messages = {
    de: { confirm: 'Möchtest du Calculo Pro wirklich kündigen?\n\nDu verlierst Zugriff auf:\n• Realwert-Berechnung mit Inflation\n• Steuer-Details\n• ETF-Vergleichsdatenbank\n• Erweiterte Features\n• Alle Pro-Inhalte werden sofort unzugänglich', success: 'Calculo Pro wurde gekündigt.\n\nAlle Pro-Features sind jetzt nicht mehr zugänglich.' },
    en: { confirm: 'Do you really want to cancel Calculo Pro?\n\nYou will lose access to:\n• Real value calculation with inflation\n• Tax details\n• ETF comparison database\n• Advanced features\n• All pro content will be immediately inaccessible', success: 'Calculo Pro has been cancelled.\n\nAll pro features are now no longer accessible.' },
    es: { confirm: '¿Realmente deseas cancelar Calculo Pro?\n\nPerderás acceso a:\n• Cálculo de valor real con inflación\n• Detalles fiscales\n• Base de datos de comparación ETF\n• Funciones avanzadas\n• Todo el contenido pro será inaccesible de inmediato', success: 'Calculo Pro ha sido cancelado.\n\nTodas las funciones pro ya no están accesibles.' },
    fr: { confirm: 'Voulez-vous vraiment annuler Calculo Pro?\n\nVous perdrez l\'accès à :\n• Calcul de valeur réelle avec inflation\n• Détails fiscaux\n• Base de données de comparaison ETF\n• Fonctionnalités avancées\n• Tout le contenu pro sera immédiatement inaccessible', success: 'Calculo Pro a été annulé.\n\nToutes les fonctionnalités pro ne sont plus accessibles.' }
  };
  
  const lang = aktuelleSprache || 'de';
  const msg = messages[lang] || messages['de'];
  
  const confirmed = confirm(msg.confirm);
  
  if (confirmed) {
    localStorage.setItem('isPro', 'false');
    
    // Verstecke ALLE Pro-Features sofort
    versteckeAlleProFeatures();
    
    // Aktualisiere Pro-Status in der UI
    updateProStatus();
    
    // Aktualisiere alle Bereiche sofort
    berechneSpar(); // Aktualisiere Sparrechner
    
    // Zeige ETF Free View falls auf ETF-Seite
    if (document.getElementById('etf').classList.contains('active')) {
      document.getElementById('etfFreeView').style.display = 'block';
      document.getElementById('etfProView').style.display = 'none';
    }
    
    alert(msg.success);
  }
}

function versteckeAlleProFeatures() {
  // Verstecke Sparrechner Pro-Features
  const sparProFeatures = document.getElementById('sparProFeatures');
  if (sparProFeatures) {
    sparProFeatures.style.display = 'none';
  }
  
  const sparProTeaser = document.getElementById('sparProTeaser');
  if (sparProTeaser) {
    sparProTeaser.style.display = 'block';
  }
  
  // Verstecke ETF Pro View
  const etfProView = document.getElementById('etfProView');
  if (etfProView) {
    etfProView.style.display = 'none';
  }
  
  const etfFreeView = document.getElementById('etfFreeView');
  if (etfFreeView) {
    etfFreeView.style.display = 'block';
  }
  
  // Setze Ansicht zurück auf Brutto (statt Netto)
  zeigeSparNetto = false;
  
  // Entferne alle Pro-spezifischen Daten aus der Anzeige
  const sparRealwert = document.getElementById('sparRealwert');
  if (sparRealwert) {
    sparRealwert.textContent = '--- ' + getWaehrungsSymbol();
  }
  
  const sparSteuern = document.getElementById('sparSteuern');
  if (sparSteuern) {
    sparSteuern.textContent = '--- ' + getWaehrungsSymbol();
  }
}

function updateProStatus() {
  const storedIsPro = localStorage.getItem('isPro') === 'true';
  const isPro = isProLaunchLive() && storedIsPro;
  if (!isProLaunchLive() && storedIsPro) {
    localStorage.setItem('isPro', 'false');
  }
  
  if (isPro) {
    document.getElementById('proAccountFree').style.display = 'none';
    document.getElementById('proAccountActive').style.display = 'block';
    // ETF Pro View anzeigen
    document.getElementById('etfFreeView').style.display = 'none';
    document.getElementById('etfProView').style.display = 'block';
  } else {
    document.getElementById('proAccountFree').style.display = 'block';
    document.getElementById('proAccountActive').style.display = 'none';
    // ETF Free View anzeigen
    document.getElementById('etfFreeView').style.display = 'block';
    document.getElementById('etfProView').style.display = 'none';
  }

  applyPrelaunchProUI();
}

function setTheme(theme) {
  document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  
  // Setze data-theme Attribut am root Element
  document.documentElement.setAttribute('data-theme', theme);
  
  // Speichere Auswahl in localStorage
  localStorage.setItem('theme', theme);
}

// Theme beim Laden der Seite wiederherstellen
function loadTheme() {
  const savedTheme = localStorage.getItem('theme') || 'dark';
  document.documentElement.setAttribute('data-theme', savedTheme);
  
  // Aktiviere den entsprechenden Button
  document.querySelectorAll('.theme-btn').forEach(btn => {
    btn.classList.remove('active');
    if ((savedTheme === 'system' && btn.textContent === 'System') ||
        (savedTheme === 'light' && btn.textContent === 'Hell') ||
        (savedTheme === 'dark' && btn.textContent === 'Dunkel')) {
      btn.classList.add('active');
    }
  });
}

// Update previews on input
document.addEventListener('DOMContentLoaded', function() {
  const nachkaufKurs = document.getElementById('nachkaufKurs');
  const nachkaufMenge = document.getElementById('nachkaufMenge');
  const verkaufMenge = document.getElementById('verkaufMenge');
  const verkaufPreis = document.getElementById('verkaufPreis');
  
  if (nachkaufKurs) nachkaufKurs.addEventListener('input', updateNachkaufPreview);
  if (nachkaufMenge) nachkaufMenge.addEventListener('input', updateNachkaufPreview);
  if (verkaufMenge) verkaufMenge.addEventListener('input', updateTeilverkaufPreview);
  if (verkaufPreis) verkaufPreis.addEventListener('input', updateTeilverkaufPreview);
  
  // Sprache beim Laden wiederherstellen
  const gespeicherteSprache = localStorage.getItem('sprache');
  if (gespeicherteSprache) {
    aktuelleSprache = gespeicherteSprache;
    aktualisiereSprachAnzeige();
  } else {
    // Initial auch übersetzen
    aktualisiereSprachAnzeige();
  }
  
  // Hebel-Funktion beim Laden wiederherstellen
  const hebelAktiv = localStorage.getItem('hebelAktiv') === 'true';
  document.getElementById('hebelToggle').checked = hebelAktiv;
  if (hebelAktiv) {
    document.getElementById('hebelFeld').style.display = 'block';
  }
  
  // Break-Even und CRV Einstellungen beim Laden wiederherstellen
  const breakEvenAktiv = localStorage.getItem('breakEvenAktiv') === 'true';
  const crvAktiv = localStorage.getItem('crvAktiv') === 'true';
  
  document.getElementById('breakEvenToggle').checked = breakEvenAktiv;
  document.getElementById('crvToggle').checked = crvAktiv;
  
  if (breakEvenAktiv) {
    document.getElementById('breakEvenContainer').style.display = 'block';
  }
  if (crvAktiv) {
    document.getElementById('crvContainer').style.display = 'block';
  }
  
  updateAnalyseWerteContainer();
  
  // Pro-Status laden
  startLaunchCountdownBanner();
  updateProStatus();
  bindUpgradeButtons();
  
  // Prognose-Parameter laden
  ladePrognoseParameter();
  
  // Range Slider initialisieren
  updateRangeSlider('hebel');
  updateRangeSlider('zeit');
  
  // ETF Datenbank initialisieren
  initETFDatenbank();
});

// Button-basierte Sortierung
function setzeRichtung(richtung) {
  document.getElementById('etfSortRichtung').value = richtung;
  
  // Button-Styling aktualisieren
  const btnAsc = document.getElementById('btnAsc');
  const btnDesc = document.getElementById('btnDesc');
  
  if (richtung === 'asc') {
    btnAsc.style.background = 'linear-gradient(90deg,var(--blue),#60a5fa)';
    btnAsc.style.color = '#fff';
    btnAsc.style.border = 'none';
    btnAsc.style.boxShadow = '0 2px 8px rgba(59,130,246,0.3)';
    
    btnDesc.style.background = 'rgba(255,255,255,0.05)';
    btnDesc.style.color = 'var(--text)';
    btnDesc.style.border = '1px solid rgba(255,255,255,0.2)';
    btnDesc.style.boxShadow = 'none';
  } else {
    btnDesc.style.background = 'linear-gradient(90deg,var(--blue),#60a5fa)';
    btnDesc.style.color = '#fff';
    btnDesc.style.border = 'none';
    btnDesc.style.boxShadow = '0 2px 8px rgba(59,130,246,0.3)';
    
    btnAsc.style.background = 'rgba(255,255,255,0.05)';
    btnAsc.style.color = 'var(--text)';
    btnAsc.style.border = '1px solid rgba(255,255,255,0.2)';
    btnAsc.style.boxShadow = 'none';
  }
  
  sortETFs();
}

function setzeKriterium(kriterium) {
  document.getElementById('etfSortKriterium').value = kriterium;
  
  // Alle Kriterium-Buttons zurücksetzen
  const buttons = ['btnKritName', 'btnKrit1J', 'btnKrit3J', 'btnKrit5J', 'btnKrit10J', 'btnKritTER'];
  buttons.forEach(btnId => {
    const btn = document.getElementById(btnId);
    btn.style.background = 'rgba(255,255,255,0.05)';
    btn.style.color = 'var(--text)';
    btn.style.border = '1px solid rgba(255,255,255,0.2)';
    btn.style.boxShadow = 'none';
  });
  
  // Aktiven Button hervorheben
  const activeBtn = {
    'name': 'btnKritName',
    'rendite1j': 'btnKrit1J',
    'rendite3j': 'btnKrit3J',
    'rendite5j': 'btnKrit5J',
    'rendite10j': 'btnKrit10J',
    'ter': 'btnKritTER'
  }[kriterium];
  
  if (activeBtn) {
    const btn = document.getElementById(activeBtn);
    btn.style.background = 'linear-gradient(90deg,var(--accent),#34d399)';
    btn.style.color = '#072017';
    btn.style.border = 'none';
    btn.style.boxShadow = '0 2px 8px rgba(16,185,129,0.3)';
  }
}

function zeigeVergleichshinweis() {
  const anzahl = ausgewaehlteETFs.length;
  if (anzahl === 0) {
    const msgs = {
      de: 'Bitte wähle 1-2 ETFs aus der Liste aus, um sie zu vergleichen.',
      en: 'Please select 1-2 ETFs from the list to compare.',
      es: 'Por favor, selecciona 1-2 ETFs de la lista para compararlos.',
      fr: 'Veuillez sélectionner 1-2 ETF de la liste pour les comparer.'
    };
    alert(msgs[aktuelleSprache] || msgs.de);
  } else if (anzahl === 1) {
    const msgs = {
      de: 'Du hast 1 ETF ausgewählt. Wähle einen zweiten ETF aus, um einen detaillierten Vergleich zu sehen.',
      en: 'You have selected 1 ETF. Select a second ETF to see a detailed comparison.',
      es: 'Has seleccionado 1 ETF. Selecciona un segundo ETF para ver una comparación detallada.',
      fr: 'Vous avez sélectionné 1 ETF. Sélectionnez un deuxième ETF pour voir une comparaison détaillée.'
    };
    alert(msgs[aktuelleSprache] || msgs.de);
  } else {
    // Scrolle zum Diagramm
    document.getElementById('etfChartContainer').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}

function zeigeTERInfo() {
  document.getElementById('terInfoModal').classList.add('active');
}

// ETF Datenbank
let etfChart = null;
let ausgewaehlteETFs = [];
let etfDaten = [
  { name: 'MSCI World', isin: 'IE00B4L5Y983', beschreibung: 'Weltweite Aktien aus Industrieländern', rendite: 8.5, rendite1J: 12.3, rendite3J: 9.8, rendite5J: 8.9, rendite10J: 8.5, ter: 0.20, kategorie: 'Global' },
  { name: 'S&P 500', isin: 'IE00B5BMR087', beschreibung: '500 größte US-Unternehmen', rendite: 12.5, rendite1J: 18.5, rendite3J: 14.2, rendite5J: 13.1, rendite10J: 12.5, ter: 0.07, kategorie: 'USA' },
  { name: 'NASDAQ 100', isin: 'IE00B53SZB19', beschreibung: '100 größte Tech-Unternehmen', rendite: 15.8, rendite1J: 22.4, rendite3J: 18.6, rendite5J: 16.9, rendite10J: 15.8, ter: 0.33, kategorie: 'Technologie' },
  { name: 'FTSE All-World', isin: 'IE00B3RBWM25', beschreibung: 'Globale Diversifikation', rendite: 7.8, rendite1J: 11.2, rendite3J: 8.9, rendite5J: 8.2, rendite10J: 7.8, ter: 0.22, kategorie: 'Global' },
  { name: 'MSCI Emerging Markets', isin: 'IE00B4L5YC18', beschreibung: 'Schwellenländer weltweit', rendite: 4.2, rendite1J: 6.8, rendite3J: 5.1, rendite5J: 4.6, rendite10J: 4.2, ter: 0.18, kategorie: 'Emerging Markets' },
  { name: 'DAX', isin: 'DE0005933931', beschreibung: '40 größte deutsche Unternehmen', rendite: 6.3, rendite1J: 9.5, rendite3J: 7.2, rendite5J: 6.8, rendite10J: 6.3, ter: 0.15, kategorie: 'Deutschland' },
  { name: 'Euro Stoxx 50', isin: 'IE00B4L5YX21', beschreibung: '50 größte europäische Unternehmen', rendite: 5.9, rendite1J: 8.7, rendite3J: 6.8, rendite5J: 6.3, rendite10J: 5.9, ter: 0.09, kategorie: 'Europa' },
  { name: 'MSCI Japan', isin: 'IE00B53QDK08', beschreibung: 'Japanische Aktien', rendite: 5.1, rendite1J: 7.8, rendite3J: 6.2, rendite5J: 5.6, rendite10J: 5.1, ter: 0.12, kategorie: 'Asien' },
  { name: 'FTSE 100', isin: 'IE00B53HP851', beschreibung: 'Größte britische Unternehmen', rendite: 4.8, rendite1J: 7.2, rendite3J: 5.8, rendite5J: 5.2, rendite10J: 4.8, ter: 0.07, kategorie: 'UK' },
  { name: 'Dividenden Aristocrats', isin: 'IE00B6YX5D40', beschreibung: 'Dividendenstarke Unternehmen', rendite: 7.2, rendite1J: 10.5, rendite3J: 8.4, rendite5J: 7.8, rendite10J: 7.2, ter: 0.35, kategorie: 'Dividende' },
  { name: 'Global Clean Energy', isin: 'IE00B1XNHC34', beschreibung: 'Erneuerbare Energien weltweit', rendite: 9.3, rendite1J: 15.8, rendite3J: 12.4, rendite5J: 10.6, rendite10J: 9.3, ter: 0.65, kategorie: 'Nachhaltigkeit' },
  { name: 'MSCI World Small Cap', isin: 'IE00BF4RFH31', beschreibung: 'Kleine Unternehmen weltweit', rendite: 9.7, rendite1J: 14.2, rendite3J: 11.5, rendite5J: 10.4, rendite10J: 9.7, ter: 0.35, kategorie: 'Small Cap' },
  { name: 'Gold', isin: 'IE00B579F325', beschreibung: 'Physisches Gold', rendite: 3.8, rendite1J: 5.2, rendite3J: 4.6, rendite5J: 4.1, rendite10J: 3.8, ter: 0.25, kategorie: 'Rohstoffe' },
  { name: 'Global Real Estate', isin: 'IE00B5BTY828', beschreibung: 'Immobilien weltweit', rendite: 6.1, rendite1J: 8.9, rendite3J: 7.2, rendite5J: 6.6, rendite10J: 6.1, ter: 0.40, kategorie: 'Immobilien' },
  { name: 'Corporate Bonds', isin: 'IE00BZ163M45', beschreibung: 'Unternehmensanleihen', rendite: 3.2, rendite1J: 4.5, rendite3J: 3.8, rendite5J: 3.4, rendite10J: 3.2, ter: 0.20, kategorie: 'Anleihen' },
  { name: 'MSCI China', isin: 'IE00BJ5JPG56', beschreibung: 'Chinesische Aktien', rendite: 3.5, rendite1J: 5.8, rendite3J: 4.2, rendite5J: 3.9, rendite10J: 3.5, ter: 0.40, kategorie: 'Asien' },
  { name: 'MSCI India', isin: 'IE00BZCQB185', beschreibung: 'Indische Aktien', rendite: 11.2, rendite1J: 16.8, rendite3J: 13.5, rendite5J: 12.1, rendite10J: 11.2, ter: 0.60, kategorie: 'Asien' },
  { name: 'Russell 2000', isin: 'IE00B60SX394', beschreibung: 'US Small Cap Aktien', rendite: 8.9, rendite1J: 13.5, rendite3J: 10.8, rendite5J: 9.6, rendite10J: 8.9, ter: 0.25, kategorie: 'USA' },
  { name: 'MSCI Europe', isin: 'IE00B1YZSC51', beschreibung: 'Europäische Aktien', rendite: 6.8, rendite1J: 10.2, rendite3J: 8.1, rendite5J: 7.3, rendite10J: 6.8, ter: 0.12, kategorie: 'Europa' },
  { name: 'STOXX Europe 600', isin: 'LU0328476410', beschreibung: '600 größte europäische Unternehmen', rendite: 7.1, rendite1J: 10.8, rendite3J: 8.5, rendite5J: 7.6, rendite10J: 7.1, ter: 0.18, kategorie: 'Europa' },
  { name: 'Dow Jones Industrial', isin: 'IE00B53L4350', beschreibung: '30 große US-Unternehmen', rendite: 10.2, rendite1J: 15.3, rendite3J: 12.1, rendite5J: 11.0, rendite10J: 10.2, ter: 0.34, kategorie: 'USA' },
  { name: 'MSCI Asia Pacific', isin: 'IE00B14X4M10', beschreibung: 'Asien-Pazifik Region', rendite: 6.5, rendite1J: 9.8, rendite3J: 7.7, rendite5J: 7.0, rendite10J: 6.5, ter: 0.15, kategorie: 'Asien' },
  { name: 'MSCI Canada', isin: 'IE00BF4G6Y48', beschreibung: 'Kanadische Aktien', rendite: 5.7, rendite1J: 8.5, rendite3J: 6.8, rendite5J: 6.1, rendite10J: 5.7, ter: 0.25, kategorie: 'Nordamerika' },
  { name: 'MSCI Australia', isin: 'IE00B5377D42', beschreibung: 'Australische Aktien', rendite: 4.9, rendite1J: 7.4, rendite3J: 5.9, rendite5J: 5.3, rendite10J: 4.9, ter: 0.23, kategorie: 'Asien' },
  { name: 'MSCI Brazil', isin: 'IE00B0M63953', beschreibung: 'Brasilianische Aktien', rendite: 2.8, rendite1J: 4.5, rendite3J: 3.4, rendite5J: 3.0, rendite10J: 2.8, ter: 0.55, kategorie: 'Emerging Markets' },
  { name: 'MSCI South Korea', isin: 'IE00B0M63730', beschreibung: 'Südkoreanische Aktien', rendite: 5.4, rendite1J: 8.2, rendite3J: 6.5, rendite5J: 5.8, rendite10J: 5.4, ter: 0.40, kategorie: 'Asien' },
  { name: 'MDAX', isin: 'DE0005933923', beschreibung: 'Mittelgroße deutsche Unternehmen', rendite: 7.8, rendite1J: 11.5, rendite3J: 9.2, rendite5J: 8.4, rendite10J: 7.8, ter: 0.20, kategorie: 'Deutschland' },
  { name: 'SDAX', isin: 'DE0005933949', beschreibung: 'Kleinere deutsche Unternehmen', rendite: 8.4, rendite1J: 12.8, rendite3J: 10.1, rendite5J: 9.0, rendite10J: 8.4, ter: 0.30, kategorie: 'Deutschland' },
  { name: 'Healthcare Innovation', isin: 'IE00BYZK4883', beschreibung: 'Gesundheit & Biotechnologie', rendite: 10.5, rendite1J: 16.2, rendite3J: 12.9, rendite5J: 11.4, rendite10J: 10.5, ter: 0.45, kategorie: 'Technologie' },
  { name: 'Artificial Intelligence', isin: 'IE00BMQ5SL74', beschreibung: 'KI & Maschinelles Lernen', rendite: 18.5, rendite1J: 28.5, rendite3J: 22.8, rendite5J: 20.3, rendite10J: 18.5, ter: 0.50, kategorie: 'Technologie' },
  { name: 'Cybersecurity', isin: 'IE00BYPLS672', beschreibung: 'IT-Sicherheit Unternehmen', rendite: 14.2, rendite1J: 21.5, rendite3J: 17.1, rendite5J: 15.4, rendite10J: 14.2, ter: 0.60, kategorie: 'Technologie' },
  { name: 'Water Resources', isin: 'IE00B23D8S39', beschreibung: 'Wasserwirtschaft & Infrastruktur', rendite: 8.1, rendite1J: 12.3, rendite3J: 9.8, rendite5J: 8.8, rendite10J: 8.1, ter: 0.60, kategorie: 'Nachhaltigkeit' },
  { name: 'ESG Leaders', isin: 'IE00BFNM3J75', beschreibung: 'Nachhaltige Unternehmensführung', rendite: 7.9, rendite1J: 11.8, rendite3J: 9.4, rendite5J: 8.5, rendite10J: 7.9, ter: 0.18, kategorie: 'Nachhaltigkeit' },
  { name: 'Silver', isin: 'IE00B4NCWG09', beschreibung: 'Physisches Silber', rendite: 4.2, rendite1J: 6.5, rendite3J: 5.1, rendite5J: 4.6, rendite10J: 4.2, ter: 0.49, kategorie: 'Rohstoffe' },
  { name: 'Crude Oil', isin: 'IE00B76BRJ76', beschreibung: 'Rohöl-Preisentwicklung', rendite: 5.5, rendite1J: 8.8, rendite3J: 6.9, rendite5J: 6.1, rendite10J: 5.5, ter: 0.40, kategorie: 'Rohstoffe' },
  { name: 'Commodity Producers', isin: 'IE00B6R51W83', beschreibung: 'Rohstoffproduzenten', rendite: 6.8, rendite1J: 10.5, rendite3J: 8.3, rendite5J: 7.4, rendite10J: 6.8, ter: 0.55, kategorie: 'Rohstoffe' },
  { name: 'High Yield Bonds', isin: 'IE00B66F4759', beschreibung: 'Hochverzinsliche Unternehmensanleihen', rendite: 4.8, rendite1J: 6.8, rendite3J: 5.6, rendite5J: 5.1, rendite10J: 4.8, ter: 0.50, kategorie: 'Anleihen' },
  { name: 'Government Bonds', isin: 'IE00B4WXJJ64', beschreibung: 'Staatsanleihen entwickelter Länder', rendite: 2.1, rendite1J: 3.2, rendite3J: 2.6, rendite5J: 2.3, rendite10J: 2.1, ter: 0.20, kategorie: 'Anleihen' },
  { name: 'Emerging Markets Bonds', isin: 'IE00BF4HY026', beschreibung: 'Schwellenländer-Anleihen', rendite: 4.5, rendite1J: 6.5, rendite3J: 5.3, rendite5J: 4.8, rendite10J: 4.5, ter: 0.45, kategorie: 'Anleihen' },
  { name: 'Infrastructure', isin: 'IE00BZ048462', beschreibung: 'Globale Infrastruktur-Projekte', rendite: 7.5, rendite1J: 11.2, rendite3J: 8.9, rendite5J: 8.1, rendite10J: 7.5, ter: 0.46, kategorie: 'Immobilien' },
  { name: 'MSCI World Quality', isin: 'IE00BP3QZ601', beschreibung: 'Qualitätsaktien weltweit', rendite: 9.2, rendite1J: 13.8, rendite3J: 10.9, rendite5J: 9.8, rendite10J: 9.2, ter: 0.30, kategorie: 'Global' },
  { name: 'MSCI World Momentum', isin: 'IE00BL25JL35', beschreibung: 'Momentum-Aktien weltweit', rendite: 10.5, rendite1J: 16.2, rendite3J: 12.8, rendite5J: 11.3, rendite10J: 10.5, ter: 0.30, kategorie: 'Global' },
  { name: 'MSCI World Value', isin: 'IE00BP3QZB59', beschreibung: 'Value-Aktien weltweit', rendite: 7.8, rendite1J: 11.5, rendite3J: 9.2, rendite5J: 8.4, rendite10J: 7.8, ter: 0.30, kategorie: 'Global' },
  { name: 'Global Semiconductors', isin: 'IE00BYXG2H39', beschreibung: 'Halbleiter-Industrie', rendite: 16.8, rendite1J: 25.5, rendite3J: 20.2, rendite5J: 18.1, rendite10J: 16.8, ter: 0.35, kategorie: 'Technologie' },
  { name: 'Cloud Computing', isin: 'IE00BKY55W78', beschreibung: 'Cloud-Technologie Unternehmen', rendite: 17.5, rendite1J: 26.8, rendite3J: 21.2, rendite5J: 19.0, rendite10J: 17.5, ter: 0.50, kategorie: 'Technologie' },
  { name: 'E-Commerce', isin: 'IE00BMW42900', beschreibung: 'Online-Handel & Logistik', rendite: 15.2, rendite1J: 22.8, rendite3J: 18.3, rendite5J: 16.4, rendite10J: 15.2, ter: 0.60, kategorie: 'Technologie' },
  { name: 'Robotics & Automation', isin: 'IE00BYZK4552', beschreibung: 'Robotik & Automatisierung', rendite: 13.5, rendite1J: 20.5, rendite3J: 16.3, rendite5J: 14.6, rendite10J: 13.5, ter: 0.40, kategorie: 'Technologie' },
  { name: 'Blockchain', isin: 'IE00BGBN6P67', beschreibung: 'Blockchain-Technologie', rendite: 19.5, rendite1J: 32.5, rendite3J: 24.8, rendite5J: 21.8, rendite10J: 19.5, ter: 0.65, kategorie: 'Technologie' },
  { name: 'FinTech', isin: 'IE00BKY55T58', beschreibung: 'Finanztechnologie', rendite: 14.8, rendite1J: 22.2, rendite3J: 17.8, rendite5J: 16.0, rendite10J: 14.8, ter: 0.65, kategorie: 'Technologie' },
  { name: 'Electric Vehicles', isin: 'IE00BLRPRG98', beschreibung: 'Elektromobilität & Batterien', rendite: 12.8, rendite1J: 19.5, rendite3J: 15.5, rendite5J: 13.9, rendite10J: 12.8, ter: 0.75, kategorie: 'Nachhaltigkeit' },
  { name: 'Solar Energy', isin: 'IE00B4BNMY34', beschreibung: 'Solarenergie-Unternehmen', rendite: 11.5, rendite1J: 17.8, rendite3J: 14.2, rendite5J: 12.6, rendite10J: 11.5, ter: 0.69, kategorie: 'Nachhaltigkeit' },
  { name: 'Wind Energy', isin: 'IE00B4WPH590', beschreibung: 'Windkraft-Technologie', rendite: 10.2, rendite1J: 15.8, rendite3J: 12.6, rendite5J: 11.2, rendite10J: 10.2, ter: 0.65, kategorie: 'Nachhaltigkeit' },
  { name: 'Hydrogen Economy', isin: 'IE000S77TP10', beschreibung: 'Wasserstoff-Technologie', rendite: 13.8, rendite1J: 21.5, rendite3J: 16.9, rendite5J: 15.0, rendite10J: 13.8, ter: 0.75, kategorie: 'Nachhaltigkeit' },
  { name: 'Sustainable Agriculture', isin: 'IE00BNG8L278', beschreibung: 'Nachhaltige Landwirtschaft', rendite: 9.5, rendite1J: 14.5, rendite3J: 11.5, rendite5J: 10.2, rendite10J: 9.5, ter: 0.50, kategorie: 'Nachhaltigkeit' },
  { name: 'Battery Technology', isin: 'IE00BF0M2Z96', beschreibung: 'Batterietechnologie & Speicher', rendite: 14.5, rendite1J: 22.0, rendite3J: 17.5, rendite5J: 15.7, rendite10J: 14.5, ter: 0.69, kategorie: 'Technologie' },
  { name: 'Smart Cities', isin: 'IE00BGV5VR99', beschreibung: 'Intelligente Städte & IoT', rendite: 11.8, rendite1J: 18.2, rendite3J: 14.5, rendite5J: 12.9, rendite10J: 11.8, ter: 0.49, kategorie: 'Technologie' },
  { name: 'Genomics', isin: 'IE00BMYDM794', beschreibung: 'Genforschung & Biotechnologie', rendite: 15.5, rendite1J: 23.8, rendite3J: 18.9, rendite5J: 16.9, rendite10J: 15.5, ter: 0.75, kategorie: 'Technologie' },
  { name: 'Space Exploration', isin: 'IE00BLH3CV30', beschreibung: 'Weltraumtechnologie', rendite: 16.2, rendite1J: 25.0, rendite3J: 19.8, rendite5J: 17.6, rendite10J: 16.2, ter: 0.75, kategorie: 'Technologie' },
  { name: 'Video Gaming', isin: 'IE00BKY55W98', beschreibung: 'Gaming & E-Sports', rendite: 12.5, rendite1J: 19.2, rendite3J: 15.3, rendite5J: 13.6, rendite10J: 12.5, ter: 0.50, kategorie: 'Technologie' },
  { name: 'Luxury Goods', isin: 'LU1215461085', beschreibung: 'Luxusgüter-Hersteller', rendite: 10.8, rendite1J: 16.5, rendite3J: 13.1, rendite5J: 11.7, rendite10J: 10.8, ter: 0.60, kategorie: 'Global' },
  { name: 'Defense & Security', isin: 'IE00BYXPXL17', beschreibung: 'Rüstung & Sicherheit', rendite: 9.8, rendite1J: 14.8, rendite3J: 11.8, rendite5J: 10.6, rendite10J: 9.8, ter: 0.35, kategorie: 'Global' },
  { name: 'Telecommunications', isin: 'IE00B0M62Y33', beschreibung: 'Telekommunikation weltweit', rendite: 5.5, rendite1J: 8.5, rendite3J: 6.8, rendite5J: 6.0, rendite10J: 5.5, ter: 0.40, kategorie: 'Global' },
  { name: 'Consumer Staples', isin: 'IE00B4L5ZD98', beschreibung: 'Basiskonsumgüter', rendite: 6.5, rendite1J: 9.8, rendite3J: 7.8, rendite5J: 7.0, rendite10J: 6.5, ter: 0.30, kategorie: 'Global' },
  { name: 'Utilities', isin: 'IE00B4JY5R22', beschreibung: 'Versorgungsunternehmen', rendite: 5.2, rendite1J: 7.8, rendite3J: 6.2, rendite5J: 5.6, rendite10J: 5.2, ter: 0.30, kategorie: 'Global' },
  { name: 'Global Banks', isin: 'IE00B53L3W79', beschreibung: 'Bankensektor weltweit', rendite: 6.8, rendite1J: 10.5, rendite3J: 8.3, rendite5J: 7.4, rendite10J: 6.8, ter: 0.40, kategorie: 'Global' },
  { name: 'Insurance', isin: 'IE00B5377D86', beschreibung: 'Versicherungen weltweit', rendite: 7.2, rendite1J: 10.8, rendite3J: 8.6, rendite5J: 7.8, rendite10J: 7.2, ter: 0.35, kategorie: 'Global' },
  { name: 'Materials', isin: 'IE00B4JS5R38', beschreibung: 'Rohstoff-Verarbeitung', rendite: 7.5, rendite1J: 11.5, rendite3J: 9.1, rendite5J: 8.2, rendite10J: 7.5, ter: 0.30, kategorie: 'Rohstoffe' },
  { name: 'Industrials', isin: 'IE00B4KBBD01', beschreibung: 'Industrieunternehmen weltweit', rendite: 8.2, rendite1J: 12.5, rendite3J: 9.9, rendite5J: 8.9, rendite10J: 8.2, ter: 0.30, kategorie: 'Global' },
  { name: 'Energy', isin: 'IE00B5KQNG97', beschreibung: 'Energiesektor weltweit', rendite: 6.2, rendite1J: 9.5, rendite3J: 7.5, rendite5J: 6.7, rendite10J: 6.2, ter: 0.40, kategorie: 'Rohstoffe' },
  { name: 'Metaverse', isin: 'IE00BLRPRL42', beschreibung: 'Metaverse & Virtual Reality', rendite: 14.2, rendite1J: 21.8, rendite3J: 17.4, rendite5J: 15.5, rendite10J: 14.2, ter: 0.75, kategorie: 'Technologie' },
  { name: 'Streaming & Media', isin: 'IE00BMW3QX54', beschreibung: 'Streaming-Dienste & Medien', rendite: 11.8, rendite1J: 18.5, rendite3J: 14.6, rendite5J: 12.9, rendite10J: 11.8, ter: 0.60, kategorie: 'Technologie' },
  { name: '5G Technology', isin: 'IE00BKXVTY24', beschreibung: '5G Netzwerk-Infrastruktur', rendite: 13.2, rendite1J: 20.2, rendite3J: 16.1, rendite5J: 14.3, rendite10J: 13.2, ter: 0.65, kategorie: 'Technologie' },
  { name: 'MSCI Taiwan', isin: 'IE00B0M63391', beschreibung: 'Taiwanesische Aktien', rendite: 8.5, rendite1J: 13.2, rendite3J: 10.5, rendite5J: 9.3, rendite10J: 8.5, ter: 0.35, kategorie: 'Asien' },
  { name: 'MSCI Mexico', isin: 'IE00B4ZJ4188', beschreibung: 'Mexikanische Aktien', rendite: 4.2, rendite1J: 6.8, rendite3J: 5.3, rendite5J: 4.7, rendite10J: 4.2, ter: 0.50, kategorie: 'Emerging Markets' },
  { name: 'MSCI Russia', isin: 'IE00B5V87390', beschreibung: 'Russische Aktien', rendite: 3.8, rendite1J: 6.2, rendite3J: 4.8, rendite5J: 4.2, rendite10J: 3.8, ter: 0.65, kategorie: 'Emerging Markets' },
  { name: 'MSCI Turkey', isin: 'IE00B1FZS574', beschreibung: 'Türkische Aktien', rendite: 5.2, rendite1J: 8.5, rendite3J: 6.6, rendite5J: 5.8, rendite10J: 5.2, ter: 0.65, kategorie: 'Emerging Markets' },
  { name: 'MSCI Indonesia', isin: 'IE00B1GVX668', beschreibung: 'Indonesische Aktien', rendite: 6.8, rendite1J: 10.5, rendite3J: 8.3, rendite5J: 7.4, rendite10J: 6.8, ter: 0.50, kategorie: 'Asien' },
  { name: 'MSCI Thailand', isin: 'IE00B1FZS236', beschreibung: 'Thailändische Aktien', rendite: 4.5, rendite1J: 7.2, rendite3J: 5.6, rendite5J: 5.0, rendite10J: 4.5, ter: 0.50, kategorie: 'Asien' },
  { name: 'MSCI Vietnam', isin: 'IE00BKM4H197', beschreibung: 'Vietnamesische Aktien', rendite: 7.8, rendite1J: 12.2, rendite3J: 9.7, rendite5J: 8.6, rendite10J: 7.8, ter: 0.70, kategorie: 'Asien' },
  { name: 'MSCI Malaysia', isin: 'IE00B3S8YN04', beschreibung: 'Malaysische Aktien', rendite: 3.5, rendite1J: 5.8, rendite3J: 4.5, rendite5J: 3.9, rendite10J: 3.5, ter: 0.50, kategorie: 'Asien' },
  { name: 'MSCI Singapore', isin: 'IE00B5V8B863', beschreibung: 'Singapurische Aktien', rendite: 5.8, rendite1J: 9.2, rendite3J: 7.2, rendite5J: 6.4, rendite10J: 5.8, ter: 0.40, kategorie: 'Asien' },
  { name: 'MSCI Philippines', isin: 'IE00B3Z2NW38', beschreibung: 'Philippinische Aktien', rendite: 4.8, rendite1J: 7.8, rendite3J: 6.1, rendite5J: 5.3, rendite10J: 4.8, ter: 0.50, kategorie: 'Asien' },
  { name: 'MSCI Hong Kong', isin: 'IE00B5M4WH52', beschreibung: 'Hong Kong Aktien', rendite: 4.2, rendite1J: 6.8, rendite3J: 5.3, rendite5J: 4.6, rendite10J: 4.2, ter: 0.35, kategorie: 'Asien' },
  { name: 'TecDAX', isin: 'DE0007203275', beschreibung: 'Deutsche Technologie-Werte', rendite: 9.8, rendite1J: 15.2, rendite3J: 12.1, rendite5J: 10.7, rendite10J: 9.8, ter: 0.40, kategorie: 'Deutschland' },
  { name: 'CAC 40', isin: 'FR0003500008', beschreibung: 'Französische Blue Chips', rendite: 6.5, rendite1J: 10.2, rendite3J: 8.0, rendite5J: 7.1, rendite10J: 6.5, ter: 0.25, kategorie: 'Europa' },
  { name: 'IBEX 35', isin: 'ES0SI0000005', beschreibung: 'Spanische Leitaktien', rendite: 5.2, rendite1J: 8.5, rendite3J: 6.6, rendite5J: 5.8, rendite10J: 5.2, ter: 0.30, kategorie: 'Europa' },
  { name: 'AEX', isin: 'NL0000000107', beschreibung: 'Niederländische Top-Unternehmen', rendite: 7.2, rendite1J: 11.2, rendite3J: 8.9, rendite5J: 7.9, rendite10J: 7.2, ter: 0.30, kategorie: 'Europa' },
  { name: 'BEL 20', isin: 'BE0389555039', beschreibung: 'Belgische Leitaktien', rendite: 5.5, rendite1J: 8.8, rendite3J: 6.9, rendite5J: 6.1, rendite10J: 5.5, ter: 0.35, kategorie: 'Europa' },
  { name: 'SMI', isin: 'CH0009980894', beschreibung: 'Schweizer Bluechips', rendite: 6.8, rendite1J: 10.5, rendite3J: 8.3, rendite5J: 7.4, rendite10J: 6.8, ter: 0.35, kategorie: 'Europa' },
  { name: 'OMX Stockholm 30', isin: 'SE0000337842', beschreibung: 'Schwedische Top-Aktien', rendite: 7.5, rendite1J: 11.8, rendite3J: 9.3, rendite5J: 8.2, rendite10J: 7.5, ter: 0.30, kategorie: 'Europa' },
  { name: 'FTSE MIB', isin: 'IT0003465736', beschreibung: 'Italienische Leitaktien', rendite: 5.8, rendite1J: 9.2, rendite3J: 7.2, rendite5J: 6.4, rendite10J: 5.8, ter: 0.35, kategorie: 'Europa' },
  { name: 'WIG20', isin: 'PL9999999375', beschreibung: 'Polnische Top-Unternehmen', rendite: 6.2, rendite1J: 9.8, rendite3J: 7.7, rendite5J: 6.8, rendite10J: 6.2, ter: 0.40, kategorie: 'Europa' },
  { name: 'MSCI South Africa', isin: 'IE00B5BFJG71', beschreibung: 'Südafrikanische Aktien', rendite: 4.5, rendite1J: 7.2, rendite3J: 5.6, rendite5J: 4.9, rendite10J: 4.5, ter: 0.55, kategorie: 'Emerging Markets' },
  { name: 'MSCI Israel', isin: 'IE00B4XY4K04', beschreibung: 'Israelische Aktien', rendite: 8.2, rendite1J: 12.8, rendite3J: 10.2, rendite5J: 9.0, rendite10J: 8.2, ter: 0.45, kategorie: 'Global' },
  { name: 'REITs Global', isin: 'IE00B1FZS467', beschreibung: 'Immobilien-Investmentfonds weltweit', rendite: 6.8, rendite1J: 10.5, rendite3J: 8.3, rendite5J: 7.4, rendite10J: 6.8, ter: 0.40, kategorie: 'Immobilien' },
  { name: 'US REITs', isin: 'IE00B1FZS350', beschreibung: 'US-Immobilienfonds', rendite: 7.5, rendite1J: 11.5, rendite3J: 9.1, rendite5J: 8.1, rendite10J: 7.5, ter: 0.40, kategorie: 'Immobilien' },
  { name: 'Europe REITs', isin: 'IE00B1FZS244', beschreibung: 'Europäische Immobilienfonds', rendite: 5.8, rendite1J: 9.2, rendite3J: 7.2, rendite5J: 6.4, rendite10J: 5.8, ter: 0.40, kategorie: 'Immobilien' },
  { name: 'Asia REITs', isin: 'IE00B1FZS137', beschreibung: 'Asiatische Immobilienfonds', rendite: 5.2, rendite1J: 8.2, rendite3J: 6.5, rendite5J: 5.7, rendite10J: 5.2, ter: 0.45, kategorie: 'Immobilien' },
  { name: 'Quantum Computing', isin: 'IE00BMFNWC33', beschreibung: 'Quantencomputer-Technologie', rendite: 18.2, rendite1J: 28.8, rendite3J: 22.5, rendite5J: 19.9, rendite10J: 18.2, ter: 0.75, kategorie: 'Technologie' },
  { name: 'Digital Payments', isin: 'IE00BL6K5J42', beschreibung: 'Digitale Zahlungsdienste', rendite: 13.8, rendite1J: 21.2, rendite3J: 16.9, rendite5J: 15.0, rendite10J: 13.8, ter: 0.65, kategorie: 'Technologie' },
  { name: 'Precision Medicine', isin: 'IE00BMFNWH88', beschreibung: 'Personalisierte Medizin', rendite: 14.5, rendite1J: 22.5, rendite3J: 17.9, rendite5J: 15.9, rendite10J: 14.5, ter: 0.75, kategorie: 'Technologie' },
  { name: 'Smart Manufacturing', isin: 'IE00BMDXM866', beschreibung: 'Industrie 4.0', rendite: 11.2, rendite1J: 17.5, rendite3J: 13.9, rendite5J: 12.3, rendite10J: 11.2, ter: 0.60, kategorie: 'Technologie' },
  { name: 'Circular Economy', isin: 'IE00BLRB0242', beschreibung: 'Kreislaufwirtschaft', rendite: 9.8, rendite1J: 15.2, rendite3J: 12.1, rendite5J: 10.7, rendite10J: 9.8, ter: 0.60, kategorie: 'Nachhaltigkeit' },
  { name: 'Ocean Economy', isin: 'IE00BF0MBG18', beschreibung: 'Meereswirtschaft & Aquakultur', rendite: 8.5, rendite1J: 13.2, rendite3J: 10.5, rendite5J: 9.3, rendite10J: 8.5, ter: 0.65, kategorie: 'Nachhaltigkeit' },
  { name: 'Timber & Forestry', isin: 'IE00BKM4GZ66', beschreibung: 'Forstwirtschaft & Holzproduktion', rendite: 6.5, rendite1J: 10.2, rendite3J: 8.1, rendite5J: 7.1, rendite10J: 6.5, ter: 0.55, kategorie: 'Rohstoffe' },
  { name: 'Platinum & Palladium', isin: 'IE00B4ND3602', beschreibung: 'Edelmetalle (Platin/Palladium)', rendite: 4.8, rendite1J: 7.8, rendite3J: 6.1, rendite5J: 5.3, rendite10J: 4.8, ter: 0.49, kategorie: 'Rohstoffe' },
  { name: 'Agricultural Commodities', isin: 'IE00B6R52143', beschreibung: 'Agrarrohstoffe', rendite: 5.5, rendite1J: 8.8, rendite3J: 6.9, rendite5J: 6.1, rendite10J: 5.5, ter: 0.55, kategorie: 'Rohstoffe' },
  { name: 'Uranium & Nuclear', isin: 'IE00BLRPRL28', beschreibung: 'Uran & Kernenergie', rendite: 11.8, rendite1J: 18.5, rendite3J: 14.6, rendite5J: 12.9, rendite10J: 11.8, ter: 0.75, kategorie: 'Rohstoffe' },
  { name: 'Lithium & Rare Earths', isin: 'IE00BLRPRK11', beschreibung: 'Lithium & Seltene Erden', rendite: 13.5, rendite1J: 21.2, rendite3J: 16.8, rendite5J: 14.8, rendite10J: 13.5, ter: 0.69, kategorie: 'Rohstoffe' },
  { name: 'Natural Gas', isin: 'IE00B6R52036', beschreibung: 'Erdgas-Produktion', rendite: 6.8, rendite1J: 10.8, rendite3J: 8.5, rendite5J: 7.5, rendite10J: 6.8, ter: 0.45, kategorie: 'Rohstoffe' },
  { name: 'Copper Mining', isin: 'IE00BMDXM759', beschreibung: 'Kupferbergbau', rendite: 7.2, rendite1J: 11.2, rendite3J: 8.9, rendite5J: 7.9, rendite10J: 7.2, ter: 0.55, kategorie: 'Rohstoffe' },
  { name: 'Global Convertible Bonds', isin: 'IE00B8JYLC77', beschreibung: 'Wandelanleihen weltweit', rendite: 4.2, rendite1J: 6.5, rendite3J: 5.1, rendite5J: 4.6, rendite10J: 4.2, ter: 0.40, kategorie: 'Anleihen' },
  { name: 'Inflation-Linked Bonds', isin: 'IE00B0M62S72', beschreibung: 'Inflationsgeschützte Anleihen', rendite: 2.8, rendite1J: 4.2, rendite3J: 3.4, rendite5J: 3.0, rendite10J: 2.8, ter: 0.25, kategorie: 'Anleihen' },
  { name: 'Green Bonds', isin: 'IE00BKM4H932', beschreibung: 'Nachhaltige Anleihen', rendite: 3.5, rendite1J: 5.2, rendite3J: 4.2, rendite5J: 3.8, rendite10J: 3.5, ter: 0.30, kategorie: 'Anleihen' },
  { name: 'Global Multi-Asset', isin: 'IE00B4PY7Y77', beschreibung: 'Diversifizierte Multi-Asset-Strategie', rendite: 5.8, rendite1J: 8.8, rendite3J: 7.0, rendite5J: 6.3, rendite10J: 5.8, ter: 0.60, kategorie: 'Global' },
  { name: 'Global Minimum Volatility', isin: 'IE00B3RBWM41', beschreibung: 'Risikoarme Aktien weltweit', rendite: 6.5, rendite1J: 9.8, rendite3J: 7.8, rendite5J: 7.0, rendite10J: 6.5, ter: 0.30, kategorie: 'Global' },
  { name: 'Global Dividend', isin: 'IE00B9CQXS71', beschreibung: 'Dividendenstarke Aktien weltweit', rendite: 7.8, rendite1J: 11.5, rendite3J: 9.2, rendite5J: 8.4, rendite10J: 7.8, ter: 0.38, kategorie: 'Dividende' },
  { name: 'Asia Pacific Dividend', isin: 'IE00B9F5YL18', beschreibung: 'Asien-Pazifik Dividendenaktien', rendite: 6.2, rendite1J: 9.5, rendite3J: 7.5, rendite5J: 6.7, rendite10J: 6.2, ter: 0.50, kategorie: 'Dividende' }
];

let gefiltereETFs = [...etfDaten];

function translateETFCategory(category) {
  if (aktuelleSprache === 'es') {
    const map = {
      'Global': 'Global',
      'USA': 'EE. UU.',
      'Technologie': 'Tecnología',
      'Europa': 'Europa',
      'Asien': 'Asia',
      'Deutschland': 'Alemania',
      'Emerging Markets': 'Mercados emergentes',
      'Dividende': 'Dividendos',
      'Nachhaltigkeit': 'Sostenibilidad',
      'Small Cap': 'Small Cap',
      'Rohstoffe': 'Materias primas',
      'Immobilien': 'Inmobiliario',
      'Anleihen': 'Bonos',
      'Nordamerika': 'Norteamérica',
      'UK': 'Reino Unido'
    };
    return map[category] || category;
  }
  if (aktuelleSprache === 'fr') {
    const map = {
      'Global': 'Global',
      'USA': 'États-Unis',
      'Technologie': 'Technologie',
      'Europa': 'Europe',
      'Asien': 'Asie',
      'Deutschland': 'Allemagne',
      'Emerging Markets': 'Marchés émergents',
      'Dividende': 'Dividendes',
      'Nachhaltigkeit': 'Durabilité',
      'Small Cap': 'Small Cap',
      'Rohstoffe': 'Matières premières',
      'Immobilien': 'Immobilier',
      'Anleihen': 'Obligations',
      'Nordamerika': 'Amérique du Nord',
      'UK': 'Royaume-Uni'
    };
    return map[category] || category;
  }
  if (aktuelleSprache === 'en') {
    const map = {
      'Global': 'Global',
      'USA': 'USA',
      'Technologie': 'Technology',
      'Europa': 'Europe',
      'Asien': 'Asia',
      'Deutschland': 'Germany',
      'Emerging Markets': 'Emerging Markets',
      'Dividende': 'Dividends',
      'Nachhaltigkeit': 'Sustainability',
      'Small Cap': 'Small Cap',
      'Rohstoffe': 'Commodities',
      'Immobilien': 'Real Estate',
      'Anleihen': 'Bonds',
      'Nordamerika': 'North America',
      'UK': 'UK'
    };
    return map[category] || category;
  }
  return category;
}

function translateETFDescription(description) {
  if (aktuelleSprache === 'es') {
    const map = {
      'Weltweite Aktien aus Industrieländern': 'Acciones globales de países desarrollados',
      '500 größte US-Unternehmen': '500 mayores empresas de EE. UU.',
      '100 größte Tech-Unternehmen': '100 mayores empresas tecnológicas',
      'Globale Diversifikation': 'Diversificación global',
      'Schwellenländer weltweit': 'Mercados emergentes a nivel mundial',
      '40 größte deutsche Unternehmen': '40 mayores empresas alemanas',
      '50 größte europäische Unternehmen': '50 mayores empresas europeas',
      'Japanische Aktien': 'Acciones japonesas',
      'Größte britische Unternehmen': 'Mayores empresas británicas',
      'Dividendenstarke Unternehmen': 'Empresas con alto dividendo',
      'Erneuerbare Energien weltweit': 'Energías renovables a nivel mundial',
      'Kleine Unternehmen weltweit': 'Pequeñas empresas a nivel mundial',
      'Physisches Gold': 'Oro físico',
      'Immobilien weltweit': 'Inmobiliario a nivel mundial',
      'Unternehmensanleihen': 'Bonos corporativos',
      'Chinesische Aktien': 'Acciones chinas',
      'Indische Aktien': 'Acciones indias',
      'US Small Cap Aktien': 'Acciones small cap de EE. UU.',
      'Europäische Aktien': 'Acciones europeas',
      '600 größte europäische Unternehmen': '600 mayores empresas europeas',
      '30 große US-Unternehmen': '30 grandes empresas de EE. UU.',
      'Asien-Pazifik Region': 'Región Asia-Pacífico',
      'Kanadische Aktien': 'Acciones canadienses',
      'Australische Aktien': 'Acciones australianas',
      'Brasilianische Aktien': 'Acciones brasileñas',
      'Südkoreanische Aktien': 'Acciones surcoreanas',
      'Mittelgroße deutsche Unternehmen': 'Empresas alemanas de mediana capitalización',
      'Kleinere deutsche Unternehmen': 'Empresas alemanas más pequeñas',
      'Gesundheit & Biotechnologie': 'Salud y biotecnología',
      'KI & Maschinelles Lernen': 'IA y aprendizaje automático',
      'IT-Sicherheit Unternehmen': 'Empresas de ciberseguridad',
      'Wasserwirtschaft & Infrastruktur': 'Gestión del agua e infraestructura',
      'Nachhaltige Unternehmensführung': 'Gestión empresarial sostenible',
      'Physisches Silber': 'Plata física',
      'Rohöl-Preisentwicklung': 'Evolución del precio del petróleo crudo',
      'Rohstoffproduzenten': 'Productores de materias primas',
      'Hochverzinsliche Unternehmensanleihen': 'Bonos corporativos de alto rendimiento',
      'Staatsanleihen entwickelter Länder': 'Bonos soberanos de países desarrollados',
      'Schwellenländer-Anleihen': 'Bonos de mercados emergentes',
      'Globale Infrastruktur-Projekte': 'Proyectos de infraestructura global',
      'Qualitätsaktien weltweit': 'Acciones de calidad a nivel mundial',
      'Momentum-Aktien weltweit': 'Acciones de momentum a nivel mundial',
      'Value-Aktien weltweit': 'Acciones de valor a nivel mundial',
      'Halbleiter-Industrie': 'Industria de semiconductores',
      'Cloud-Technologie Unternehmen': 'Empresas de tecnología cloud',
      'Online-Handel & Logistik': 'Comercio electrónico y logística',
      'Robotik & Automatisierung': 'Robótica y automatización',
      'Blockchain-Technologie': 'Tecnología blockchain',
      'Finanztechnologie': 'Tecnología financiera',
      'Elektromobilität & Batterien': 'Movilidad eléctrica y baterías',
      'Solarenergie-Unternehmen': 'Empresas de energía solar',
      'Windkraft-Technologie': 'Tecnología eólica',
      'Wasserstoff-Technologie': 'Tecnología del hidrógeno',
      'Nachhaltige Landwirtschaft': 'Agricultura sostenible',
      'Batterietechnologie & Speicher': 'Tecnología de baterías y almacenamiento',
      'Intelligente Städte & IoT': 'Ciudades inteligentes e IoT',
      'Genforschung & Biotechnologie': 'Genómica y biotecnología',
      'Weltraumtechnologie': 'Tecnología espacial',
      'Gaming & E-Sports': 'Gaming y eSports',
      'Luxusgüter-Hersteller': 'Fabricantes de artículos de lujo',
      'Rüstung & Sicherheit': 'Defensa y seguridad',
      'Telekommunikation weltweit': 'Telecomunicaciones a nivel mundial',
      'Basiskonsumgüter': 'Bienes de consumo básico',
      'Versorgungsunternehmen': 'Empresas de servicios públicos',
      'Bankensektor weltweit': 'Sector bancario a nivel mundial',
      'Versicherungen weltweit': 'Seguros a nivel mundial',
      'Rohstoff-Verarbeitung': 'Procesamiento de materias primas',
      'Industrieunternehmen weltweit': 'Empresas industriales a nivel mundial',
      'Energiesektor weltweit': 'Sector energético a nivel mundial',
      'Metaverse & Virtual Reality': 'Metaverso y realidad virtual',
      'Streaming-Dienste & Medien': 'Servicios de streaming y medios',
      '5G Netzwerk-Infrastruktur': 'Infraestructura de red 5G',
      'Taiwanesische Aktien': 'Acciones taiwanesas',
      'Mexikanische Aktien': 'Acciones mexicanas',
      'Russische Aktien': 'Acciones rusas',
      'Türkische Aktien': 'Acciones turcas',
      'Indonesische Aktien': 'Acciones indonesias',
      'Thailändische Aktien': 'Acciones tailandesas',
      'Vietnamesische Aktien': 'Acciones vietnamitas',
      'Malaysische Aktien': 'Acciones malasias',
      'Singapurische Aktien': 'Acciones singapurenses',
      'Philippinische Aktien': 'Acciones filipinas',
      'Hong Kong Aktien': 'Acciones de Hong Kong',
      'Deutsche Technologie-Werte': 'Valores tecnológicos alemanes',
      'Französische Blue Chips': 'Blue chips francesas',
      'Spanische Leitaktien': 'Blue chips españolas',
      'Niederländische Top-Unternehmen': 'Principales empresas neerlandesas',
      'Belgische Leitaktien': 'Blue chips belgas',
      'Schweizer Bluechips': 'Blue chips suizas',
      'Schwedische Top-Aktien': 'Principales acciones suecas',
      'Italienische Leitaktien': 'Blue chips italianas',
      'Polnische Top-Unternehmen': 'Principales empresas polacas',
      'Südafrikanische Aktien': 'Acciones sudafricanas',
      'Israelische Aktien': 'Acciones israelíes',
      'Immobilien-Investmentfonds weltweit': 'Fondos inmobiliarios a nivel mundial',
      'US-Immobilienfonds': 'Fondos inmobiliarios de EE. UU.',
      'Europäische Immobilienfonds': 'Fondos inmobiliarios europeos',
      'Asiatische Immobilienfonds': 'Fondos inmobiliarios asiáticos',
      'Quantencomputer-Technologie': 'Tecnología de computación cuántica',
      'Digitale Zahlungsdienste': 'Servicios de pago digitales',
      'Personalisierte Medizin': 'Medicina personalizada',
      'Industrie 4.0': 'Industria 4.0',
      'Kreislaufwirtschaft': 'Economía circular',
      'Meereswirtschaft & Aquakultur': 'Economía marítima y acuicultura',
      'Forstwirtschaft & Holzproduktion': 'Silvicultura y producción de madera',
      'Edelmetalle (Platin/Palladium)': 'Metales preciosos (platino/paladio)',
      'Agrarrohstoffe': 'Materias primas agrícolas',
      'Uran & Kernenergie': 'Uranio y energía nuclear',
      'Lithium & Seltene Erden': 'Litio y tierras raras',
      'Erdgas-Produktion': 'Producción de gas natural',
      'Kupferbergbau': 'Minería de cobre',
      'Wandelanleihen weltweit': 'Bonos convertibles a nivel mundial',
      'Inflationsgeschützte Anleihen': 'Bonos ligados a la inflación',
      'Nachhaltige Anleihen': 'Bonos sostenibles',
      'Diversifizierte Multi-Asset-Strategie': 'Estrategia multi-activo diversificada',
      'Risikoarme Aktien weltweit': 'Acciones de bajo riesgo a nivel mundial',
      'Dividendenstarke Aktien weltweit': 'Acciones con alto dividendo a nivel mundial',
      'Asien-Pazifik Dividendenaktien': 'Acciones de dividendos de Asia-Pacífico'
    };
    return map[description] || description;
  }
  if (aktuelleSprache === 'en') {
    const map = {
      'Weltweite Aktien aus Industrieländern': 'Global equities from developed markets',
      '500 größte US-Unternehmen': '500 largest US companies',
      '100 größte Tech-Unternehmen': '100 largest tech companies',
      'Globale Diversifikation': 'Global diversification',
      'Schwellenländer weltweit': 'Global emerging markets',
      '40 größte deutsche Unternehmen': '40 largest German companies',
      '50 größte europäische Unternehmen': '50 largest European companies',
      'Japanische Aktien': 'Japanese equities',
      'Größte britische Unternehmen': 'Largest UK companies',
      'Dividendenstarke Unternehmen': 'High-dividend companies',
      'Erneuerbare Energien weltweit': 'Renewable energy worldwide',
      'Kleine Unternehmen weltweit': 'Small companies worldwide',
      'Physisches Gold': 'Physical gold',
      'Immobilien weltweit': 'Global real estate',
      'Unternehmensanleihen': 'Corporate bonds',
      'Chinesische Aktien': 'Chinese equities',
      'Indische Aktien': 'Indian equities',
      'US Small Cap Aktien': 'US small-cap equities',
      'Europäische Aktien': 'European equities',
      '600 größte europäische Unternehmen': '600 largest European companies',
      '30 große US-Unternehmen': '30 large US companies',
      'Asien-Pazifik Region': 'Asia-Pacific region',
      'Kanadische Aktien': 'Canadian equities',
      'Australische Aktien': 'Australian equities',
      'Brasilianische Aktien': 'Brazilian equities',
      'Südkoreanische Aktien': 'South Korean equities',
      'Mittelgroße deutsche Unternehmen': 'Mid-cap German companies',
      'Kleinere deutsche Unternehmen': 'Smaller German companies',
      'Gesundheit & Biotechnologie': 'Healthcare & biotech',
      'KI & Maschinelles Lernen': 'AI & machine learning',
      'IT-Sicherheit Unternehmen': 'Cybersecurity companies',
      'Wasserwirtschaft & Infrastruktur': 'Water management & infrastructure',
      'Nachhaltige Unternehmensführung': 'Sustainable corporate governance',
      'Physisches Silber': 'Physical silver',
      'Rohöl-Preisentwicklung': 'Crude oil price performance',
      'Rohstoffproduzenten': 'Commodity producers',
      'Hochverzinsliche Unternehmensanleihen': 'High-yield corporate bonds',
      'Staatsanleihen entwickelter Länder': 'Government bonds of developed countries',
      'Schwellenländer-Anleihen': 'Emerging market bonds',
      'Globale Infrastruktur-Projekte': 'Global infrastructure projects',
      'Qualitätsaktien weltweit': 'Global quality stocks',
      'Momentum-Aktien weltweit': 'Global momentum stocks',
      'Value-Aktien weltweit': 'Global value stocks',
      'Halbleiter-Industrie': 'Semiconductor industry',
      'Cloud-Technologie Unternehmen': 'Cloud technology companies',
      'Online-Handel & Logistik': 'E-commerce & logistics',
      'Robotik & Automatisierung': 'Robotics & automation',
      'Blockchain-Technologie': 'Blockchain technology',
      'Finanztechnologie': 'Financial technology',
      'Elektromobilität & Batterien': 'Electric mobility & batteries',
      'Solarenergie-Unternehmen': 'Solar energy companies',
      'Windkraft-Technologie': 'Wind power technology',
      'Wasserstoff-Technologie': 'Hydrogen technology',
      'Nachhaltige Landwirtschaft': 'Sustainable agriculture',
      'Batterietechnologie & Speicher': 'Battery technology & storage',
      'Intelligente Städte & IoT': 'Smart cities & IoT',
      'Genforschung & Biotechnologie': 'Genomics & biotechnology',
      'Weltraumtechnologie': 'Space technology',
      'Gaming & E-Sports': 'Gaming & e-sports',
      'Luxusgüter-Hersteller': 'Luxury goods manufacturers',
      'Rüstung & Sicherheit': 'Defense & security',
      'Telekommunikation weltweit': 'Telecommunications worldwide',
      'Basiskonsumgüter': 'Consumer staples',
      'Versorgungsunternehmen': 'Utilities',
      'Bankensektor weltweit': 'Global banking sector',
      'Versicherungen weltweit': 'Insurance worldwide',
      'Rohstoff-Verarbeitung': 'Commodity processing',
      'Industrieunternehmen weltweit': 'Industrial companies worldwide',
      'Energiesektor weltweit': 'Global energy sector',
      'Metaverse & Virtual Reality': 'Metaverse & virtual reality',
      'Streaming-Dienste & Medien': 'Streaming services & media',
      '5G Netzwerk-Infrastruktur': '5G network infrastructure',
      'Taiwanesische Aktien': 'Taiwanese equities',
      'Mexikanische Aktien': 'Mexican equities',
      'Russische Aktien': 'Russian equities',
      'Türkische Aktien': 'Turkish equities',
      'Indonesische Aktien': 'Indonesian equities',
      'Thailändische Aktien': 'Thai equities',
      'Vietnamesische Aktien': 'Vietnamese equities',
      'Malaysische Aktien': 'Malaysian equities',
      'Singapurische Aktien': 'Singapore equities',
      'Philippinische Aktien': 'Philippine equities',
      'Hong Kong Aktien': 'Hong Kong equities',
      'Deutsche Technologie-Werte': 'German tech stocks',
      'Französische Blue Chips': 'French blue chips',
      'Spanische Leitaktien': 'Spanish blue chips',
      'Niederländische Top-Unternehmen': 'Top Dutch companies',
      'Belgische Leitaktien': 'Belgian blue chips',
      'Schweizer Bluechips': 'Swiss blue chips',
      'Schwedische Top-Aktien': 'Top Swedish stocks',
      'Italienische Leitaktien': 'Italian blue chips',
      'Polnische Top-Unternehmen': 'Top Polish companies',
      'Südafrikanische Aktien': 'South African equities',
      'Israelische Aktien': 'Israeli equities',
      'Immobilien-Investmentfonds weltweit': 'Global real estate investment funds',
      'US-Immobilienfonds': 'US real estate funds',
      'Europäische Immobilienfonds': 'European real estate funds',
      'Asiatische Immobilienfonds': 'Asian real estate funds',
      'Quantencomputer-Technologie': 'Quantum computing technology',
      'Digitale Zahlungsdienste': 'Digital payment services',
      'Personalisierte Medizin': 'Personalized medicine',
      'Industrie 4.0': 'Industry 4.0',
      'Kreislaufwirtschaft': 'Circular economy',
      'Meereswirtschaft & Aquakultur': 'Ocean economy & aquaculture',
      'Forstwirtschaft & Holzproduktion': 'Forestry & timber production',
      'Edelmetalle (Platin/Palladium)': 'Precious metals (platinum/palladium)',
      'Agrarrohstoffe': 'Agricultural commodities',
      'Uran & Kernenergie': 'Uranium & nuclear energy',
      'Lithium & Seltene Erden': 'Lithium & rare earths',
      'Erdgas-Produktion': 'Natural gas production',
      'Kupferbergbau': 'Copper mining',
      'Wandelanleihen weltweit': 'Global convertible bonds',
      'Inflationsgeschützte Anleihen': 'Inflation-linked bonds',
      'Nachhaltige Anleihen': 'Sustainable bonds',
      'Diversifizierte Multi-Asset-Strategie': 'Diversified multi-asset strategy',
      'Risikoarme Aktien weltweit': 'Low-risk equities worldwide',
      'Dividendenstarke Aktien weltweit': 'High-dividend equities worldwide',
      'Asien-Pazifik Dividendenaktien': 'Asia-Pacific dividend equities'
    };
    return map[description] || description;
  }
  if (aktuelleSprache === 'fr') {
    const map = {
      'Weltweite Aktien aus Industrieländern': 'Actions mondiales des marchés développés',
      '500 größte US-Unternehmen': '500 plus grandes entreprises américaines',
      '100 größte Tech-Unternehmen': '100 plus grandes entreprises technologiques',
      'Globale Diversifikation': 'Diversification mondiale',
      'Schwellenländer weltweit': 'Marchés émergents mondiaux',
      '40 größte deutsche Unternehmen': '40 plus grandes entreprises allemandes',
      '50 größte europäische Unternehmen': '50 plus grandes entreprises européennes',
      'Japanische Aktien': 'Actions japonaises',
      'Größte britische Unternehmen': 'Plus grandes entreprises britanniques',
      'Dividendenstarke Unternehmen': 'Entreprises à forts dividendes',
      'Erneuerbare Energien weltweit': 'Énergies renouvelables dans le monde',
      'Kleine Unternehmen weltweit': 'Petites entreprises mondiales',
      'Physisches Gold': 'Or physique',
      'Immobilien weltweit': 'Immobilier mondial',
      'Unternehmensanleihen': 'Obligations d’entreprises',
      'Chinesische Aktien': 'Actions chinoises',
      'Indische Aktien': 'Actions indiennes',
      'US Small Cap Aktien': 'Actions small cap américaines',
      'Europäische Aktien': 'Actions européennes',
      '600 größte europäische Unternehmen': '600 plus grandes entreprises européennes',
      '30 große US-Unternehmen': '30 grandes entreprises américaines',
      'Asien-Pazifik Region': 'Région Asie-Pacifique',
      'Kanadische Aktien': 'Actions canadiennes',
      'Australische Aktien': 'Actions australiennes',
      'Brasilianische Aktien': 'Actions brésiliennes',
      'Südkoreanische Aktien': 'Actions sud-coréennes',
      'Mittelgroße deutsche Unternehmen': 'Entreprises allemandes de moyenne capitalisation',
      'Kleinere deutsche Unternehmen': 'Petites entreprises allemandes',
      'Gesundheit & Biotechnologie': 'Santé et biotechnologie',
      'KI & Maschinelles Lernen': 'IA et apprentissage automatique',
      'IT-Sicherheit Unternehmen': 'Entreprises de cybersécurité',
      'Wasserwirtschaft & Infrastruktur': 'Gestion de l’eau et infrastructures',
      'Nachhaltige Unternehmensführung': 'Gouvernance d’entreprise durable',
      'Physisches Silber': 'Argent physique',
      'Rohöl-Preisentwicklung': 'Évolution du prix du pétrole brut',
      'Rohstoffproduzenten': 'Producteurs de matières premières',
      'Hochverzinsliche Unternehmensanleihen': 'Obligations d’entreprises à haut rendement',
      'Staatsanleihen entwickelter Länder': 'Obligations d’État des pays développés',
      'Schwellenländer-Anleihen': 'Obligations des marchés émergents',
      'Globale Infrastruktur-Projekte': 'Projets d’infrastructure mondiaux',
      'Qualitätsaktien weltweit': 'Actions de qualité mondiales',
      'Momentum-Aktien weltweit': 'Actions momentum mondiales',
      'Value-Aktien weltweit': 'Actions de valeur mondiales',
      'Halbleiter-Industrie': 'Industrie des semi-conducteurs',
      'Cloud-Technologie Unternehmen': 'Entreprises de technologie cloud',
      'Online-Handel & Logistik': 'E-commerce et logistique',
      'Robotik & Automatisierung': 'Robotique et automatisation',
      'Blockchain-Technologie': 'Technologie blockchain',
      'Finanztechnologie': 'Technologie financière',
      'Elektromobilität & Batterien': 'Mobilité électrique et batteries',
      'Solarenergie-Unternehmen': 'Entreprises d’énergie solaire',
      'Windkraft-Technologie': 'Technologie éolienne',
      'Wasserstoff-Technologie': 'Technologie de l’hydrogène',
      'Nachhaltige Landwirtschaft': 'Agriculture durable',
      'Batterietechnologie & Speicher': 'Technologie des batteries et stockage',
      'Intelligente Städte & IoT': 'Villes intelligentes et IoT',
      'Genforschung & Biotechnologie': 'Génomique et biotechnologie',
      'Weltraumtechnologie': 'Technologie spatiale',
      'Gaming & E-Sports': 'Gaming et e-sports',
      'Luxusgüter-Hersteller': 'Fabricants de produits de luxe',
      'Rüstung & Sicherheit': 'Défense et sécurité',
      'Telekommunikation weltweit': 'Télécommunications mondiales',
      'Basiskonsumgüter': 'Biens de consommation de base',
      'Versorgungsunternehmen': 'Services publics',
      'Bankensektor weltweit': 'Secteur bancaire mondial',
      'Versicherungen weltweit': 'Assurances mondiales',
      'Rohstoff-Verarbeitung': 'Transformation des matières premières',
      'Industrieunternehmen weltweit': 'Entreprises industrielles mondiales',
      'Energiesektor weltweit': 'Secteur énergétique mondial',
      'Metaverse & Virtual Reality': 'Métavers et réalité virtuelle',
      'Streaming-Dienste & Medien': 'Services de streaming et médias',
      '5G Netzwerk-Infrastruktur': 'Infrastructure réseau 5G',
      'Taiwanesische Aktien': 'Actions taïwanaises',
      'Mexikanische Aktien': 'Actions mexicaines',
      'Russische Aktien': 'Actions russes',
      'Türkische Aktien': 'Actions turques',
      'Indonesische Aktien': 'Actions indonésiennes',
      'Thailändische Aktien': 'Actions thaïlandaises',
      'Vietnamesische Aktien': 'Actions vietnamiennes',
      'Malaysische Aktien': 'Actions malaisiennes',
      'Singapurische Aktien': 'Actions singapouriennes',
      'Philippinische Aktien': 'Actions philippines',
      'Hong Kong Aktien': 'Actions de Hong Kong',
      'Deutsche Technologie-Werte': 'Valeurs technologiques allemandes',
      'Französische Blue Chips': 'Blue chips françaises',
      'Spanische Leitaktien': 'Blue chips espagnoles',
      'Niederländische Top-Unternehmen': 'Principales entreprises néerlandaises',
      'Belgische Leitaktien': 'Blue chips belges',
      'Schweizer Bluechips': 'Blue chips suisses',
      'Schwedische Top-Aktien': 'Principales actions suédoises',
      'Italienische Leitaktien': 'Blue chips italiennes',
      'Polnische Top-Unternehmen': 'Principales entreprises polonaises',
      'Südafrikanische Aktien': 'Actions sud-africaines',
      'Israelische Aktien': 'Actions israéliennes',
      'Immobilien-Investmentfonds weltweit': 'Fonds immobiliers mondiaux',
      'US-Immobilienfonds': 'Fonds immobiliers américains',
      'Europäische Immobilienfonds': 'Fonds immobiliers européens',
      'Asiatische Immobilienfonds': 'Fonds immobiliers asiatiques',
      'Quantencomputer-Technologie': 'Technologie de l’informatique quantique',
      'Digitale Zahlungsdienste': 'Services de paiement numériques',
      'Personalisierte Medizin': 'Médecine personnalisée',
      'Industrie 4.0': 'Industrie 4.0',
      'Kreislaufwirtschaft': 'Économie circulaire',
      'Meereswirtschaft & Aquakultur': 'Économie maritime et aquaculture',
      'Forstwirtschaft & Holzproduktion': 'Sylviculture et production de bois',
      'Edelmetalle (Platin/Palladium)': 'Métaux précieux (platine/palladium)',
      'Agrarrohstoffe': 'Matières premières agricoles',
      'Uran & Kernenergie': 'Uranium et énergie nucléaire',
      'Lithium & Seltene Erden': 'Lithium et terres rares',
      'Erdgas-Produktion': 'Production de gaz naturel',
      'Kupferbergbau': 'Extraction de cuivre',
      'Wandelanleihen weltweit': 'Obligations convertibles mondiales',
      'Inflationsgeschützte Anleihen': 'Obligations indexées sur l’inflation',
      'Nachhaltige Anleihen': 'Obligations durables',
      'Diversifizierte Multi-Asset-Strategie': 'Stratégie multi-actifs diversifiée',
      'Risikoarme Aktien weltweit': 'Actions à faible risque mondiales',
      'Dividendenstarke Aktien weltweit': 'Actions à fort dividende mondiales',
      'Asien-Pazifik Dividendenaktien': 'Actions à dividendes Asie-Pacifique'
    };
    return map[description] || description;
  }
  return description;
}

function initETFDatenbank() {
  sortETFs();
  initETFChart();
}

function toggleETFAuswahl(isin, evt) {
  if (evt && typeof evt.stopPropagation === 'function') {
    evt.stopPropagation();
  }
  const index = ausgewaehlteETFs.indexOf(isin);
  
  if (index > -1) {
    // ETF abwählen
    ausgewaehlteETFs.splice(index, 1);
  } else {
    // ETF auswählen (max 2)
    if (ausgewaehlteETFs.length >= 2) {
      // Entferne den ältesten ETF
      ausgewaehlteETFs.shift();
    }
    ausgewaehlteETFs.push(isin);
  }
  
  updateETFChart();
  zeigeETFs();

  const chartContainer = document.getElementById('etfChartContainer');
  if (chartContainer && chartContainer.style.display !== 'none' && evt) {
    chartContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}

function initETFChart() {
  const ctx = document.getElementById('etfChart');
  if (!ctx) return;
  
  etfChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [t('year10'), t('year5'), t('year3'), t('year1')],
      datasets: []
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: {
          display: true,
          position: 'top',
          labels: {
            color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim(),
            font: {
              size: 12,
              weight: 600
            },
            padding: 20,
            usePointStyle: true
          }
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          titleColor: '#fff',
          bodyColor: '#fff',
          padding: 12,
          callbacks: {
            label: function(context) {
              return context.dataset.label + ': ' + context.parsed.y.toFixed(2) + '% p.a.';
            }
          }
        }
      },
      scales: {
        x: {
          grid: {
            color: 'rgba(255, 255, 255, 0.05)'
          },
          ticks: {
            color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim(),
            font: {
              size: 12,
              weight: 600
            }
          }
        },
        y: {
          beginAtZero: true,
          grid: {
            color: 'rgba(255, 255, 255, 0.05)'
          },
          ticks: {
            color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim(),
            callback: function(value) {
              return value + '%';
            }
          }
        }
      }
    }
  });
  
  updateETFChart();
}

function updateETFChart() {
  if (!etfChart) return;
  
  const ausgewaehlte = etfDaten.filter(etf => ausgewaehlteETFs.includes(etf.isin));
  
  // Aktualisiere Anzeige
  const ausgewaehlteAnzahlEl = document.getElementById('ausgewaehlteAnzahl');
  if (ausgewaehlteAnzahlEl) ausgewaehlteAnzahlEl.textContent = ausgewaehlteETFs.length;
  
  const chartContainer = document.getElementById('etfChartContainer');
  const hinweis = document.getElementById('vergleichsHinweis');
  const detailVergleich = document.getElementById('detailVergleich');
  if (!chartContainer || !hinweis || !detailVergleich) {
    return;
  }
  
  if (ausgewaehlte.length === 0) {
    // Verstecke das gesamte Diagramm wenn keine ETFs ausgewählt
    chartContainer.style.display = 'none';
    detailVergleich.style.display = 'none';
    etfChart.data.datasets = [];
  } else {
    // Zeige Diagramm wenn ETFs ausgewählt sind
    chartContainer.style.display = 'block';
    hinweis.style.display = 'none';
    
    // Erstelle ein Dataset für jeden ausgewählten ETF
    const colors = [
      { border: 'rgba(16, 185, 129, 1)', bg: 'rgba(16, 185, 129, 0.1)' },
      { border: 'rgba(59, 130, 246, 1)', bg: 'rgba(59, 130, 246, 0.1)' }
    ];
    
    etfChart.data.datasets = ausgewaehlte.map((etf, i) => ({
      label: etf.name,
      data: [etf.rendite10J, etf.rendite5J, etf.rendite3J, etf.rendite1J],
      borderColor: colors[i].border,
      backgroundColor: colors[i].bg,
      borderWidth: 3,
      tension: 0.4,
      fill: true,
      pointRadius: 5,
      pointHoverRadius: 7,
      pointBackgroundColor: colors[i].border,
      pointBorderColor: '#fff',
      pointBorderWidth: 2
    }));
    
    // Zeige Detailvergleich wenn 2 ETFs ausgewählt sind
    if (ausgewaehlte.length === 2) {
      detailVergleich.style.display = 'block';
      updateDetailVergleich(ausgewaehlte[0], ausgewaehlte[1]);
    } else {
      detailVergleich.style.display = 'none';
    }
  }
  
  etfChart.update('none');
}

function updateDetailVergleich(etf1, etf2) {
  // Extrahiere Ticker aus ISIN oder Namen
  const ticker1 = etf1.isin.substring(0, 4);
  const ticker2 = etf2.isin.substring(0, 4);
  
  // ETF 1
  document.getElementById('v1_ticker').textContent = ticker1;
  document.getElementById('v1_name').textContent = etf1.name;
  document.getElementById('v1_ter').textContent = etf1.ter.toFixed(2) + '%';
  document.getElementById('v1_ter').style.color = etf1.ter < 0.3 ? 'rgba(16,185,129,1)' : (etf1.ter > 0.5 ? '#ef4444' : 'var(--text)');
  document.getElementById('v1_1j').textContent = etf1.rendite1J.toFixed(1) + '%';
  document.getElementById('v1_1j').style.color = etf1.rendite1J > etf2.rendite1J ? 'rgba(16,185,129,1)' : (etf1.rendite1J < etf2.rendite1J ? '#ef4444' : 'var(--text)');
  document.getElementById('v1_5j').textContent = etf1.rendite5J.toFixed(1) + '%';
  document.getElementById('v1_5j').style.color = etf1.rendite5J > etf2.rendite5J ? 'rgba(16,185,129,1)' : (etf1.rendite5J < etf2.rendite5J ? '#ef4444' : 'var(--text)');
  document.getElementById('v1_kat').textContent = translateETFCategory(etf1.kategorie);
  
  // ETF 2
  document.getElementById('v2_ticker').textContent = ticker2;
  document.getElementById('v2_name').textContent = etf2.name;
  document.getElementById('v2_ter').textContent = etf2.ter.toFixed(2) + '%';
  document.getElementById('v2_ter').style.color = etf2.ter < 0.3 ? 'rgba(16,185,129,1)' : (etf2.ter > 0.5 ? '#ef4444' : 'var(--text)');
  document.getElementById('v2_1j').textContent = etf2.rendite1J.toFixed(1) + '%';
  document.getElementById('v2_1j').style.color = etf2.rendite1J > etf1.rendite1J ? 'rgba(16,185,129,1)' : (etf2.rendite1J < etf1.rendite1J ? '#ef4444' : 'var(--text)');
  document.getElementById('v2_5j').textContent = etf2.rendite5J.toFixed(1) + '%';
  document.getElementById('v2_5j').style.color = etf2.rendite5J > etf1.rendite5J ? 'rgba(16,185,129,1)' : (etf2.rendite5J < etf1.rendite5J ? '#ef4444' : 'var(--text)');
  document.getElementById('v2_kat').textContent = translateETFCategory(etf2.kategorie);
}

function zeigeETFDetails(isin) {
  const etf = etfDaten.find(e => e.isin === isin);
  if (!etf) return;
  
  document.getElementById('etfDetailName').textContent = etf.name;
  document.getElementById('etfDetailIsin').textContent = etf.isin;
  document.getElementById('etfDetailBeschreibung').textContent = translateETFDescription(etf.beschreibung);
  document.getElementById('etfDetailKategorie').textContent = translateETFCategory(etf.kategorie);
  document.getElementById('etfDetailTER').textContent = etf.ter.toFixed(2) + '%';
  document.getElementById('etfDetail1J').textContent = etf.rendite1J.toFixed(1) + '%';
  document.getElementById('etfDetail3J').textContent = etf.rendite3J.toFixed(1) + '%';
  document.getElementById('etfDetail5J').textContent = etf.rendite5J.toFixed(1) + '%';
  document.getElementById('etfDetail10J').textContent = etf.rendite10J.toFixed(1) + '%';
  
  // Vergleich-Button aktualisieren
  const vergleichBtn = document.getElementById('etfDetailVergleichBtn');
  const istAusgewaehlt = ausgewaehlteETFs.includes(isin);
  vergleichBtn.textContent = istAusgewaehlt ? t('etfSelected') : t('toComparison');
  vergleichBtn.onclick = function() {
    toggleETFAuswahl(isin);
    closeModal('etfDetailModal');
  };
  
  document.getElementById('etfDetailModal').classList.add('active');
}

function filterETFs() {
  const suchbegriff = document.getElementById('etfSuche').value.toLowerCase();
  
  gefiltereETFs = etfDaten.filter(etf => 
    etf.name.toLowerCase().includes(suchbegriff) ||
    etf.isin.toLowerCase().includes(suchbegriff) ||
    etf.beschreibung.toLowerCase().includes(suchbegriff) ||
    etf.kategorie.toLowerCase().includes(suchbegriff)
  );
  
  sortETFs();
}

function sortETFs() {
  const kriterium = document.getElementById('etfSortKriterium').value;
  const richtung = document.getElementById('etfSortRichtung').value;
  
  switch(kriterium) {
    case 'name':
      gefiltereETFs.sort((a, b) => {
        return richtung === 'asc' 
          ? a.name.localeCompare(b.name)
          : b.name.localeCompare(a.name);
      });
      break;
    case 'rendite1j':
      gefiltereETFs.sort((a, b) => {
        return richtung === 'desc' 
          ? b.rendite1J - a.rendite1J
          : a.rendite1J - b.rendite1J;
      });
      break;
    case 'rendite3j':
      gefiltereETFs.sort((a, b) => {
        return richtung === 'desc' 
          ? b.rendite3J - a.rendite3J
          : a.rendite3J - b.rendite3J;
      });
      break;
    case 'rendite5j':
      gefiltereETFs.sort((a, b) => {
        return richtung === 'desc' 
          ? b.rendite5J - a.rendite5J
          : a.rendite5J - b.rendite5J;
      });
      break;
    case 'rendite10j':
      gefiltereETFs.sort((a, b) => {
        return richtung === 'desc' 
          ? b.rendite10J - a.rendite10J
          : a.rendite10J - b.rendite10J;
      });
      break;
    case 'ter':
      gefiltereETFs.sort((a, b) => {
        return richtung === 'desc' 
          ? b.ter - a.ter
          : a.ter - b.ter;
      });
      break;
  }
  
  zeigeETFs();
}

function zeigeETFs() {
  const liste = document.getElementById('etfListe');
  const keineErgebnisse = document.getElementById('keineErgebnisse');
  const anzahl = document.getElementById('etfAnzahl');
  
  if (gefiltereETFs.length === 0) {
    liste.style.display = 'none';
    keineErgebnisse.style.display = 'block';
    anzahl.textContent = t('zeroETFs');
    return;
  }
  
  liste.style.display = 'grid';
  keineErgebnisse.style.display = 'none';
  anzahl.textContent = `(${ gefiltereETFs.length} ETFs)`;
  
  const kriterium = document.getElementById('etfSortKriterium').value;
  
  liste.innerHTML = gefiltereETFs.map(etf => {
    const istAusgewaehlt = ausgewaehlteETFs.includes(etf.isin);
    const buttonStyle = istAusgewaehlt 
      ? 'background:linear-gradient(90deg,var(--accent),#34d399);color:#072017;border:2px solid var(--accent)' 
      : 'background:rgba(255,255,255,0.05);color:var(--text);border:2px solid var(--border)';
    const buttonText = istAusgewaehlt ? t('etfSelected') : t('toComparison');
    
    // Bestimme welcher Wert angezeigt werden soll basierend auf Sortierung
    let sortWert = '';
    let sortLabel = '';
    switch(kriterium) {
      case 'name':
        sortWert = etf.name;
        sortLabel = '';
        break;
      case 'rendite1j':
        sortWert = etf.rendite1J.toFixed(1) + '%';
        sortLabel = t('year1');
        break;
      case 'rendite3j':
        sortWert = etf.rendite3J.toFixed(1) + '%';
        sortLabel = t('year3');
        break;
      case 'rendite5j':
        sortWert = etf.rendite5J.toFixed(1) + '%';
        sortLabel = t('year5');
        break;
      case 'rendite10j':
        sortWert = etf.rendite10J.toFixed(1) + '%';
        sortLabel = t('year10');
        break;
      case 'ter':
        sortWert = etf.ter.toFixed(2) + '%';
        sortLabel = t('ter').split(' ')[0];
        break;
    }
    
    return `
    <div style="background:rgba(255,255,255,0.03);padding:20px;border-radius:12px;border:${istAusgewaehlt ? '2px solid var(--accent)' : '1px solid var(--border)'};transition:all 0.2s;position:relative;cursor:pointer" onclick="zeigeETFDetails('${etf.isin}')" onmouseover="this.style.background='rgba(255,255,255,0.06)'" onmouseout="this.style.background='rgba(255,255,255,0.03)'">
      <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:12px">
        <div style="flex:1">
          <div style="font-weight:700;color:var(--text);font-size:16px;margin-bottom:4px">${etf.name}</div>
          <div style="font-size:12px;color:var(--muted);margin-bottom:6px">${etf.isin}</div>
          <div style="font-size:13px;color:var(--text);line-height:1.5">${translateETFDescription(etf.beschreibung)}</div>
        </div>
        <div style="text-align:right;margin-left:20px">
          <div style="font-size:24px;font-weight:800;color:var(--accent);margin-bottom:4px">${sortWert}</div>
          <div style="font-size:11px;color:var(--muted)">${sortLabel}</div>
        </div>
      </div>
      <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center">
        <div style="display:inline-flex;align-items:center;gap:6px;background:rgba(255,255,255,0.05);padding:6px 12px;border-radius:20px;font-size:11px;font-weight:600">
          <span style="color:var(--muted)">TER:</span>
          <span style="color:var(--text)">${etf.ter.toFixed(2)}%</span>
        </div>
        <div style="display:inline-flex;align-items:center;gap:6px;background:rgba(59,130,246,0.15);padding:6px 12px;border-radius:20px;font-size:11px;font-weight:600;color:var(--blue)">
          ${translateETFCategory(etf.kategorie)}
        </div>
        <button onclick="toggleETFAuswahl('${etf.isin}', event)" style="${buttonStyle};padding:8px 16px;border-radius:20px;font-size:12px;font-weight:700;cursor:pointer;transition:all 0.2s;margin-left:auto" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
          ${buttonText}
        </button>
      </div>
    </div>
  `;
  }).join('');
}

// Sparen
let sparModus = 'endkapital'; // 'endkapital' oder 'rate'
let sparChart = null;

function initSparChart() {
  const ctx = document.getElementById('sparChart');
  if (!ctx) return;
  
  sparChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [
        {
          label: t('totalCapital'),
          data: [],
          borderColor: 'rgb(16, 185, 129)',
          backgroundColor: 'rgba(16, 185, 129, 0.1)',
          fill: true,
          tension: 0.4
        },
        {
          label: t('sparDeposits'),
          data: [],
          borderColor: 'rgb(59, 130, 246)',
          backgroundColor: 'rgba(59, 130, 246, 0.1)',
          fill: true,
          tension: 0.4
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: {
          display: true,
          position: 'top',
          labels: {
            color: getComputedStyle(document.documentElement).getPropertyValue('--text').trim(),
            font: {
              size: 11,
              weight: 600
            }
          }
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          titleColor: '#fff',
          bodyColor: '#fff',
          padding: 12,
          displayColors: true,
          callbacks: {
            label: function(context) {
              let label = context.dataset.label || '';
              if (label) {
                label += ': ';
              }
              label += Math.round(context.parsed.y).toLocaleString() + ' €';
              return label;
            }
          }
        }
      },
      scales: {
        x: {
          grid: {
            color: 'rgba(255, 255, 255, 0.05)'
          },
          ticks: {
            color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim()
          }
        },
        y: {
          beginAtZero: true,
          grid: {
            color: 'rgba(255, 255, 255, 0.05)'
          },
          ticks: {
            color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim(),
            stepSize: 20000,
            callback: function(value) {
              return Math.round(value).toLocaleString() + ' €';
            }
          }
        }
      }
    }
  });
}

function updateSparChart(a, r, z, j) {
  if (!sparChart) {
    initSparChart();
  }
  
  const monatszins = z / 100 / 12;
  const monate = j * 12;
  const jaehrlicheDynamik = parseFloat(localStorage.getItem('jaehrlicheDynamik')) || 0;
  
  // Berechne Werte für jeden Monat
  const labels = [];
  const gesamtkapital = [];
  const einzahlungen = [];
  
  // Zeige Datenpunkte in 6-Monats-Schritten
  const intervall = 6; // 6 Monate
  
  let kapital = a;
  let summeEinzahlungen = a;
  let aktuelleRate = r;
  
  for (let i = 0; i <= monate; i++) {
    if (i % intervall === 0 || i === monate) {
      const jahr = Math.floor(i / 12);
      const monat = i % 12;
      if (i === 0) {
        labels.push('Start');
      } else if (monat === 0) {
        labels.push(`${jahr}J`);
      } else {
        labels.push(`${jahr}J ${monat}M`);
      }
      gesamtkapital.push(Math.round(kapital));
      einzahlungen.push(Math.round(summeEinzahlungen));
    }
    
    if (i < monate) {
      // Erhöhe Rate zu Beginn jedes Jahres (außer im ersten Jahr)
      if (i > 0 && i % 12 === 0 && jaehrlicheDynamik > 0) {
        aktuelleRate = aktuelleRate * (1 + jaehrlicheDynamik / 100);
      }
      kapital = kapital * (1 + monatszins) + aktuelleRate;
      summeEinzahlungen += aktuelleRate;
    }
  }
  
  sparChart.data.labels = labels;
  sparChart.data.datasets[0].data = gesamtkapital;
  sparChart.data.datasets[1].data = einzahlungen;
  sparChart.update('none'); // 'none' für keine Animation beim Update
}

function wechsleSparModus(modus) {
  sparModus = modus;
  
  const btnEndkapital = document.getElementById('btnEndkapital');
  const btnZielRate = document.getElementById('btnZielRate');
  const zielRateEingabe = document.getElementById('zielRateEingabe');
  const sparrateLabel = document.getElementById('sparrateLabel');
  const rateInput = document.getElementById('rate');
  
  if (modus === 'endkapital') {
    // Endkapital-Modus: Rate wird eingegeben, Endkapital berechnet
    btnEndkapital.style.background = 'linear-gradient(90deg,var(--accent),#34d399)';
    btnEndkapital.style.color = '#072017';
    btnZielRate.style.background = 'var(--input-bg)';
    btnZielRate.style.color = 'var(--muted)';
    zielRateEingabe.style.display = 'none';
    sparrateLabel.style.display = 'block';
    rateInput.disabled = false;
  } else {
    // Ziel-Rate-Modus: Endkapital wird eingegeben, Rate berechnet
    btnZielRate.style.background = 'linear-gradient(90deg,var(--blue),#60a5fa)';
    btnZielRate.style.color = '#fff';
    btnEndkapital.style.background = 'var(--input-bg)';
    btnEndkapital.style.color = 'var(--muted)';
    zielRateEingabe.style.display = 'block';
    sparrateLabel.style.display = 'none';
    rateInput.disabled = true;
  }
  
  berechneSpar();
}

function berechneSpar() {
  const a = parseFloat(document.getElementById('anfang').value) || 0;
  const j = parseInt(document.getElementById('zeit').value) || 1;
  const z = parseFloat(document.getElementById('zins').value) || 0;
  
  document.getElementById('zeitVal').textContent = j;
  updateRangeSlider('zeit');
  
  const monatszins = z / 100 / 12;
  const monate = j * 12;
  const landDaten = getLandSteuerdaten();
  const steuersatz = landDaten.steuersatz;
  const symbol = getWaehrungsSymbol();
  
  if (sparModus === 'endkapital') {
    // Normaler Modus: Berechne Endkapital aus gegebener Rate
    const r = parseFloat(document.getElementById('rate').value) || 0;
    const jaehrlicheDynamik = parseFloat(localStorage.getItem('jaehrlicheDynamik')) || 0;
    
    let bruttoEndkapital = a;
    let aktuelleRate = r;
    let gesamtEinzahlungen = a;
    
    for (let i = 0; i < monate; i++) {
      // Erhöhe Rate zu Beginn jedes Jahres (außer im ersten Jahr)
      if (i > 0 && i % 12 === 0 && jaehrlicheDynamik > 0) {
        aktuelleRate = aktuelleRate * (1 + jaehrlicheDynamik / 100);
      }
      bruttoEndkapital = bruttoEndkapital * (1 + monatszins) + aktuelleRate;
      gesamtEinzahlungen += aktuelleRate;
    }
    
    const einzahlungen = gesamtEinzahlungen;
    const bruttoGewinn = bruttoEndkapital - einzahlungen;
    
    let steuern = 0;
    if (bruttoGewinn > 0) {
      steuern = bruttoGewinn * (steuersatz / 100);
    }
    
    const nettoEndkapital = bruttoEndkapital - steuern;
    const endkapital = zeigeSparNetto ? nettoEndkapital : bruttoEndkapital;
    const rendite = einzahlungen > 0 ? ((nettoEndkapital - einzahlungen) / einzahlungen * 100) : 0;
    
    document.getElementById('sparEndkapital').textContent = Math.round(endkapital).toLocaleString() + ' ' + symbol;
    const finalCapitalLabel = t('finalCapital').toUpperCase();
    const netProfitLabel = t('netProfit').toUpperCase();
    const grossProfitLabel = t('grossProfit').toUpperCase();
    document.getElementById('sparEndkapitalLabel').textContent = zeigeSparNetto ? finalCapitalLabel + ' (' + netProfitLabel + ') ?' : finalCapitalLabel + ' (' + grossProfitLabel + ') ?';
    document.getElementById('sparRendite').textContent = rendite.toFixed(2) + '%';
    
    document.getElementById('sparEinzahlungen').textContent = Math.round(einzahlungen).toLocaleString() + ' ' + symbol;
    document.getElementById('sparZinsen').textContent = Math.round(bruttoGewinn).toLocaleString() + ' ' + symbol;
    
    // Chart aktualisieren
    updateSparChart(a, r, z, j);
    
    // Pro Features berechnen und anzeigen
    const isPro = localStorage.getItem('isPro') === 'true';
    if (isPro) {
      // Realwert mit Inflation aus Einstellungen
      const inflation = parseFloat(localStorage.getItem('inflationsrate')) || 2.0;
      const inflationsFaktor = Math.pow(1 + inflation / 100, j);
      const realwert = nettoEndkapital / inflationsFaktor;
      
      document.getElementById('sparRealwert').textContent = Math.round(realwert).toLocaleString() + ' ' + symbol;
      document.getElementById('sparSteuern').textContent = Math.round(steuern).toLocaleString() + ' ' + symbol;
      
      document.getElementById('sparProFeatures').style.display = 'flex';
      document.getElementById('sparProTeaser').style.display = 'none';
    } else {
      document.getElementById('sparProFeatures').style.display = 'none';
      document.getElementById('sparProTeaser').style.display = 'block';
    }
    
  } else {
    // Ziel-Rate-Modus: Berechne benötigte Rate für gewünschtes Endkapital
    const zielBrutto = parseFloat(document.getElementById('zielEndkapital').value) || 0;
    
    // Berechne benötigte Rate durch Iteration (numerische Lösung)
    let rate = 0;
    let step = 1000;
    let tolerance = 1;
    
    for (let iteration = 0; iteration < 50; iteration++) {
      let testEndkapital = a;
      for (let i = 0; i < monate; i++) {
        testEndkapital = testEndkapital * (1 + monatszins) + rate;
      }
      
      const diff = zielBrutto - testEndkapital;
      
      if (Math.abs(diff) < tolerance) break;
      
      if (diff > 0) {
        rate += step;
      } else {
        rate -= step;
        step /= 2;
      }
      
      if (rate < 0) rate = 0;
    }
    
    // Aktualisiere die Rate im Input
    document.getElementById('rate').value = rate.toFixed(2);
    
    // Berechne Werte mit berechneter Rate
    let bruttoEndkapital = a;
    for (let i = 0; i < monate; i++) {
      bruttoEndkapital = bruttoEndkapital * (1 + monatszins) + rate;
    }
    
    const einzahlungen = a + (rate * monate);
    const bruttoGewinn = bruttoEndkapital - einzahlungen;
    
    let steuern = 0;
    if (bruttoGewinn > 0) {
      steuern = bruttoGewinn * (steuersatz / 100);
    }
    
    const nettoEndkapital = bruttoEndkapital - steuern;
    const endkapital = zeigeSparNetto ? nettoEndkapital : bruttoEndkapital;
    const rendite = einzahlungen > 0 ? ((nettoEndkapital - einzahlungen) / einzahlungen * 100) : 0;
    
    document.getElementById('sparEndkapital').textContent = rate.toFixed(2) + ' ' + symbol;
    document.getElementById('sparEndkapitalLabel').textContent = t('requiredRate');
    document.getElementById('sparRendite').textContent = 'Ziel: ' + Math.round(zielBrutto).toLocaleString() + ' ' + symbol;
    
    document.getElementById('sparEinzahlungen').textContent = Math.round(einzahlungen).toLocaleString() + ' ' + symbol;
    document.getElementById('sparZinsen').textContent = Math.round(bruttoGewinn).toLocaleString() + ' ' + symbol;
    
    // Chart aktualisieren
    updateSparChart(a, rate, z, j);
  }
}

function toggleSparAnzeige() {
  zeigeSparNetto = !zeigeSparNetto;
  berechneSpar();
}

function updateRangeSlider(id) {
  const slider = document.getElementById(id);
  if (!slider) return;
  
  const min = parseFloat(slider.min) || 0;
  const max = parseFloat(slider.max) || 100;
  const val = parseFloat(slider.value) || 0;
  
  const percentage = ((val - min) / (max - min)) * 100;
  const theme = document.documentElement.getAttribute('data-theme') || 'dark';
  const grayColor = (theme === 'light' || (theme === 'system' && window.matchMedia('(prefers-color-scheme: light)').matches)) ? 'rgba(0,0,0,0.1)' : 'rgba(255,255,255,0.1)';
  slider.style.background = `linear-gradient(90deg, var(--accent) 0%, var(--accent) ${percentage}%, ${grayColor} ${percentage}%, ${grayColor} 100%)`;
}

// Freibetrag aktualisieren
function aktualisiereFreibetrag() {
  const verwendet = parseFloat(document.getElementById('verwendeterFreibetrag').value) || 0;
  const landDaten = getLandSteuerdaten();
  const freibetrag = landDaten.freibetrag; // Länderspezifischer Jahres-Freibetrag
  const verbleibend = Math.max(0, freibetrag - verwendet);
  const prozent = freibetrag > 0 ? (verwendet / freibetrag * 100).toFixed(0) : 0;
  const numberLocale = getNumberLocale();
  
  const symbol = getWaehrungsSymbol();
  
  // Input max dynamisch setzen
  const freibetragInput = document.getElementById('verwendeterFreibetrag');
  if (freibetragInput) {
    freibetragInput.max = freibetrag;
  }
  
  // Verbleibenden Betrag aktualisieren
  document.getElementById('verbleibenderFreibetrag').textContent = verbleibend.toLocaleString(numberLocale, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' ' + symbol;
  
  // Fortschrittsbalken aktualisieren
  document.getElementById('freibetragProgress').style.width = Math.min(100, prozent) + '%';
  
  // Prozent-Text aktualisieren
  document.getElementById('freibetragProzent').textContent = prozent + '% ' + t('used');
  
  // Farbe ändern wenn Freibetrag überschritten
  if (verwendet > freibetrag) {
    document.getElementById('verbleibenderFreibetrag').style.color = 'var(--danger)';
    document.getElementById('freibetragProgress').style.background = 'var(--danger)';
  } else {
    document.getElementById('verbleibenderFreibetrag').style.color = 'var(--accent)';
    document.getElementById('freibetragProgress').style.background = 'var(--accent)';
  }
  
  // Speichere in localStorage
  localStorage.setItem('verwendeterFreibetrag', verwendet.toString());
}

// Freibetrag beim Laden wiederherstellen
function ladeFreibetrag() {
  const gespeicherterWert = localStorage.getItem('verwendeterFreibetrag');
  if (gespeicherterWert !== null) {
    document.getElementById('verwendeterFreibetrag').value = gespeicherterWert;
    aktualisiereFreibetrag();
  }
}

// Broker und Gebühren
const BROKER_GEBUEHREN_MODELLE = {
  finanzenzero: {
    direkt: { typ: 'free-ab', ab: 500, sonst: { typ: 'fixed', wert: 1.0 } },
    xetra: { typ: 'fixed', wert: 4.9 }
  },
  smartbrokerplus: {
    direkt: { typ: 'free-ab', ab: 500, sonst: { typ: 'fixed', wert: 1.0 } },
    xetra: { typ: 'staffel', stufen: [
      { bis: 5000, gebuehr: 4.0 },
      { bis: 25000, gebuehr: 9.0 },
      { bis: Infinity, gebuehr: 19.0 }
    ] }
  },
  justtrade: {
    direkt: { typ: 'free-ab', ab: 500, sonst: { typ: 'fixed', wert: 1.0 } },
    xetra: { typ: 'fixed', wert: 5.0 }
  },
  traderepublic: {
    direkt: { typ: 'fixed', wert: 1.0 },
    xetra: { typ: 'fixed', wert: 1.0 }
  },
  scalablecapital: {
    direkt: { typ: 'fixed', wert: 0.99 },
    xetra: { typ: 'fixed', wert: 0.99 }
  },
  flatex: {
    direkt: { typ: 'fixed', wert: 5.9 },
    xetra: { typ: 'fixed', wert: 5.9 }
  },
  comdirect: {
    direkt: { typ: 'percent', fix: 4.9, prozent: 0.25, min: 9.9, max: 59.9 },
    xetra: { typ: 'percent', fix: 4.9, prozent: 0.25, min: 9.9, max: 59.9, boersenplatz: 2.9 }
  },
  ing: {
    direkt: { typ: 'percent', fix: 4.9, prozent: 0.25, min: 9.9, max: 69.9 },
    xetra: { typ: 'percent', fix: 4.9, prozent: 0.25, min: 9.9, max: 69.9, boersenplatz: 2.9 }
  },
  consorsbank: {
    direkt: { typ: 'percent', fix: 4.95, prozent: 0.25, min: 9.95, max: 69.0 },
    xetra: { typ: 'percent', fix: 4.95, prozent: 0.25, min: 9.95, max: 69.0, boersenplatz: 2.95 }
  },
  commerzbank: {
    direkt: { typ: 'percent', fix: 4.9, prozent: 0.25, min: 9.9, max: 59.9 },
    xetra: { typ: 'percent', fix: 4.9, prozent: 0.25, min: 9.9, max: 59.9, boersenplatz: 2.9 }
  },
  dkb: {
    direkt: { typ: 'fixed', wert: 10.0 },
    xetra: { typ: 'fixed', wert: 10.0 }
  },
  interactivebrokers: {
    direkt: { typ: 'percent', fix: 0.0, prozent: 0.05, min: 1.25, max: 29.0 },
    xetra: { typ: 'percent', fix: 0.0, prozent: 0.05, min: 1.25, max: 29.0 }
  }
};

function berechneOrderGebuehrNachModell(orderwert, modell) {
  if (!modell || orderwert <= 0) return 0;
  if (modell.typ === 'fixed') {
    return Math.max(0, modell.wert || 0);
  }
  if (modell.typ === 'staffel') {
    const stufen = Array.isArray(modell.stufen) ? modell.stufen : [];
    for (const stufe of stufen) {
      if (orderwert <= stufe.bis) {
        return Math.max(0, stufe.gebuehr || 0);
      }
    }
    return 0;
  }
  if (modell.typ === 'free-ab') {
    if (orderwert >= (modell.ab || 0)) return 0;
    return berechneOrderGebuehrNachModell(orderwert, modell.sonst);
  }
  if (modell.typ === 'percent') {
    const fix = modell.fix || 0;
    const prozent = modell.prozent || 0;
    const boersenplatz = modell.boersenplatz || 0;
    let gebuehr = fix + (orderwert * prozent / 100) + boersenplatz;
    if (typeof modell.min === 'number') gebuehr = Math.max(modell.min, gebuehr);
    if (typeof modell.max === 'number') gebuehr = Math.min(modell.max, gebuehr);
    return Math.max(0, gebuehr);
  }
  return 0;
}

function berechneOrderGebuehr(orderwert, broker) {
  if (orderwert <= 0) return 0;

  if (broker === 'custom') {
    const fixkosten = parseFloat(localStorage.getItem('fixkosten') || 0);
    const variableGebuehr = parseFloat(localStorage.getItem('variableGebuehr') || 0);
    return Math.max(0, fixkosten + (orderwert * variableGebuehr / 100));
  }

  const modell = BROKER_GEBUEHREN_MODELLE[broker];
  if (!modell) {
    const fixkosten = parseFloat(localStorage.getItem('fixkosten') || 0);
    const variableGebuehr = parseFloat(localStorage.getItem('variableGebuehr') || 0);
    return Math.max(0, fixkosten + (orderwert * variableGebuehr / 100));
  }

  const ausfuehrung = localStorage.getItem('orderAusfuehrung') || 'auto';
  if (ausfuehrung === 'direkthandel') {
    return berechneOrderGebuehrNachModell(orderwert, modell.direkt);
  }
  if (ausfuehrung === 'xetra') {
    return berechneOrderGebuehrNachModell(orderwert, modell.xetra);
  }

  const direktGebuehr = berechneOrderGebuehrNachModell(orderwert, modell.direkt);
  const xetraGebuehr = berechneOrderGebuehrNachModell(orderwert, modell.xetra);
  return Math.min(direktGebuehr, xetraGebuehr);
}

function berechneGesamtGebuehren(einstieg, stueck, ziel, broker) {
  const kaufwert = Math.max(0, einstieg * stueck);
  const verkaufswert = Math.max(0, ziel * stueck);
  const kaufGebuehr = berechneOrderGebuehr(kaufwert, broker);
  const verkaufsGebuehr = berechneOrderGebuehr(verkaufswert, broker);
  return kaufGebuehr + verkaufsGebuehr;
}

function berechneBreakEvenKurs(einstieg, stueck, broker) {
  if (einstieg <= 0 || stueck <= 0) return einstieg || 0;

  const kaufwert = einstieg * stueck;
  const kaufGebuehr = berechneOrderGebuehr(kaufwert, broker);
  const nettoBeiKurs = (kurs) => {
    const brutto = (kurs - einstieg) * stueck;
    const verkaufsGebuehr = berechneOrderGebuehr(kurs * stueck, broker);
    return brutto - kaufGebuehr - verkaufsGebuehr;
  };

  if (nettoBeiKurs(einstieg) >= 0) return einstieg;

  let low = einstieg;
  let high = Math.max(einstieg * 1.05, einstieg + 0.01);
  let guard = 0;
  while (nettoBeiKurs(high) < 0 && guard < 60) {
    high *= 1.35;
    guard += 1;
  }

  for (let i = 0; i < 40; i++) {
    const mid = (low + high) / 2;
    if (nettoBeiKurs(mid) >= 0) {
      high = mid;
    } else {
      low = mid;
    }
  }

  return high;
}

function aendereBroker() {
  const broker = document.getElementById('brokerAuswahl').value;
  const fixkostenInput = document.getElementById('fixkosten');
  const variableInput = document.getElementById('variableGebuehr');
  const feesDescription = document.getElementById('feesDescription');
  
  switch(broker) {
    case 'finanzenzero':
      fixkostenInput.value = '0.00';
      variableInput.value = '0';
      fixkostenInput.disabled = true;
      variableInput.disabled = true;
      break;
    case 'smartbrokerplus':
      fixkostenInput.value = '0.00';
      variableInput.value = '0';
      fixkostenInput.disabled = true;
      variableInput.disabled = true;
      break;
    case 'justtrade':
      fixkostenInput.value = '0.00';
      variableInput.value = '0';
      fixkostenInput.disabled = true;
      variableInput.disabled = true;
      break;
    case 'traderepublic':
      fixkostenInput.value = '1.00';
      variableInput.value = '0';
      fixkostenInput.disabled = true;
      variableInput.disabled = true;
      break;
    case 'scalablecapital':
      fixkostenInput.value = '0.99';
      variableInput.value = '0';
      fixkostenInput.disabled = true;
      variableInput.disabled = true;
      break;
    case 'flatex':
      fixkostenInput.value = '5.90';
      variableInput.value = '0';
      fixkostenInput.disabled = true;
      variableInput.disabled = true;
      break;
    case 'comdirect':
      fixkostenInput.value = '4.90';
      variableInput.value = '0.25';
      fixkostenInput.disabled = true;
      variableInput.disabled = true;
      break;
    case 'ing':
      fixkostenInput.value = '4.90';
      variableInput.value = '0.25';
      fixkostenInput.disabled = true;
      variableInput.disabled = true;
      break;
    case 'consorsbank':
      fixkostenInput.value = '4.95';
      variableInput.value = '0.25';
      fixkostenInput.disabled = true;
      variableInput.disabled = true;
      break;
    case 'commerzbank':
      fixkostenInput.value = '4.90';
      variableInput.value = '0.25';
      fixkostenInput.disabled = true;
      variableInput.disabled = true;
      break;
    case 'dkb':
      fixkostenInput.value = '10.00';
      variableInput.value = '0.25';
      fixkostenInput.disabled = true;
      variableInput.disabled = true;
      break;
    case 'interactivebrokers':
      fixkostenInput.value = '1.25';
      variableInput.value = '0.05';
      fixkostenInput.disabled = true;
      variableInput.disabled = true;
      break;
    case 'custom':
      fixkostenInput.disabled = false;
      variableInput.disabled = false;
      break;
  }

  if (feesDescription) {
    if (broker === 'custom') {
      feesDescription.textContent = 'Ordergebühren deines Brokers. Diese werden sowohl beim Kauf als auch beim Verkauf berücksichtigt.';
    } else {
      feesDescription.textContent = 'Für diesen Broker wird ein Ordermodell mit Direkthandel/Xetra, Mindestorderwerten und ggf. Staffel-/Min-/Max-Preis automatisch berücksichtigt.';
    }
  }
  
  // Speichere Broker-Auswahl und Gebühren
  localStorage.setItem('broker', broker);
  speichereGebuehren();
}

function speichereGebuehren() {
  const fixkosten = document.getElementById('fixkosten').value;
  const variableGebuehr = document.getElementById('variableGebuehr').value;
  
  localStorage.setItem('fixkosten', fixkosten);
  localStorage.setItem('variableGebuehr', variableGebuehr);
}

// Prognose Parameter speichern und laden
function speicherePrognoseParameter() {
  const inflationsrate = document.getElementById('inflationsrate').value;
  const jaehrlicheDynamik = document.getElementById('jaehrlicheDynamik').value;
  
  localStorage.setItem('inflationsrate', inflationsrate);
  localStorage.setItem('jaehrlicheDynamik', jaehrlicheDynamik);
  
  // Sparrechner neu berechnen wenn aktiv
  if (document.getElementById('sparen').classList.contains('active')) {
    berechneSpar();
  }
}

function ladePrognoseParameter() {
  const gespeicherteInflation = localStorage.getItem('inflationsrate');
  const gespeicherteDynamik = localStorage.getItem('jaehrlicheDynamik');
  
  if (gespeicherteInflation !== null) {
    document.getElementById('inflationsrate').value = gespeicherteInflation;
  }
  if (gespeicherteDynamik !== null) {
    document.getElementById('jaehrlicheDynamik').value = gespeicherteDynamik;
  }
}

function ladeGebuehren() {
  // Lade gespeicherten Broker
  const gespeicherterBroker = localStorage.getItem('broker') || 'custom';
  document.getElementById('brokerAuswahl').value = gespeicherterBroker;
  
  // Lade gespeicherte Gebühren
  const fixkosten = localStorage.getItem('fixkosten');
  const variableGebuehr = localStorage.getItem('variableGebuehr');
  
  if (fixkosten !== null) {
    document.getElementById('fixkosten').value = fixkosten;
  }
  if (variableGebuehr !== null) {
    document.getElementById('variableGebuehr').value = variableGebuehr;
  }
  
  // Wende Broker-Einstellungen an
  aendereBroker();
}

// Login/Registrierung System
let istLoginModus = true;
let aktuelleWaehrung = 'EUR';
let waehrungsSymbole = {
  'EUR': '€', 'USD': '$', 'GBP': '£', 'CHF': 'Fr', 'JPY': '¥', 'AUD': 'A$',
  'CAD': 'C$', 'NZD': 'NZ$', 'SEK': 'kr', 'NOK': 'kr', 'DKK': 'kr', 'PLN': 'zł',
  'CZK': 'Kč', 'HUF': 'Ft', 'RON': 'lei', 'BGN': 'лв', 'HRK': 'kn', 'TRY': '₺',
  'INR': '₹', 'BRL': 'R$', 'MXN': '$', 'ZAR': 'R', 'KRW': '₩', 'SGD': 'S$',
  'HKD': 'HK$', 'CNY': '¥', 'THB': '฿', 'MYR': 'RM', 'IDR': 'Rp', 'PHP': '₱',
  'VND': '₫', 'AED': 'د.إ', 'ILS': '₪', 'RUB': '₽', 'ARS': '$', 'CLP': '$', 'COP': '$'
};

// Sprachsystem
let aktuelleSprache = 'de';
const uebersetzungen = {
  de: {
    // Navigation
    home: 'Home',
    trading: 'Trading',
    sparen: 'Sparen',
    etf: 'ETF Vergleich',
    settings: 'Einstellungen',
    
    // Home
    heroTitle: 'Professionelles Trading.<br>Einfach kalkuliert.',
    heroSubtitle: 'Berechne deine Trades präzise, plane langfristig und maximiere deine Rendite – alles in einem Tool. Mit optionalem Pro-Account für erweiterte Features.',
    startNow: 'Jetzt starten',
    learnMore: 'Mehr erfahren',
    
    // Features
    tradingCalculator: 'Trading Rechner',
    tradingDesc: 'Berechne Gewinne, Renditen, Break-Even, CRV und mehr. Mit Hebel-Funktion, Stop-Loss und präzisen Steuer- und Gebührenberechnungen.',
    savingsCalculator: 'Sparrechner',
    savingsDesc: 'Plane deine finanzielle Zukunft mit intelligenten Sparraten, Zinseszins-Berechnungen und Inflations-Analysen (Pro).',
    proAccount: 'Pro Account',
    proDesc: 'Unbegrenzte Trades, ETF-Datenbank, Inflations- & Steuerrechner, PDF/CSV Export und werbefrei – für nur 1,99€/Monat.',
    
    // Settings
    appearance: 'Erscheinungsbild',
    language: 'Sprache',
    currency: 'Währung',
    dataManagement: 'Daten verwalten',
    exportData: 'Daten exportieren',
    legal: 'Rechtliches',
    feedback: 'Feedback Portal',
    feedbackDesc: 'Teile deine Ideen und hilf uns, Trade zu verbessern',
    feedbackSupportHeading: 'FEEDBACK & SUPPORT',
    positionNameOptionalLabel: 'Positions-Name (Optional)',
    positionNamePlaceholder: 'z. B. Apple Long, Bitcoin Short...',
    
    // Feedback
    feedbackTitle: 'Dein Feedback ist wertvoll',
    feedbackSubtitle: 'Hilf uns, Trade zu verbessern. Teile deine Ideen, Wünsche oder melde Probleme. Jedes Feedback wird gelesen und berücksichtigt.',
    name: 'Name',
    nameOptional: 'Name (optional)',
    email: 'E-Mail',
    emailOptional: 'E-Mail (optional)',
    category: 'Kategorie',
    message: 'Deine Nachricht',
    messagePlaceholder: 'Beschreibe dein Feedback so detailliert wie möglich...',
    categoryFeature: '💡 Feature-Wunsch',
    categoryBug: '🐛 Bug-Meldung',
    categoryImprovement: '🛠 Verbesserungsvorschlag',
    categoryDesign: '🎨 Design-Feedback',
    categoryOther: '📝 Sonstiges',
    privacyNotice: 'Datenschutz:',
    privacyText: 'Deine Angaben werden vertraulich behandelt und nur zur Verbesserung von Trade verwendet. E-Mail und Name sind optional.',
    sendFeedback: 'Feedback senden',
    thankYou: 'Vielen Dank!',
    feedbackSuccess: 'Dein Feedback wurde erfolgreich übermittelt. Wir schätzen deine Meinung sehr und werden sie bei der Weiterentwicklung berücksichtigen.',
    backToHome: 'Zurück zur Startseite',
    
    // Trading
    tradeCalculation: 'Trade-Berechnung',
    entryPrice: 'Einstiegskurs',
    quantity: 'Stückzahl',
    targetPrice: 'Zielkurs',
    stopLoss: 'Stop-Loss',
    leverage: 'Hebel',
    position: 'Position',
    long: 'Long',
    short: 'Short',
    calculate: 'Berechnen',
    profit: 'Gewinn',
    return: 'Rendite',
    saveTrade: 'Trade speichern',
    investment: 'Investition',
    fees: 'Gebühren',
    taxes: 'Steuern',
    netProfit: 'Netto-Gewinn',
    gross: 'Brutto',
    net: 'Netto',
    addBuy: 'Nachkauf hinzufügen',
    partialSell: 'Teilverkauf',
    pieces: 'Stk.',
    breakEven: 'Break-Even Kurs',
    crv: 'CRV (Chance-Risiko)',
    
    // Sparen
    savingsGoal: 'Sparziel',
    monthlySavings: 'Monatliche Sparrate',
    duration: 'Laufzeit',
    interestRate: 'Zinssatz',
    years: 'Jahre',
    finalCapital: 'Endkapital',
    initialCapital: 'Startkapital',
    totalContributions: 'Gesamteinzahlungen',
    interestEarned: 'Zinsen',
    realValue: 'Realwert',
    inflationRate: 'Inflationsrate',
    yearlyIncrease: 'Jährliche Dynamik',
    contributions: 'Einzahlungen',
    pureInterest: 'Reiner Zins',
    realValueInflation: 'Realwert (Inflationsber.)',
    moreDetails: 'Mehr Details mit Calculo Pro',
    seeRealValue: 'Sieh Realwert und Steuern deiner Sparpläne',
    upgradeFor: 'Upgrade für 1,99€/Monat',
    anytime: 'Jederzeit kündbar',
    
    // ETF
    etfDatabase: 'ETF Datenbank',
    etfComparison: 'ETF Vergleich',
    searchETF: 'ETF suchen...',
    selectETF: 'ETF auswählen',
    performance: 'Performance',
    year1: '1 Jahr',
    year3: '3 Jahre',
    year5: '5 Jahre',
    year10: '10 Jahre',
    ter: 'TER (Kosten)',
    description: 'Beschreibung',
    avgReturn: 'Ø Rendite p.a.',
    proFeature: 'PRO FEATURE',
    compareHistorical: 'Vergleiche historische Durchschnittsrenditen beliebter ETFs',
    unlockETF: 'ETF Datenbank freischalten',
    accessHistorical: 'Zugriff auf historische Daten der letzten 10 Jahre. Vergleiche Performance, TER und simuliere deinen Sparplan.',
    upgradeNow: 'Jetzt upgraden für 1,99€/Monat',
    popularETFs: 'Beliebte ETFs',
    descending: 'Absteigend',
    ascending: 'Aufsteigend',
    sortBy: 'Sortieren nach',
    sortByName: 'Sortieren nach: Name',
    sortByReturn1Y: 'Sortieren nach: Rendite 1 Jahr',
    sortByReturn3Y: 'Sortieren nach: Rendite 3 Jahre',
    sortByReturn5Y: 'Sortieren nach: Rendite 5 Jahre',
    sortByReturn10Y: 'Sortieren nach: Rendite 10 Jahre',
    sortByTER: 'Sortieren nach: Kosten (TER)',
    whatIsTER: 'Was ist TER?',
    returnComparison: 'Renditen-Vergleich (10 Jahre)',
    selectedETFs: 'ETFs ausgewählt',
    selectedETFsOfTwo: 'von 2 ETFs ausgewählt',
    selectUpTo2: 'Wähle bis zu 2 ETFs aus der Liste unten aus, um sie zu vergleichen',
    noETFsFound: 'Keine ETFs gefunden',
    tryDifferent: 'Versuche einen anderen Suchbegriff',
    noteHistorical: 'Hinweis: Die angegebenen Renditen sind historische Durchschnittswerte und keine Garantie für zukünftige Entwicklungen. TER = Total Expense Ratio (Gesamtkostenquote). Alle Angaben ohne Gewähr.',
    category: 'Kat.',
    etfDetailsTitle: 'ETF Details',
    etfSelected: '✓ Ausgewählt',
    toComparison: 'Zum Vergleich',
    etfTrustedBy: 'Vertraut von Tausenden',
    etfUnlockHeadline: 'Pro-Features freischalten',
    etfUnlockSubheading: 'Nutze die volle Kraft von 1.247 professionellen ETFs mit 10 Jahren Daten, unbegrenzte Vergleiche und erweiterte Analysen – für weniger als ein Kaffee pro Monat.',
    etfStatHistorical: 'Historische Daten',
    etfStatEtfs: 'Professionelle ETFs',
    etfStatCompare: 'Vergleiche ohne Limit',
    etfStatProfitability: 'Sichere Rentabilität',
    etfUpgradeCta: 'Jetzt upgraden – 1,99€/Monat',
    etfTrustCancelable: 'Jederzeit kündbar',
    etfTrustFreeDays: '3 Tage kostenlos',
    etfTrustAllFeatures: 'Alle Features sofort',
    etfTrustPrivacy: 'Sicherer Datenschutz',
    etfExpectTitle: 'Das erwartet dich',
    etfFeature1Title: '📈 Rendite-Analysen',
    etfFeature1Desc: 'Professionelle Charts mit 10 Jahren vollständiger Kurshistorie. Erkenne Trends und Muster auf den ersten Blick.',
    etfFeature2Title: '🧩 Vergleich-Tool',
    etfFeature2Desc: 'Vergleiche unbegrenzt viele ETFs nebeneinander. Renditen, Gebühren, Risiken auf einen Blick.',
    etfFeature3Title: '💸 Sparplan-Simulator',
    etfFeature3Desc: 'Teste Sparstrategien mit echten Daten. Sieh exakt, wohin dein Geld fließt und wie du profitierst.',
    etfFeature4Title: '📊 Portfolio-Tracking',
    etfFeature4Desc: 'Behalte deine Investments im Blick. Automatische Performance-Analyse und detaillierte Übersichten.',
    etfPreviewTitle: 'Vorschau: So sieht deine Datenbank aus (unscharfes Vorschaubild)',
    etfSample1Desc: 'Weltweite Aktien – 3.500+ Unternehmen',
    etfSample2Desc: 'US Tech & Growth – 500 Top-Unternehmen',
    etfSample3Desc: 'Tech-fokussiert – 100 größte Konzerne',
    etfInfoTitle: '✨ Vollständige Analysen',
    etfInfoDesc: 'Filter nach Kosten, Regionen, Branchen & mehr – alle 1.247 ETFs mit detaillierten Kennzahlen',
    etfPreviewMore: '+ 1.244 weitere ETFs mit vollständigen Daten',
    etfPreviewAvailableAfter: 'Alle verfügbar nach dem Upgrade',
    etfAvg10y: '10 Jahre Ø',
    etfStatHistoricalHtml: 'Historische<br>Daten',
    etfStatEtfsHtml: 'Professionelle<br>ETFs',
    etfStatCompareHtml: 'Detaillierte<br>Analysen',
    etfStatProfitabilityHtml: 'Sichere<br>Rentabilität',
    etfTrustCancelableHtml: 'Jederzeit<br>kündbar',
    etfTrustFreeDaysHtml: '3 Tage<br>kostenlos',
    etfTrustAllFeaturesHtml: 'Alle Features<br>sofort',
    etfTrustPrivacyHtml: 'Sicherer<br>Datenschutz',
    
    // Settings
    appearance: 'Erscheinungsbild',
    language: 'Sprache',
    currency: 'Währung',
    dataManagement: 'Daten verwalten',
    exportData: 'Daten exportieren',
    legal: 'Rechtliches',
    feedback: 'Feedback Portal',
    feedbackDesc: 'Teile deine Ideen und hilf uns, Trade zu verbessern',
    theme: 'Design',
    system: 'System',
    light: 'Hell',
    dark: 'Dunkel',
    currencyTools: 'Währung & Tools',
    leverageFunction: 'Hebel-Funktion',
    analysisValues: 'Analyse-Werte',
    taxesDE: 'Steuern (DE)',
    taxFreeAmount: 'Jahres-Freibetrag',
    taxRate: 'Steuersatz',
    alreadyUsed: 'Bereits verwendet',
    broker: 'Broker',
    currentBroker: 'Aktueller Broker',
    custom: 'Benutzerdefiniert',
    forecastParameters: 'Prognose Parameter',
    fixedCosts: 'Fixkosten',
    variableFee: 'Variable Gebühr',
    proAccountTitle: 'PRO ACCOUNT',
    tradePro: 'Trade Pro',
    advancedFeatures: 'Erweiterte Funktionen für ernsthafte Trader',
    unlimitedTrades: 'Unbegrenzte Trades',
    saveAsMany: 'Speichere so viele Trades wie du möchtest',
    etfDatabaseAccess: 'ETF Datenbank',
    accessHistoricalReturns: 'Zugriff auf historische Durchschnittsrenditen',
    inflationTaxCalc: 'Inflations- & Steuerrechner',
    preciseCalculation: 'Präzise Berechnung mit Steuern und Inflation',
    pdfCsvExport: 'PDF/CSV Export',
    exportCalculations: 'Exportiere deine Berechnungen',
    adFree: 'Werbefrei',
    noAds: 'Keine störenden Werbebanner',
    perMonth: 'pro Monat',
    perYear: 'pro Jahr',
    trialDays: '3 Tage kostenlos testen',
    trialInfo: '3 Tage kostenlos – Jederzeit kündbar',
    afterTrial: 'Nach der Testphase 1,99€/Monat oder 18,99€/Jahr',
    monthsFree: '2 Monate gratis',
    noPaymentDuringTrial: 'Keine Zahlung während der Testphase. Jederzeit kündbar.',
    upgradeNowBtn: 'Jetzt upgraden',
    cancelAnytime: 'Jederzeit kündbar',
    active: 'AKTIV',
    allPremium: 'Alle Premium-Features freigeschaltet',
    cancelPro: 'Pro kündigen',
    chooseTheme: 'Wähle zwischen hellem, dunklem oder dem System-Modus.',
    leverageDesc: 'Die Hebel-Funktion ermöglicht die Berechnung von Derivaten (Long/Short).',
    breakEvenPrice: 'Break-Even Kurs',
    crvRatio: 'CRV (Chance-Risiko)',
    breakEvenDesc: 'Break-Even zeigt den Kurs, ab dem du inkl. Gebühren im Plus bist. CRV bewertet das Verhältnis von Gewinnziel zu Stop-Loss.',
    breakEvenModalTitle: 'Break-Even',
    breakEvenModalDesc: 'Der Kurs, bei dem dein Trade unter Berücksichtigung aller Kauf- und Verkaufsgebühren genau bei 0€ Gewinn/Verlust landet. Ab diesem Punkt bist du in der Gewinnzone.',
    crvModalTitle: 'CRV – Chance-Risiko-Verhältnis',
    crvModalDesc: 'Das Verhältnis deines potenziellen Gewinns zum Risiko (Abstand zum Stop-Loss). Ein CRV von 2.0 bedeutet, dass dein Zielgewinn doppelt so hoch ist wie dein mögliches Verlustrisiko.',
    understood: 'Verstanden',
    remaining2026: 'Verbleibend 2026',
    used: 'verbraucht',
    yearlyAllowance: 'Jahres-Freibetrag',
    taxInfo: 'In Deutschland liegt die Abgeltungssteuer inkl. Soli bei 26,375%. Der Freibetrag von 1.000€ erneuert sich automatisch am 1. Januar jeden Jahres. Gespeicherte Trades werden automatisch dem jeweiligen Jahr zugeordnet.',
    capitalGainsTaxWithSoli: 'Abgeltungssteuer inkl. Soli',
    taxInfoWithAllowance: 'In {country} liegt die {taxLabel} bei {rate}%. Der Freibetrag von {allowance} erneuert sich automatisch am 1. Januar jeden Jahres. Gespeicherte Trades werden automatisch dem jeweiligen Jahr zugeordnet.',
    taxInfoNoAllowance: 'In {country} liegt die {taxLabel} bei {rate}%. Gespeicherte Trades werden automatisch dem jeweiligen Jahr zugeordnet.',
    taxFaqBase: 'Die {taxLabel} in {country} betraegt {rate}%.',
    taxFaqAllowance: 'Der Freibetrag von {allowance} pro Jahr wird automatisch beruecksichtigt.',
    sparAssetDevelopment: 'VERMÖGENSENTWICKLUNG',
    sparCalculationMode: 'BERECHNUNGSMODUS',
    sparDeposits: 'Einzahlungen',
    sparPureInterest: 'REINER ZINS',
    crvRatioLabel: 'CRV (CHANCE/RISIKO)',
    totalCapital: 'Gesamtkapital',
    depositsDesc: 'Summe aus Startkapital und Sparraten inkl. Dynamik.',
    pureInterestDesc: 'Der gesamte Gewinn durch Verzinsung und Zinseszins.',
    requiredRate: 'BENÖTIGTE RATE',
    
    // ETF
    zeroETFs: '(0 ETFs)',
    terModalDesc: 'Die Total Expense Ratio (Gesamtkostenquote) gibt die jährlichen laufenden Kosten eines ETFs an.',
    terExampleLabel: 'BEISPIEL',
    terExample: 'Bei einem TER von 0,20% und einem Investment von 10.000€ zahlst du 20€ pro Jahr an Gebühren.',
    lowerTERBetter: 'Niedriger TER = Besser für dich!',
    terIncludes: 'Die TER umfasst Verwaltungsgebühren, Betriebskosten und andere laufende Ausgaben. Sie wird automatisch vom Fondsvermögen abgezogen und ist bereits in der Wertentwicklung berücksichtigt.',
    
    // Settings - Broker
    brokerHeading: 'BROKER',
    currentBrokerLabel: 'Aktueller Broker',
    customBroker: 'Benutzerdefiniert',
    
    // Settings - Forecast Parameters
    forecastParametersHeading: 'PROGNOSE PARAMETER',
    inflationRateLabel: 'Inflationsrate',
    yearlyIncreaseLabel: 'Jährliche Dynamik',
    forecastDescription: 'Die Inflationsrate wird für die Realwertberechnung im Sparrechner verwendet. Die jährliche Dynamik erhöht deine Sparrate automatisch um den angegebenen Prozentsatz pro Jahr.',
    brokerFinanzenZero: 'Finanzen.net Zero',
    brokerSmartbrokerPlus: 'Smartbroker+',
    brokerJustTrade: 'justTRADE',
    brokerTradeRepublic: 'Trade Republic',
    brokerScalableCapital: 'Scalable Capital',
    brokerFlatex: 'Flatex',
    brokerComdirect: 'Comdirect',
    brokerIng: 'ING',
    brokerConsorsbank: 'Consorsbank',
    brokerCommerzbank: 'Commerzbank',
    brokerDkb: 'DKB',
    brokerInteractiveBrokers: 'Interactive Brokers',
    
    // Login/Register
    loginBtn: 'Anmelden',
    loginModalTitle: 'Anmelden',
    loginTab: 'Anmelden',
    registerTab: 'Registrieren',
    emailLabel: 'E-Mail Adresse',
    emailPlaceholder: 'deine@email.de',
    passwordLabel: 'Passwort',
    passwordPlaceholder: '••••••••',
    acceptTerms: 'Ich akzeptiere die',
    termsLink: 'Nutzungsbedingungen',
    andThe: 'und die',
    privacyLink: 'Datenschutzerklärung',
    loginSubmit: 'Anmelden',
    registerSubmit: 'Registrieren',
    
    // Settings - Fees
    feesHeading: 'GEBÜHREN',
    fixedCostsLabel: 'Fixkosten',
    variableFeeLabel: 'Variable Gebühr',
    feesDescription: 'Ordergebühren deines Brokers. Diese werden sowohl beim Kauf als auch beim Verkauf berücksichtigt.',
    
    // Settings - Legal
    legalHeading: 'RECHTLICHES',
    aboutTradeTitle: 'Über Trade',
    aboutTradeDescription: 'Trade ist ein kostenloser Trading-Rechner für private Trader und Investoren. Die App bietet präzise Berechnungen für Trading, Sparen und Investments mit automatischer Steuerberechnung.',
    supportEmail: 'Support:',
    version: 'Version:',
    privacyPolicy: 'Datenschutzerklärung',
    privacyPolicyDesc: 'Erfahre, wie wir deine Daten schützen',
    termsOfService: 'Nutzungsbedingungen',
    termsOfServiceDesc: 'Lies unsere allgemeinen Geschäftsbedingungen',
    imprint: 'Impressum',
    imprintDesc: 'Rechtliche Informationen zum Anbieter',
    termsTitle: 'Nutzungsbedingungen',
    privacyTitle: 'Datenschutzerklärung',
    imprintTitle: 'Impressum',
    termsHtml: `
      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Anbieter und Kontakt</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Anbieter dieser Website und des Tools ist LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG, Bizetstrasse 111, 13088 Berlin, Deutschland. Kontakt: [E-Mail Platzhalter], [Telefon Platzhalter]. Handelsregister: [Platzhalter], Vertretungsberechtigte: Leonard George Toader, Pepe Rene Cruz, Thomas Markendorf.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. Geltungsbereich</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Diese Nutzungsbedingungen regeln die Nutzung der Website "Calculo" und der darin enthaltenen Rechner und Funktionen (nachfolgend "Tool"). Mit der Nutzung des Tools akzeptierst du diese Bedingungen.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Leistungen des Tools</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Das Tool stellt Berechnungen und Informationen fuer Trading, Sparen und Investments bereit. Die Inhalte dienen ausschliesslich der Information und ersetzen keine individuelle Beratung.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. Keine Anlage-, Steuer- oder Rechtsberatung</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Alle Berechnungen erfolgen ohne Gewaehr. Das Tool stellt keine Anlageberatung, Steuerberatung oder Rechtsberatung dar. Fuer verbindliche Auskuenfte konsultiere bitte qualifizierte Fachleute.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. Registrierung und lokale Speicherung</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Sofern eine Registrierung angeboten wird, erfolgt diese ueber Firebase Auth. Dabei werden E-Mail und Passwort (verschluesselt) sowie Profilangaben wie das Land gespeichert. Weitere App-Daten koennen lokal im Browser gespeichert werden.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. Nutzerpflichten</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Du bist fuer die Richtigkeit deiner Eingaben verantwortlich und nutzt das Tool auf eigenes Risiko. Du darfst das Tool nicht missbraeuchlich nutzen, insbesondere nicht zur Stoerung, Manipulation oder Umgehung von Sicherheitsfunktionen.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Verfuegbarkeit und Aenderungen</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Wir bemuehen uns um eine hohe Verfuegbarkeit, garantieren diese jedoch nicht. Wir duerfen Funktionen jederzeit aendern, einschranken oder einstellen.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Pro-Account und Preise</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Ein Pro-Account ist optional und bietet erweiterte Funktionen. Der aktuelle Preis und die Konditionen werden im Tool angezeigt (z. B. 1,99 EUR/Monat). Ein Abonnement kann jederzeit gekuendigt werden; Pro-Funktionen werden danach deaktiviert.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">9. Haftung</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Wir haften nicht fuer Schaeden, die aus der Nutzung oder Nichtnutzung des Tools entstehen, insbesondere nicht fuer finanzielle Verluste aufgrund von Berechnungen oder Entscheidungen. Zwingende gesetzliche Haftung bleibt unberuehrt.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">10. Schlussbestimmungen</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Es gilt deutsches Recht. Sofern gesetzlich zulaessig, ist Gerichtsstand Berlin. Sollte eine Bestimmung unwirksam sein, bleibt die Wirksamkeit der uebrigen Regelungen unberuehrt.
      </p>

      <p style="color:var(--muted);font-size:12px;margin-top:24px">Stand: <span data-last-updated="true"></span></p>
    `,
    privacyHtml: `
      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Verantwortlicher</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Verantwortlich fuer die Datenverarbeitung ist LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG, Bizetstrasse 111, 13088 Berlin, Deutschland. Kontakt: [E-Mail Platzhalter], [Telefon Platzhalter].
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. Allgemeine Hinweise</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Der Schutz deiner Daten ist uns wichtig. Diese Datenschutzerklaerung erklaert, welche Daten im Rahmen der Nutzung des Tools verarbeitet werden.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Verarbeitete Daten</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Verarbeitet werden die von dir eingegebenen Daten, die fuer Anmeldung und Profil noetig sind (z. B. E-Mail, Passwort-Hash, Land) sowie optional lokal gespeicherte Einstellungen.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. Lokale Speicherung</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Account-Daten werden in der Cloud (Firebase/Firestore) gespeichert. Lokale App-Daten koennen im Browser gespeichert werden.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. Keine Drittanbieter, kein Tracking</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Es werden keine Tracking- oder Analyse-Tools eingesetzt. Fuer Anmeldung und Profildaten nutzen wir Firebase (Google) als Dienstleister.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. Datensicherheit</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Wir setzen technische und organisatorische Massnahmen ein, um Account-Daten zu schuetzen. Bitte schuetze zusaetzlich dein Geraet und deine Zugangsdaten.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Deine Rechte</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Du kannst deine Account-Daten loeschen oder berichtigen lassen. Lokal gespeicherte Daten kannst du in den Browser-Einstellungen entfernen. Bei Fragen erreichst du uns ueber die genannten Kontaktdaten.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Aenderungen</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Diese Datenschutzerklaerung kann bei Bedarf aktualisiert werden. Aenderungen werden im Tool bekanntgegeben.
      </p>

      <p style="color:var(--muted);font-size:12px;margin-top:24px">Stand: <span data-last-updated="true"></span></p>
    `,
    imprintHtml: `
      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Angaben gemaess § 5 TMG</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG<br>
        Bizetstrasse 111<br>
        13088 Berlin<br>
        Deutschland
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. Kontakt</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        E-Mail: [E-Mail Platzhalter]<br>
        Telefon: [Telefon Platzhalter]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Registereintrag</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Handelsregister: [Platzhalter]<br>
        Registergericht: [Platzhalter]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. Vertretungsberechtigte</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Leonard George Toader, Pepe Rene Cruz, Thomas Markendorf
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. Umsatzsteuer-ID</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Umsatzsteuer-Identifikationsnummer gemaess § 27 a UStG: [Platzhalter]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. Verantwortlich fuer den Inhalt</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        [Platzhalter gemaess § 18 Abs. 2 MStV]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Haftung fuer Inhalte</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Die Inhalte unserer Seiten und der App wurden mit groesster Sorgfalt erstellt. Fuer die Richtigkeit, Vollstaendigkeit und Aktualitaet der Inhalte koennen wir jedoch keine Gewaehr uebernehmen.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Haftung fuer Links</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Diese Website kann Links zu externen Webseiten Dritter enthalten. Auf deren Inhalte haben wir keinen Einfluss. Fuer die Inhalte der verlinkten Seiten ist stets der jeweilige Anbieter verantwortlich.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">9. Hinweis zu Finanzinformationen</h3>
      <div style="background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:12px;padding:20px;margin-bottom:16px">
        <p style="color:var(--text);font-size:14px;line-height:1.7;font-weight:600;margin-bottom:8px">
          Wichtiger Hinweis: Keine Finanz- oder Anlageberatung
        </p>
        <p style="color:var(--text);font-size:13px;line-height:1.7">
          Die auf dieser Website bereitgestellten Informationen und Tools dienen ausschliesslich Informationszwecken und stellen keine Empfehlung zum Kauf oder Verkauf von Finanzinstrumenten dar. Ebenso erfolgt keine Steuer- oder Rechtsberatung.
        </p>
      </div>

      <p style="color:var(--muted);font-size:12px;margin-top:24px">Stand: <span data-last-updated="true"></span></p>
    `,
    allRightsReserved: 'Alle Rechte vorbehalten.',
    
    // Allgemein
    save: 'Speichern',
    cancel: 'Abbrechen',
    delete: 'Löschen',
    edit: 'Bearbeiten',
    close: 'Schließen',
    yes: 'Ja',
    no: 'Nein',
    optional: 'optional',
    loading: 'Lädt...',
    
    // Home - Erweitert
    financialPlanningReimagined: 'Finanzplanung neu gedacht',
    financialPlanningDesc: 'Optimiert für Trading, Sparen und Investments. Mit automatischer Steuerberechnung, Hebel-Trading, Stop-Loss Management und intuitiver Benutzeroberfläche.',
    capitalGainsTax: 'Abgeltungssteuer',
    capitalGainsTaxLabel: 'Abgeltungssteuer (26,375%)',
    taxFreeAllowance: 'Steuerfreibetrag',
    per: 'Pro',
    perMonth: 'Monat',
    perYear: 'Jahr',
    proPerMonth: 'Pro Monat',
    country: 'Land',
    countryForTax: 'Land (für Steuerberechnung)',
    taxRateInfo: 'Steuersatz',
    taxAllowanceInfo: 'Freibetrag',
    noTax: 'Keine Kapitalertragssteuer',
    howItWorks: 'Wie es funktioniert',
    step1Title: 'Werte eingeben',
    step1Desc: 'Trage deine Trading-Daten ein: Einstiegskurs, Stückzahl und Zielkurs. Optional kannst du auch Nachkäufe und Teilverkäufe simulieren.',
    step2Title: 'Automatische Berechnung',
    step2Desc: 'Das Tool berechnet automatisch deinen Netto-Gewinn unter Berücksichtigung von Broker-Gebühren und der aktuellen Kapitalertragssteuer.',
    step3Title: 'Position speichern',
    step3Desc: 'Speichere deine Trades in der Historie und behalte den Überblick über deine Performance und den verbleibenden Steuerfreibetrag.',
    step4Title: 'Performance verfolgen',
    step4Desc: 'Analysiere deine Trading-Erfolge mit detaillierten Charts und behalte alle wichtigen Kennzahlen im Blick.',
    yourAdvantages: 'Deine Vorteile',
    preciseCalculations: 'Präzise Berechnungen',
    preciseCalculationsDesc: 'Exakte Gewinnberechnungen mit Berücksichtigung aller Gebühren und Steuern.',
    dataPrivacy: '100% Datenschutz',
    dataPrivacyDesc: 'Account-Daten werden sicher in der Cloud gespeichert (Firebase). Ohne Anmeldung bleiben Daten lokal im Browser.',
    fastSpeed: 'Blitzschnell',
    fastSpeedDesc: 'Keine Ladezeiten, sofortige Berechnungen. Arbeitet komplett offline nach dem ersten Laden.',
    multiBroker: 'Multi-Broker Support',
    multiBrokerDesc: 'Vorkonfigurierte Gebührenmodelle für Finanzen.net Zero, Smartbroker+, justTRADE, Trade Republic, Scalable Capital, Flatex, Comdirect, ING, Consorsbank, Commerzbank, DKB, Interactive Brokers und benutzerdefinierte Broker.',
    tradingHistory: 'Trading Historie',
    tradingHistoryDesc: 'Speichere und verfolge all deine Trades mit detaillierten Informationen zu Gewinn, Rendite und Zeitpunkt.',
    noPositionsSaved: 'Noch keine Positionen gespeichert',
    saveFirstPosition: 'Speichere deine erste Position, um sie hier zu sehen',
    
    // Trading Modals
    addBuy: 'Nachkauf -',
    buyPrice: 'Nachkauf Kurs',
    quantity: 'Menge',
    pieces: 'Stk.',
    newAverage: 'Neuer Durchschnitt',
    invested: 'Investiert',
    confirmBuy: 'Nachkauf bestätigen',
    partialSell: 'Teilverkauf +',
    sellPrice: 'Verkaufspreis',
    sellQuantity: 'Verkaufs-Menge',
    remaining: 'Verbleibend',
    profitFromSale: 'Gewinn aus Verkauf',
    confirmSell: 'Teilverkauf bestätigen',
    addBuyBtn: 'Nachkauf +',
    partialSellBtn: 'Teilverkauf +',
    netProfit: 'NETTO GEWINN',
    grossProfit: 'BRUTTO GEWINN',
    
    // Position Cards
    unnamedPosition: 'Unbenannte Position',
    entry: 'Einstieg',
    target: 'Zielkurs',
    quantity: 'Stückzahl',
    yield: 'Rendite',
    profit: 'Gewinn',
    net: 'Netto',
    gross: 'Brutto',
    toggle: 'Wechseln',
    freeStart: 'Kostenlos starten',
    freeStartDesc: 'Komplett kostenlos nutzbar mit allen Basis-Features. Optional: Pro-Account für 1,99€/Monat mit erweiterten Funktionen.',
    faq: 'Häufig gestellte Fragen',
    faqQ1: 'Wie werden meine Daten gespeichert?',
    faqA1: 'Bei Anmeldung speichern wir Account-Daten sicher in der Cloud (Firebase/Firestore). Ohne Anmeldung bleiben Daten lokal im Browser.',
    faqQ2: 'Welche Broker werden unterstützt?',
    faqA2: 'Wir bieten vorkonfigurierte Gebührenmodelle für Finanzen.net Zero, Smartbroker+, justTRADE, Trade Republic, Scalable Capital, Flatex, Comdirect, ING, Consorsbank, Commerzbank, DKB und Interactive Brokers. Du kannst auch eigene Gebühren für jeden beliebigen Broker eingeben.',
    faqQ3: 'Wie wird die Steuer berechnet?',
    faqA3: 'Die Abgeltungssteuer in Deutschland beträgt 26,375% (25% Abgeltungssteuer + 5,5% Solidaritätszuschlag). Der Freibetrag von 1.000€ pro Jahr wird automatisch berücksichtigt.',
    faqQ4: 'Kann ich zwischen Brutto und Netto wechseln?',
    faqA4: 'Ja! Bei allen Berechnungen kannst du durch Klick auf die Gewinn-Anzeige zwischen Brutto (vor Steuern/Gebühren) und Netto (nach Abzug) wechseln.',
    faqQ5: 'Brauche ich einen Account?',
    faqA5: 'Ein Account ist optional. Ohne Anmeldung kannst du alle Rechner nutzen. Mit Account werden deine gespeicherten Positionen mit deinem Profil verknüpft.',
    yourOpinionMatters: 'Deine Meinung zählt!',
    feedbackCTA: 'Hilf uns, Trade noch besser zu machen. Teile deine Ideen, Wünsche oder melde Probleme – jedes Feedback wird geschätzt und berücksichtigt.',
    giveFeedback: 'Feedback geben',
    
    // Delete Dialogs
    deletePosition: 'Position löschen',
    confirmDeletePosition: 'Bist du sicher, dass du diese Position unwiderruflich löschen möchtest?',
    deletePositionWarning: 'Bist du sicher, dass du diese Position unwiderruflich löschen möchtest?',
    deleteAllPositions: 'Alle Positionen löschen',
    deleteAllWarning: 'ACHTUNG: Du bist dabei, {count} Position(en) unwiderruflich zu löschen!',
    irreversibleAction: 'Diese Aktion kann nicht rückgängig gemacht werden.',
    deleteButtonText: 'Löschen',
    deleteAllButtonText: 'Alle löschen',
    
    // Buttons
    calculate: 'Berechnen',
    saveTrade: 'Position speichern',
    loginToSave: 'Anmelden zum Speichern',
    addBuyBtn: 'Nachkauf +',
    partialSellBtn: 'Teilverkauf +',
    upgradeNow: 'Jetzt upgraden',
    exportData: 'Daten exportieren',
    cancelPro: 'Pro kündigen',
    login: 'Anmelden',
    register: 'Registrieren',
    logoutBtn: 'Abmelden',
    privacyPolicy: 'Datenschutz',
    terms: 'Nutzungsbedingungen',
    imprint: 'Impressum',
    feedbackBtn: 'Feedback geben',
    themeSystem: 'System',
    themeLight: 'Hell',
    themeDark: 'Dunkel',
    understood: 'Verstanden',
    cancel: 'Abbrechen',
    
    // Form Validation
    fillAllFields: 'Bitte fülle alle Felder aus.',
    validEmail: 'Bitte gib eine gültige E-Mail Adresse ein.',
    noAccountFound: 'Kein Account mit dieser E-Mail gefunden.',
    wrongPassword: 'Falsches Passwort.',
    loginSuccess: 'Erfolgreich angemeldet!',
    acceptTermsRequired: 'Du musst die Nutzungsbedingungen und Datenschutzerklärung akzeptieren, um ein Konto zu erstellen.',
    passwordMinLength: 'Das Passwort muss mindestens 6 Zeichen lang sein.',
    accountExists: 'Ein Account mit dieser E-Mail existiert bereits.',
    registerSuccess: 'Account erfolgreich erstellt! Du wirst angemeldet...',
    logoutConfirm: 'Möchtest du dich wirklich abmelden?'
  },
  en: {
    // Navigation
    home: 'Home',
    trading: 'Trading',
    sparen: 'Savings',
    etf: 'ETF Comparison',
    settings: 'Settings',
    
    // Home
    heroTitle: 'Professional Trading.<br>Simply Calculated.',
    heroSubtitle: 'Calculate your trades precisely, plan long-term and maximize your returns – all in one tool. With optional Pro account for advanced features.',
    startNow: 'Start Now',
    learnMore: 'Learn More',
    
    // Features
    tradingCalculator: 'Trading Calculator',
    tradingDesc: 'Calculate profits, returns, break-even, CRV and more. With leverage function, stop-loss and precise tax and fee calculations.',
    savingsCalculator: 'Savings Calculator',
    savingsDesc: 'Plan your financial future with smart savings rates, compound interest calculations and inflation analysis (Pro).',
    proAccount: 'Pro Account',
    proDesc: 'Unlimited trades, ETF database, inflation & tax calculator, PDF/CSV export and ad-free – for only €1.99/month.',
    
    // Settings
    appearance: 'Appearance',
    language: 'Language',
    currency: 'Currency',
    dataManagement: 'Data Management',
    exportData: 'Export Data',
    legal: 'Legal',
    feedback: 'Feedback Portal',
    feedbackDesc: 'Share your ideas and help us improve Trade',
    feedbackSupportHeading: 'FEEDBACK & SUPPORT',
    positionNameOptionalLabel: 'Position Name (Optional)',
    positionNamePlaceholder: 'e.g. Apple Long, Bitcoin Short...',
    
    // Feedback
    feedbackTitle: 'Your Feedback is Valuable',
    feedbackSubtitle: 'Help us improve Trade. Share your ideas, wishes or report problems. Every feedback is read and considered.',
    name: 'Name',
    nameOptional: 'Name (optional)',
    email: 'Email',
    emailOptional: 'Email (optional)',
    category: 'Category',
    message: 'Your Message',
    messagePlaceholder: 'Describe your feedback in as much detail as possible...',
    categoryFeature: '💡 Feature Request',
    categoryBug: '🐛 Bug Report',
    categoryImprovement: '🛠 Improvement Suggestion',
    categoryDesign: '🎨 Design Feedback',
    categoryOther: '📝 Other',
    privacyNotice: 'Privacy:',
    privacyText: 'Your information will be treated confidentially and used only to improve Trade. Email and name are optional.',
    sendFeedback: 'Send Feedback',
    thankYou: 'Thank You!',
    feedbackSuccess: 'Your feedback has been successfully submitted. We greatly appreciate your opinion and will consider it in further development.',
    backToHome: 'Back to Home',
    
    // Trading
    tradeCalculation: 'Trade Calculation',
    entryPrice: 'Entry Price',
    quantity: 'Quantity',
    targetPrice: 'Target Price',
    stopLoss: 'Stop Loss',
    leverage: 'Leverage',
    position: 'Position',
    long: 'Long',
    short: 'Short',
    calculate: 'Calculate',
    profit: 'Profit',
    return: 'Return',
    saveTrade: 'Save Trade',
    investment: 'Investment',
    fees: 'Fees',
    taxes: 'Taxes',
    netProfit: 'Net Profit',
    gross: 'Gross',
    net: 'Net',
    addBuy: 'Add Purchase',
    partialSell: 'Partial Sell',
    pieces: 'Pcs.',
    breakEven: 'Break-Even Price',
    crv: 'CRV (Risk-Reward)',
    
    // Sparen
    savingsGoal: 'Savings Goal',
    monthlySavings: 'Monthly Savings',
    duration: 'Duration',
    interestRate: 'Interest Rate',
    years: 'Years',
    finalCapital: 'Final Capital',
    initialCapital: 'Initial Capital',
    totalContributions: 'Total Contributions',
    interestEarned: 'Interest',
    realValue: 'Real Value',
    inflationRate: 'Inflation Rate',
    yearlyIncrease: 'Yearly Increase',
    
    // ETF
    etfDatabase: 'ETF Database',
    etfComparison: 'ETF Comparison',
    searchETF: 'Search ETF...',
    selectETF: 'Select ETF',
    performance: 'Performance',
    year1: '1 Year',
    year3: '3 Years',
    year5: '5 Years',
    year10: '10 Years',
    ter: 'TER (Total Expense Ratio)',
    description: 'Description',
    avgReturn: 'Avg. Return p.a.',
    proFeature: 'PRO FEATURE',
    compareHistorical: 'Compare historical average returns of popular ETFs',
    unlockETF: 'Unlock ETF Database',
    accessHistorical: 'Access historical data for the last 10 years. Compare performance, TER and simulate your savings plan.',
    upgradeNow: 'Upgrade now – €1.99/month',
    popularETFs: 'Popular ETFs',
    descending: 'Descending',
    ascending: 'Ascending',
    sortBy: 'Sort by',
    sortByName: 'Sort by: Name',
    sortByReturn1Y: 'Sort by: 1-year return',
    sortByReturn3Y: 'Sort by: 3-year return',
    sortByReturn5Y: 'Sort by: 5-year return',
    sortByReturn10Y: 'Sort by: 10-year return',
    sortByTER: 'Sort by: Total Expense Ratio (TER)',
    whatIsTER: 'What is TER (Total Expense Ratio)?',
    returnComparison: 'Return comparison (10 years)',
    selectedETFs: 'ETFs selected',
    selectedETFsOfTwo: 'of 2 ETFs selected',
    selectUpTo2: 'Select up to 2 ETFs from the list below to compare them',
    noETFsFound: 'No ETFs found',
    tryDifferent: 'Try a different search term',
    noteHistorical: 'Note: The returns shown are historical averages and not a guarantee of future performance. TER = Total Expense Ratio. All information without guarantee.',
    category: 'Cat.',
    etfDetailsTitle: 'ETF Details',
    etfSelected: '✓ Selected',
    toComparison: 'To comparison',
    etfTrustedBy: 'Trusted by thousands',
    etfUnlockHeadline: 'Unlock Pro features',
    etfUnlockSubheading: 'Use the full power of 1,247 professional ETFs with 10 years of data, unlimited comparisons and advanced analyses – for less than a coffee per month.',
    etfStatHistorical: 'Historical Data',
    etfStatEtfs: 'Professional ETFs',
    etfStatCompare: 'Unlimited Comparisons',
    etfStatProfitability: 'Reliable Profitability',
    etfUpgradeCta: 'Upgrade now – €1.99/month',
    etfTrustCancelable: 'Cancel anytime',
    etfTrustFreeDays: '3 days free',
    etfTrustAllFeatures: 'All features instantly',
    etfTrustPrivacy: 'Secure privacy',
    etfExpectTitle: 'What you get',
    etfFeature1Title: '📈 Return Analysis',
    etfFeature1Desc: 'Professional charts with 10 years of full price history. Spot trends and patterns at a glance.',
    etfFeature2Title: '🧩 Comparison Tool',
    etfFeature2Desc: 'Compare unlimited ETFs side by side. Returns, fees, risks at a glance.',
    etfFeature3Title: '💸 Savings Plan Simulator',
    etfFeature3Desc: 'Test savings strategies with real data. See exactly where your money goes and how you benefit.',
    etfFeature4Title: '📊 Portfolio Tracking',
    etfFeature4Desc: 'Keep track of your investments. Automatic performance analysis and detailed overviews.',
    etfPreviewTitle: 'Preview: This is what your database looks like (blurred preview)',
    etfSample1Desc: 'Global equities – 3,500+ companies',
    etfSample2Desc: 'US tech & growth – 500 top companies',
    etfSample3Desc: 'Tech-focused – 100 largest companies',
    etfInfoTitle: '✨ Complete Analysis',
    etfInfoDesc: 'Filter by costs, regions, sectors & more – all 1,247 ETFs with detailed metrics',
    etfPreviewMore: '+ 1,244 more ETFs with full data',
    etfPreviewAvailableAfter: 'All available after upgrade',
    etfAvg10y: '10-year avg',
    etfStatHistoricalHtml: 'Historical<br>Data',
    etfStatEtfsHtml: 'Professional<br>ETFs',
    etfStatCompareHtml: 'Detailed<br>Analysis',
    etfStatProfitabilityHtml: 'Reliable<br>Profitability',
    etfTrustCancelableHtml: 'Cancel<br>anytime',
    etfTrustFreeDaysHtml: '3 days<br>free',
    etfTrustAllFeaturesHtml: 'All features<br>instantly',
    etfTrustPrivacyHtml: 'Secure<br>privacy',
    
    // Settings
    appearance: 'Appearance',
    language: 'Language',
    currency: 'Currency',
    dataManagement: 'Data Management',
    exportData: 'Export Data',
    legal: 'Legal',
    feedback: 'Feedback Portal',
    feedbackDesc: 'Share your ideas and help us improve Trade',
    theme: 'Theme',
    system: 'System',
    light: 'Light',
    dark: 'Dark',
    currencyTools: 'Currency & Tools',
    leverageFunction: 'Leverage Function',
    analysisValues: 'Analysis Values',
    taxesDE: 'Taxes (DE)',
    taxFreeAmount: 'Tax-Free Amount',
    taxRate: 'Tax Rate',
    alreadyUsed: 'Already Used',
    broker: 'Broker',
    currentBroker: 'Current Broker',
    custom: 'Custom',
    forecastParameters: 'Forecast Parameters',
    fixedCosts: 'Fixed Costs',
    variableFee: 'Variable Fee',
    proAccountTitle: 'PRO ACCOUNT',
    tradePro: 'Trade Pro',
    advancedFeatures: 'Advanced features for serious traders',
    unlimitedTrades: 'Unlimited Trades',
    saveAsMany: 'Save as many trades as you want',
    etfDatabaseAccess: 'ETF Database',
    accessHistoricalReturns: 'Access to historical average returns',
    inflationTaxCalc: 'Inflation & Tax Calculator',
    preciseCalculation: 'Precise calculation with taxes and inflation',
    pdfCsvExport: 'PDF/CSV Export',
    exportCalculations: 'Export your calculations',
    adFree: 'Ad-Free',
    noAds: 'No annoying advertising banners',
    perMonth: 'per month',
    perYear: 'per year',
    trialDays: 'Try 3 days free',
    trialInfo: '3 days free – Cancel anytime',
    afterTrial: 'After trial €1.99/month or €18.99/year',
    monthsFree: '2 months free',
    noPaymentDuringTrial: 'No payment during trial. Cancel anytime.',
    upgradeNowBtn: 'Upgrade now',
    cancelAnytime: 'Cancel anytime',
    active: 'ACTIVE',
    allPremium: 'All premium features unlocked',
    cancelPro: 'Cancel Pro',
    chooseTheme: 'Choose between light, dark or system mode.',
    leverageDesc: 'The leverage function enables the calculation of derivatives (Long/Short).',
    breakEvenPrice: 'Break-Even Price',
    crvRatio: 'CRV (Risk-Reward)',
    breakEvenDesc: 'Break-Even shows the price at which you are in profit including fees. CRV evaluates the ratio of profit target to stop-loss.',
    breakEvenModalTitle: 'Break-Even',
    breakEvenModalDesc: 'The price at which your trade, considering all buy and sell fees, is exactly at €0 profit/loss. From this point onwards, you are in the profit zone.',
    crvModalTitle: 'CRV – Risk-Reward Ratio',
    crvModalDesc: 'The ratio of your potential profit to your risk (distance to stop-loss). A CRV of 2.0 means your profit target is twice as high as your possible loss risk.',
    understood: 'Understood',
    remaining2026: 'Remaining 2026',
    used: 'used',
    yearlyAllowance: 'Yearly Allowance',
    taxInfo: 'In Germany, capital gains tax including solidarity surcharge is 26.375%. The allowance of €1,000 is automatically renewed on January 1st of each year. Saved trades are automatically assigned to the respective year.',
    capitalGainsTaxWithSoli: 'Capital Gains Tax incl. solidarity surcharge',
    taxInfoWithAllowance: 'In {country}, {taxLabel} is {rate}%. The allowance of {allowance} renews automatically on January 1 each year. Saved trades are automatically assigned to the respective year.',
    taxInfoNoAllowance: 'In {country}, {taxLabel} is {rate}%. Saved trades are automatically assigned to the respective year.',
    taxFaqBase: '{taxLabel} in {country} is {rate}%.',
    taxFaqAllowance: 'The allowance of {allowance} per year is automatically applied.',
    sparAssetDevelopment: 'ASSET DEVELOPMENT',
    sparCalculationMode: 'CALCULATION MODE',
    sparDeposits: 'Deposits',
    sparPureInterest: 'PURE INTEREST',
    crvRatioLabel: 'CRV (RISK/REWARD)',
    totalCapital: 'Total Capital',
    depositsDesc: 'Sum of initial capital and savings rates including dynamics.',
    pureInterestDesc: 'The total profit from interest and compound interest.',
    requiredRate: 'REQUIRED RATE',
    
    // ETF
    zeroETFs: '(0 ETFs)',
    terModalDesc: 'TER (Total Expense Ratio) indicates the annual ongoing costs of an ETF',
    terExampleLabel: 'EXAMPLE',
    terExample: 'With a TER of 0.20% and an investment of €10,000 you pay €20 per year in fees.',
    lowerTERBetter: 'Lower TER = Better for you!',
    terIncludes: 'The TER includes management fees, operating costs and other ongoing expenses. It is automatically deducted from the fund assets and is already reflected in the value development.',
    
    // Settings - Broker
    brokerHeading: 'BROKER',
    currentBrokerLabel: 'Current Broker',
    customBroker: 'Custom',
    
    // Settings - Forecast Parameters
    forecastParametersHeading: 'FORECAST PARAMETERS',
    inflationRateLabel: 'Inflation Rate',
    yearlyIncreaseLabel: 'Yearly Increase',
    forecastDescription: 'The inflation rate is used for real value calculation in the savings calculator. The yearly increase automatically raises your savings rate by the specified percentage per year.',
    brokerFinanzenZero: 'Finanzen.net Zero',
    brokerSmartbrokerPlus: 'Smartbroker+',
    brokerJustTrade: 'justTRADE',
    brokerTradeRepublic: 'Trade Republic',
    brokerScalableCapital: 'Scalable Capital',
    brokerFlatex: 'Flatex',
    brokerComdirect: 'Comdirect',
    brokerIng: 'ING',
    brokerConsorsbank: 'Consorsbank',
    brokerCommerzbank: 'Commerzbank',
    brokerDkb: 'DKB',
    brokerInteractiveBrokers: 'Interactive Brokers',
    
    // Login/Register
    loginBtn: 'Login',
    loginModalTitle: 'Login',
    loginTab: 'Login',
    registerTab: 'Register',
    emailLabel: 'Email Address',
    emailPlaceholder: 'your@email.com',
    passwordLabel: 'Password',
    passwordPlaceholder: '••••••••',
    acceptTerms: 'I accept the',
    termsLink: 'Terms of Service',
    andThe: 'and the',
    privacyLink: 'Privacy Policy',
    loginSubmit: 'Login',
    registerSubmit: 'Register',
    
    // Settings - Fees
    feesHeading: 'FEES',
    fixedCostsLabel: 'Fixed Costs',
    variableFeeLabel: 'Variable Fee',
    feesDescription: 'Order fees of your broker. These are considered for both buying and selling.',
    
    // Settings - Legal
    legalHeading: 'LEGAL',
    aboutTradeTitle: 'About Trade',
    aboutTradeDescription: 'Trade is a free trading calculator for private traders and investors. The app offers precise calculations for trading, saving and investments with automatic tax calculation.',
    supportEmail: 'Support:',
    version: 'Version:',
    privacyPolicy: 'Privacy Policy',
    privacyPolicyDesc: 'Learn how we protect your data',
    termsOfService: 'Terms of Service',
    termsOfServiceDesc: 'Read our general terms and conditions',
    imprint: 'Imprint',
    imprintDesc: 'Legal information about the provider',
    termsTitle: 'Terms of Service',
    privacyTitle: 'Privacy Policy',
    imprintTitle: 'Imprint',
    termsHtml: `
      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Provider and Contact</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        The provider of this website and the tool is LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG, Bizetstrasse 111, 13088 Berlin, Germany. Contact: [Email placeholder], [Phone placeholder]. Trade register: [Placeholder], Authorized representatives: Leonard George Toader, Pepe Rene Cruz, Thomas Markendorf.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. Scope</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        These terms govern the use of the "Calculo" website and its calculators and features (the "Tool"). By using the Tool, you accept these terms.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Services</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        The Tool provides calculations and information for trading, saving and investments. The content is for information only and does not replace individual advice.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. No Investment, Tax or Legal Advice</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        All calculations are provided without warranty. The Tool does not provide investment, tax or legal advice. For binding guidance, consult qualified professionals.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. Registration and Local Storage</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        If registration is available, it is handled locally in your browser. Inputs, settings and calculations are stored locally only (localStorage). No data is transmitted to external servers or third parties.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. User Obligations</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        You are responsible for the accuracy of your inputs and use the Tool at your own risk. You must not misuse the Tool, in particular not to disrupt, manipulate or bypass security features.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Availability and Changes</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        We strive for high availability but do not guarantee it. We may change, restrict or discontinue features at any time.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Pro Account and Pricing</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        A Pro account is optional and unlocks advanced features. Current prices and conditions are shown in the Tool (e.g., EUR 1.99/month). Subscriptions can be cancelled at any time; Pro features are then deactivated.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">9. Liability</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        We are not liable for damages arising from the use or non-use of the Tool, especially financial losses based on calculations or decisions. Mandatory statutory liability remains unaffected.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">10. Final Provisions</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        German law applies. Where legally permissible, the place of jurisdiction is Berlin. If any provision is invalid, the remaining provisions remain effective.
      </p>

      <p style="color:var(--muted);font-size:12px;margin-top:24px">Last updated: <span data-last-updated="true"></span></p>
    `,
    privacyHtml: `
      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Controller</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        The controller is LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG, Bizetstrasse 111, 13088 Berlin, Germany. Contact: [Email placeholder], [Phone placeholder].
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. General Notes</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        We take the protection of your data seriously. This privacy policy explains which data is processed when you use the Tool.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Processed Data</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Only the data you enter is processed (e.g., trading and saving values, settings, and optionally email and password for local login).
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. Local Storage</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        All data is stored locally in your browser (localStorage). No data is transmitted to external servers or third parties.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. No Third Parties, No Tracking</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        No third-party cookies, analytics tools or tracking are used. Your usage behavior is not recorded.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. Data Security</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Since data is stored only locally on your device, the security of your data is your responsibility. Please protect your device from unauthorized access.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Your Rights</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        You can delete your locally stored data at any time in your browser settings. If you have questions, you can contact us using the details above.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Changes</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        This privacy policy may be updated if needed. Changes will be announced in the Tool.
      </p>

      <p style="color:var(--muted);font-size:12px;margin-top:24px">Last updated: <span data-last-updated="true"></span></p>
    `,
    imprintHtml: `
      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Information pursuant to Section 5 TMG</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG<br>
        Bizetstrasse 111<br>
        13088 Berlin<br>
        Germany
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. Contact</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Email: [Email placeholder]<br>
        Phone: [Phone placeholder]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Register Entry</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Trade register: [Placeholder]<br>
        Register court: [Placeholder]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. Authorized Representatives</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Leonard George Toader, Pepe Rene Cruz, Thomas Markendorf
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. VAT ID</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        VAT identification number pursuant to § 27 a UStG: [Placeholder]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. Responsible for Content</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        [Placeholder pursuant to § 18 para. 2 MStV]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Liability for Content</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        The contents of our pages and app were created with great care. However, we cannot guarantee the accuracy, completeness or timeliness of the content.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Liability for Links</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        This website may contain links to external third-party websites. We have no influence on their content. The respective provider is always responsible for the content of linked pages.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">9. Financial Information Notice</h3>
      <div style="background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:12px;padding:20px;margin-bottom:16px">
        <p style="color:var(--text);font-size:14px;line-height:1.7;font-weight:600;margin-bottom:8px">
          Important notice: No financial or investment advice
        </p>
        <p style="color:var(--text);font-size:13px;line-height:1.7">
          The information and tools provided on this website are for informational purposes only and do not constitute a recommendation to buy or sell financial instruments. No tax or legal advice is provided.
        </p>
      </div>

      <p style="color:var(--muted);font-size:12px;margin-top:24px">Last updated: <span data-last-updated="true"></span></p>
    `,
    allRightsReserved: 'All rights reserved.',
    contributions: 'Contributions',
    pureInterest: 'Pure Interest',
    realValueInflation: 'Real Value (Inflation Adj.)',
    moreDetails: 'More Details with Trade Pro',
    seeRealValue: 'See real value and taxes of your savings plans',
    upgradeFor: 'Upgrade for €1.99/month',
    anytime: 'Cancel anytime',
    proFeature: 'PRO FEATURE',
    compareHistorical: 'Compare historical average returns of popular ETFs',
    unlockETF: 'Unlock ETF Database',
    accessHistorical: 'Access to historical data from the last 10 years. Compare performance, TER and simulate your savings plan.',
    upgradeNow: 'Upgrade now for €1.99/month',
    popularETFs: 'Popular ETFs',
    descending: 'Descending',
    ascending: 'Ascending',
    sortBy: 'Sort by',
    sortByName: 'Sort by: Name',
    sortByReturn1Y: 'Sort by: Return 1 Year',
    sortByReturn3Y: 'Sort by: Return 3 Years',
    sortByReturn5Y: 'Sort by: Return 5 Years',
    sortByReturn10Y: 'Sort by: Return 10 Years',
    sortByTER: 'Sort by: Total Expense Ratio (TER)',
    whatIsTER: 'What is TER (Total Expense Ratio)?',
    returnComparison: 'Return Comparison (10 Years)',
    selectedETFs: 'ETFs selected',
    selectUpTo2: 'Select up to 2 ETFs from the list below to compare them',
    noETFsFound: 'No ETFs found',
    tryDifferent: 'Try a different search term',
    noteHistorical: 'Note: The returns shown are historical averages and no guarantee for future developments. TER = Total Expense Ratio. All information without guarantee.',
    category: 'Cat.',
    
    // Allgemein
    save: 'Save',
    cancel: 'Cancel',
    delete: 'Delete',
    edit: 'Edit',
    close: 'Close',
    yes: 'Yes',
    no: 'No',
    optional: 'optional',
    loading: 'Loading...',
    
    // Home - Extended
    financialPlanningReimagined: 'Financial Planning Reimagined',
    financialPlanningDesc: 'Optimized for trading, saving and investments. With automatic tax calculation, leverage trading, stop-loss management and intuitive user interface.',
    capitalGainsTax: 'Capital Gains Tax',
    capitalGainsTaxLabel: 'Capital Gains Tax (26.375%)',
    taxFreeAllowance: 'Tax-Free Allowance',
    per: 'Per',
    perMonth: 'Month',
    perYear: 'Year',
    proPerMonth: 'Pro Month',
    country: 'Country',
    countryForTax: 'Country (for tax calculation)',
    taxRateInfo: 'Tax Rate',
    taxAllowanceInfo: 'Tax Allowance',
    noTax: 'No capital gains tax',
    howItWorks: 'How It Works',
    step1Title: 'Enter Values',
    step1Desc: 'Enter your trading data: entry price, quantity and target price. Optionally, you can also simulate additional purchases and partial sales.',
    step2Title: 'Automatic Calculation',
    step2Desc: 'The tool automatically calculates your net profit taking into account broker fees and current capital gains tax.',
    step3Title: 'Save Position',
    step3Desc: 'Save your trades in the history and keep track of your performance and remaining tax allowance.',
    step4Title: 'Track Performance',
    step4Desc: 'Analyze your trading success with detailed charts and keep all important metrics in view.',
    yourAdvantages: 'Your Advantages',
    preciseCalculations: 'Precise Calculations',
    preciseCalculationsDesc: 'Exact profit calculations considering all fees and taxes.',
    dataPrivacy: '100% Data Privacy',
    dataPrivacyDesc: 'Account data is stored securely in the cloud (Firebase). Without login, data stays local in your browser.',
    fastSpeed: 'Lightning Fast',
    fastSpeedDesc: 'No loading times, instant calculations. Works completely offline after first load.',
    multiBroker: 'Multi-Broker Support',
    multiBrokerDesc: 'Pre-configured fee models for Finanzen.net Zero, Smartbroker+, justTRADE, Trade Republic, Scalable Capital, Flatex, Comdirect, ING, Consorsbank, Commerzbank, DKB, Interactive Brokers and custom brokers.',
    tradingHistory: 'Trading History',
    noPositionsSaved: 'No positions saved yet',
    saveFirstPosition: 'Save your first position to see it here',
    
    // Trading Modals
    addBuy: 'Add Buy -',
    buyPrice: 'Buy Price',
    quantity: 'Quantity',
    pieces: 'Pcs.',
    newAverage: 'New Average',
    invested: 'Invested',
    confirmBuy: 'Confirm Buy',
    partialSell: 'Partial Sell +',
    sellPrice: 'Sell Price',
    sellQuantity: 'Sell Quantity',
    remaining: 'Remaining',
    profitFromSale: 'Profit from Sale',
    confirmSell: 'Confirm Sell',
    addBuyBtn: 'Add Buy +',
    partialSellBtn: 'Partial Sell +',
    netProfit: 'NET PROFIT',
    grossProfit: 'GROSS PROFIT',
    
    // Position Cards
    unnamedPosition: 'Unnamed Position',
    entry: 'Entry',
    target: 'Target',
    quantity: 'Quantity',
    yield: 'Yield',
    profit: 'Profit',
    net: 'Net',
    gross: 'Gross',
    toggle: 'Toggle',
    tradingHistoryDesc: 'Save and track all your trades with detailed information on profit, return and timing.',
    freeStart: 'Start Free',
    freeStartDesc: 'Completely free to use with all basic features. Optional: Pro account for €1.99/month with advanced features.',
    faq: 'Frequently Asked Questions',
    faqQ1: 'How is my data stored?',
    faqA1: 'When you sign in, account data is stored securely in the cloud (Firebase/Firestore). Without login, data stays local in your browser.',
    faqQ2: 'Which brokers are supported?',
    faqA2: 'We offer pre-configured fee models for Finanzen.net Zero, Smartbroker+, justTRADE, Trade Republic, Scalable Capital, Flatex, Comdirect, ING, Consorsbank, Commerzbank, DKB and Interactive Brokers. You can also enter custom fees for any broker.',
    faqQ3: 'How is the tax calculated?',
    faqA3: 'The capital gains tax in Germany is 26.375% (25% capital gains tax + 5.5% solidarity surcharge). The allowance of €1,000 per year is automatically taken into account.',
    faqQ4: 'Can I switch between gross and net?',
    faqA4: 'Yes! For all calculations, you can switch between gross (before taxes/fees) and net (after deduction) by clicking on the profit display.',
    faqQ5: 'Do I need an account?',
    faqA5: 'An account is optional. Without registration you can use all calculators. With an account, your saved positions are linked to your profile.',
    yourOpinionMatters: 'Your Opinion Matters!',
    feedbackCTA: 'Help us make Trade even better. Share your ideas, wishes or report problems – every feedback is appreciated and considered.',
    giveFeedback: 'Give Feedback',
    
    // Delete Dialogs
    deletePosition: 'Delete Position',
    confirmDeletePosition: 'Are you sure you want to permanently delete this position?',
    deletePositionWarning: 'Are you sure you want to permanently delete this position?',
    deleteAllPositions: 'Delete All Positions',
    deleteAllWarning: 'WARNING: You are about to permanently delete {count} position(s)!',
    irreversibleAction: 'This action cannot be undone.',
    deleteButtonText: 'Delete',
    deleteAllButtonText: 'Delete All',
    
    // Buttons
    calculate: 'Calculate',
    saveTrade: 'Save Position',
    loginToSave: 'Login to Save',
    addBuyBtn: 'Buy +',
    partialSellBtn: 'Sell +',
    upgradeNow: 'Upgrade Now',
    exportData: 'Export Data',
    cancelPro: 'Cancel Pro',
    login: 'Login',
    register: 'Register',
    logoutBtn: 'Logout',
    privacyPolicy: 'Privacy Policy',
    terms: 'Terms of Service',
    imprint: 'Imprint',
    feedbackBtn: 'Send Feedback',
    themeSystem: 'System',
    themeLight: 'Light',
    themeDark: 'Dark',
    understood: 'Understood',
    cancel: 'Cancel',
    
    // Form Validation
    fillAllFields: 'Please fill in all fields.',
    validEmail: 'Please enter a valid email address.',
    noAccountFound: 'No account with this email found.',
    wrongPassword: 'Wrong password.',
    loginSuccess: 'Successfully logged in!',
    acceptTermsRequired: 'You must accept the terms of service and privacy policy to create an account.',
    passwordMinLength: 'Password must be at least 6 characters long.',
    accountExists: 'An account with this email already exists.',
    registerSuccess: 'Account successfully created! You will be logged in...',
    logoutConfirm: 'Do you really want to log out?'
  },
  es: {
    // Navigation
    home: 'Inicio',
    trading: 'Trading',
    sparen: 'Ahorros',
    etf: 'Comparación ETF',
    settings: 'Configuración',
    
    // Home
    heroTitle: 'Trading Profesional.<br>Simplemente Calculado.',
    heroSubtitle: 'Calcula tus operaciones con precisión, planifica a largo plazo y maximiza tus rendimientos, todo en una herramienta. Con cuenta Pro opcional para funciones avanzadas.',
    startNow: 'Comenzar Ahora',
    learnMore: 'Más información',
    
    // Features
    tradingCalculator: 'Calculadora de Trading',
    tradingDesc: 'Calcula ganancias, rendimientos, punto de equilibrio, CRV y más. Con función de apalancamiento, stop-loss y cálculos precisos de impuestos y comisiones.',
    savingsCalculator: 'Calculadora de Ahorros',
    savingsDesc: 'Planifica tu futuro financiero con tasas de ahorro inteligentes, cálculos de interés compuesto y análisis de inflación (Pro).',
    proAccount: 'Cuenta Pro',
    proDesc: 'Operaciones ilimitadas, base de datos ETF, calculadora de inflación e impuestos, exportación PDF/CSV y sin publicidad – por solo 1,99€/mes.',
    
    // Settings
    appearance: 'Apariencia',
    language: 'Idioma',
    currency: 'Moneda',
    dataManagement: 'Gestión de Datos',
    exportData: 'Exportar Datos',
    legal: 'Legal',
    feedback: 'Portal de Comentarios',
    feedbackDesc: 'Comparte tus ideas y ayúdanos a mejorar Trade',
    feedbackSupportHeading: 'COMENTARIOS Y SOPORTE',
    positionNameOptionalLabel: 'Nombre de la posición (opcional)',
    positionNamePlaceholder: 'p. ej., Apple Long, Bitcoin Short...',
    
    // Feedback
    feedbackTitle: 'Tu Opinión es Valiosa',
    feedbackSubtitle: 'Ayúdanos a mejorar Trade. Comparte tus ideas, deseos o reporta problemas. Cada comentario es leído y considerado.',
    name: 'Nombre',
    nameOptional: 'Nombre (opcional)',
    email: 'Correo',
    emailOptional: 'Correo (opcional)',
    category: 'Categoría',
    message: 'Tu Mensaje',
    messagePlaceholder: 'Describe tus comentarios con el mayor detalle posible...',
    categoryFeature: '💡 Solicitud de Función',
    categoryBug: '🐛 Informe de Error',
    categoryImprovement: '🛠 Sugerencia de Mejora',
    categoryDesign: '🎨 Opinión de Diseño',
    categoryOther: '📝 Otro',
    privacyNotice: 'Privacidad:',
    privacyText: 'Tu información será tratada de forma confidencial y utilizada únicamente para mejorar Trade. El correo electrónico y el nombre son opcionales.',
    sendFeedback: 'Enviar Comentarios',
    thankYou: '¡Gracias!',
    feedbackSuccess: 'Tus comentarios han sido enviados exitosamente. Apreciamos mucho tu opinión y la consideraremos en el desarrollo futuro.',
    backToHome: 'Volver al Inicio',
    calculationMode: 'Modo de Cálculo',
    wealthDevelopment: 'Desarrollo del Patrimonio',
    
    // Trading
    tradeCalculation: 'Cálculo de Operación',
    entryPrice: 'Precio de Entrada',
    quantity: 'Cantidad',
    targetPrice: 'Precio Objetivo',
    stopLoss: 'Stop Loss',
    leverage: 'Apalancamiento',
    position: 'Posición',
    long: 'Largo',
    short: 'Corto',
    calculate: 'Calcular',
    profit: 'Ganancia',
    return: 'Rendimiento',
    saveTrade: 'Guardar Operación',
    investment: 'Inversión',
    fees: 'Comisiones',
    taxes: 'Impuestos',
    netProfit: 'Ganancia Neta',
    gross: 'Bruto',
    net: 'Neto',
    addBuy: 'Añadir Compra',
    partialSell: 'Venta Parcial',
    pieces: 'Pcs.',
    breakEven: 'Precio de Equilibrio',
    crv: 'CRV (Riesgo-Beneficio)',
    
    // Sparen
    savingsGoal: 'Objetivo de Ahorro',
    monthlySavings: 'Ahorro Mensual',
    duration: 'Duración',
    interestRate: 'Tasa de Interés',
    years: 'Años',
    finalCapital: 'Capital Final',
    initialCapital: 'Capital Inicial',
    totalContributions: 'Contribuciones Totales',
    interestEarned: 'Intereses',
    realValue: 'Valor Real',
    inflationRate: 'Tasa de Inflación',
    yearlyIncrease: 'Aumento Anual',
    
    // ETF
    etfDatabase: 'Base de Datos ETF',
    etfComparison: 'Comparación ETF',
    searchETF: 'Buscar ETF...',
    selectETF: 'Seleccionar ETF',
    performance: 'Rendimiento',
    year1: '1 Año',
    year3: '3 Años',
    year5: '5 Años',
    year10: '10 Años',
    ter: 'TER (Ratio de Gastos Totales)',
    description: 'Descripción',
    avgReturn: 'Rendimiento Prom. anual',
    proFeature: 'FUNCIÓN PRO',
    compareHistorical: 'Compara rendimientos promedio históricos de ETFs populares',
    unlockETF: 'Desbloquear base de datos ETF',
    accessHistorical: 'Acceso a datos históricos de los últimos 10 años. Compara rendimiento, TER y simula tu plan de ahorro.',
    upgradeNow: 'Actualizar ahora – 1,99€/mes',
    popularETFs: 'ETFs populares',
    descending: 'Descendente',
    ascending: 'Ascendente',
    sortBy: 'Ordenar por',
    sortByName: 'Ordenar por: Nombre',
    sortByReturn1Y: 'Ordenar por: Rendimiento 1 año',
    sortByReturn3Y: 'Ordenar por: Rendimiento 3 años',
    sortByReturn5Y: 'Ordenar por: Rendimiento 5 años',
    sortByReturn10Y: 'Ordenar por: Rendimiento 10 años',
    sortByTER: 'Ordenar por: Ratio de Gastos Totales (TER)',
    whatIsTER: '¿Qué es TER (Ratio de Gastos Totales)?',
    returnComparison: 'Comparación de rendimientos (10 años)',
    selectedETFs: 'ETFs seleccionados',
    selectedETFsOfTwo: 'de 2 ETFs seleccionados',
    selectUpTo2: 'Selecciona hasta 2 ETFs de la lista de abajo para compararlos',
    noETFsFound: 'No se encontraron ETFs',
    tryDifferent: 'Prueba con otro término de búsqueda',
    noteHistorical: 'Nota: Los rendimientos mostrados son promedios históricos y no garantizan resultados futuros. TER = Ratio de Gastos Totales (Total Expense Ratio). Información sin garantía',
    category: 'Cat.',
    etfDetailsTitle: 'Detalles del ETF',
    etfSelected: '? Seleccionado',
    toComparison: 'Ir a comparar',
    etfTrustedBy: 'Confiado por miles',
    etfUnlockHeadline: 'Desbloquea funciones Pro',
    etfUnlockSubheading: 'Aprovecha todo el poder de 1.247 ETFs profesionales con 10 años de datos, comparaciones ilimitadas y análisis avanzados, por menos que un café al mes',
    etfStatHistorical: 'Datos históricos',
    etfStatEtfs: 'ETFs profesionales',
    etfStatCompare: 'Comparaciones ilimitadas',
    etfStatProfitability: 'Rentabilidad confiable',
    etfUpgradeCta: 'Actualizar ahora – 1,99€/mes',
    etfTrustCancelable: 'Cancela cuando quieras',
    etfTrustFreeDays: '3 días gratis',
    etfTrustAllFeatures: 'Todas las funciones al instante',
    etfTrustPrivacy: 'Privacidad segura',
    etfExpectTitle: 'Esto es lo que obtienes',
    etfFeature1Title: '📈 Análisis de rentabilidad',
    etfFeature1Desc: 'Gráficos profesionales con 10 años de historial completo. Detecta tendencias y patrones de un vistazo.',
    etfFeature2Title: '🧩 Herramienta de comparación',
    etfFeature2Desc: 'Compara ETFs ilimitados lado a lado. Rentabilidades, comisiones y riesgos de un vistazo.',
    etfFeature3Title: '💸 Simulador de plan de ahorro',
    etfFeature3Desc: 'Prueba estrategias de ahorro con datos reales. Ve exactamente a dónde va tu dinero y cómo te beneficia',
    etfFeature4Title: '📊 Seguimiento de Cartera',
    etfFeature4Desc: 'Mantén tus inversiones bajo control. Análisis automático de rendimiento y vistas detalladas.',
    etfPreviewTitle: 'Vista previa: Así se ve tu base de datos (vista borrosa)',
    etfSample1Desc: 'Acciones globales – 3.500+ empresas',
    etfSample2Desc: 'Tecnología y crecimiento USA – 500 mejores empresas',
    etfSample3Desc: 'Enfocado en tecnología – 100 empresas más grandes',
    etfInfoTitle: '✨ Análisis completo',
    etfInfoDesc: 'Filtrar por costos, regiones, sectores y más – todos los 1.247 ETF con métricas detalladas',
    etfPreviewMore: '+ 1.244 ETFs más con datos completos',
    etfPreviewAvailableAfter: 'Todo disponible tras el upgrade',
    etfAvg10y: 'Prom. 10 años',
    etfStatHistoricalHtml: 'Datos<br>históricos',
    etfStatEtfsHtml: 'ETFs<br>profesionales',
    etfStatCompareHtml: 'Análisis<br>Detallado',
    etfStatProfitabilityHtml: 'Rentabilidad<br>confiable',
    etfTrustCancelableHtml: 'Cancela<br>cuando quieras',
    etfTrustFreeDaysHtml: '3 días<br>gratis',
    etfTrustAllFeaturesHtml: 'Todas las funciones<br>al instante',
    etfTrustPrivacyHtml: 'Privacidad<br>segura',
    
    // Settings
    appearance: 'Apariencia',
    language: 'Idioma',
    currency: 'Moneda',
    dataManagement: 'Gestión de Datos',
    exportData: 'Exportar Datos',
    legal: 'Legal',
    feedback: 'Portal de Comentarios',
    feedbackDesc: 'Comparte tus ideas y ayúdanos a mejorar Trade',
    theme: 'Tema',
    system: 'Sistema',
    light: 'Claro',
    dark: 'Oscuro',
    currencyTools: 'Moneda y Herramientas',
    leverageFunction: 'Función de Apalancamiento',
    analysisValues: 'Valores de Análisis',
    taxesDE: 'Impuestos (DE)',
    taxFreeAmount: 'Cantidad Libre de Impuestos',
    taxRate: 'Tasa de Impuesto',
    alreadyUsed: 'Ya Utilizado',
    broker: 'Bróker',
    currentBroker: 'Bróker Actual',
    custom: 'Personalizado',
    forecastParameters: 'Parámetros de Pronóstico',
    fixedCosts: 'Costos Fijos',
    variableFee: 'Tarifa Variable',
    proAccountTitle: 'CUENTA PRO',
    tradePro: 'Trade Pro',
    advancedFeatures: 'Funciones avanzadas para traders serios',
    unlimitedTrades: 'Operaciones Ilimitadas',
    saveAsMany: 'Guarda tantas operaciones como quieras',
    etfDatabaseAccess: 'Base de Datos ETF',
    accessHistoricalReturns: 'Acceso a retornos históricos promedio',
    inflationTaxCalc: 'Calculadora de Inflación e Impuestos',
    preciseCalculation: 'Cálculo preciso con impuestos e inflación',
    pdfCsvExport: 'Exportación PDF/CSV',
    exportCalculations: 'Exporta tus cálculos',
    adFree: 'Sin Anuncios',
    noAds: 'Sin molestos banners publicitarios',
    perMonth: 'por mes',
    perYear: 'por año',
    trialDays: 'Prueba 3 días gratis',
    trialInfo: '3 días gratis – Cancelar en cualquier momento',
    afterTrial: 'Después de la prueba 1,99€/mes o 18,99€/año',
    monthsFree: '2 meses gratis',
    noPaymentDuringTrial: 'Sin pago durante la prueba. Cancelar en cualquier momento.',
    upgradeNowBtn: 'Actualizar ahora',
    cancelAnytime: 'Cancelar en cualquier momento',
    active: 'ACTIVO',
    allPremium: 'Todas las funciones premium desbloqueadas',
    cancelPro: 'Cancelar Pro',
    chooseTheme: 'Elige entre modo claro, oscuro o del sistema.',
    leverageDesc: 'La función de apalancamiento permite el cálculo de derivados (Long/Short).',
    breakEvenPrice: 'Precio de Equilibrio',
    crvRatio: 'CRV (Riesgo-Recompensa)',
    breakEvenDesc: 'El break-even muestra el precio al que estás en ganancia incluyendo las comisiones. El CRV evalúa la relación entre el objetivo de ganancia y el stop loss.',
    breakEvenModalTitle: 'Precio de Equilibrio',
    breakEvenModalDesc: 'El precio al que tu operación, considerando todas las comisiones de compra y venta, está exactamente en €0 de ganancia/pérdida. A partir de este punto, estás en la zona de ganancias.',
    crvModalTitle: 'CRV – Ratio Riesgo-Recompensa',
    crvModalDesc: 'La relación entre tu ganancia potencial y tu riesgo (distancia al stop-loss). Un CRV de 2.0 significa que tu objetivo de ganancia es el doble de tu posible riesgo de pérdida.',
    understood: 'Entendido',
    remaining2026: 'Restante 2026',
    used: 'utilizado',
    yearlyAllowance: 'Desgravación Anual',
    taxInfo: 'En Alemania, el impuesto sobre plusvalías incluido el recargo de solidaridad es del 26,375%. La desgravación de 1.000€ se renueva automáticamente el 1 de enero de cada año. Las operaciones guardadas se asignan automáticamente al año respectivo.',
    capitalGainsTaxWithSoli: 'Impôt sur les plus-values, contribution de solidarité incluse',
    taxInfoWithAllowance: 'En {country}, l\'impôt sur les plus-values est de {rate}%. L\'abattement de {allowance} est automatiquement renouvelé le 1er janvier de chaque année. Les transactions enregistrées sont automatiquement attribuées à l\'année correspondante.',
    taxInfoNoAllowance: 'En {country}, l\'impôt sur les plus-values est de {rate}%. Les transactions enregistrées sont automatiquement attribuées à l\'année correspondante.',
    taxFaqBase: 'L\'impôt sur les plus-values en {country} est de {rate}%.',
    taxFaqAllowance: 'L\'abattement de {allowance} par an est appliqué automatiquement.',
    capitalGainsTaxWithSoli: 'Impuesto sobre plusvalías incl. recargo de solidaridad',
    taxInfoWithAllowance: 'En {country}, el {taxLabel} es del {rate}%. La desgravación de {allowance} se renueva automáticamente el 1 de enero de cada año. Las operaciones guardadas se asignan automáticamente al año correspondiente.',
    taxInfoNoAllowance: 'En {country}, el {taxLabel} es del {rate}%. Las operaciones guardadas se asignan automáticamente al año correspondiente.',
    taxFaqBase: 'El {taxLabel} en {country} es del {rate}%.',
    taxFaqAllowance: 'La desgravación de {allowance} al año se aplica automáticamente.',
    sparAssetDevelopment: 'DESARROLLO DE ACTIVOS',
    sparCalculationMode: 'MODO DE CÁLCULO',
    sparDeposits: 'Depósitos',
    sparPureInterest: 'INTERÉS PURO',
    crvRatioLabel: 'CRV (RIESGO/RECOMPENSA)',
    totalCapital: 'Capital Total',
    depositsDesc: 'Suma del capital inicial y tasas de ahorro incluida la dinámica.',
    pureInterestDesc: 'La ganancia total del interés y el interés compuesto.',
    requiredRate: 'TASA REQUERIDA',
    
    // ETF
    zeroETFs: '(0 ETFs)',
    terModalDesc: 'La Proporción de Gastos Totales (TER) indica los costos anuales en curso de un ETF.',
    terExampleLabel: 'EJEMPLO',
    terExample: 'Con un TER del 0,20% y una inversión de €10.000 pagas €20 por año en honorarios.',
    lowerTERBetter: '¡TER más bajo = ¡Mejor para ti!',
    terIncludes: 'El TER incluye honorarios de gestión, costos operativos y otros gastos continuos. Se deduce automáticamente de los activos del fondo y ya se refleja en el desarrollo del valor.',
    
    // Settings - Broker
    brokerHeading: 'BROKER',
    currentBrokerLabel: 'Corredor Actual',
    customBroker: 'Personalizado',
    
    // Settings - Forecast Parameters
    forecastParametersHeading: 'PARÁMETROS DE PRONÓSTICO',
    inflationRateLabel: 'Tasa de Inflación',
    yearlyIncreaseLabel: 'Aumento Anual',
    forecastDescription: 'La tasa de inflación se utiliza para el cálculo del valor real en la calculadora de ahorros. El aumento anual incrementa automáticamente su tasa de ahorro en el porcentaje especificado por año.',
    brokerFinanzenZero: 'Finanzen.net Zero',
    brokerSmartbrokerPlus: 'Smartbroker+',
    brokerJustTrade: 'justTRADE',
    brokerTradeRepublic: 'Trade Republic',
    brokerScalableCapital: 'Scalable Capital',
    brokerFlatex: 'Flatex',
    brokerComdirect: 'Comdirect',
    brokerIng: 'ING',
    brokerConsorsbank: 'Consorsbank',
    brokerCommerzbank: 'Commerzbank',
    brokerDkb: 'DKB',
    brokerInteractiveBrokers: 'Interactive Brokers',
    
    // Login/Register
    loginBtn: 'Iniciar sesión',
    loginModalTitle: 'Iniciar sesión',
    loginTab: 'Iniciar sesión',
    registerTab: 'Registrarse',
    emailLabel: 'Correo electrónico',
    emailPlaceholder: 'tu@email.es',
    passwordLabel: 'Contraseña',
    passwordPlaceholder: '••••••••',
    acceptTerms: 'Acepto los',
    termsLink: 'Términos de uso',
    andThe: 'y la',
    privacyLink: 'Política de privacidad',
    loginSubmit: 'Iniciar sesión',
    registerSubmit: 'Registrarse',
    
    // Settings - Fees
    feesHeading: 'TARIFAS',
    fixedCostsLabel: 'Costos Fijos',
    variableFeeLabel: 'Tarifa Variable',
    feesDescription: 'Tarifas de pedido de su corredor. Estos se consideran tanto para la compra como para la venta.',
    
    // Settings - Legal
    legalHeading: 'LEGAL',
    aboutTradeTitle: 'Acerca de Trade',
    aboutTradeDescription: 'Trade es una calculadora de trading gratuita para traders e inversores privados. La aplicación ofrece cálculos precisos para trading, ahorro e inversiones con cálculo automático de impuestos.',
    supportEmail: 'Soporte:',
    version: 'Versión:',
    privacyPolicy: 'Política de Privacidad',
    privacyPolicyDesc: 'Aprende cómo protegemos tus datos',
    termsOfService: 'Términos de Servicio',
    termsOfServiceDesc: 'Lee nuestros términos y condiciones generales',
    imprint: 'Aviso Legal',
    imprintDesc: 'Información legal sobre el proveedor',
    termsTitle: 'Términos de Servicio',
    privacyTitle: 'Política de Privacidad',
    imprintTitle: 'Aviso Legal',
    termsHtml: `
      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Proveedor y contacto</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        El proveedor de este sitio web y de la herramienta es LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG, Bizetstrasse 111, 13088 Berlin, Alemania. Contacto: [Marcador de correo], [Marcador de telefono]. Registro mercantil: [Marcador], Representantes autorizados: Leonard George Toader, Pepe Rene Cruz, Thomas Markendorf.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. Ambito de aplicacion</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Estos terminos regulan el uso del sitio web "Calculo" y de sus calculadoras y funciones (la "Herramienta"). Al usar la Herramienta, aceptas estos terminos.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Servicios</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        La Herramienta proporciona calculos e informacion para trading, ahorro e inversiones. El contenido es solo informativo y no sustituye el asesoramiento individual.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. Sin asesoramiento financiero, fiscal o legal</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Todos los calculos se proporcionan sin garantia. La Herramienta no ofrece asesoramiento financiero, fiscal ni legal. Para orientacion vinculante, consulta a profesionales cualificados.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. Registro y almacenamiento local</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Si se ofrece registro, este se realiza localmente en tu navegador. Las entradas, ajustes y calculos se almacenan solo de forma local (localStorage). No se transmiten datos a servidores externos ni a terceros.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. Obligaciones del usuario</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Eres responsable de la exactitud de tus datos y utilizas la Herramienta bajo tu propio riesgo. No debes usarla de forma indebida, especialmente para interferir, manipular o eludir funciones de seguridad.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Disponibilidad y cambios</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Nos esforzamos por una alta disponibilidad, pero no la garantizamos. Podemos modificar, restringir o discontinuar funciones en cualquier momento.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Cuenta Pro y precios</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        La cuenta Pro es opcional y desbloquea funciones avanzadas. Los precios y condiciones actuales se muestran en la Herramienta (p. ej., 1,99 EUR/mes). Las suscripciones pueden cancelarse en cualquier momento; luego se desactivan las funciones Pro.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">9. Responsabilidad</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        No asumimos responsabilidad por danos derivados del uso o no uso de la Herramienta, en especial perdidas financieras basadas en calculos o decisiones. La responsabilidad legal obligatoria permanece intacta.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">10. Disposiciones finales</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Se aplica el derecho aleman. En la medida permitida por la ley, el fuero es Berlin. Si alguna disposicion fuera invalida, las demas disposiciones seguiran vigentes.
      </p>

      <p style="color:var(--muted);font-size:12px;margin-top:24px">Ultima actualizacion: <span data-last-updated="true"></span></p>
    `,
    privacyHtml: `
      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Responsable</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        El responsable del tratamiento es LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG, Bizetstrasse 111, 13088 Berlin, Alemania. Contacto: [Marcador de correo], [Marcador de telefono].
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. Notas generales</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Nos tomamos en serio la proteccion de tus datos. Esta politica explica que datos se procesan al usar la Herramienta.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Datos tratados</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Solo se tratan los datos que introduces (p. ej., valores de trading y ahorro, ajustes y, opcionalmente, correo y contrasena para inicio local).
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. Almacenamiento local</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Todos los datos se almacenan localmente en tu navegador (localStorage). No se transmiten datos a servidores externos ni a terceros.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. Sin terceros ni seguimiento</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        No se usan cookies de terceros, herramientas de analitica ni seguimiento. Tu comportamiento de uso no se registra.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. Seguridad de datos</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Dado que los datos se almacenan solo en tu dispositivo, la seguridad de tus datos es tu responsabilidad. Protege tu dispositivo contra accesos no autorizados.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Tus derechos</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Puedes eliminar tus datos locales en cualquier momento desde la configuracion del navegador. Si tienes preguntas, puedes contactarnos mediante los datos indicados.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Cambios</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Esta politica puede actualizarse cuando sea necesario. Los cambios se anunciaran en la Herramienta.
      </p>

      <p style="color:var(--muted);font-size:12px;margin-top:24px">Ultima actualizacion: <span data-last-updated="true"></span></p>
    `,
    imprintHtml: `
      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Datos conforme al § 5 TMG</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG<br>
        Bizetstrasse 111<br>
        13088 Berlin<br>
        Alemania
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. Contacto</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Correo: [Marcador de correo]<br>
        Telefono: [Marcador de telefono]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Registro mercantil</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Registro mercantil: [Marcador]<br>
        Juzgado de registro: [Marcador]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. Representantes autorizados</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Leonard George Toader, Pepe Rene Cruz, Thomas Markendorf
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. NIF-IVA</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Numero de identificacion a efectos de IVA conforme al § 27 a UStG: [Marcador]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. Responsable del contenido</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        [Marcador conforme al § 18 Abs. 2 MStV]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Responsabilidad por contenidos</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Los contenidos de nuestras paginas y de la app se han creado con la mayor diligencia. Sin embargo, no podemos garantizar la exactitud, integridad o actualidad de los contenidos.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Responsabilidad por enlaces</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Este sitio puede contener enlaces a paginas externas de terceros. No tenemos influencia sobre su contenido. El proveedor respectivo es siempre responsable del contenido de las paginas enlazadas.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">9. Aviso sobre informacion financiera</h3>
      <div style="background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:12px;padding:20px;margin-bottom:16px">
        <p style="color:var(--text);font-size:14px;line-height:1.7;font-weight:600;margin-bottom:8px">
          Aviso importante: Sin asesoramiento financiero ni de inversion
        </p>
        <p style="color:var(--text);font-size:13px;line-height:1.7">
          La informacion y las herramientas proporcionadas en este sitio son solo informativas y no constituyen una recomendacion de compra o venta de instrumentos financieros. No se ofrece asesoramiento fiscal ni legal.
        </p>
      </div>

      <p style="color:var(--muted);font-size:12px;margin-top:24px">Ultima actualizacion: <span data-last-updated="true"></span></p>
    `,
    allRightsReserved: 'Todos los derechos reservados.',
    contributions: 'Contribuciones',
    pureInterest: 'Interés Puro',
    realValueInflation: 'Valor Real (Ajustado por Inflación)',
    moreDetails: 'Más Detalles con Trade Pro',
    seeRealValue: 'Ve el valor real y los impuestos de tus planes de ahorro',
    upgradeFor: 'Actualizar por 1,99€/mes',
    anytime: 'Cancelar en cualquier momento',
    proFeature: 'FUNCI\u00d3N PRO',
    compareHistorical: 'Compara retornos históricos promedio de ETFs populares',
    unlockETF: 'Desbloquear Base de Datos ETF',
    accessHistorical: 'Acceso a datos históricos de los últimos 10 años. Compara rendimiento, TER y simula tu plan de ahorro.',
    upgradeNow: 'Actualizar ahora por 1,99€/mes',
    popularETFs: 'ETFs Populares',
    descending: 'Descendente',
    ascending: 'Ascendente',
    sortBy: 'Ordenar por',
    sortByName: 'Ordenar por: Nombre',
    sortByReturn1Y: 'Ordenar por: Rentabilidad 1 Año',
    sortByReturn3Y: 'Ordenar por: Rentabilidad 3 Años',
    sortByReturn5Y: 'Ordenar por: Rentabilidad 5 Años',
    sortByReturn10Y: 'Ordenar por: Rentabilidad 10 Años',
    sortByTER: 'Ordenar por: Ratio de Gastos Totales (TER)',
    whatIsTER: '¿Qué es TER (Ratio de Gastos Totales)?',
    returnComparison: 'Comparación de Rentabilidad (10 Años)',
    selectedETFs: 'ETFs seleccionados',
    selectUpTo2: 'Selecciona hasta 2 ETFs de la lista a continuación para compararlos',
    noETFsFound: 'No se encontraron ETFs',
    tryDifferent: 'Prueba con otro término de búsqueda',
    noteHistorical: 'Nota: Las rentabilidades mostradas son promedios históricos y no garantizan desarrollos futuros. TER = Ratio de Gastos Totales (Total Expense Ratio). Toda la información sin garantía.',
    category: 'Cat.',
    
    // Allgemein
    save: 'Guardar',
    cancel: 'Cancelar',
    delete: 'Eliminar',
    edit: 'Editar',
    close: 'Cerrar',
    yes: 'Sí',
    no: 'No',
    optional: 'opcional',
    loading: 'Cargando...',
    
    // Home - Extendido
    financialPlanningReimagined: 'Planificación Financiera Reinventada',
    financialPlanningDesc: 'Optimizado para trading, ahorro e inversiones. Con cálculo automático de impuestos, trading con apalancamiento, gestión de stop-loss e interfaz intuitiva.',
    capitalGainsTax: 'Impuesto sobre Plusvalías',
    capitalGainsTaxLabel: 'Impuesto sobre Plusvalías (26,375%)',
    taxFreeAllowance: 'Desgravación Fiscal',
    per: 'Por',
    perMonth: 'mes',
    perYear: 'año',
    proPerMonth: 'Pro mes',
    country: 'País',
    countryForTax: 'País (para cálculo de impuestos)',
    taxRateInfo: 'Tasa impositiva',
    taxAllowanceInfo: 'Desgravación fiscal',
    noTax: 'Sin impuesto sobre ganancias',
    howItWorks: 'Cómo Funciona',
    step1Title: 'Introducir Valores',
    step1Desc: 'Introduce tus datos de trading: precio de entrada, cantidad y precio objetivo. Opcionalmente, también puedes simular compras adicionales y ventas parciales.',
    step2Title: 'Cálculo Automático',
    step2Desc: 'La herramienta calcula automáticamente tu beneficio neto teniendo en cuenta las comisiones del broker y el impuesto alemán sobre plusvalías.',
    step3Title: 'Guardar Posición',
    step3Desc: 'Guarda tus operaciones en el historial y mantén un seguimiento de tu rendimiento y desgravación fiscal restante.',
    step4Title: 'Seguir Rendimiento',
    step4Desc: 'Analiza tu éxito en el trading con gráficos detallados y mantén todas las métricas importantes a la vista.',
    yourAdvantages: 'Tus Ventajas',
    preciseCalculations: 'Cálculos Precisos',
    preciseCalculationsDesc: 'Cálculos exactos de beneficios considerando todas las comisiones e impuestos.',
    dataPrivacy: '100% Privacidad de Datos',
    dataPrivacyDesc: 'Los datos de cuenta se almacenan de forma segura en la nube (Firebase). Sin inicio de sesión, los datos quedan locales en tu navegador.',
    fastSpeed: 'Ultrarrápido',
    fastSpeedDesc: 'Sin tiempos de carga, cálculos instantáneos. Funciona completamente sin conexión después de la primera carga.',
    multiBroker: 'Soporte Multi-Broker',
    multiBrokerDesc: 'Modelos de comisiones preconfigurados para Finanzen.net Zero, Smartbroker+, justTRADE, Trade Republic, Scalable Capital, Flatex, Comdirect, ING, Consorsbank, Commerzbank, DKB, Interactive Brokers y brokers personalizados.',
    tradingHistory: 'Historial de Trading',
    noPositionsSaved: 'Aún no hay posiciones guardadas',
    saveFirstPosition: 'Guarda tu primera posición para verla aquí',
    
    // Trading Modals
    addBuy: 'Compra Adicional -',
    buyPrice: 'Precio de Compra',
    quantity: 'Cantidad',
    pieces: 'Pzs.',
    newAverage: 'Nuevo Promedio',
    invested: 'Invertido',
    confirmBuy: 'Confirmar Compra',
    partialSell: 'Venta Parcial +',
    sellPrice: 'Precio de Venta',
    sellQuantity: 'Cantidad de Venta',
    remaining: 'Restante',
    profitFromSale: 'Ganancia de Venta',
    confirmSell: 'Confirmar Venta',
    addBuyBtn: 'Compra Adicional +',
    partialSellBtn: 'Venta Parcial +',
    netProfit: 'BENEFICIO NETO',
    grossProfit: 'BENEFICIO BRUTO',
    
    // Position Cards
    unnamedPosition: 'Posición Sin Nombre',
    entry: 'Entrada',
    target: 'Objetivo',
    quantity: 'Cantidad',
    yield: 'Rendimiento',
    profit: 'Beneficio',
    net: 'Neto',
    gross: 'Bruto',
    toggle: 'Cambiar',
    tradingHistoryDesc: 'Guarda y rastrea todas tus operaciones con información detallada sobre beneficio, rentabilidad y momento.',
    freeStart: 'Empezar Gratis',
    freeStartDesc: 'Completamente gratuito con todas las funciones básicas. Opcional: Cuenta Pro por 1,99€/mes con funciones avanzadas.',
    faq: 'Preguntas Frecuentes',
    faqQ1: '¿Cómo se almacenan mis datos?',
    faqA1: 'Al iniciar sesión, los datos de cuenta se almacenan de forma segura en la nube (Firebase/Firestore). Sin inicio de sesión, los datos quedan locales en tu navegador.',
    faqQ2: '¿Qué brokers son compatibles?',
    faqA2: 'Ofrecemos modelos de comisiones preconfigurados para Finanzen.net Zero, Smartbroker+, justTRADE, Trade Republic, Scalable Capital, Flatex, Comdirect, ING, Consorsbank, Commerzbank, DKB e Interactive Brokers. También puedes introducir comisiones personalizadas para cualquier broker.',
    faqQ3: '¿Cómo se calculan los impuestos?',
    faqA3: 'El impuesto sobre plusvalías en Alemania es del 26,375% (25% impuesto sobre plusvalías + 5,5% recargo de solidaridad). La desgravación de 1.000€ al año se tiene en cuenta automáticamente.',
    faqQ4: '¿Puedo cambiar entre bruto y neto?',
    faqA4: '¡Sí! En todos los cálculos, puedes cambiar entre bruto (antes de impuestos/comisiones) y neto (después de la deducción) haciendo clic en la visualización del beneficio.',
    faqQ5: '¿Necesito una cuenta?',
    faqA5: 'Una cuenta es opcional. Sin registro puedes usar todas las calculadoras. Con una cuenta, tus posiciones guardadas están vinculadas a tu perfil.',
    yourOpinionMatters: '¡Tu Opinión Cuenta!',
    feedbackCTA: 'Ayúdanos a mejorar Trade aún más. Comparte tus ideas, deseos o reporta problemas – cada comentario es apreciado y considerado.',
    giveFeedback: 'Dar Feedback',
    
    // Delete Dialogs
    deletePosition: 'Eliminar Posición',
    confirmDeletePosition: '¿Estás seguro de que deseas eliminar permanentemente esta posición?',
    deletePositionWarning: '¿Estás seguro de que deseas eliminar permanentemente esta posición?',
    deleteAllPositions: 'Eliminar Todas las Posiciones',
    deleteAllWarning: 'ADVERTENCIA: ¿Estás a punto de eliminar permanentemente {count} posición(es)!',
    irreversibleAction: 'Esta acción no se puede deshacer.',
    deleteButtonText: 'Eliminar',
    deleteAllButtonText: 'Eliminar Todo',
    
    // Buttons
    calculate: 'Calcular',
    saveTrade: 'Guardar Posición',
    loginToSave: 'Inicia sesion para guardar',
    addBuyBtn: 'Compra +',
    partialSellBtn: 'Venta +',
    upgradeNow: 'Actualizar Ahora',
    exportData: 'Exportar Datos',
    cancelPro: 'Cancelar Pro',
    login: 'Iniciar Sesión',
    register: 'Registrarse',
    logoutBtn: 'Cerrar Sesión',
    privacyPolicy: 'Política de Privacidad',
    terms: 'Términos de Servicio',
    imprint: 'Aviso Legal',
    feedbackBtn: 'Enviar Comentarios',
    themeSystem: 'Sistema',
    themeLight: 'Claro',
    themeDark: 'Oscuro',
    understood: 'Entendido',
    cancel: 'Cancelar',
    
    // Form Validation
    fillAllFields: 'Por favor, completa todos los campos.',
    validEmail: 'Por favor, ingresa una direcci\u00f3n de correo v\u00e1lida.',
    noAccountFound: 'No se encontró ninguna cuenta con este correo.',
    wrongPassword: 'Contraseña incorrecta.',
    loginSuccess: '¡Iniciaste sesión correctamente!',
    acceptTermsRequired: 'Debes aceptar los términos de servicio y la política de privacidad para crear una cuenta.',
    passwordMinLength: 'La contraseña debe tener al menos 6 caracteres.',
    accountExists: 'Ya existe una cuenta con este correo.',
    registerSuccess: '¡Cuenta creada exitosamente! Serás conectado...',
    logoutConfirm: '¿Realmente deseas cerrar sesión?'
  },
  fr: {
    // Navigation
    home: 'Accueil',
    trading: 'Trading',
    sparen: 'Épargne',
    etf: 'Comparaison ETF',
    settings: 'Paramètres',
    
    // Home
    heroTitle: 'Trading Professionnel.<br>Simplement Calculé.',
    heroSubtitle: 'Calculez vos trades avec précision, planifiez à long terme et maximisez vos rendements – tout dans un seul outil. Avec compte Pro optionnel pour des fonctionnalités avancées.',
    startNow: 'Commencer',
    learnMore: 'En Savoir Plus',
    
    // Features
    tradingCalculator: 'Calculateur de Trading',
    tradingDesc: 'Calculez les profits, rendements, seuil de rentabilité, CRV et plus. Avec fonction de levier, stop-loss et calculs précis des taxes et frais.',
    savingsCalculator: 'Calculateur d\'épargne',
    savingsDesc: 'Planifiez votre avenir financier avec des taux d\'épargne intelligents, des calculs d\'intérêts composés et une analyse d\'inflation (Pro).',
    proAccount: 'Compte Pro',
    proDesc: 'Trades illimités, base de données ETF, calculateur d\'inflation et d\'impôts, export PDF/CSV et sans publicité – pour seulement 1,99€/mois.',
    
    // Settings
    appearance: 'Apparence',
    language: 'Langue',
    currency: 'Devise',
    dataManagement: 'Gestion des Données',
    exportData: 'Exporter les Données',
    legal: 'Mentions Légales',
    feedback: 'Portail de Commentaires',
    feedbackDesc: 'Partagez vos idées et aidez-nous à améliorer Trade',
    feedbackSupportHeading: 'AVIS & SUPPORT',
    positionNameOptionalLabel: 'Nom de la position (optionnel)',
    positionNamePlaceholder: 'ex. Apple Long, Bitcoin Short...',
    
    // Feedback
    feedbackTitle: 'Votre Avis est Précieux',
    feedbackSubtitle: 'Aidez-nous à améliorer Trade. Partagez vos idées, souhaits ou signalez des problèmes. Chaque commentaire est lu et pris en compte.',
    name: 'Nom',
    nameOptional: 'Nom (optionnel)',
    email: 'Email',
    emailOptional: 'Email (optionnel)',
    category: 'Catégorie',
    message: 'Votre Message',
    messagePlaceholder: 'Décrivez vos commentaires aussi précisément que possible...',
    categoryFeature: '🚨 Demande de Fonctionnalité',
    categoryBug: '🐛 Rapport de Bug',
    categoryImprovement: '💬 Suggestion d\'Amélioration',
    categoryDesign: '🎨 Retour sur le Design',
    categoryOther: '📝 Autre',
    privacyNotice: 'Confidentialité:',
    privacyText: 'Vos informations seront traitées de manière confidentielle et utilisées uniquement pour améliorer Trade. L\'e-mail et le nom sont facultatifs.',
    sendFeedback: 'Envoyer les Commentaires',
    thankYou: 'Merci!',
    feedbackSuccess: 'Votre commentaire a été envoyé avec succès. Nous apprécions beaucoup votre opinion et la prendrons en compte dans le développement futur.',
    backToHome: 'Retour à l\'Accueil',
    
    // Trading
    tradeCalculation: 'Calcul de Trade',
    entryPrice: 'Prix d\'Entrée',
    quantity: 'Quantité',
    targetPrice: 'Prix Cible',
    stopLoss: 'Stop Loss',
    leverage: 'Levier',
    position: 'Position',
    long: 'Long',
    short: 'Short',
    calculate: 'Calculer',
    profit: 'Profit',
    return: 'Rendement',
    saveTrade: 'Sauvegarder le Trade',
    investment: 'Investissement',
    fees: 'Frais',
    taxes: 'Impôts',
    netProfit: 'Profit Net',
    gross: 'Brut',
    net: 'Net',
    addBuy: 'Ajouter un Achat',
    partialSell: 'Vente Partielle',
    pieces: 'Pcs.',
    breakEven: 'Seuil de Rentabilité',
    crv: 'CRV (Risque-Rendement)',
    
    // Sparen
    savingsGoal: 'Objectif d\'épargne',
    monthlySavings: 'Épargne Mensuelle',
    duration: 'Durée',
    interestRate: 'Taux d\'Intérêt',
    years: 'Années',
    finalCapital: 'Capital Final',
    initialCapital: 'Capital Initial',
    totalContributions: 'Contributions Totales',
    interestEarned: 'Intérêts',
    realValue: 'Valeur Réelle',
    inflationRate: 'Taux d\'Inflation',
    yearlyIncrease: 'Augmentation Annuelle',
    
    // ETF
    etfDatabase: 'Base de Données ETF',
    etfComparison: 'Comparaison ETF',
    searchETF: 'Rechercher ETF...',
    selectETF: 'Sélectionner ETF',
    performance: 'Performance',
    year1: '1 An',
    year3: '3 Ans',
    year5: '5 Ans',
    year10: '10 Ans',
    ter: 'TER (Ratio de Frais Totaux)',
    description: 'Description',
    avgReturn: 'Rendement Moy. annuel',
    proFeature: 'FONCTION PRO',
    compareHistorical: 'Comparez les rendements moyens historiques des ETF populaires',
    unlockETF: 'Déverrouiller la base de données ETF',
    accessHistorical: 'Accédez aux données historiques des 10 dernières années. Comparez la performance, le TER et simulez votre plan d\'épargne.',
    upgradeNow: 'Passer à la version Pro à 1,99€/mois',
    popularETFs: 'ETF populaires',
    descending: 'Décroissant',
    ascending: 'Croissant',
    sortBy: 'Trier par',
    sortByName: 'Trier par : Nom',
    sortByReturn1Y: 'Trier par : Rendement 1 an',
    sortByReturn3Y: 'Trier par : Rendement 3 ans',
    sortByReturn5Y: 'Trier par : Rendement 5 ans',
    sortByReturn10Y: 'Trier par : Rendement 10 ans',
    sortByTER: 'Trier par : Ratio de Frais Totaux (TER)',
    whatIsTER: 'Qu\'est-ce que le TER (Ratio de Frais Totaux)?',
    returnComparison: 'Comparaison des rendements (10 ans)',
    selectedETFs: 'ETF sélectionnés',
    selectedETFsOfTwo: 'sur 2 ETF sélectionnés',
    selectUpTo2: 'Sélectionnez jusqu\'à 2 ETF dans la liste ci-dessous pour les comparer',
    noETFsFound: 'Aucun ETF trouvé',
    tryDifferent: 'Essayez un autre terme de recherche',
    noteHistorical: 'Note : Les rendements affichés sont des moyennes historiques et ne garantissent pas les performances futures. TER = Ratio de Frais Totaux (Total Expense Ratio). Informations sans garantie.',
    category: 'Cat.',
    etfDetailsTitle: 'Détails de l\'ETF',
    toComparison: 'Comparer',
    etfSelected: '? Sélectionné',
    etfTrustedBy: 'Plébiscité par des milliers',
    etfUnlockHeadline: 'Déverrouillez les fonctionnalités Pro',
    etfUnlockSubheading: 'Profitez de toute la puissance de 1 247 ETF professionnels avec 10 ans de données, des comparaisons illimitées et des analyses avancées - pour moins qu\'un café par mois.',
    etfStatHistorical: 'Données historiques',
    etfStatEtfs: 'ETF professionnels',
    etfStatCompare: 'Comparaisons illimitées',
    etfStatProfitability: 'Rentabilité fiable',
    etfUpgradeCta: 'Passer à la version Pro à 1,99€/mois',
    etfTrustCancelable: 'Annulable à tout moment',
    etfTrustFreeDays: '3 jours gratuits',
    etfTrustAllFeatures: 'Toutes les fonctionnalités tout de suite',
    etfTrustPrivacy: 'Confidentialité sécurisée',
    etfExpectTitle: 'Ce que vous obtenez',
    etfFeature1Title: '📈 Analyse de performance',
    etfFeature1Desc: 'Graphiques professionnels avec 10 ans d\'historique complet. Repérez tendances et motifs en un coup d\'œil.',
    etfFeature2Title: '🧩 Outil de comparaison',
    etfFeature2Desc: 'Comparez un nombre illimité d\'ETF côte à côte. Rendements, frais, risques en un coup d\'œil.',
    etfFeature3Title: '💸 Simulateur de plan d\'épargne',
    etfFeature3Desc: 'Testez des stratégies d\'épargne avec des données réelles. Voyez exactement où va votre argent et comment vous en profitez.',
    etfFeature4Title: '📊 Suivi de Portefeuille',
    etfFeature4Desc: 'Gardez vos investissements sous contrôle. Analyse automatique des performances et aperçus détaillés.',
    etfPreviewTitle: 'Aperçu : Voici à quoi ressemble votre base de données (aperçu flouté)',
    etfSample1Desc: 'Actions mondiales - 3 500+ entreprises',
    etfSample2Desc: 'Tech & croissance US - 500 meilleures entreprises',
    etfSample3Desc: 'Axé technologie - 100 plus grandes entreprises',
    etfInfoTitle: '✨ Analyses complètes',
    etfInfoDesc: 'Filtrer par coûts, régions, secteurs et plus – tous les 1.247 ETF avec des métriques détaillées',
    etfPreviewMore: '+ 1 244 ETF supplémentaires avec données complètes',
    etfPreviewAvailableAfter: 'Tous disponibles après l\'upgrade',
    etfAvg10y: 'Moy. 10 ans',
    etfStatHistoricalHtml: 'Données<br>historiques',
    etfStatEtfsHtml: 'ETF<br>professionnels',
    etfStatCompareHtml: 'Analyses<br>Détaillées',
    etfStatProfitabilityHtml: 'Rentabilité<br>fiable',
    etfTrustCancelableHtml: 'Annulable<br>à tout moment',
    etfTrustFreeDaysHtml: '3 jours<br>gratuits',
    etfTrustAllFeaturesHtml: 'Toutes les fonctionnalités<br>tout de suite',
    etfTrustPrivacyHtml: 'Confidentialité<br>sécurisée',
    
    // Settings
    appearance: 'Apparence',
    language: 'Langue',
    currency: 'Devise',
    dataManagement: 'Gestion des Données',
    exportData: 'Exporter les Données',
    legal: 'Mentions Légales',
    feedback: 'Portail de Commentaires',
    feedbackDesc: 'Partagez vos idées et aidez-nous à améliorer Trade',
    theme: 'Thème',
    system: 'Système',
    light: 'Clair',
    dark: 'Sombre',
    currencyTools: 'Devise et Outils',
    leverageFunction: 'Fonction Levier',
    analysisValues: 'Valeurs d\'Analyse',
    taxesDE: 'Impôts (DE)',
    taxFreeAmount: 'Montant Exempt d\'Impôt',
    taxRate: 'Taux d\'Imposition',
    alreadyUsed: 'Déjà Utilisé',
    broker: 'Courtier',
    currentBroker: 'Courtier Actuel',
    custom: 'Personnalisé',
    forecastParameters: 'Paramètres de Prévision',
    fixedCosts: 'Coûts Fixes',
    variableFee: 'Frais Variables',
    proAccountTitle: 'COMPTE PRO',
    tradePro: 'Trade Pro',
    advancedFeatures: 'Fonctionnalités avancées pour les traders sérieux',
    unlimitedTrades: 'Transactions Illimitées',
    saveAsMany: 'Enregistrez autant de transactions que vous le souhaitez',
    etfDatabaseAccess: 'Base de Données ETF',
    accessHistoricalReturns: 'Accès aux rendements historiques moyens',
    inflationTaxCalc: 'Calculateur d\'Inflation et d\'Impôts',
    preciseCalculation: 'Calcul précis avec impôts et inflation',
    pdfCsvExport: 'Export PDF/CSV',
    exportCalculations: 'Exportez vos calculs',
    adFree: 'Sans Publicité',
    noAds: 'Pas de bannières publicitaires gênantes',
    perMonth: 'par mois',
    perYear: 'par an',
    trialDays: 'Essai gratuit 3 jours',
    trialInfo: '3 jours gratuits - Annuler à tout moment',
    afterTrial: 'Après l\'essai 1,99€/mois ou 18,99€/an',
    monthsFree: '2 mois gratuits',
    noPaymentDuringTrial: 'Aucun paiement pendant l\'essai. Annuler à tout moment.',
    upgradeNowBtn: 'Mettre à niveau maintenant',
    cancelAnytime: 'Annuler à tout moment',
    active: 'ACTIF',
    allPremium: 'Toutes les fonctionnalités premium débloquées',
    cancelPro: 'Annuler Pro',
    chooseTheme: 'Choisissez entre le mode clair, sombre ou système.',
    leverageDesc: 'La fonction de levier permet le calcul de produits dérivés (Long/Short).',
    breakEvenPrice: 'Prix de Seuil de Rentabilité',
    crvRatio: 'CRV (Risque-Récompense)',
    breakEvenDesc: 'Le break-even montre le prix auquel vous êtes en gain, frais inclus. Le CRV évalue le rapport entre l\'objectif de gain et le stop loss.',
    breakEvenModalTitle: 'Prix de Seuil de Rentabilité',
    breakEvenModalDesc: 'Le prix auquel votre transaction, en tenant compte de tous les frais d\'achat et de vente, est exactement à 0 de profit/perte. À partir de ce point, vous êtes dans la zone de profit.',
    crvModalTitle: 'CRV - Ratio Risque-Récompense',
    crvModalDesc: 'Le rapport entre votre profit potentiel et votre risque (distance au stop-loss). Un CRV de 2.0 signifie que votre objectif de profit est deux fois plus élevé que votre risque de perte possible.',
    understood: 'Compris',
    remaining2026: 'Restant 2026',
    used: 'utilisé',
    yearlyAllowance: 'Abattement Annuel',
    taxInfo: 'En Allemagne, l\'impôt sur les plus-values y compris la contribution de solidarité est de 26,375%. L\'abattement de 1.000€ est automatiquement renouvelé le 1er janvier de chaque année. Les transactions sauvegardées sont automatiquement attribuées à l\'année correspondante.',
    sparAssetDevelopment: 'DÉVELOPPEMENT DES ACTIFS',
    sparCalculationMode: 'MODE DE CALCUL',
    sparDeposits: 'Dépôts',
    sparPureInterest: 'INTÉRÊT PUR',
    crvRatioLabel: 'CRV (RISQUE/RÉCOMPENSE)',
    totalCapital: 'Capital Total',
    depositsDesc: 'Somme du capital initial et des taux d\'épargne incluant la dynamique.',
    pureInterestDesc: 'Le profit total des intérêts et des intérêts composés.',
    requiredRate: 'TAUX REQUIS',
    
    // ETF
    zeroETFs: '(0 ETFs)',
    terModalDesc: 'TER (Ratio de Frais Totaux) indique les frais annuels continus d\'un ETF',
    terExampleLabel: 'EXEMPLE',
    terExample: 'Avec un TER de 0,20% et un investissement de €10 000 vous payez €20 par an en frais.',
    lowerTERBetter: 'TER plus bas = Meilleur pour toi!',
    terIncludes: 'Le TER comprend les frais de gestion, les frais d\'exploitation et autres dépenses permanentes. Il est automatiquement déduit des actifs du fonds et est déjà reflété dans l\'évolution de la valeur.',
    
    // Settings - Broker
    brokerHeading: 'BROKER',
    currentBrokerLabel: 'Courtier Actuel',
    customBroker: 'Personnalisé',
    
    // Settings - Forecast Parameters
    forecastParametersHeading: 'PARAMÈTRES DE PRÉVISION',
    inflationRateLabel: 'Taux d\'Inflation',
    yearlyIncreaseLabel: 'Augmentation Annuelle',
    forecastDescription: 'Le taux d\'inflation est utilisé pour le calcul de la valeur réelle dans la calculatrice d\'épargne. L\'augmentation annuelle augmente automatiquement votre taux d\'épargne du pourcentage spécifié par an.',
    brokerFinanzenZero: 'Finanzen.net Zero',
    brokerSmartbrokerPlus: 'Smartbroker+',
    brokerJustTrade: 'justTRADE',
    brokerTradeRepublic: 'Trade Republic',
    brokerScalableCapital: 'Scalable Capital',
    brokerFlatex: 'Flatex',
    brokerComdirect: 'Comdirect',
    brokerIng: 'ING',
    brokerConsorsbank: 'Consorsbank',
    brokerCommerzbank: 'Commerzbank',
    brokerDkb: 'DKB',
    brokerInteractiveBrokers: 'Interactive Brokers',
    
    // Login/Register
    loginBtn: 'Se connecter',
    loginModalTitle: 'Se connecter',
    loginTab: 'Se connecter',
    registerTab: 'S\'inscrire',
    emailLabel: 'Adresse e-mail',
    emailPlaceholder: 'votre@email.fr',
    passwordLabel: 'Mot de passe',
    passwordPlaceholder: '********',
    acceptTerms: 'J\'accepte les',
    termsLink: 'Conditions d\'utilisation',
    andThe: 'et la',
    privacyLink: 'Politique de confidentialité',
    loginSubmit: 'Se connecter',
    registerSubmit: 'S\'inscrire',
    
    // Settings - Fees
    feesHeading: 'FRAIS',
    fixedCostsLabel: 'Coûts Fixes',
    variableFeeLabel: 'Frais Variables',
    feesDescription: 'Frais de commande de votre courtier. Ceux-ci sont pris en compte à la fois pour l\'achat et la vente.',
    
    // Settings - Legal
    legalHeading: 'LÉGAL',
    aboutTradeTitle: 'À Propos de Trade',
    aboutTradeDescription: 'Trade est une calculatrice de trading gratuite pour les traders et investisseurs privés. L\'application offre des calculs précis pour le trading, l\'épargne et les investissements avec calcul automatique des impôts.',
    supportEmail: 'Support:',
    version: 'Version:',
    privacyPolicy: 'Politique de Confidentialité',
    privacyPolicyDesc: 'Découvrez comment nous protégeons vos données',
    termsOfService: 'Conditions d\'Utilisation',
    termsOfServiceDesc: 'Lisez nos conditions générales',
    imprint: 'Mentions Légales',
    imprintDesc: 'Informations légales sur le fournisseur',
    termsTitle: 'Conditions d\'Utilisation',
    privacyTitle: 'Politique de Confidentialité',
    imprintTitle: 'Mentions Légales',
    termsHtml: `
      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Fournisseur et contact</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Le fournisseur de ce site et de l'outil est LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG, Bizetstrasse 111, 13088 Berlin, Allemagne. Contact: [Marqueur e-mail], [Marqueur telephone]. Registre du commerce: [Marqueur], Representants autorises: Leonard George Toader, Pepe Rene Cruz, Thomas Markendorf.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. Champ d'application</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Les presentes conditions regissent l'utilisation du site "Calculo" et de ses calculateurs et fonctionnalites (l'"Outil"). En utilisant l'Outil, tu acceptes ces conditions.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Services</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        L'Outil fournit des calculs et des informations pour le trading, l'epargne et les investissements. Le contenu est fourni a titre informatif et ne remplace pas un conseil individuel.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. Aucun conseil financier, fiscal ou juridique</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Tous les calculs sont fournis sans garantie. L'Outil ne fournit pas de conseil financier, fiscal ou juridique. Pour des informations contraignantes, consulte des professionnels qualifies.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. Inscription et stockage local</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Si une inscription est proposee, elle est geree localement dans ton navigateur. Les saisies, parametres et calculs sont stockes localement uniquement (localStorage). Aucune transmission vers des serveurs externes ou des tiers n'a lieu.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. Obligations de l'utilisateur</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Tu es responsable de l'exactitude de tes saisies et utilises l'Outil a tes risques. Tu ne dois pas utiliser l'Outil de maniere abusive, notamment pour perturber, manipuler ou contourner des fonctions de securite.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Disponibilite et modifications</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Nous nous efforcons d'assurer une haute disponibilite sans la garantir. Nous pouvons modifier, restreindre ou interrompre des fonctionnalites a tout moment.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Compte Pro et prix</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Le compte Pro est optionnel et debloque des fonctionnalites avancees. Les prix et conditions actuels sont affiches dans l'Outil (par ex. 1,99 EUR/mois). Les abonnements peuvent etre resilies a tout moment; les fonctions Pro sont alors desactivees.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">9. Responsabilite</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Nous ne sommes pas responsables des dommages lies a l'utilisation ou a la non-utilisation de l'Outil, notamment des pertes financieres basees sur des calculs ou des decisions. La responsabilite legale obligatoire demeure.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">10. Dispositions finales</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Le droit allemand s'applique. Dans la mesure permise par la loi, le for juridique est Berlin. Si une disposition est invalide, les autres dispositions restent valables.
      </p>

      <p style="color:var(--muted);font-size:12px;margin-top:24px">Derniere mise a jour: <span data-last-updated="true"></span></p>
    `,
    privacyHtml: `
      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Responsable</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Le responsable du traitement est LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG, Bizetstrasse 111, 13088 Berlin, Allemagne. Contact: [Marqueur e-mail], [Marqueur telephone].
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. Informations generales</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        La protection de tes donnees est importante pour nous. Cette politique explique quelles donnees sont traitees lors de l'utilisation de l'Outil.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Donnees traitees</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Seules les donnees que tu saisis sont traitees (par ex. valeurs de trading et d'epargne, parametres, et eventuellement e-mail et mot de passe pour connexion locale).
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. Stockage local</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Toutes les donnees sont stockees localement dans ton navigateur (localStorage). Aucune transmission vers des serveurs externes ou des tiers.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. Aucun tiers, aucun suivi</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Aucun cookie tiers, aucun outil d'analyse et aucun suivi ne sont utilises. Ton comportement d'utilisation n'est pas enregistre.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. Securite des donnees</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Comme les donnees sont stockees uniquement sur ton appareil, la securite de tes donnees releve de ta responsabilite. Protege ton appareil contre les acces non autorises.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Tes droits</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Tu peux supprimer tes donnees locales a tout moment dans les parametres du navigateur. Si tu as des questions, contacte-nous via les coordonnees indiquees.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Modifications</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Cette politique peut etre mise a jour si necessaire. Les modifications seront annoncees dans l'Outil.
      </p>

      <p style="color:var(--muted);font-size:12px;margin-top:24px">Derniere mise a jour: <span data-last-updated="true"></span></p>
    `,
    imprintHtml: `
      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">1. Informations conformes au § 5 TMG</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        LTP-TMC UG (haftungsbeschraenkt) &amp; CO. KG<br>
        Bizetstrasse 111<br>
        13088 Berlin<br>
        Allemagne
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">2. Contact</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        E-mail: [Marqueur e-mail]<br>
        Telephone: [Marqueur telephone]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">3. Registre du commerce</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Registre du commerce: [Marqueur]<br>
        Tribunal d'enregistrement: [Marqueur]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">4. Representants autorises</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Leonard George Toader, Pepe Rene Cruz, Thomas Markendorf
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">5. TVA intracommunautaire</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Numero d'identification TVA conforme au § 27a UStG: [Marqueur]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">6. Responsable du contenu</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        [Marqueur conforme au § 18 Abs. 2 MStV]
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">7. Responsabilite concernant le contenu</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Les contenus de nos pages et de l'application ont ete crees avec le plus grand soin. Toutefois, nous ne pouvons garantir l'exactitude, l'exhaustivite ou l'actualite des contenus.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">8. Responsabilite concernant les liens</h3>
      <p style="margin-bottom:16px;color:var(--muted)">
        Ce site peut contenir des liens vers des sites tiers. Nous n'avons aucune influence sur leur contenu. Le fournisseur respectif est toujours responsable du contenu des pages liees.
      </p>

      <h3 style="margin-top:20px;margin-bottom:12px;color:var(--accent)">9. Avis sur les informations financieres</h3>
      <div style="background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:12px;padding:20px;margin-bottom:16px">
        <p style="color:var(--text);font-size:14px;line-height:1.7;font-weight:600;margin-bottom:8px">
          Avis important: Aucun conseil financier ou d'investissement
        </p>
        <p style="color:var(--text);font-size:13px;line-height:1.7">
          Les informations et outils fournis sur ce site sont a titre informatif uniquement et ne constituent pas une recommandation d'achat ou de vente d'instruments financiers. Aucun conseil fiscal ou juridique n'est fourni.
        </p>
      </div>

      <p style="color:var(--muted);font-size:12px;margin-top:24px">Derniere mise a jour: <span data-last-updated="true"></span></p>
    `,
    allRightsReserved: 'Tous droits réservés.',
    contributions: 'Contributions',
    pureInterest: 'Intérêt Pur',
    realValueInflation: 'Valeur Réelle (Ajustée pour l\'Inflation)',
    moreDetails: 'Plus de Détails avec Trade Pro',
    seeRealValue: 'Voir la valeur réelle et les impôts de vos plans d\'épargne',
    upgradeFor: 'Mettre à niveau pour 1,99€/mois',
    anytime: 'Annuler à tout moment',
    proFeature: 'FONCTION PRO',
    compareHistorical: 'Comparez les rendements historiques moyens des ETF populaires',
    unlockETF: 'Débloquer la Base de Données ETF',
    accessHistorical: 'Accès aux données historiques des 10 dernières années. Comparez les performances, le TER et simulez votre plan d\'épargne.',
    upgradeNow: 'Mettre à niveau maintenant pour 1,99€/mois',
    popularETFs: 'ETF Populaires',
    descending: 'Descendant',
    ascending: 'Ascendant',
    sortBy: 'Trier par',
    sortByName: 'Trier par: Nom',
    sortByReturn1Y: 'Trier par: Rendement 1 An',
    sortByReturn3Y: 'Trier par: Rendement 3 Ans',
    sortByReturn5Y: 'Trier par: Rendement 5 Ans',
    sortByReturn10Y: 'Trier par: Rendement 10 Ans',
    sortByTER: 'Trier par: Ratio de Frais Totaux (TER)',
    whatIsTER: 'Qu\'est-ce que le TER (Ratio de Frais Totaux)?',
    returnComparison: 'Comparaison des Rendements (10 Ans)',
    selectedETFs: 'ETF sélectionnés',
    selectUpTo2: 'Sélectionnez jusqu\'à 2 ETF dans la liste ci-dessous pour les comparer',
    noETFsFound: 'Aucun ETF trouvé',
    tryDifferent: 'Essayez un autre terme de recherche',
    noteHistorical: 'Note : Les rendements indiqués sont des moyennes historiques et ne garantissent pas les développements futurs. TER = Ratio de Frais Totaux (Total Expense Ratio). Toutes les informations sans garantie.',
    category: 'Cat.',
    
    // Allgemein
    save: 'Enregistrer',
    cancel: 'Annuler',
    delete: 'Supprimer',
    edit: 'Modifier',
    close: 'Fermer',
    yes: 'Oui',
    no: 'Non',
    optional: 'optionnel',
    loading: 'Chargement...',
    
    // Home - Étendu
    financialPlanningReimagined: 'Planification Financière Réinventée',
    financialPlanningDesc: 'Optimisé pour le trading, l\'épargne et les investissements. Avec calcul automatique des impôts, trading avec effet de levier, gestion stop-loss et interface intuitive.',
    capitalGainsTax: 'Impôt sur les Plus-Values',
    capitalGainsTaxLabel: 'Impôt sur les Plus-Values (26,375%)',
    taxFreeAllowance: 'Abattement Fiscal',
    per: 'Pro',
    perMonth: 'Mois',
    perYear: 'An',
    proPerMonth: 'Pro Mois',
    country: 'Pays',
    countryForTax: 'Pays (pour calcul fiscal)',
    taxRateInfo: 'Taux d\'imposition',
    taxAllowanceInfo: 'Abattement fiscal',
    noTax: 'Pas d\'impôt sur les plus-values',
    howItWorks: 'Comment ça Marche',
    step1Title: 'Saisir les Valeurs',
    step1Desc: 'Entrez vos données de trading : prix d\'entrée, quantité et prix cible. En option, vous pouvez également simuler des achats supplémentaires et des ventes partielles.',
    step2Title: 'Calcul Automatique',
    step2Desc: 'L\'outil calcule automatiquement votre profit net en tenant compte des frais de courtage et de l\'impôt allemand sur les plus-values.',
    step3Title: 'Enregistrer la Position',
    step3Desc: 'Enregistrez vos transactions dans l\'historique et gardez un aperçu de votre performance et de l\'abattement fiscal restant.',
    step4Title: 'Suivre la Performance',
    step4Desc: 'Analysez votre succès en trading avec des graphiques détaillés et gardez tous les indicateurs importants en vue.',
    yourAdvantages: 'Vos Avantages',
    preciseCalculations: 'Calculs Précis',
    preciseCalculationsDesc: 'Calculs exacts des bénéfices en tenant compte de tous les frais et impôts.',
    dataPrivacy: '100% Confidentialité',
    dataPrivacyDesc: 'Les données de compte sont stockées de façon sécurisée dans le cloud (Firebase). Sans connexion, les données restent locales dans votre navigateur.',
    fastSpeed: 'Ultra Rapide',
    fastSpeedDesc: 'Aucun temps de chargement, calculs instantanés. Fonctionne complètement hors ligne après le premier chargement.',
    multiBroker: 'Support Multi-Courtiers',
    multiBrokerDesc: 'Modèles de frais préconfigurés pour Finanzen.net Zero, Smartbroker+, justTRADE, Trade Republic, Scalable Capital, Flatex, Comdirect, ING, Consorsbank, Commerzbank, DKB, Interactive Brokers et courtiers personnalisés.',
    tradingHistory: 'Historique de Trading',
    noPositionsSaved: 'Aucune position enregistrée',
    saveFirstPosition: 'Enregistrez votre première position pour la voir ici',
    
    // Trading Modals
    addBuy: 'Achat Supplémentaire -',
    buyPrice: 'Prix d\'Achat',
    quantity: 'Quantité',
    pieces: 'Pcs.',
    newAverage: 'Nouvelle Moyenne',
    invested: 'Investi',
    confirmBuy: 'Confirmer l\'Achat',
    partialSell: 'Vente Partielle +',
    sellPrice: 'Prix de Vente',
    sellQuantity: 'Quantité de Vente',
    remaining: 'Restant',
    profitFromSale: 'Profit de Vente',
    confirmSell: 'Confirmer la Vente',
    addBuyBtn: 'Achat Supplémentaire +',
    partialSellBtn: 'Vente Partielle +',
    netProfit: 'PROFIT NET',
    grossProfit: 'PROFIT BRUT',
    
    // Position Cards
    unnamedPosition: 'Position Sans Nom',
    entry: 'Entrée',
    target: 'Objectif',
    quantity: 'Quantité',
    yield: 'Rendement',
    profit: 'Profit',
    net: 'Net',
    gross: 'Brut',
    toggle: 'Changer',
    tradingHistoryDesc: 'Enregistrez et suivez toutes vos transactions avec des informations détaillées sur le profit, le rendement et le moment.',
    freeStart: 'Commencer Gratuitement',
    freeStartDesc: 'Entièrement gratuit avec toutes les fonctionnalités de base. Option : Compte Pro pour 1,99€/mois avec fonctionnalités avancées.',
    faq: 'Questions Fréquentes',
    faqQ1: 'Comment mes données sont-elles stockées?',
    faqA1: 'Lorsque vous vous connectez, les donnees de compte sont stockees de facon securisee dans le cloud (Firebase/Firestore). Sans connexion, les donnees restent locales dans votre navigateur.',
    faqQ2: 'Quels courtiers sont pris en charge?',
    faqA2: 'Nous proposons des modèles de frais préconfigurés pour Finanzen.net Zero, Smartbroker+, justTRADE, Trade Republic, Scalable Capital, Flatex, Comdirect, ING, Consorsbank, Commerzbank, DKB et Interactive Brokers. Vous pouvez également saisir des frais personnalisés pour n\'importe quel courtier.',
    faqQ3: 'Comment les impôts sont-ils calculés?',
    faqA3: 'L\'impôt sur les plus-values en Allemagne est de 26,375% (25% impôt sur les plus-values + 5,5% contribution de solidarité). L\'abattement de 1.000€ par an est automatiquement pris en compte.',
    faqQ4: 'Puis-je basculer entre brut et net?',
    faqA4: 'Oui! Pour tous les calculs, vous pouvez basculer entre brut (avant impôts/frais) et net (après déduction) en cliquant sur l\'affichage du profit.',
    faqQ5: 'Ai-je besoin d\'un compte?',
    faqA5: 'Un compte est optionnel. Sans inscription, vous pouvez utiliser toutes les calculatrices. Avec un compte, vos positions sauvegardées sont liées à votre profil.',
    yourOpinionMatters: 'Votre Opinion Compte!',
    feedbackCTA: 'Aidez-nous à améliorer Trade encore plus. Partagez vos idées, souhaits ou signalez des problèmes - chaque retour est apprécié et pris en compte.',
    giveFeedback: 'Donner un Feedback',
    
    // Delete Dialogs
    deletePosition: 'Supprimer la Position',
    confirmDeletePosition: 'Êtes-vous certain de vouloir supprimer définitivement cette position?',
    deletePositionWarning: 'Êtes-vous certain de vouloir supprimer définitivement cette position?',
    deleteAllPositions: 'Supprimer Toutes les Positions',
    deleteAllWarning: 'ATTENTION: Vous êtes sur le point de supprimer définitivement {count} position(s)!',
    irreversibleAction: 'Cette action ne peut pas être annulée.',
    deleteButtonText: 'Supprimer',
    deleteAllButtonText: 'Supprimer Tout',
    
    // Buttons
    calculate: 'Calculer',
    saveTrade: 'Enregistrer la Position',
    loginToSave: 'Connexion pour enregistrer',
    addBuyBtn: 'Achat +',
    partialSellBtn: 'Vente +',
    upgradeNow: 'Passer à la Version Pro',
    exportData: 'Exporter les Données',
    cancelPro: 'Annuler Pro',
    login: 'Connexion',
    register: 'Inscription',
    logoutBtn: 'Déconnexion',
    privacyPolicy: 'Politique de Confidentialité',
    terms: 'Conditions de Service',
    imprint: 'Mentions Légales',
    feedbackBtn: 'Envoyer des Commentaires',
    themeSystem: 'Système',
    themeLight: 'Clair',
    themeDark: 'Sombre',
    understood: 'Compris',
    cancel: 'Annuler',
    
    // Form Validation
    fillAllFields: 'Veuillez remplir tous les champs.',
    validEmail: 'Veuillez entrer une adresse e-mail valide.',
    noAccountFound: 'Aucun compte trouvé avec cet e-mail.',
    wrongPassword: 'Mot de passe incorrect.',
    loginSuccess: 'Connecté avec succès!',
    acceptTermsRequired: 'Vous devez accepter les conditions de service et la politique de confidentialité pour créer un compte.',
    passwordMinLength: 'Le mot de passe doit contenir au moins 6 caractères.',
    accountExists: 'Un compte avec cet e-mail existe déjà.',
    registerSuccess: 'Compte créé avec succès! Vous serez connecté...',
    logoutConfirm: 'Voulez-vous vraiment vous déconnecter?'
  }
};

function t(key) {
  return uebersetzungen[aktuelleSprache]?.[key] || uebersetzungen['de'][key] || key;
}

function aendereSprache(sprache) {
  aktuelleSprache = sprache;
  localStorage.setItem('sprache', sprache);
  
  // Sprach-Select aktualisieren
  const spracheSelect = document.getElementById('spracheSelect');
  if (spracheSelect) spracheSelect.value = sprache;
  
  // WICHTIG: Die gesamte Sprach-Aktualisierung durchführen
  aktualisiereSprachAnzeige();
  
  // Alle Übersetzungen durchführen - IN REIHENFOLGE
  if (typeof translatePageText === 'function') translatePageText();
  if (typeof aggressiveTranslateAllText === 'function') aggressiveTranslateAllText();
  if (typeof applyTranslations === 'function') applyTranslations();
  
  // Kurze Verzögerung für zusätzliche Aktualisierungen
  setTimeout(() => {
    // Update dynamische Inhalte
    zeigeGespeichertePositionen();
    
    // Aktualisiere Settings-Labels auf neue Sprache
    if (typeof aktualisiereAlleWaehrungen === 'function') aktualisiereAlleWaehrungen();
    if (typeof aktualisiereNachLandWechsel === 'function') aktualisiereNachLandWechsel();
    
    // Berechne Ergebnisse neu für aktuelle Seite
    if (document.getElementById('trading') && document.getElementById('trading').classList.contains('active')) {
      berechneTrading();
    }
    
    if (document.getElementById('sparen') && document.getElementById('sparen').classList.contains('active')) {
      berechneSpar();
    }
    
    // Update Charts
    if (typeof sparChart !== 'undefined' && sparChart) {
      sparChart.update();
    }
    if (typeof etfChart !== 'undefined' && etfChart) {
      etfChart.update();
    }
  }, 50);
}



function aendereSpracheSelect() {
  const select = document.getElementById('spracheSelect');
  aendereSprache(select.value);
}

function ladeSprache() {
  const gespeicherteSprache = localStorage.getItem('sprache') || 'de';
  aktuelleSprache = gespeicherteSprache;
  const select = document.getElementById('spracheSelect');
  if (select) select.value = gespeicherteSprache;
  aktualisiereSprachAnzeige();
}

function aktualisiereSprachAnzeige() {
  // Navigation Tabs aktualisieren
  const tabs = document.querySelectorAll('.tab');
  if (tabs[0]) tabs[0].textContent = t('home');
  if (tabs[1]) tabs[1].textContent = t('trading');
  if (tabs[2]) tabs[2].textContent = t('sparen');
  if (tabs[3]) tabs[3].textContent = t('etf');
  if (tabs[4]) tabs[4].textContent = t('settings');
  
  // Bottom Navigation aktualisieren - nur Textknoten in span ändern
  const bottomNavItems = document.querySelectorAll('.bottom-nav-item');
  if (bottomNavItems[0]) {
    const textSpan = bottomNavItems[0].querySelector('.nav-text');
    if (textSpan) textSpan.textContent = t('trading');
  }
  if (bottomNavItems[1]) {
    const textSpan = bottomNavItems[1].querySelector('.nav-text');
    if (textSpan) textSpan.textContent = t('sparen');
  }
  if (bottomNavItems[2]) {
    const textSpan = bottomNavItems[2].querySelector('.nav-text');
    if (textSpan) textSpan.textContent = t('etfComparison');
  }
  
  // ===== HOME SEITE =====
  const heroTitle = document.querySelector('#home h1');
  if (heroTitle) heroTitle.innerHTML = t('heroTitle');
  
  const heroSubtitle = document.querySelector('#home h1 + p');
  if (heroSubtitle) heroSubtitle.textContent = t('heroSubtitle');
  
  // Buttons auf Home
  const homeButtons = document.querySelectorAll('#home .btn');
  if (homeButtons[0]) {
    const svg = homeButtons[0].querySelector('svg');
    homeButtons[0].textContent = t('startNow');
    if (svg) homeButtons[0].prepend(svg);
  }
  if (homeButtons[1]) homeButtons[1].textContent = t('learnMore');
  
  // Feature Cards
  const featureCards = document.querySelectorAll('#home > div > div:nth-of-type(2) > div');
  if (featureCards[0]) {
    const h3 = featureCards[0].querySelector('h3');
    const p = featureCards[0].querySelector('p');
    if (h3) h3.textContent = t('tradingCalculator');
    if (p) p.textContent = t('tradingDesc');
  }
  if (featureCards[1]) {
    const h3 = featureCards[1].querySelector('h3');
    const p = featureCards[1].querySelector('p');
    if (h3) h3.textContent = t('savingsCalculator');
    if (p) p.textContent = t('savingsDesc');
  }
  if (featureCards[2]) {
    const h3 = featureCards[2].querySelector('h3');
    const p = featureCards[2].querySelector('p');
    if (h3) h3.textContent = t('proAccount');
    if (p) p.textContent = t('proDesc');
  }

  const sparenTitle = document.getElementById('sparenTitle');
  if (sparenTitle) sparenTitle.textContent = t('savingsCalculator');

  // ===== ETF Free View Labels mit Linebreaks =====
  const etfStat10Value = document.getElementById('etfStat10Value');
  if (etfStat10Value) etfStat10Value.textContent = t('year10');
  const etfStatHistoricalLabel = document.getElementById('etfStatHistoricalLabel');
  if (etfStatHistoricalLabel) etfStatHistoricalLabel.innerHTML = t('etfStatHistoricalHtml');
  const etfStatEtfsLabel = document.getElementById('etfStatEtfsLabel');
  if (etfStatEtfsLabel) etfStatEtfsLabel.innerHTML = t('etfStatEtfsHtml');
  const etfStatCompareLabel = document.getElementById('etfStatCompareLabel');
  if (etfStatCompareLabel) etfStatCompareLabel.innerHTML = t('etfStatCompareHtml');
  const etfStatProfitLabel = document.getElementById('etfStatProfitLabel');
  if (etfStatProfitLabel) etfStatProfitLabel.innerHTML = t('etfStatProfitabilityHtml');

  const etfTrustCancelableLabel = document.getElementById('etfTrustCancelableLabel');
  if (etfTrustCancelableLabel) etfTrustCancelableLabel.innerHTML = t('etfTrustCancelableHtml');
  const etfTrustFreeDaysLabel = document.getElementById('etfTrustFreeDaysLabel');
  if (etfTrustFreeDaysLabel) etfTrustFreeDaysLabel.innerHTML = t('etfTrustFreeDaysHtml');
  const etfTrustAllFeaturesLabel = document.getElementById('etfTrustAllFeaturesLabel');
  if (etfTrustAllFeaturesLabel) etfTrustAllFeaturesLabel.innerHTML = t('etfTrustAllFeaturesHtml');
  const etfTrustPrivacyLabel = document.getElementById('etfTrustPrivacyLabel');
  if (etfTrustPrivacyLabel) etfTrustPrivacyLabel.innerHTML = t('etfTrustPrivacyHtml');
  
  // ETF Free View Text Updates
  const etfTrustedByBadge = document.querySelector('#etfFreeView [style*="color:var(--accent)"]');
  if (etfTrustedByBadge && etfTrustedByBadge.textContent.includes('Vertraut')) {
    etfTrustedByBadge.textContent = t('etfTrustedBy');
  }
  
  const etfUnlockHeadline = document.querySelector('#etfFreeView h2');
  if (etfUnlockHeadline) etfUnlockHeadline.textContent = t('etfUnlockHeadline');
  
  const etfUnlockSubheading = document.querySelector('#etfFreeView > div > div > p');
  if (etfUnlockSubheading) etfUnlockSubheading.textContent = t('etfUnlockSubheading');
  
  const etfExpectTitle = document.querySelector('#etfFreeView h3');
  if (etfExpectTitle) etfExpectTitle.innerHTML = '<span style="font-size:clamp(24px,5vw,32px)">?</span>' + t('etfExpectTitle');
  
  const etfFeature1Title = document.getElementById('etfFeature1Title');
  if (etfFeature1Title) etfFeature1Title.textContent = t('etfFeature1Title');
  const etfFeature2Title = document.getElementById('etfFeature2Title');
  if (etfFeature2Title) etfFeature2Title.textContent = t('etfFeature2Title');
  const etfFeature3Title = document.getElementById('etfFeature3Title');
  if (etfFeature3Title) etfFeature3Title.textContent = t('etfFeature3Title');
  const etfFeature4Title = document.getElementById('etfFeature4Title');
  if (etfFeature4Title) etfFeature4Title.textContent = t('etfFeature4Title');
  
  const etfFeature1Desc = document.getElementById('etfFeature1Desc');
  if (etfFeature1Desc) etfFeature1Desc.textContent = t('etfFeature1Desc');
  const etfFeature2Desc = document.getElementById('etfFeature2Desc');
  if (etfFeature2Desc) etfFeature2Desc.textContent = t('etfFeature2Desc');
  const etfFeature3Desc = document.getElementById('etfFeature3Desc');
  if (etfFeature3Desc) etfFeature3Desc.textContent = t('etfFeature3Desc');
  const etfFeature4Desc = document.getElementById('etfFeature4Desc');
  if (etfFeature4Desc) etfFeature4Desc.textContent = t('etfFeature4Desc');
  
  const etfPreviewTitle = document.getElementById('etfPreviewTitle');
  if (etfPreviewTitle) etfPreviewTitle.innerHTML = '<span style="font-size:clamp(20px,4vw,24px)">🗂️</span>' + t('etfPreviewTitle');
  
  const etfSample1Desc = document.getElementById('etfSample1Desc');
  if (etfSample1Desc) etfSample1Desc.textContent = t('etfSample1Desc');
  const etfSample2Desc = document.getElementById('etfSample2Desc');
  if (etfSample2Desc) etfSample2Desc.textContent = t('etfSample2Desc');
  const etfSample3Desc = document.getElementById('etfSample3Desc');
  if (etfSample3Desc) etfSample3Desc.textContent = t('etfSample3Desc');
  
  const etfPreviewMore = document.getElementById('etfPreviewMore');
  if (etfPreviewMore) etfPreviewMore.textContent = t('etfPreviewMore');
  const etfPreviewAvailableAfter = document.getElementById('etfPreviewAvailableAfter');
  if (etfPreviewAvailableAfter) etfPreviewAvailableAfter.textContent = t('etfPreviewAvailableAfter');
  
  const etfAvg10yLabels = document.querySelectorAll('.etf-avg-10y');
  if (etfAvg10yLabels.length) {
    const avgText = t('etfAvg10y');
    etfAvg10yLabels.forEach(label => { label.textContent = avgText; });
  }
  
  // Stats Section
  const statsTitle = document.getElementById('statsTitle');
  if (statsTitle) statsTitle.textContent = t('financialPlanningReimagined');
  
  const statsDesc = document.getElementById('statsDesc');
  if (statsDesc) statsDesc.textContent = t('financialPlanningDesc');
  
  
  // Stats Labels
  const statLabel1 = document.getElementById('statLabel1');
  if (statLabel1) statLabel1.textContent = t('capitalGainsTax');
  
  const statLabel2 = document.getElementById('statLabel2');
  if (statLabel2) statLabel2.textContent = t('taxFreeAllowance');
  
  const statLabel3 = document.getElementById('statLabel3');
  if (statLabel3) statLabel3.textContent = t('proPerMonth');
  
  // Country Label in Settings
  const countryLabel = document.getElementById('countryLabel');
  if (countryLabel) countryLabel.textContent = t('country');

  // Tax Rate Label in Settings
  const steuersatzLabel = document.getElementById('steuersatzLabel');
  if (steuersatzLabel) steuersatzLabel.textContent = t('taxRate');

  // Country Label in Register
  const countrySelectLabelText = document.getElementById('countrySelectLabelText');
  if (countrySelectLabelText) countrySelectLabelText.textContent = t('countryForTax');

  // Länder-Optionen in Dropdowns aktualisieren
  aktualisiereLandOptionen();
  
  // Pricing Cards - Neue Übersetzungen
  const pricingPers = document.querySelectorAll('.pricing-per');
  pricingPers.forEach(el => { el.textContent = t('per'); });
  
  const pricingMonths = document.querySelectorAll('.pricing-month');
  pricingMonths.forEach(el => { el.textContent = t('perMonth'); });
  
  const pricingYears = document.querySelectorAll('.pricing-year');
  pricingYears.forEach(el => { el.textContent = t('perYear'); });
  
  const pricingBonus = document.querySelector('.pricing-bonus');
  if (pricingBonus) pricingBonus.textContent = t('monthsFree');
  
  const trialTitle = document.querySelector('.trial-title');
  if (trialTitle) trialTitle.innerHTML = '🎁 ' + t('trialDays');
  
  const trialDesc = document.querySelector('.trial-desc');
  if (trialDesc) trialDesc.textContent = t('noPaymentDuringTrial');
  
  const upgradeButtonText = document.querySelector('.upgrade-button-text');
  if (upgradeButtonText) upgradeButtonText.textContent = t('trialDays');
  
  // Update dynamische länderspezifische Texte
  aktualisiereDynamischeTexte();
  
  // "Wie es funktioniert" Section
  const howItWorksTitle = document.querySelector('#home > div > div:nth-of-type(4) > h2');
  if (howItWorksTitle) howItWorksTitle.textContent = t('howItWorks');
  
  const stepCards = document.querySelectorAll('#home > div > div:nth-of-type(4) > div > div');
  if (stepCards[0]) {
    const h3 = stepCards[0].querySelector('h3');
    const p = stepCards[0].querySelector('p');
    if (h3) h3.textContent = t('step1Title');
    if (p) p.textContent = t('step1Desc');
  }
  if (stepCards[1]) {
    const h3 = stepCards[1].querySelector('h3');
    const p = stepCards[1].querySelector('p');
    if (h3) h3.textContent = t('step2Title');
    if (p) p.textContent = t('step2Desc');
  }
  if (stepCards[2]) {
    const h3 = stepCards[2].querySelector('h3');
    const p = stepCards[2].querySelector('p');
    if (h3) h3.textContent = t('step3Title');
    if (p) p.textContent = t('step3Desc');
  }
  if (stepCards[3]) {
    const h3 = stepCards[3].querySelector('h3');
    const p = stepCards[3].querySelector('p');
    if (h3) h3.textContent = t('step4Title');
    if (p) p.textContent = t('step4Desc');
  }
  
  // "Deine Vorteile" Section
  const advantagesTitle = document.querySelector('#home > div > div:nth-of-type(5) > h2');
  if (advantagesTitle) advantagesTitle.textContent = t('yourAdvantages');
  
  const advantageCards = document.querySelectorAll('#home > div > div:nth-of-type(5) > div > div');
  if (advantageCards[0]) {
    const h3 = advantageCards[0].querySelector('h3');
    const p = advantageCards[0].querySelector('p');
    if (h3) h3.textContent = t('preciseCalculations');
    if (p) p.textContent = t('preciseCalculationsDesc');
  }
  if (advantageCards[1]) {
    const h3 = advantageCards[1].querySelector('h3');
    const p = advantageCards[1].querySelector('p');
    if (h3) h3.textContent = t('dataPrivacy');
    if (p) p.textContent = t('dataPrivacyDesc');
  }
  if (advantageCards[2]) {
    const h3 = advantageCards[2].querySelector('h3');
    const p = advantageCards[2].querySelector('p');
    if (h3) h3.textContent = t('fastSpeed');
    if (p) p.textContent = t('fastSpeedDesc');
  }
  if (advantageCards[3]) {
    const h3 = advantageCards[3].querySelector('h3');
    const p = advantageCards[3].querySelector('p');
    if (h3) h3.textContent = t('multiBroker');
    if (p) p.textContent = t('multiBrokerDesc');
  }
  if (advantageCards[4]) {
    const h3 = advantageCards[4].querySelector('h3');
    const p = advantageCards[4].querySelector('p');
    if (h3) h3.textContent = t('tradingHistory');
    if (p) p.textContent = t('tradingHistoryDesc');
  }
  if (advantageCards[5]) {
    const h3 = advantageCards[5].querySelector('h3');
    const p = advantageCards[5].querySelector('p');
    if (h3) h3.textContent = t('freeStart');
    if (p) p.textContent = t('freeStartDesc');
  }
  
  // FAQ Section
  const faqTitle = document.getElementById('faqTitle');
  if (faqTitle) faqTitle.textContent = t('faq');
  
  const faqQ1 = document.getElementById('faqQ1');
  if (faqQ1) faqQ1.textContent = t('faqQ1');
  const faqA1 = document.getElementById('faqA1');
  if (faqA1) faqA1.textContent = t('faqA1');
  
  const faqQ2 = document.getElementById('faqQ2');
  if (faqQ2) faqQ2.textContent = t('faqQ2');
  const faqA2 = document.getElementById('faqA2');
  if (faqA2) faqA2.textContent = t('faqA2');
  
  const faqQ3 = document.getElementById('faqQ3');
  if (faqQ3) faqQ3.textContent = t('faqQ3');
  const faqA3 = document.getElementById('faqA3');
  if (faqA3) faqA3.textContent = t('faqA3');
  
  const tradingSteuerLabel = document.getElementById('tradingSteuerLabel');
  if (tradingSteuerLabel) tradingSteuerLabel.textContent = t('capitalGainsTaxLabel');
  
  const sparVermogensentwicklungLabel = document.getElementById('sparVermogensentwicklungLabel');
  if (sparVermogensentwicklungLabel) sparVermogensentwicklungLabel.textContent = t('sparAssetDevelopment');
  
  const sparBerechnungsmodusLabel = document.getElementById('sparBerechnungsmodusLabel');
  if (sparBerechnungsmodusLabel) sparBerechnungsmodusLabel.textContent = t('sparCalculationMode');
  
  const sparEinzahlungenLabel = document.getElementById('sparEinzahlungenLabel');
  if (sparEinzahlungenLabel) {
    const btnText = sparEinzahlungenLabel.querySelector('button');
    sparEinzahlungenLabel.textContent = t('sparDeposits');
    if (btnText) sparEinzahlungenLabel.appendChild(btnText);
  }
  
  const sparReinerZinsLabel = document.getElementById('sparReinerZinsLabel');
  if (sparReinerZinsLabel) {
    const btnText = sparReinerZinsLabel.querySelector('button');
    sparReinerZinsLabel.textContent = t('sparPureInterest');
    if (btnText) sparReinerZinsLabel.appendChild(btnText);
  }
  
  const tradingCRVLabel = document.getElementById('tradingCRVLabel');
  if (tradingCRVLabel) tradingCRVLabel.textContent = t('crvRatioLabel');
  const breakEvenLabel = document.getElementById('breakEvenLabel');
  if (breakEvenLabel) breakEvenLabel.textContent = t('breakEvenModalTitle').toUpperCase();
  
  const breakEvenModalTitle = document.getElementById('breakEvenModalTitle');
  if (breakEvenModalTitle) breakEvenModalTitle.textContent = t('breakEvenModalTitle');
  const breakEvenModalDesc = document.getElementById('breakEvenModalDesc');
  if (breakEvenModalDesc) breakEvenModalDesc.textContent = t('breakEvenModalDesc');
  const breakEvenModalBtn = document.getElementById('breakEvenModalBtn');
  if (breakEvenModalBtn) breakEvenModalBtn.textContent = t('understood');
  
  const crvModalTitle = document.getElementById('crvModalTitle');
  if (crvModalTitle) crvModalTitle.textContent = t('crvModalTitle');
  const crvModalDesc = document.getElementById('crvModalDesc');
  if (crvModalDesc) crvModalDesc.textContent = t('crvModalDesc');
  const crvModalBtn = document.getElementById('crvModalBtn');
  if (crvModalBtn) crvModalBtn.textContent = t('understood');
  
  const faqQ4 = document.getElementById('faqQ4');
  if (faqQ4) faqQ4.textContent = t('faqQ4');
  const faqA4 = document.getElementById('faqA4');
  if (faqA4) faqA4.textContent = t('faqA4');
  
  const faqQ5 = document.getElementById('faqQ5');
  if (faqQ5) faqQ5.textContent = t('faqQ5');
  const faqA5 = document.getElementById('faqA5');
  if (faqA5) faqA5.textContent = t('faqA5');
  
  // Feedback CTA Section
  const feedbackCTATitle = document.getElementById('feedbackCTATitle');
  if (feedbackCTATitle) feedbackCTATitle.textContent = t('yourOpinionMatters');
  
  const feedbackCTADesc = document.getElementById('feedbackCTADesc');
  if (feedbackCTADesc) feedbackCTADesc.textContent = t('feedbackCTA');
  
  const feedbackCTAButton = document.getElementById('feedbackCTAButton');
  if (feedbackCTAButton) {
    const svg = feedbackCTAButton.querySelector('svg');
    feedbackCTAButton.innerHTML = '';
    if (svg) feedbackCTAButton.appendChild(svg);
    feedbackCTAButton.appendChild(document.createTextNode('\n            ' + t('giveFeedback') + '\n          '));
  }
  
  // ===== TRADING SEITE =====
  const tradingH2 = document.querySelector('#trading h2');
  if (tradingH2) tradingH2.textContent = t('tradeCalculation');
  
  // Trading Labels - ALLE .label-text Elemente auf Trading-Seite
  const tradingLabels = document.querySelectorAll('#trading .label-text');
  if (tradingLabels[0]) tradingLabels[0].textContent = t('entryPrice').toUpperCase();
  if (tradingLabels[1]) tradingLabels[1].textContent = t('quantity').toUpperCase();
  if (tradingLabels[2]) tradingLabels[2].textContent = t('targetPrice').toUpperCase();
  if (tradingLabels[3]) tradingLabels[3].textContent = t('stopLoss').toUpperCase();
  if (tradingLabels[4]) tradingLabels[4].textContent = t('leverage').toUpperCase();
  
  // Position Radio Labels
  const positionLabels = document.querySelectorAll('#trading input[type="radio"] + span');
  if (positionLabels[0]) positionLabels[0].textContent = t('long');
  if (positionLabels[1]) positionLabels[1].textContent = t('short');
  
  // Trading Buttons
  const calcBtn = document.querySelector('#trading button[onclick="berechneTrading()"]');
  if (calcBtn) {
    const svg = calcBtn.querySelector('svg');
    calcBtn.textContent = t('calculate');
    if (svg) calcBtn.prepend(svg);
  }
  
  const saveBtn = document.getElementById('savePositionBtn');
  if (saveBtn) {
    const svg = saveBtn.querySelector('svg');
    saveBtn.textContent = t('saveTrade');
    if (svg) saveBtn.prepend(svg);
  }
  
  // ===== SPAREN SEITE LABELS =====
  const sparenLabels = document.querySelectorAll('#sparen .label-text');
  const labelTexts = {
    'Anfangskapital': t('initialCapital'),
    'Gewünschtes Endkapital': t('finalCapital'),
    'Sparrate (Monatlich)': t('monthlySavings'),
    'Laufzeit': t('duration'),
    'Zinssatz p.a.': t('interestRate') + ' p.a.'
  };
  
  sparenLabels.forEach(label => {
    const text = label.textContent.trim();
    if (text === 'Anfangskapital') label.textContent = t('initialCapital');
    else if (text === 'Gewünschtes Endkapital') label.textContent = t('finalCapital');
    else if (text === 'Sparrate (Monatlich)') label.textContent = t('monthlySavings');
    else if (text.includes('Laufzeit:')) {
      // Special case for Laufzeit with value
      const zeitVal = label.querySelector('#zeitVal');
      if (zeitVal) {
        const jahre = zeitVal.textContent;
        label.innerHTML = t('duration') + ': <span id="zeitVal" style="color:var(--accent);font-weight:700">' + jahre + '</span> ' + t('years');
      }
    }
    else if (text === 'Zinssatz p.a.') label.textContent = t('interestRate') + ' p.a.';
  });
  
  // ===== FEEDBACK SEITE LABELS =====
  // (wird später noch einmal vollständig gesetzt)
  
  // ===== MODAL LABELS =====
  
  // Berechnungsmodus Buttons
  const btnEndkapital = document.getElementById('btnEndkapital');
  const btnZielRate = document.getElementById('btnZielRate');
  if (btnEndkapital && btnEndkapital.textContent.trim() !== t('finalCapital')) {
    btnEndkapital.textContent = t('finalCapital');
  }
  if (btnZielRate && btnZielRate.textContent.trim() !== t('savingsGoal')) {
    btnZielRate.textContent = t('savingsGoal');
  }
  
  // Einzahlungen & Reiner Zins Labels - Nur die korrekten divs ändern
  const sparInfoDivs = document.querySelectorAll('#sparen div[style*="font-size:11px"][style*="letter-spacing:1px"]');
  sparInfoDivs.forEach(div => {
    const text = div.textContent.trim();
    if (text === 'EINZAHLUNGEN') {
      div.textContent = t('contributions').toUpperCase();
    } else if (text === 'REINER ZINS') {
      div.textContent = t('pureInterest').toUpperCase();
    } else if (text === 'REALWERT (INFLATIONSBER.)') {
      div.textContent = t('realValueInflation').toUpperCase();
    } else if (text === 'STEUERN') {
      div.textContent = t('taxes').toUpperCase();
    }
  });
  
  // Pro Teaser Text - Spezifische Selektoren verwenden
  const sparProTeaserTitle = document.querySelector('#sparProTeaser > div[style*="font-size:14px"]');
  if (sparProTeaserTitle && sparProTeaserTitle.textContent.includes('Mehr Details')) {
    sparProTeaserTitle.textContent = t('moreDetails');
  }
  
  const sparProTeaserDesc = document.querySelector('#sparProTeaser > div[style*="font-size:12px"]');
  if (sparProTeaserDesc && sparProTeaserDesc.textContent.includes('Sieh Realwert')) {
    sparProTeaserDesc.textContent = t('seeRealValue');
  }
  
  const sparUpgradeBtn = document.querySelector('#sparProTeaser .btn');
  if (sparUpgradeBtn && sparUpgradeBtn.textContent.includes('Upgrade')) {
    const svg = sparUpgradeBtn.querySelector('svg');
    sparUpgradeBtn.textContent = t('upgradeFor');
    if (svg) sparUpgradeBtn.prepend(svg);
  }
  
  // ===== ETF SEITE =====
  const etfCompareH2 = document.querySelector('#etf .chart > div:first-child h2');
  if (etfCompareH2) etfCompareH2.textContent = t('etfComparison');
  const etfCompareTitle = document.getElementById('etfCompareTitle');
  if (etfCompareTitle) etfCompareTitle.textContent = t('etfComparison');
  const etfCompareSubtitle = document.getElementById('etfCompareSubtitle');
  if (etfCompareSubtitle) etfCompareSubtitle.textContent = t('compareHistorical');
  const etfDatabaseH2 = document.querySelector('#etfProView h2');
  if (etfDatabaseH2) etfDatabaseH2.textContent = t('etfDatabase');
  const etfDatabaseListTitle = document.getElementById('etfDatabaseListTitle');
  if (etfDatabaseListTitle) etfDatabaseListTitle.textContent = t('etfDatabase');
  const etfChartTitle = document.getElementById('etfChartTitle');
  if (etfChartTitle) etfChartTitle.textContent = t('returnComparison').toUpperCase();
  const ausgewaehlteText = document.getElementById('ausgewaehlteText');
  if (ausgewaehlteText) ausgewaehlteText.textContent = t('selectedETFsOfTwo');
  const vergleichsHinweis = document.getElementById('vergleichsHinweis');
  if (vergleichsHinweis) vergleichsHinweis.textContent = t('selectUpTo2');
  const keineErgebnisseTitle = document.getElementById('keineErgebnisseTitle');
  if (keineErgebnisseTitle) keineErgebnisseTitle.textContent = t('noETFsFound');
  const keineErgebnisseDesc = document.getElementById('keineErgebnisseDesc');
  if (keineErgebnisseDesc) keineErgebnisseDesc.textContent = t('tryDifferent');
  const etfDetailCategoryLabel = document.getElementById('etfDetailCategoryLabel');
  if (etfDetailCategoryLabel) etfDetailCategoryLabel.textContent = t('category').toUpperCase();
  const etfDetailTerLabel = document.getElementById('etfDetailTerLabel');
  if (etfDetailTerLabel) etfDetailTerLabel.textContent = (t('ter') + ' P.A.').toUpperCase();
  const etfDetailAvgReturnsLabel = document.getElementById('etfDetailAvgReturnsLabel');
  if (etfDetailAvgReturnsLabel) etfDetailAvgReturnsLabel.textContent = t('avgReturn').toUpperCase();
  const etfDetail1YLabel = document.getElementById('etfDetail1YLabel');
  if (etfDetail1YLabel) etfDetail1YLabel.textContent = t('year1').toUpperCase();
  const etfDetail3YLabel = document.getElementById('etfDetail3YLabel');
  if (etfDetail3YLabel) etfDetail3YLabel.textContent = t('year3').toUpperCase();
  const etfDetail5YLabel = document.getElementById('etfDetail5YLabel');
  if (etfDetail5YLabel) etfDetail5YLabel.textContent = t('year5').toUpperCase();
  const etfDetail10YLabel = document.getElementById('etfDetail10YLabel');
  if (etfDetail10YLabel) etfDetail10YLabel.textContent = t('year10').toUpperCase();
  const etfDetailDisclaimer = document.getElementById('etfDetailDisclaimer');
  if (etfDetailDisclaimer) etfDetailDisclaimer.textContent = t('noteHistorical');
  const etfDetailCloseBtn = document.getElementById('etfDetailCloseBtn');
  if (etfDetailCloseBtn) etfDetailCloseBtn.textContent = t('close');
  if (typeof etfChart !== 'undefined' && etfChart && etfChart.data) {
    etfChart.data.labels = [t('year10'), t('year5'), t('year3'), t('year1')];
    etfChart.update('none');
  }
  
  // ETF Pro Feature Texte
  document.querySelectorAll('#etf .chart > div:first-child div').forEach(div => {
    if (div.textContent === 'PRO FEATURE') div.textContent = t('proFeature');
    if (div.textContent === 'ETF Vergleich') div.textContent = t('etfComparison');
    if (div.textContent.includes('Vergleiche historische')) div.textContent = t('compareHistorical');
  });
  
  // ETF Free View Texte
  document.querySelectorAll('#etfFreeView div').forEach(div => {
    if (div.textContent === 'Beliebte ETFs') div.textContent = t('popularETFs');
    if (div.textContent.includes('ETF Datenbank freischalten')) div.textContent = t('unlockETF');
    if (div.textContent.includes('Zugriff auf historische')) div.textContent = t('accessHistorical');
    if (div.textContent.includes('Jederzeit kündbar')) div.textContent = t('anytime');
  });
  
  const etfUnlockBtn = document.querySelector('#etfFreeView .btn');
  if (etfUnlockBtn && etfUnlockBtn.textContent.includes('Jetzt upgraden')) {
    const svg = etfUnlockBtn.querySelector('svg');
    etfUnlockBtn.textContent = t('upgradeNow');
    if (svg) etfUnlockBtn.prepend(svg);
  }
  
  // ETF Search Placeholder
  const etfSearch = document.getElementById('etfSuche');
  if (etfSearch) etfSearch.placeholder = t('searchETF');
  
  // ETF Label Text - SORTIEREN NACH / REIHENFOLGE
  document.querySelectorAll('#etf .label-text').forEach(label => {
    const text = label.textContent.trim();
    // Nutze existing Translations wenn möglich, sonst nutze Fallback
    if (text === 'SORTIEREN NACH') {
      label.textContent = aktuelleSprache === 'de' ? 'SORTIEREN NACH' :
                          aktuelleSprache === 'en' ? 'SORT BY' :
                          aktuelleSprache === 'es' ? 'ORDENAR POR' :
                          aktuelleSprache === 'fr' ? 'TRIER PAR' : 'SORTIEREN NACH';
    }
    if (text === 'REIHENFOLGE') {
      label.textContent = aktuelleSprache === 'de' ? 'REIHENFOLGE' :
                          aktuelleSprache === 'en' ? 'ORDER' :
                          aktuelleSprache === 'es' ? 'ORDEN' :
                          aktuelleSprache === 'fr' ? 'ORDRE' : 'REIHENFOLGE';
    }
  });
  
  // ETF Sort Options - Beide Versionen (normale und erweiterte Sortierung)
  const etfSortRichtung = document.getElementById('etfSortRichtung');
  if (etfSortRichtung && etfSortRichtung.options.length >= 2) {
    etfSortRichtung.options[0].text = t('descending');
    etfSortRichtung.options[1].text = t('ascending');
  }
  
  // Zusätzlich alle select#etfSortRichtung Elemente behandeln
  document.querySelectorAll('select#etfSortRichtung').forEach(select => {
    select.querySelectorAll('option').forEach(opt => {
      if (opt.value === 'desc') opt.textContent = t('descending');
      if (opt.value === 'asc') opt.textContent = t('ascending');
    });
  });
  
  const etfSortKriterium = document.getElementById('etfSortKriterium');
  if (etfSortKriterium && etfSortKriterium.options.length >= 5) {
    etfSortKriterium.options[0].text = t('sortByName');
    etfSortKriterium.options[1].text = t('sortByReturn1Y');
    etfSortKriterium.options[2].text = t('sortByReturn3Y');
    etfSortKriterium.options[3].text = t('sortByReturn5Y');
    etfSortKriterium.options[4].text = t('sortByReturn10Y');
    if (etfSortKriterium.options.length >= 6) {
      etfSortKriterium.options[5].text = t('sortByTER');
    }
  }
  
  // Zusätzlich alle select#etfSortKriterium Elemente behandeln
  document.querySelectorAll('select#etfSortKriterium').forEach(select => {
    const options = select.querySelectorAll('option');
    options.forEach((opt, idx) => {
      if (opt.value === 'name') opt.textContent = t('sortByName');
      if (opt.value === 'rendite1j') opt.textContent = t('sortByReturn1Y');
      if (opt.value === 'rendite3j') opt.textContent = t('sortByReturn3Y');
      if (opt.value === 'rendite5j') opt.textContent = t('sortByReturn5Y');
      if (opt.value === 'rendite10j') opt.textContent = t('sortByReturn10Y');
      if (opt.value === 'ter') opt.textContent = t('sortByTER');
    });
  });
  
  // "Was ist TER?" Button
  document.querySelectorAll('#etf button').forEach(btn => {
    if (btn.textContent.includes('Was ist TER?')) btn.lastChild.textContent = ' ' + t('whatIsTER');
  });
  
  // ETF Chart Labels
  document.querySelectorAll('#etfChartContainer div').forEach(div => {
    if (div.textContent.includes('RENDITEN-VERGLEICH')) div.textContent = t('returnComparison').toUpperCase();
    if (div.textContent.includes('ETFs ausgewählt')) {
      const anzahl = div.querySelector('span#ausgewaehlteAnzahl')?.textContent || '0';
      div.innerHTML = `<span id="ausgewaehlteAnzahl">${anzahl}</span> ${t('selectedETFsOfTwo')}`;
    }
    if (div.textContent.includes('Wähle bis zu 2')) div.textContent = t('selectUpTo2');
  });
  
  // ETF Detail Vergleich Labels
  document.querySelectorAll('#detailVergleich div').forEach(div => {
    if (div.textContent === 'TER' && div.style.fontSize === '11px') div.textContent = t('ter').toUpperCase();
    if (div.textContent === '1 JAHR') div.textContent = t('year1').toUpperCase();
    if (div.textContent === '5 JAHRE') div.textContent = t('year5').toUpperCase();
    if (div.textContent === 'KAT.') div.textContent = t('category').toUpperCase();
  });
  
  // "Keine ETFs gefunden"
  document.querySelectorAll('#keineErgebnisse div').forEach(div => {
    if (div.textContent === 'Keine ETFs gefunden') div.textContent = t('noETFsFound');
    if (div.textContent.includes('Versuche einen anderen')) div.textContent = t('tryDifferent');
  });
  
  // ETF Hinweis
  document.querySelectorAll('#etf .chart > div:last-child div').forEach(div => {
    if (div.textContent.includes('Hinweis:')) div.innerHTML = `<strong style="color:var(--text)">${t('noteHistorical').split(':')[0]}:</strong> ${t('noteHistorical').split(':')[1]}`;
  });
  
  // ===== FEEDBACK SEITE =====
  const feedbackTitle = document.querySelector('#feedback h2');
  if (feedbackTitle) feedbackTitle.textContent = t('feedbackTitle');
  
  const feedbackSubtitle = document.querySelector('#feedback h2 + p');
  if (feedbackSubtitle) feedbackSubtitle.textContent = t('feedbackSubtitle');
  
  // Feedback Formular Labels
  feedbackLabels = document.querySelectorAll('#feedbackForm .label-text');
  if (feedbackLabels[0]) feedbackLabels[0].textContent = t('nameOptional');
  if (feedbackLabels[1]) feedbackLabels[1].textContent = t('emailOptional');
  if (feedbackLabels[2]) feedbackLabels[2].textContent = t('category');
  if (feedbackLabels[3]) feedbackLabels[3].textContent = t('message');
  
  // Feedback Kategorie Select Options
  const feedbackKategorie = document.getElementById('feedbackKategorie');
  if (feedbackKategorie) {
    feedbackKategorie.options[0].text = t('categoryFeature');
    feedbackKategorie.options[1].text = t('categoryBug');
    feedbackKategorie.options[2].text = t('categoryImprovement');
    feedbackKategorie.options[3].text = t('categoryDesign');
    feedbackKategorie.options[4].text = t('categoryOther');
  }
  
  // Feedback Inputs
  const feedbackNameInput = document.getElementById('feedbackName');
  if (feedbackNameInput) feedbackNameInput.placeholder = t('name');
  
  const feedbackEmailInput = document.getElementById('feedbackEmail');
  if (feedbackEmailInput) feedbackEmailInput.placeholder = t('email');
  
  const feedbackNachricht = document.getElementById('feedbackNachricht');
  if (feedbackNachricht) feedbackNachricht.placeholder = t('messagePlaceholder');
  
  // Feedback Datenschutz-Hinweis
  const feedbackPrivacy = document.getElementById('feedbackPrivacy');
  if (feedbackPrivacy) {
    feedbackPrivacy.innerHTML = `<strong style="color:var(--accent)">${t('privacyNotice')}</strong> ${t('privacyText')}`;
  }
  
  // Feedback Button
  const sendBtn = document.querySelector('#feedbackForm .btn-primary');
  if (sendBtn) {
    const svg = sendBtn.querySelector('svg');
    sendBtn.textContent = t('sendFeedback');
    if (svg) sendBtn.prepend(svg);
  }
  
  // Feedback Success
  const thankYouTitle = document.querySelector('#feedbackSuccess h3');
  if (thankYouTitle) thankYouTitle.textContent = t('thankYou');
  
  const successMsg = document.querySelector('#feedbackSuccess p');
  if (successMsg) successMsg.textContent = t('feedbackSuccess');
  
  const backBtn = document.querySelector('#feedbackSuccess .btn');
  if (backBtn) {
    const svg = backBtn.querySelector('svg');
    backBtn.textContent = t('backToHome');
    if (svg) backBtn.prepend(svg);
  }
  
  // ===== SETTINGS SEITE =====
  const settingsH2 = document.querySelector('#settings h2');
  if (settingsH2) settingsH2.textContent = t('settings');
  
  // Settings Überschriften
  const settingsH3 = document.querySelectorAll('#settings h3');
  settingsH3.forEach(h3 => {
    const text = h3.textContent.trim();
    if (text === 'PRO ACCOUNT') h3.textContent = t('proAccountTitle');
    if (text === 'DATEN VERWALTEN') h3.textContent = t('dataManagement').toUpperCase();
    if (text === 'ERSCHEINUNGSBILD') h3.textContent = t('appearance').toUpperCase();
    if (text.includes('WÄHRUNG & TOOLS')) h3.textContent = t('currencyTools').toUpperCase();
    if (text === 'ANALYSE-WERTE') h3.textContent = t('analysisValues').toUpperCase();
    if (text === 'STEUERN (DE)') h3.textContent = t('taxesDE').toUpperCase();
    if (text === 'BROKER') h3.textContent = t('brokerHeading');
    if (text === 'PROGNOSE PARAMETER') h3.textContent = t('forecastParametersHeading');
    if (text === 'GEBÜHREN') h3.textContent = t('feesHeading');
    if (text === 'RECHTLICHES') h3.textContent = t('legalHeading');
  });
  
  // Settings - Broker Section - ALLE info-row Labels übersetzen
  let infoRowLabels = document.querySelectorAll('#settings .info-row span[style*="color:var(--muted)"]');
  infoRowLabels.forEach(span => {
    const text = span.textContent.trim();
    if (text === 'Aktueller Broker') span.textContent = t('currentBrokerLabel');
    if (text === 'Inflationsrate') span.textContent = t('inflationRateLabel');
    if (text === 'Jährliche Dynamik') span.textContent = t('yearlyIncreaseLabel');
    if (text === 'Fixkosten') span.textContent = t('fixedCostsLabel');
    if (text === 'Variable Gebühr') span.textContent = t('variableFeeLabel');
    if (text === 'Sprache') span.textContent = t('language');
    if (text === 'Währung') span.textContent = t('currency');
    if (text === 'Break-Even Kurs') span.textContent = t('breakEvenPrice');
    if (text === 'CRV (Chance-Risiko)') span.textContent = t('crvRatio');
    if (text === 'Jahres-Freibetrag') span.textContent = t('yearlyAllowance');
    if (text === 'Steuersatz') span.textContent = t('taxRate');
    if (text === 'Aktueller Broker') span.textContent = t('currentBroker');
  });
  
  // Übersetze ALLE span Texte auf der Einstellungsseite die Settings-Beschreibungen sind
  document.querySelectorAll('#settings span').forEach(span => {
    const text = span.textContent.trim();
    // Nur übersetzen wenn es kurze Labels sind (nicht lange Beschreibungen)
    if (text.length < 50) {
      if (text === 'Aktueller Broker') span.textContent = t('currentBrokerLabel');
      if (text === 'Inflationsrate') span.textContent = t('inflationRateLabel');
      if (text === 'Jährliche Dynamik') span.textContent = t('yearlyIncreaseLabel');
      if (text === 'Fixkosten') span.textContent = t('fixedCostsLabel');
      if (text === 'Variable Gebühr') span.textContent = t('variableFeeLabel');
    }
  });
  
  // Broker Select Options - Alle Optionen übersetzen
  const brokerSelect = document.getElementById('brokerAuswahl');
  if (brokerSelect) {
    brokerSelect.querySelectorAll('option').forEach(opt => {
      if (opt.value === 'custom') opt.textContent = t('customBroker');
      if (opt.value === 'finanzenzero') opt.textContent = t('brokerFinanzenZero');
      if (opt.value === 'smartbrokerplus') opt.textContent = t('brokerSmartbrokerPlus');
      if (opt.value === 'justtrade') opt.textContent = t('brokerJustTrade');
      if (opt.value === 'traderepublic') opt.textContent = t('brokerTradeRepublic');
      if (opt.value === 'scalablecapital') opt.textContent = t('brokerScalableCapital');
      if (opt.value === 'flatex') opt.textContent = t('brokerFlatex');
      if (opt.value === 'comdirect') opt.textContent = t('brokerComdirect');
      if (opt.value === 'ing') opt.textContent = t('brokerIng');
      if (opt.value === 'consorsbank') opt.textContent = t('brokerConsorsbank');
      if (opt.value === 'commerzbank') opt.textContent = t('brokerCommerzbank');
      if (opt.value === 'dkb') opt.textContent = t('brokerDkb');
      if (opt.value === 'interactivebrokers') opt.textContent = t('brokerInteractiveBrokers');
    });
  }
  
  // Währungs Select Options - Alle Optionen übersetzen
  const waehrungSelect = document.getElementById('waehrungSelect');
  if (waehrungSelect) {
    waehrungSelect.querySelectorAll('option').forEach(opt => {
      const val = opt.value;
      const text = opt.textContent;
      if (val === 'EUR' && text.includes('EUR')) {
        opt.textContent = 'EUR (' + waehrungsSymbole['EUR'] + ')';
      }
      if (val === 'USD' && text.includes('USD')) {
        opt.textContent = 'USD (' + waehrungsSymbole['USD'] + ')';
      }
      if (val === 'GBP' && text.includes('GBP')) {
        opt.textContent = 'GBP (' + waehrungsSymbole['GBP'] + ')';
      }
    });
  }
  
  // Settings - Forecast Description
  const forecastDescription = document.getElementById('forecastDescription');
  if (forecastDescription) forecastDescription.textContent = t('forecastDescription');
  
  // Settings - Fees Description
  const feesDescription = document.getElementById('feesDescription');
  if (feesDescription) feesDescription.textContent = t('feesDescription');
  
  // Übersetze ALLE H3 Überschriften auf der Seite Settings
  document.querySelectorAll('#settings h3').forEach(h3 => {
    const text = h3.textContent.trim();
    if (text === 'PRO ACCOUNT') h3.textContent = t('proAccountTitle').toUpperCase();
    if (text === 'DATEN VERWALTEN') h3.textContent = t('dataManagement').toUpperCase();
    if (text === 'ERSCHEINUNGSBILD') h3.textContent = t('appearance').toUpperCase();
    if (text.includes('WÄHRUNG')) h3.textContent = t('currencyTools').toUpperCase();
    if (text === 'ANALYSE-WERTE') h3.textContent = t('analysisValues').toUpperCase();
    if (text === 'STEUERN (DE)') h3.textContent = t('taxesDE').toUpperCase();
    if (text === 'BROKER') h3.textContent = t('brokerHeading').toUpperCase();
    if (text === 'PROGNOSE PARAMETER') h3.textContent = t('forecastParametersHeading').toUpperCase();
    if (text === 'GEBÜHREN') h3.textContent = t('feesHeading').toUpperCase();
    if (text === 'RECHTLICHES') h3.textContent = t('legalHeading').toUpperCase();
  });
  
  // übersetze alle Button-Texte in Settings
  document.querySelectorAll('#settings button').forEach(btn => {
    const text = btn.textContent.trim();
    if (text === 'Pro kündigen' || text === 'Pro kündigen') {
      const svg = btn.querySelector('svg');
      btn.textContent = t('cancelPro');
      if (svg) btn.prepend(svg);
    }
    if (text === 'Daten exportieren' || text === 'Exportieren') {
      const svg = btn.querySelector('svg');
      btn.textContent = t('exportData');
      if (svg) btn.prepend(svg);
    }
    if (text.includes('Jetzt upgraden') || text.includes('Upgrade')) {
      const svg = btn.querySelector('svg');
      btn.textContent = t('upgradeNowBtn');
      if (svg) btn.prepend(svg);
    }
  });
  
  // Settings - Legal Section "über Trade"
  const aboutTradeTitle = document.getElementById('aboutTradeTitle');
  if (aboutTradeTitle) aboutTradeTitle.textContent = t('aboutTradeTitle');
  
  const aboutTradeDesc = document.getElementById('aboutTradeDesc');
  if (aboutTradeDesc) aboutTradeDesc.textContent = t('aboutTradeDescription');
  
  // Settings - Legal Section Strong Labels
  const supportLabel = document.querySelectorAll('#settings strong[style*="color:var(--text)"]');
  supportLabel.forEach(strong => {
    if (strong.textContent.trim() === 'Support:') strong.textContent = t('supportEmail');
    if (strong.textContent.trim() === 'Version:') strong.textContent = t('version');
  });
  
  // Settings - Legal Buttons
  const legalButtons = document.querySelectorAll('#settings button[style*="rgba(255,255,255,0.02)"]');
  legalButtons.forEach(btn => {
    const titleDiv = btn.querySelector('div[style*="font-weight:600"]');
    const descDiv = btn.querySelector('div[style*="font-size:12px"]');
    
    if (titleDiv && titleDiv.textContent.trim() === 'Datenschutzerklärung') {
      titleDiv.textContent = t('privacyPolicy');
      if (descDiv) descDiv.textContent = t('privacyPolicyDesc');
    }
    if (titleDiv && titleDiv.textContent.trim() === 'Nutzungsbedingungen') {
      titleDiv.textContent = t('termsOfService');
      if (descDiv) descDiv.textContent = t('termsOfServiceDesc');
    }
    if (titleDiv && titleDiv.textContent.trim() === 'Impressum') {
      titleDiv.textContent = t('imprint');
      if (descDiv) descDiv.textContent = t('imprintDesc');
    }
  });
  
  // Pro Account Card dynamische Texte - Vorsichtiger Ansatz mit spezifischen Selektoren
  // Pro Account Free - Titel
  const proTitleFree = document.querySelector('#proAccountFree div[style*="font-size:18px"]');
  if (proTitleFree && proTitleFree.textContent.trim() === 'Trade Pro') {
    proTitleFree.textContent = t('tradePro');
  }
  
  // Pro Account Free - Untertitel
  const proSubtitleFree = document.querySelector('#proAccountFree div[style*="font-size:13px"]');
  if (proSubtitleFree && proSubtitleFree.textContent.includes('Erweiterte Funktionen')) {
    proSubtitleFree.textContent = t('advancedFeatures');
  }
  
  // Pro Account Free - Feature-Liste (nur Haupttitel, nicht Beschreibungen)
  const proFeatures = document.querySelectorAll('#proAccountFree > div[style*="margin-bottom:20px"] > div[style*="font-size:13px"]');
  proFeatures.forEach(div => {
    const text = div.textContent.trim();
    if (text.startsWith('∞ ') || text.includes('Unbegrenzte Trades')) div.textContent = '∞ ' + t('unlimitedTrades');
    else if (text.startsWith('📚 ') || text.includes('ETF Datenbank')) div.textContent = '📚 ' + t('etfDatabaseAccess');
    else if (text.startsWith('🧮 ') || text.includes('Inflations- & Steuerrechner')) div.textContent = '🧮 ' + t('inflationTaxCalc');
    else if (text.startsWith('📄 ') || text.includes('PDF/CSV Export')) div.textContent = '📄 ' + t('pdfCsvExport');
    else if (text.startsWith('🚫 ') || text.includes('Werbefrei')) div.textContent = '🚫 ' + t('adFree');
  });
  
  // Pro Account Free - Feature-Beschreibungen
  const proFeatureDescs = document.querySelectorAll('#proAccountFree > div[style*="margin-bottom:20px"] > div[style*="font-size:11px"][style*="margin-left:16px"]');
  proFeatureDescs.forEach(div => {
    const text = div.textContent.trim();
    if (text.includes('Speichere so viele')) div.textContent = t('saveAsMany');
    else if (text.includes('Zugriff auf historische')) div.textContent = t('accessHistoricalReturns');
    else if (text.includes('Präzise Berechnung')) div.textContent = t('preciseCalculation');
    else if (text.includes('Exportiere deine')) div.textContent = t('exportCalculations');
    else if (text.includes('Keine störenden')) div.textContent = t('noAds');
  });
  
  // Pro Account Free - "pro Monat"
  const proPerMonthDiv = document.querySelector('#proAccountFree div[style*="font-size:12px"][style*="color:var(--muted)"]');
  if (proPerMonthDiv && proPerMonthDiv.textContent.trim() === 'pro Monat') {
    proPerMonthDiv.textContent = t('perMonth');
  }
  
  // Pro Account Free - Upgrade Button
  const upgradeBtn = document.querySelector('#proAccountFree .btn');
  if (upgradeBtn) {
    const svg = upgradeBtn.querySelector('svg');
    const text = upgradeBtn.textContent.trim();
    if (text.includes('Jetzt upgraden') || text === t('upgradeNowBtn')) {
      upgradeBtn.textContent = t('upgradeNowBtn');
      if (svg) upgradeBtn.prepend(svg);
    }
  }
  
  // Pro Account Free - "Jederzeit kündbar"
  const cancelAnytimeDiv = document.querySelector('#proAccountFree > div[style*="text-align:center"]');
  if (cancelAnytimeDiv && cancelAnytimeDiv.textContent.includes('Jederzeit kündbar')) {
    cancelAnytimeDiv.textContent = t('cancelAnytime');
  }
  
  // Pro Account Active - Titel
  const proTitleActive = document.querySelector('#proAccountActive div[style*="font-size:18px"]');
  if (proTitleActive && proTitleActive.textContent.trim() === 'Trade Pro') {
    proTitleActive.textContent = t('tradePro');
  }
  
  // Pro Account Active - "AKTIV" Badge
  const proActiveBadge = document.querySelector('#proAccountActive div[style*="background:var(--purple)"][style*="padding:4px 12px"]');
  if (proActiveBadge && proActiveBadge.textContent.trim() === 'AKTIV') {
    proActiveBadge.textContent = t('active');
  }
  
  // Pro Account Active - Untertitel
  const proSubtitleActive = document.querySelector('#proAccountActive div[style*="font-size:13px"][style*="margin-top:4px"]');
  if (proSubtitleActive && proSubtitleActive.textContent.includes('Alle Premium-Features')) {
    proSubtitleActive.textContent = t('allPremium');
  }
  
  // Pro Account Active - Kündigen Button
  const cancelProBtn = document.querySelector('#proAccountActive .btn');
  if (cancelProBtn && cancelProBtn.textContent.includes('Pro kündigen')) {
    cancelProBtn.textContent = t('cancelPro');
  }
  
  // Theme Buttons
  const themeButtons = document.querySelectorAll('.theme-btn');
  if (themeButtons[0]) themeButtons[0].textContent = t('system');
  if (themeButtons[1]) themeButtons[1].textContent = t('light');
  if (themeButtons[2]) themeButtons[2].textContent = t('dark');
  
  // Theme Beschreibung
  document.querySelectorAll('#settings > div > div.chart > p').forEach(p => {
    if (p.textContent.includes('Wähle zwischen hellem')) p.textContent = t('chooseTheme');
    if (p.textContent.includes('Break-Even zeigt den Kurs')) p.textContent = t('breakEvenDesc');
  });
  
  // Tax Info Text wird dynamisch aktualisiert
  
  // Login/Register
  const loginBtnText = document.getElementById('loginBtnText');
  if (loginBtnText) loginBtnText.textContent = t('loginBtn');
  
  const loginModalTitle = document.getElementById('loginModalTitle');
  if (loginModalTitle) loginModalTitle.textContent = t('loginModalTitle');
  
  const loginTabBtn = document.getElementById('loginTabBtn');
  if (loginTabBtn) loginTabBtn.textContent = t('loginTab');
  
  const registerTabBtn = document.getElementById('registerTabBtn');
  if (registerTabBtn) registerTabBtn.textContent = t('registerTab');
  
  const emailLabel = document.getElementById('emailLabel');
  if (emailLabel) emailLabel.textContent = t('emailLabel').toUpperCase();
  
  const loginEmail = document.getElementById('loginEmail');
  if (loginEmail) loginEmail.placeholder = t('emailPlaceholder');
  
  // Trading History
  const tradingHistoryTitle = document.getElementById('tradingHistoryTitle');
  if (tradingHistoryTitle) {
    const svg = tradingHistoryTitle.querySelector('svg');
    tradingHistoryTitle.textContent = '';
    if (svg) tradingHistoryTitle.appendChild(svg);
    tradingHistoryTitle.appendChild(document.createTextNode('\n            ' + t('tradingHistory') + '\n          '));
  }
  
  // Update gespeicherte Positionen wenn leer
  zeigeGespeichertePositionen();
  
  // Nachkauf Modal
  const nachkaufTitle = document.getElementById('nachkaufTitle');
  if (nachkaufTitle) nachkaufTitle.textContent = t('addBuy');
  
  nachkaufKursLabel = document.getElementById('nachkaufKursLabel');
  if (nachkaufKursLabel) nachkaufKursLabel.textContent = t('buyPrice').toUpperCase();
  
  nachkaufMengeLabel = document.getElementById('nachkaufMengeLabel');
  if (nachkaufMengeLabel) nachkaufMengeLabel.textContent = t('quantity').toUpperCase();
  
  const nachkaufMengeUnit = document.getElementById('nachkaufMengeUnit');
  if (nachkaufMengeUnit) nachkaufMengeUnit.textContent = t('pieces');
  
  const neuerDurchschnittLabel = document.getElementById('neuerDurchschnittLabel');
  if (neuerDurchschnittLabel) neuerDurchschnittLabel.textContent = t('newAverage');
  
  const investiertLabel = document.getElementById('investiertLabel');
  if (investiertLabel) investiertLabel.textContent = t('invested');
  
  const nachkaufBestaetigenBtn = document.getElementById('nachkaufBestaetigenBtn');
  if (nachkaufBestaetigenBtn) nachkaufBestaetigenBtn.textContent = t('confirmBuy');
  
  // Teilverkauf Modal
  const teilverkaufTitle = document.getElementById('teilverkaufTitle');
  if (teilverkaufTitle) teilverkaufTitle.textContent = t('partialSell');
  
  verkaufspreisLabel = document.getElementById('verkaufspreisLabel');
  if (verkaufspreisLabel) verkaufspreisLabel.textContent = t('sellPrice').toUpperCase();
  
  const verkaufsMengeLabel = document.getElementById('verkaufsMengeLabel');
  if (verkaufsMengeLabel) verkaufsMengeLabel.textContent = t('sellQuantity').toUpperCase();
  
  const verkaufMengeUnit = document.getElementById('verkaufMengeUnit');
  if (verkaufMengeUnit) verkaufMengeUnit.textContent = t('pieces');
  
  const verbleibendLabel = document.getElementById('verbleibendLabel');
  if (verbleibendLabel) verbleibendLabel.textContent = t('remaining');
  
  const verkaufGewinnLabel = document.getElementById('verkaufGewinnLabel');
  if (verkaufGewinnLabel) verkaufGewinnLabel.textContent = t('profitFromSale');
  
  const teilverkaufBestaetigenBtn = document.getElementById('teilverkaufBestaetigenBtn');
  if (teilverkaufBestaetigenBtn) teilverkaufBestaetigenBtn.textContent = t('confirmSell');
  
  // Nachkauf/Teilverkauf Buttons
  const nachkaufBtn = document.getElementById('nachkaufBtn');
  if (nachkaufBtn) {
    const svg = nachkaufBtn.querySelector('svg');
    nachkaufBtn.textContent = '';
    if (svg) nachkaufBtn.appendChild(svg);
    nachkaufBtn.appendChild(document.createTextNode('\n            ' + t('addBuyBtn') + '\n          '));
  }
  
  const teilverkaufBtn = document.getElementById('teilverkaufBtn');
  if (teilverkaufBtn) {
    const svg = teilverkaufBtn.querySelector('svg');
    teilverkaufBtn.textContent = '';
    if (svg) teilverkaufBtn.appendChild(svg);
    teilverkaufBtn.appendChild(document.createTextNode('\n            ' + t('partialSellBtn') + '\n          '));
  }
  
  const passwordLabel = document.getElementById('passwordLabel');
  if (passwordLabel) passwordLabel.textContent = t('passwordLabel').toUpperCase();
  
  const loginPassword = document.getElementById('loginPassword');
  if (loginPassword) loginPassword.placeholder = t('passwordPlaceholder');
  
  const termsText = document.getElementById('termsText');
  if (termsText) {
    termsText.innerHTML = `${t('acceptTerms')} <span id="termsLinkText" style="color:var(--accent);text-decoration:underline;cursor:pointer" onclick="openModal('nutzungsbedingungenModal')">${t('termsLink')}</span> <span id="andTheText">${t('andThe')}</span> <span id="privacyLinkText" style="color:var(--accent);text-decoration:underline;cursor:pointer" onclick="openModal('datenschutzModal')">${t('privacyLink')}</span>`;
  }

  // Rechtstexte in Modals
  const termsModalTitle = document.getElementById('termsModalTitle');
  if (termsModalTitle) termsModalTitle.textContent = t('termsTitle');
  const privacyModalTitle = document.getElementById('privacyModalTitle');
  if (privacyModalTitle) privacyModalTitle.textContent = t('privacyTitle');
  const imprintModalTitle = document.getElementById('imprintModalTitle');
  if (imprintModalTitle) imprintModalTitle.textContent = t('imprintTitle');

  const termsContent = document.getElementById('termsContent');
  if (termsContent) termsContent.innerHTML = t('termsHtml');
  const privacyContent = document.getElementById('privacyContent');
  if (privacyContent) privacyContent.innerHTML = t('privacyHtml');
  const imprintContent = document.getElementById('imprintContent');
  if (imprintContent) imprintContent.innerHTML = t('imprintHtml');

  const termsCloseBtn = document.getElementById('termsCloseBtn');
  if (termsCloseBtn) termsCloseBtn.textContent = t('close');
  const privacyCloseBtn = document.getElementById('privacyCloseBtn');
  if (privacyCloseBtn) privacyCloseBtn.textContent = t('close');
  const imprintCloseBtn = document.getElementById('imprintCloseBtn');
  if (imprintCloseBtn) imprintCloseBtn.textContent = t('close');

  if (typeof updateLastUpdated === 'function') updateLastUpdated();
  
  // Update login submit button with current mode
  const loginSubmitBtn = document.getElementById('loginSubmitBtn');
  if (loginSubmitBtn) {
    loginSubmitBtn.textContent = istLoginModus ? t('loginSubmit') : t('registerSubmit');
  }
  
  // Settings Info Rows Labels
  infoRowLabels = document.querySelectorAll('#settings .info-row > span');
  infoRowLabels.forEach(span => {
    const text = span.textContent.trim();
    if (text === 'Sprache') span.textContent = t('language');
    if (text === 'Währung') span.textContent = t('currency');
    if (text === 'Break-Even Kurs') span.textContent = t('breakEvenPrice');
    if (text === 'CRV (Chance-Risiko)') span.textContent = t('crvRatio');
    if (text === 'Jahres-Freibetrag') span.textContent = t('yearlyAllowance');
    if (text === 'Steuersatz') span.textContent = t('taxRate');
    if (text === 'Aktueller Broker') span.textContent = t('currentBroker');
  });
  
  // Hebel-Funktion Texte
  document.querySelectorAll('#settings .info-row div div').forEach(div => {
    if (div.textContent === 'Hebel-Funktion' && div.style.fontWeight === '600') div.textContent = t('leverageFunction');
    if (div.textContent.includes('Die Hebel-Funktion ermöglicht')) div.textContent = t('leverageDesc');
  });
  
  // Labels in Settings
  document.querySelectorAll('#settings .label-text').forEach(label => {
    if (label.textContent === 'Bereits verwendet') label.textContent = t('alreadyUsed');
    if (label.textContent === 'Fixkosten') label.textContent = t('fixedCosts');
    if (label.textContent === 'Variable Gebühr') label.textContent = t('variableFee');
  });
  
  // Steuern Texte
  document.querySelectorAll('#settings .info-card div').forEach(div => {
    if (div.textContent === 'VERBLEIBEND 2026') div.textContent = t('remaining2026').toUpperCase();
  });
  
  document.querySelectorAll('#settings div[id*="freibetragProzent"]').forEach(div => {
    const match = div.textContent.match(/(\d+(?:[.,]\d+)?)%/);
    if (match) div.textContent = `${match[1]}% ${t('used')}`;
  });
  
  // Export Button
  const exportBtn = document.querySelector('#settings .btn-blue');
  if (exportBtn) {
    const svg = exportBtn.querySelector('svg');
    exportBtn.textContent = t('exportData');
    if (svg) exportBtn.prepend(svg);
  }
  
  // Feedback Portal Button in Settings
  const feedbackPortalBtn = document.querySelector('button[onclick="oeffneFeedbackPortal()"]');
  if (feedbackPortalBtn) {
    const titleDiv = feedbackPortalBtn.querySelector('div[style*="font-weight:700"]');
    const descDiv = feedbackPortalBtn.querySelector('div[style*="font-size:13px"]');
    if (titleDiv) titleDiv.textContent = t('feedback');
    if (descDiv) descDiv.textContent = t('feedbackDesc');
  }

  const feedbackSupportHeading = document.getElementById('feedbackSupportHeading');
  if (feedbackSupportHeading) feedbackSupportHeading.textContent = t('feedbackSupportHeading');

  const positionNameLabel = document.getElementById('positionNameLabel');
  if (positionNameLabel) positionNameLabel.textContent = t('positionNameOptionalLabel');
  const positionNameInput = document.getElementById('posname');
  if (positionNameInput) positionNameInput.placeholder = t('positionNamePlaceholder');
  
  // Copyright
  const copyright = document.getElementById('copyright');
  if (copyright) {
    copyright.textContent = `© 2026 Trade. ${t('allRightsReserved')}`;
  }
  
  // Sprache-Select aktualisieren
  const spracheSelect = document.getElementById('spracheSelect');
  if (spracheSelect) {
    spracheSelect.value = aktuelleSprache;
  }
  
  // TER Modal aktualisieren
  const terModalTitle = document.getElementById('terModalTitle');
  if (terModalTitle) terModalTitle.textContent = t('whatIsTER');
  const terModalDesc = document.getElementById('terModalDesc');
  if (terModalDesc) terModalDesc.textContent = t('terModalDesc');
  const terExampleLabel = document.getElementById('terExampleLabel');
  if (terExampleLabel) terExampleLabel.textContent = t('terExampleLabel');
  const terExampleText = document.getElementById('terExampleText');
  if (terExampleText) terExampleText.innerHTML = 'Bei einem TER von <strong style="color:var(--purple)">0,20%</strong> und einem Investment von <strong style="color:var(--purple)">10.000€</strong> zahlst du <strong style="color:var(--purple)">20€ pro Jahr</strong> an Gebühren.';
  const lowerTERBetterText = document.getElementById('lowerTERBetterText');
  if (lowerTERBetterText) lowerTERBetterText.innerHTML = '<svg width="20" height="20" fill="none" stroke="var(--accent)" stroke-width="2.5"><path d="M9 12l2 2 4-4"/><circle cx="12" cy="12" r="10"/></svg><strong>' + t('lowerTERBetter') + '</strong>';
  const terIncludesText = document.getElementById('terIncludesText');
  if (terIncludesText) terIncludesText.textContent = t('terIncludes');
  const terUnderstoodBtn = document.getElementById('terUnderstoodBtn');
  if (terUnderstoodBtn) terUnderstoodBtn.textContent = t('understood');
  
  const einzahlungenTitle = document.getElementById('einzahlungenTitle');
  if (einzahlungenTitle) einzahlungenTitle.textContent = t('sparDeposits');
  const einzahlungenText = document.getElementById('einzahlungenText');
  if (einzahlungenText) einzahlungenText.textContent = t('depositsDesc');
  const einzahlungenBtn = document.getElementById('einzahlungenBtn');
  if (einzahlungenBtn) einzahlungenBtn.textContent = t('understood');
  
  const reinerZinsTitle = document.getElementById('reinerZinsTitle');
  if (reinerZinsTitle) reinerZinsTitle.textContent = t('sparPureInterest');
  const reinerZinsText = document.getElementById('reinerZinsText');
  if (reinerZinsText) reinerZinsText.textContent = t('pureInterestDesc');
  const reinerZinsBtn = document.getElementById('reinerZinsBtn');
  if (reinerZinsBtn) reinerZinsBtn.textContent = t('understood');
  
  // Delete Dialogs (Lösch-Modals)
  const deletePositionTitle = document.getElementById('deletePositionTitle');
  if (deletePositionTitle) deletePositionTitle.textContent = t('deletePosition');
  
  const deletePositionMessage = document.getElementById('deletePositionMessage');
  if (deletePositionMessage) deletePositionMessage.textContent = t('deletePositionWarning');
  
  const cancelButton = document.getElementById('cancelButton');
  if (cancelButton) cancelButton.textContent = t('cancel');
  
  const deleteButton = document.getElementById('deleteButton');
  if (deleteButton) deleteButton.textContent = t('deleteButtonText');
  
  const deleteAllPositionsTitle = document.getElementById('deleteAllPositionsTitle');
  if (deleteAllPositionsTitle) deleteAllPositionsTitle.textContent = t('deleteAllPositions');
  
  const deleteAllWarningMessage = document.getElementById('deleteAllWarningMessage');
  if (deleteAllWarningMessage) {
    const count = document.getElementById('anzahlPositionen')?.textContent || '0';
    const warningLabel = aktuelleSprache === 'de' ? 'ACHTUNG:' : 
                         aktuelleSprache === 'en' ? 'WARNING:' :
                         aktuelleSprache === 'es' ? 'ADVERTENCIA:' :
                         aktuelleSprache === 'fr' ? 'ATTENTION:' : 'ACHTUNG:';
    const deleteText = aktuelleSprache === 'de' ? 'Du bist dabei,' : 
               aktuelleSprache === 'en' ? 'You are about to' :
               aktuelleSprache === 'es' ? 'Estás a punto de' :
               aktuelleSprache === 'fr' ? 'Vous êtes sur le point de' : 'Du bist dabei,';
    const deleteText2 = aktuelleSprache === 'de' ? 'Position(en) unwiderruflich zu löschen!' : 
              aktuelleSprache === 'en' ? 'position(s) permanently!' :
              aktuelleSprache === 'es' ? 'posición(es) permanentemente!' :
              aktuelleSprache === 'fr' ? 'position(s) définitivement!' : 'Position(en) unwiderruflich zu löschen!';
    deleteAllWarningMessage.innerHTML = `<strong style="color:var(--danger)">${warningLabel}</strong> ${deleteText} <strong id="anzahlPositionen">${count}</strong> ${deleteText2}`;
  }
  
  const irreversibleActionMessage = document.getElementById('irreversibleActionMessage');
  if (irreversibleActionMessage) irreversibleActionMessage.textContent = t('irreversibleAction');
  
  const cancelAllButton = document.getElementById('cancelAllButton');
  if (cancelAllButton) cancelAllButton.textContent = t('cancel');
  
  const deleteAllButton = document.getElementById('deleteAllButton');
  if (deleteAllButton) deleteAllButton.textContent = t('deleteAllButtonText');
  
  // Update Chart Labels
  if (sparChart && sparChart.data.datasets) {
    sparChart.data.datasets[0].label = t('totalCapital');
    sparChart.data.datasets[1].label = t('sparDeposits');
    sparChart.update();
  }
  
  // Update ALL Chart-related Labels in Savings section
  document.querySelectorAll('#sparen div[style*="font-size:11px"][style*="letter-spacing:1px"]').forEach(div => {
    const text = div.textContent.trim();
    if (text === 'ENDKAPITAL') div.textContent = t('finalCapital').toUpperCase();
    if (text === 'GESAMTEINZAHLUNGEN') div.textContent = t('totalContributions').toUpperCase();
    if (text === 'REINER ZINS') div.textContent = t('pureInterest').toUpperCase();
    if (text === 'REALWERT (INFLATIONSBER.)') div.textContent = t('realValueInflation').toUpperCase();
    if (text === 'STEUERN') div.textContent = t('taxes').toUpperCase();
    if (text === 'EINZAHLUNGEN') div.textContent = t('contributions');
  });
  
  // Update savings result displays
  document.querySelectorAll('#sparen div[style*="font-size:18px"][style*="font-weight:700"]').forEach(div => {
    // Nur die Label-divs, nicht die Werte
    const parent = div.parentElement;
    if (parent && parent.querySelector('div[style*="font-size:11px"]')) {
      // Das ist ein Wert-div, überspringe es
      return;
    }
  });
  
  // ===== COMPLETE TEXT TRANSLATION WALKER =====
  // Übersetze WIRKLICH ALLE verbleibenden Texte durch aggressives DOM-Traversal
  const translationPairs = [
    // Kombiniere alle Paare für die aktuelle Sprache
    ...(aktuelleSprache === 'de' ? [] : [
      ['Wähle zwischen hellem, dunklem oder dem System-Modus.', t('chooseTheme')],
      ['Starten', t('startNow')],
      ['STARTEN', t('startNow').toUpperCase()],
      ['Mehr erfahren', t('learnMore')],
      ['MEHR ERFAHREN', t('learnMore').toUpperCase()],
      ['Position speichern', t('saveTrade')],
      ['Nachkauf +', t('addBuyBtn')],
      ['Teilverkauf +', t('partialSellBtn')],
      ['Berechnen', t('calculate')],
      ['Position löschen', t('deletePosition')],
      ['Alle Positionen löschen', t('deleteAllPositions')],
      ['Jetzt upgraden', t('upgradeNowBtn')],
      ['JETZT UPGRADEN', t('upgradeNowBtn').toUpperCase()],
      ['Upgrade für 1,99€/Monat', t('upgradeNowBtn')],
      ['Daten exportieren', t('exportData')],
      ['Pro kündigen', t('cancelPro')],
      ['PRO KÜNDIGEN', t('cancelPro').toUpperCase()],
      ['Datenschutz', t('privacyPolicy')],
      ['Nutzungsbedingungen', t('terms')],
      ['Impressum', t('imprint')],
      ['Feedback geben', t('feedbackBtn')],
      ['System', t('themeSystem')],
      ['Hell', t('themeLight')],
      ['Dunkel', t('themeDark')],
      ['Anmelden', t('login')],
      ['Registrieren', t('register')],
      ['Abmelden', t('logoutBtn')],
      ['Sprache', t('language')],
      ['Währung', t('currency')],
      ['Broker', t('brokerHeading')],
      ['BROKER', t('brokerHeading')],
      ['Einstellungen', t('settings')],
      ['EINSTELLUNGEN', t('settings').toUpperCase()],
      ['Erscheinungsbild', t('appearance')],
      ['ERSCHEINUNGSBILD', t('appearance').toUpperCase()],
      ['Daten verwalten', t('dataManagement')],
      ['DATEN VERWALTEN', t('dataManagement').toUpperCase()],
      ['Wie es funktioniert', t('howItWorks')],
      ['WIE ES FUNKTIONIERT', t('howItWorks').toUpperCase()],
      ['Deine Vorteile', t('yourAdvantages')],
      ['DEINE VORTEILE', t('yourAdvantages').toUpperCase()],
      ['Häufig gestellte Fragen', t('faq')],
      ['FAQ', t('faq')],
    ])
  ];
  
  // Wende alle Text-Übersetzungen an
  function applyTranslations() {
    const walker = document.createTreeWalker(
      document.body,
      NodeFilter.SHOW_TEXT,
      null,
      false
    );
    
    let node;
    const nodesToProcess = [];
    while (node = walker.nextNode()) {
      nodesToProcess.push(node);
    }
    
    // Helper: überspringe alles innerhalb der Settings-Section
    function isInSettings(el) {
      try { return el && el.closest && el.closest('#settings'); } catch(e) { return false; }
    }

    // Verarbeite alle Textknoten
    for (let textNode of nodesToProcess) {
      let text = textNode.textContent;
      let originalText = text;
      
      // überspringe leere oder nur Leerzeichen Knoten
      if (!text.trim() || text.match(/^[\s\d€$£%\-+.,;():<>'"\/\\]+$/)) {
        continue;
      }
      // überspringe sehr lange Textknoten (ganze Absätze) - diese werden nicht aggressiv ersetzt
      if (text.length > 200) continue;
      
      // überspringe Knoten in Script/Style/etc
      const parent = textNode.parentElement;
      if (!parent || ['SCRIPT', 'STYLE', 'NOSCRIPT', 'CANVAS', 'SVG'].includes(parent.tagName)) {
        continue;
      }

      // überspringe ganze Settings-Section
      if (isInSettings(parent)) continue;
      
      // Wende alle Übersetzungspaare an
      for (const [german, translated] of translationPairs) {
        if (text.includes(german)) {
          text = text.replace(new RegExp(escapeRegex(german), 'g'), translated);
        }
      }
      
      // Aktualisiere Textknoten wenn etwas geändert wurde
      if (text !== originalText) {
        textNode.textContent = text;
      }
    }
  }
  
  function escapeRegex(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }
  
  // Führe schwere Übersetzungsarbeiten asynchron aus, damit die Seite zuerst rendert
  function scheduleAggressiveTranslations() {
    // DEAKTIVIERT FÜR NAVIGATION FIX
    return;
  }

  scheduleAggressiveTranslations();
}

// Stelle sicher, dass wichtige Handler nach dem Laden wieder gebunden werden
document.addEventListener('DOMContentLoaded', function() {
  // kleine Verzögerung, damit eventuelle DOM-Manipulationen vorbei sind
  setTimeout(() => {
    try { rebindInlineHandlers(); } catch (e) { console.error('rebindInlineHandlers failed', e); }
  }, 200);
});

// Falls Inline-onclicks wegen DOM-Manipulationen nicht mehr auslösen,
// binden wir wichtige Handler programmgesteuert nach.
function rebindInlineHandlers() {
  // Stelle sicher dass alle wichtigen Funktionen verfügbar sind
  // Der Inline-Onclick wird direkt ausgeführt, wir prüfen nur dass die Funktionen existieren
  
  // überprüfe showSection
  if (typeof showSection === 'function') {
    document.querySelectorAll('button[onclick*="showSection"]').forEach(btn => {
      // Onclick wird automatisch aufgerufen, wir brauchen nicht zu rebinden
    });
  }
  
  // überprüfe andere wichtige Handler
  if (typeof oeffneLoginModal !== 'function') {
    window.oeffneLoginModal = function() { console.warn('oeffneLoginModal nicht definiert'); };
  }
  if (typeof closeModal !== 'function') {
    window.closeModal = function(id) { console.warn('closeModal nicht definiert:', id); };
  }
  if (typeof abmelden !== 'function') {
    window.abmelden = function() { console.warn('abmelden nicht definiert'); };
  }
  if (typeof oeffneLoeschModal !== 'function') {
    window.oeffneLoeschModal = function(id) { console.warn('oeffneLoeschModal nicht definiert:', id); };
  }
}

function translatePageText() {
  // UMFASSENDE Text-Übersetzung für die aktuelle Sprache
  window.translationMap = {
    // Trading Page
    'Position speichern': t('saveTrade'),
    'Einstiegskurs': t('entryPrice'),
    'EINSTIEGSKURS': t('entryPrice').toUpperCase(),
    'Stückzahl': t('quantity'),
    'STÜCKZAHL': t('quantity').toUpperCase(),
    'Zielkurs': t('targetPrice'),
    'ZIELKURS': t('targetPrice').toUpperCase(),
    'Stop-Loss (Optional)': t('stopLoss') + ' (' + t('optional') + ')',
    'STOP-LOSS': t('stopLoss').toUpperCase(),
    'Stop-Loss': t('stopLoss'),
    'Hebel (Leverage)': t('leverage'),
    'Hebel': t('leverage'),
    'HEBEL': t('leverage').toUpperCase(),
    'Long': t('long'),
    'Short': t('short'),
    'Nachkauf +': t('addBuyBtn'),
    'Teilverkauf +': t('partialSellBtn'),
    'Positionen (gespeichert)': t('positions'),
    'Positionen': t('positions'),
    'POSITIONEN': t('positions').toUpperCase(),
    'Positions-Name (Optional)': t('positionNameOptionalLabel'),
    'Berechnen': t('calculate'),
    'BERECHNEN': t('calculate').toUpperCase(),
    
    // Savings Page - Results
    'Endkapital': t('finalCapital'),
    'ENDKAPITAL': t('finalCapital').toUpperCase(),
    'Gesamteinzahlungen': t('totalContributions'),
    'GESAMTEINZAHLUNGEN': t('totalContributions').toUpperCase(),
    'Reiner Zins': t('pureInterest'),
    'REINER ZINS': t('pureInterest').toUpperCase(),
    'Realwert (Inflationsber.)': t('realValueInflation'),
    'REALWERT (INFLATIONSBER.)': t('realValueInflation').toUpperCase(),
    'Steuern': t('taxes'),
    'STEUERN': t('taxes').toUpperCase(),
    'Einzahlungen': t('contributions'),
    'EINZAHLUNGEN': t('contributions'),
    'Brutto': t('gross'),
    'BRUTTO': t('gross').toUpperCase(),
    'Netto': t('net'),
    'NETTO': t('net').toUpperCase(),
    
    // Savings Page - Inputs
    'Sparziel': t('savingsGoal'),
    'SPARZIEL': t('savingsGoal').toUpperCase(),
    'Monatliche Sparrate': t('monthlySavings'),
    'MONATLICHE SPARRATE': t('monthlySavings').toUpperCase(),
    'Laufzeit': t('duration'),
    'LAUFZEIT': t('duration').toUpperCase(),
    'Jahre': t('years'),
    'JAHRE': t('years').toUpperCase(),
    'Zinssatz': t('interestRate'),
    'ZINSSATZ': t('interestRate').toUpperCase(),
    'Zinssatz p.a.': t('interestRate') + ' p.a.',
    'p.a.': ' p.a.',
    'Anfangskapital': t('initialCapital'),
    'ANFANGSKAPITAL': t('initialCapital').toUpperCase(),
    'Gewünschtes Endkapital': t('finalCapital'),
    'Endkapital': t('finalCapital'),
    'ENDKAPITAL': t('finalCapital').toUpperCase(),
    
    // Savings Page - Buttons
    'Gewünschtes Endkapital': t('finalCapital'),
    'Sparziel': t('savingsGoal'),
    'Sparplan': t('savingsPlan'),
    'Sparrechner': t('savingsCalculator'),

    // ETF Vergleich Seite
    'PRO FEATURE': t('proFeature'),
    'ETF Vergleich': t('etfComparison'),
    'Vergleiche historische Durchschnittsrenditen beliebter ETFs': t('compareHistorical'),
    'Vertraut von Tausenden': t('etfTrustedBy'),
    'Pro-Features freischalten': t('etfUnlockHeadline'),
    'Nutze die volle Kraft von 1.247 professionellen ETFs mit 10 Jahren Daten, unbegrenzte Vergleiche und erweiterte Analysen - für weniger als ein Kaffee pro Monat.': t('etfUnlockSubheading'),
    'Jetzt upgraden - 1,99€/Monat': t('etfUpgradeCta'),
    'Das erwartet dich': t('etfExpectTitle'),
    'Rendite-Analysen': t('etfFeature1Title'),
    'Professionelle Charts mit 10 Jahren vollständiger Kurshistorie. Erkenne Trends und Muster auf den ersten Blick.': t('etfFeature1Desc'),
    'Vergleich-Tool': t('etfFeature2Title'),
    'Vergleiche unbegrenzt viele ETFs nebeneinander. Renditen, Gebühren, Risiken auf einen Blick.': t('etfFeature2Desc'),
    'Sparplan-Simulator': t('etfFeature3Title'),
    'Teste Sparstrategien mit echten Daten. Sehe exakt, wohin dein Geld fließt und wie du profitierst.': t('etfFeature3Desc'),
    'Vorschau: So sieht deine Datenbank aus (unscharfes Vorschaubild)': t('etfPreviewTitle'),
    'Weltweite Aktien - 3.500+ Unternehmen': t('etfSample1Desc'),
    'US Tech & Growth - 500 Top-Unternehmen': t('etfSample2Desc'),
    'Tech-fokussiert - 100 größte Konzerne': t('etfSample3Desc'),
    '+ 1.244 weitere ETFs mit vollständigen Daten': t('etfPreviewMore'),
    'Alle verfügbar nach dem Upgrade': t('etfPreviewAvailableAfter'),
    '10 Jahre Ø': t('etfAvg10y'),
    'ETF Datenbank': t('etfDatabase'),
    'Suche nach ETFs...': t('searchETF'),
    'Absteigend': t('descending'),
    'Aufsteigend': t('ascending'),
    'Sortieren nach: Name': t('sortByName'),
    'Sortieren nach: Rendite 1 Jahr': t('sortByReturn1Y'),
    'Sortieren nach: Rendite 3 Jahre': t('sortByReturn3Y'),
    'Sortieren nach: Rendite 5 Jahre': t('sortByReturn5Y'),
    'Sortieren nach: Rendite 10 Jahre': t('sortByReturn10Y'),
    'Sortieren nach: Kosten (TER)': t('sortByTER'),
    'Was ist TER?': t('whatIsTER'),
    'RENDITEN-VERGLEICH (10 JAHRE)': t('returnComparison').toUpperCase(),
    'von 2 ETFs ausgewählt': t('selectedETFsOfTwo'),
    'Wähle bis zu 2 ETFs aus der Liste unten aus, um sie zu vergleichen': t('selectUpTo2'),
    'Keine ETFs gefunden': t('noETFsFound'),
    'Versuche einen anderen Suchbegriff': t('tryDifferent'),
    '1 JAHR': t('year1').toUpperCase(),
    '5 JAHRE': t('year5').toUpperCase(),
    'KAT.': t('category').toUpperCase(),
    'ETF Details': t('etfDetailsTitle'),
    'Zum Vergleich': t('toComparison'),
    'Schließen': t('close'),
    
    // Generic/Common
    'Berechnen': t('calculate'),
    'Speichern': t('save'),
    'Löschen': t('deleteButtonText'),
    'Abbrechen': t('cancel'),
    'OK': t('ok'),
    'Verstanden': t('understood'),
    'Ja': t('yes'),
    'Nein': t('no'),
    'Optional': t('optional'),
    'Erforderlich': t('required'),
    'Mehr': t('more'),
    'Weniger': t('less'),
    'Info': t('info'),
    'Fehler': t('error'),
    'Erfolg': t('success'),
    'Warnung': t('warning'),
    'Loading': t('loading'),
    'Loading...': t('loading') + '...',
    
    // Home Page
    'Wie es funktioniert': t('howItWorks'),
    'WIE ES FUNKTIONIERT': t('howItWorks').toUpperCase(),
    'Deine Vorteile': t('yourAdvantages'),
    'DEINE VORTEILE': t('yourAdvantages').toUpperCase(),
    'Häufig gestellte Fragen': t('faq'),
    'FAQ': t('faq'),
    'Starten': t('startNow'),
    'STARTEN': t('startNow').toUpperCase(),
    
    // ETF Comparison
    'Zum Vergleich': t('toComparison'),
    '? Ausgewählt': t('etfSelected'),
    'Was ist TER?': t('whatIsTER'),
    
    // Settings/Common Labels
    'Sprache': t('language'),
    'SPRACHE': t('language').toUpperCase(),
    'Währung': t('currency'),
    'WÄHRUNG': t('currency').toUpperCase(),
    'Broker': t('brokerHeading'),
    'BROKER': t('brokerHeading').toUpperCase(),
    'Einstellungen': t('settings'),
    'EINSTELLUNGEN': t('settings').toUpperCase(),
    'Erscheinungsbild': t('appearance'),
    'ERSCHEINUNGSBILD': t('appearance').toUpperCase(),
    'Daten verwalten': t('dataManagement'),
    'DATEN VERWALTEN': t('dataManagement').toUpperCase(),
    'Daten exportieren': t('exportData'),
    'DATEN EXPORTIEREN': t('exportData').toUpperCase(),
    'Thema': t('theme'),
    'THEMA': t('theme').toUpperCase(),
    'System': t('system'),
    'Hell': t('light'),
    'Dunkel': t('dark'),
    'DUNKEL': t('dark').toUpperCase(),
    'Auto': t('auto'),
    'Ausgeglichen': t('balanced'),
    'Pro Account': t('proAccountTitle'),
    'PRO ACCOUNT': t('proAccountTitle').toUpperCase(),
    'Pro kündigen': t('cancelPro'),
    'Jetzt upgraden': t('upgradeNowBtn'),
    'AKTIV': t('active'),
    'Inflationsrate': t('inflationRateLabel'),
    'Jährliche Dynamik': t('yearlyIncreaseLabel'),
    'Fixkosten': t('fixedCostsLabel'),
    'Variable Gebühr': t('variableFeeLabel'),
    'Aktueller Broker': t('currentBrokerLabel'),
    'Break-Even Kurs': t('breakEvenPrice'),
    'CRV (Chance-Risiko)': t('crvRatio'),
    'Jahres-Freibetrag': t('yearlyAllowance'),
    'Steuersatz': t('taxRate'),
    'Analyse-Werte': t('analysisValues'),
    'ANALYSE-WERTE': t('analysisValues').toUpperCase(),
    'Steuern (DE)': t('taxesDE'),
    'STEUERN (DE)': t('taxesDE').toUpperCase(),
    'Prognose Parameter': t('forecastParametersHeading'),
    'PROGNOSE PARAMETER': t('forecastParametersHeading').toUpperCase(),
    'Gebühren': t('feesHeading'),
    'GEBÜHREN': t('feesHeading').toUpperCase(),
    'Rechtliches': t('legalHeading'),
    'RECHTLICHES': t('legalHeading').toUpperCase(),
    'Benutzerdefiniert': t('customBroker'),
    'Finanzen.net Zero': t('brokerFinanzenZero'),
    'Smartbroker+': t('brokerSmartbrokerPlus'),
    'justTRADE': t('brokerJustTrade'),
    'Trade Republic': t('brokerTradeRepublic'),
    'Scalable Capital': t('brokerScalableCapital'),
    'Flatex': t('brokerFlatex'),
    'Comdirect': t('brokerComdirect'),
    'ING': t('brokerIng'),
    'Consorsbank': t('brokerConsorsbank'),
    'Commerzbank': t('brokerCommerzbank'),
    'DKB': t('brokerDkb'),
    'Interactive Brokers': t('brokerInteractiveBrokers'),
    
    // Modal Common Text
    'Schließen': t('close'),
    'SCHLIESSEN': t('close').toUpperCase(),
    'Bestätigen': t('confirm'),
    'BESTÄTIGEN': t('confirm').toUpperCase(),
    'Laden': t('load'),
    'LADEN': t('load').toUpperCase(),
    'Exportieren': t('export'),
    'EXPORTIEREN': t('export').toUpperCase(),
    'Importieren': t('import'),
    'IMPORTIEREN': t('import').toUpperCase(),
    
    // Form Fields
    'Name': t('name'),
    'NAME': t('name').toUpperCase(),
    'E-Mail': t('email'),
    'E-MAIL': t('email').toUpperCase(),
    'Nachricht': t('message'),
    'NACHRICHT': t('message').toUpperCase(),
    'Kategorie': t('category'),
    'KATEGORIE': t('category').toUpperCase(),
    'Beschreibung': t('description'),
    'BESCHREIBUNG': t('description').toUpperCase(),
    'Passwort': t('password'),
    'PASSWORT': t('password').toUpperCase(),
    'Bestätigung': t('confirmation'),
    'BESTÄTIGUNG': t('confirmation').toUpperCase(),
    
    // Numbers/Count
    'Position': t('position'),
    'POSITION': t('position').toUpperCase(),
    'Positionen': t('positions'),
    'POSITIONEN': t('positions').toUpperCase(),
    'Jahr': t('year'),
    'JAHR': t('year').toUpperCase(),
    'Monat': t('month'),
    'MONAT': t('month').toUpperCase(),
    'Tag': t('day'),
    'TAG': t('day').toUpperCase(),
    'Woche': t('week'),
    'WOCHE': t('week').toUpperCase(),
    
    // Measurements/Units
    'Stück': t('piece'),
    'STÜCK': t('piece').toUpperCase(),
    'Pcs.': t('pieces'),
    'PCS.': t('pieces').toUpperCase(),
    'Pcs': t('pieces'),
    'PCS': t('pieces').toUpperCase(),
    '%': '%',
    'EUR': 'EUR',
    'GBP': 'GBP',
    'USD': 'USD',
    '€': getWaehrungsSymbol(),
    '£': getWaehrungsSymbol(),
    '$': getWaehrungsSymbol(),
    
    // Button texts
    'Upgrade für 1,99€/Monat': t('upgradeNowBtn'),
    'Jetzt upgraden': t('upgradeNowBtn'),
    'Upgrade now': t('upgradeNowBtn'),
    'Actualizar Ahora': t('upgradeNowBtn'),
    'Mettre à niveau': t('upgradeNowBtn'),
    'Datenschutz': t('privacyPolicy'),
    'Nutzungsbedingungen': t('terms'),
    'Impressum': t('imprint'),
    'Feedback geben': t('feedbackBtn'),
    'Anmelden': t('login'),
    'Registrieren': t('register'),
    'Abmelden': t('logoutBtn'),
    'Daten exportieren': t('exportData'),
    'Pro kündigen': t('cancelPro'),
    'Berechnen': t('calculate'),
    'Position speichern': t('saveTrade'),
    'Nachkauf +': t('addBuyBtn'),
    'Teilverkauf +': t('partialSellBtn'),
    'System': t('themeSystem'),
    'Hell': t('themeLight'),
    'Dunkel': t('themeDark'),
    'Light': t('themeLight'),
    'Dark': t('themeDark'),
    'Sistema': t('themeSystem'),
    'Claro': t('themeLight'),
    'Oscuro': t('themeDark'),
    'Clair': t('themeLight'),
    'Sombre': t('themeDark'),
    
    // TER Modal
    'Was ist TER?': t('whatIsTER'),
    'Die Total Expense Ratio (Gesamtkostenquote) gibt die jährlichen laufenden Kosten eines ETFs an.': t('terModalDesc'),
    'BEISPIEL': t('terExampleLabel'),
    'Bei einem TER von 0,20% und einem Investment von 10.000€ zahlst du 20€ pro Jahr an Gebühren.': t('terExample'),
    'Niedriger TER = Besser für dich!': t('lowerTERBetter'),
    'Die TER umfasst Verwaltungsgebühren, Betriebskosten und andere laufende Ausgaben. Sie wird automatisch vom Fondsvermögen abgezogen und ist bereits in der Wertentwicklung berücksichtigt.': t('terIncludes'),
    
    // Additional common words
    'PRO FEATURE': t('proFeature'),
    'Steuern': t('taxes'),
    'STEUERN': t('taxes').toUpperCase(),
    'Realwert': t('realValue'),
    
    // Settings Section - Headers and Labels
    'Einstellungen': t('settings'),
    'PRO ACCOUNT': t('proAccountTitle'),
    'DATEN VERWALTEN': t('dataManagement'),
    'ERSCHEINUNGSBILD': t('appearance'),
    'WÄHRUNG & TOOLS': t('currencyTools').toUpperCase(),
    'ANALYSE-WERTE': t('analysisValues'),
    'STEUERN': t('taxes'),
    'STEUERN (DE)': t('taxes') + ' (DE)',
    'BROKER': t('broker'),
    'PROGNOSE PARAMETER': t('forecastParameters'),
    
    // Settings - Pro Account
    'Erweiterte Funktionen für ernsthafte Trader': t('advancedFeatures'),
    '∞ Unbegrenzte Trades': '∞ ' + t('unlimitedTrades'),
    'Speichere so viele Trades wie du möchtest': t('saveAsMany'),
    '📚 ETF Datenbank': '📚 ' + t('etfDatabaseAccess'),
    'Zugriff auf historische Durchschnittsrenditen': t('accessHistoricalReturns'),
    '🧮 Inflations- & Steuerrechner': '🧮 ' + t('inflationTaxCalc'),
    'Präzise Berechnung mit Steuern und Inflation': t('preciseCalculation'),
    '📄 PDF/CSV Export': '📄 ' + t('pdfCsvExport'),
    'Exportiere deine Berechnungen': t('exportCalculations'),
    '🚫 Werbefrei': '🚫 ' + t('adFree'),
    'Keine störenden Werbebanner': t('noAds'),
    '2 Monate gratis': t('monthsFree'),
    '🎁 3 Tage kostenlos testen': '🎁 ' + t('trialDays'),
    'Keine Zahlung während der Testphase. Jederzeit kündbar.': t('noPaymentDuringTrial'),
    '3 Tage kostenlos testen': t('trialDays'),
    '🎁 3 Tage kostenlos – Jederzeit kündbar': '🎁 ' + t('trialInfo'),
    'Nach der Testphase 1,99€/Monat oder 18,99€/Jahr': t('afterTrial'),
    'ℹ️ Abo läuft automatisch nach 3 Tagen, wenn nicht gekündigt': 'ℹ️ ' + 'Subscription auto-renews after 3 days if not canceled',
    'Trade Pro': t('tradePro'),
    'AKTIV': t('active'),
    'Alle Premium-Features freigeschaltet': t('allPremium'),
    'Pro kündigen': t('cancelPro'),
    
    // Settings - Data Management
    'Daten exportieren': t('exportData'),
    
    // Settings - Appearance
    'Wähle zwischen hellem, dunklem oder dem System-Modus.': 'Choose between light, dark or system mode.',
    
    // Settings - Currency & Tools
    'Land': t('country'),
    'Sprache': t('language'),
    'Währung': t('currency'),
    'Hebel-Funktion': t('leverageFunction'),
    'Die Hebel-Funktion ermöglicht die Berechnung von Derivaten (Long/Short).': t('leverageDesc'),
    'Benutzerdefiniert': t('custom'),
    'Finanzen.net Zero': 'Finanzen.net Zero',
    'Smartbroker+': 'Smartbroker+',
    'justTRADE': 'justTRADE',
    'Trade Republic': 'Trade Republic',
    'Scalable Capital': 'Scalable Capital',
    'Flatex': 'Flatex',
    'Comdirect': 'Comdirect',
    'ING': 'ING',
    'Consorsbank': 'Consorsbank',
    'Commerzbank': 'Commerzbank',
    'DKB': 'DKB',
    'Interactive Brokers': 'Interactive Brokers',
    
    // Settings - Analysis Values
    'Break-Even Kurs': t('breakEvenPrice'),
    'CRV (Chance-Risiko)': t('crvRatio'),
    'Break-Even zeigt den Kurs, ab dem du inkl. Gebühren im Plus bist. CRV bewertet das Verhältnis von Gewinnziel zu Stop-Loss.': t('breakEvenDesc'),
    
    // Settings - Taxes
    'VERBLEIBEND 2026': t('remaining2026').toUpperCase(),
    'verbraucht': t('used'),
    'Jahres-Freibetrag': t('taxFreeAmount'),
    'Bereits verwendet': t('alreadyUsed'),
    'Steuersatz': t('taxRate'),
    'In Deutschland liegt die Abgeltungssteuer inkl. Soli bei 26,375%. Der Freibetrag von': 'In Germany capital gains tax including solidarity surcharge is 26.375%. The allowance of',
    'erneuert sich automatisch am 1. Januar jeden Jahres. Gespeicherte Trades werden automatisch dem jeweiligen Jahr zugeordnet.': 'renews automatically on January 1st each year. Saved trades are automatically assigned to the respective year.',
    
    // Settings - Broker
    'Aktueller Broker': t('currentBroker'),
    
    // Settings - Forecast Parameters
    'Inflationsrate': t('inflationRateLabel'),
    'Jährliche Dynamik': t('yearlyIncreaseLabel'),
    'Die Inflationsrate wird für die Realwertberechnung im Sparrechner verwendet. Die jährliche Dynamik erhöht deine Sparrate automatisch um den angegebenen Prozentsatz pro Jahr.': t('forecastDescription'),
    
    // Settings - Fees
    'GEBÜHREN': t('feesHeading'),
    'Fixkosten': t('fixedCostsLabel'),
    'Variable Gebühr': t('variableFeeLabel'),
    'Ordergebühren deines Brokers. Diese werden sowohl beim Kauf als auch beim Verkauf berücksichtigt.': t('feesDescription'),
    
    // Settings - Legal
    'RECHTLICHES': t('legalHeading'),
    'Über Trade': t('aboutTradeTitle'),
    'Trade ist ein kostenloser Trading-Rechner für private Trader und Investoren. Die App bietet präzise Berechnungen für Trading, Sparen und Investments mit automatischer Steuerberechnung nach deutschem Recht.': t('aboutTradeDescription'),
    'Support:': 'Support:',
    'Version:': 'Version:',
    'Datenschutzerklärung': t('privacyPolicy'),
    'Erfahre, wie wir deine Daten schützen': t('privacyPolicyDesc'),
    'Nutzungsbedingungen': t('termsOfService'),
    'Lies unsere allgemeinen Geschäftsbedingungen': t('termsOfServiceDesc'),
    'Impressum': t('imprint'),
    'Rechtliche Informationen zum Anbieter': t('imprintDesc'),
    
    // Settings - Feedback & Support
    'FEEDBACK & SUPPORT': t('feedbackSupportHeading'),
    'Feedback Portal': t('feedback'),
    'Teile deine Ideen und hilf uns, Trade zu verbessern': t('feedbackDesc'),
    '© 2026 Trade. Alle Rechte vorbehalten.': '© 2026 Trade. ' + t('allRightsReserved'),
    
    // Placeholders and Input Fields
    'Optional': t('optional'),
    'z.B. Apple Long, Bitcoin Short...': 'e.g. Apple Long, Bitcoin Short...',
    'Suche nach ETFs...': 'Search ETFs...',
    'Dein Name': 'Your Name',
    'deine@email.de': 'your@email.com',
    '••••••••': '••••••••',
    'Beschreibe dein Feedback so detailliert wie möglich...': 'Describe your feedback in as much detail as possible...',
  };
  
  // Wende alle Übersetzungen aus der Map an
  aggressiveTranslateAllText();
}

  // ===== AGGRESSIVE TEXT REPLACEMENT SYSTEM =====
  // Durchlaufe ALLE Textknoten und ersetze JEDEN gefundenen deutschen Text
  function aggressiveTranslateAllText() {
    // Erstelle einen kompletten Translation Index (German ? Translated)
    const allTranslations = {};
    for (const [german, translated] of Object.entries(translationMap)) {
      allTranslations[german] = translated;
    }
    
    // Verwende TreeWalker für effiziente DOM-Navigation
    const walker = document.createTreeWalker(
      document.body,
      NodeFilter.SHOW_TEXT,
      null,
      false
    );
    
    let textNode;
    while (textNode = walker.nextNode()) {
      let originalText = textNode.textContent;
      let newText = originalText;
      
      // überspringe sehr kleine oder Leerzeichen-only Knoten
      if (!originalText.trim() || originalText.trim().length === 0) {
        continue;
      }
      // überspringe sehr lange Textknoten
      if (originalText.length > 200) continue;
      
      // überspringe parent-Elemente die Special sind
      const parent = textNode.parentElement;
      if (!parent) continue;
      
      // überspringe bestimmte Element-Typen
      if (['SCRIPT', 'STYLE', 'NOSCRIPT', 'CANVAS', 'SVG', 'CODE', 'PRE'].includes(parent.tagName)) {
        continue;
      }
      
      // überspringe Elemente mit bestimmten IDs/Classes die nicht übersetzt werden sollen
      if (parent.id && parent.id.match(/(modal|chart|graph|canvas|image|icon|logo)/i)) {
        continue;
      }
      
      // Wende alle Translations an - EXAKTE Matches ZUERST
      for (const [german, translated] of Object.entries(allTranslations)) {
        // Exakte Match (trimmed)
        if (newText.trim() === german) {
          newText = newText.replace(german, translated);
          break; // Aus der Inner Loop
        }
      }
      
      // Falls keine exakte Match, versuche substring replacements
      if (newText === originalText) {
        for (const [german, translated] of Object.entries(allTranslations)) {
          // Nur ersetze wenn der German String lang genug ist (Mindestens 3 Zeichen)
          // Und nicht in Zahlen/Symbolen eingebettet ist
          if (german.length >= 3 && newText.includes(german)) {
            // überspringe wenn der Text hauptsächlich aus Zahlen besteht
            if (!german.match(/^[\d\-+€$£%.,]*$/) && !newText.match(/^[\d\-+€$£%.,\s]*$/)) {
              newText = newText.replace(new RegExp(escapeRegExp(german), 'g'), translated);
            }
          }
        }
      }
      
      // Aktualisiere den TextNode wenn etwas geändert wurde
      if (newText !== originalText) {
        textNode.textContent = newText;
      }
    }
  }
  
  // Regex escape helper
  function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }
  
  // Translate HTML attributes (placeholder, aria-label, title, etc.)
  function translateAttributes() {
    // Get all elements with translatable attributes
    const elementsWithAttrs = document.querySelectorAll('[placeholder], [aria-label], [title]');
    
    elementsWithAttrs.forEach(el => {
      // Translate placeholder
      if (el.placeholder) {
        for (const [german, translated] of Object.entries(allTranslations)) {
          if (el.placeholder.includes(german)) {
            el.placeholder = el.placeholder.replace(new RegExp(escapeRegExp(german), 'g'), translated);
            break;
          }
        }
      }
      
      // Translate aria-label
      if (el.getAttribute('aria-label')) {
        const ariaLabel = el.getAttribute('aria-label');
        for (const [german, translated] of Object.entries(allTranslations)) {
          if (ariaLabel.includes(german)) {
            el.setAttribute('aria-label', ariaLabel.replace(new RegExp(escapeRegExp(german), 'g'), translated));
            break;
          }
        }
      }
      
      // Translate title
      if (el.getAttribute('title')) {
        const title = el.getAttribute('title');
        for (const [german, translated] of Object.entries(allTranslations)) {
          if (title.includes(german)) {
            el.setAttribute('title', title.replace(new RegExp(escapeRegExp(german), 'g'), translated));
            break;
          }
        }
      }
    });
  }
  
  // Call attribute translation after text translation
  translateAttributes();
  
  // AGGRESSIVE TRANSLATION - DEAKTIVIERT (läuft jetzt in scheduleAggressiveTranslations() mit Delays)
  // Dieser Block wurde auskommentiert, um die Settings-Sektion und Performance zu verbessern
  
  // Alternative Methode: Alle Textinhalte direkt durchsuchen und ersetzen - WIRD JETZT NICHT MEHR INLINE AUSGEFÜHRT

// Installiere einen MutationObserver, der dynamisch hinzugefügte Inhalte übersetzt
if (!window.__translationObserverInstalled) {
  window.__translationObserverInstalled = true;
  function __translateNode(node) {
    if (!node) return;
    if (node.nodeType === Node.TEXT_NODE) {
      let text = node.textContent;
      if (!text || !text.trim()) return;
      for (const [german, translated] of Object.entries(window.translationMap || {})) {
        if (german && translated && german !== translated && text.includes(german)) {
          text = text.split(german).join(translated);
        }
      }
      if (text !== node.textContent) node.textContent = text;
    } else if (node.nodeType === Node.ELEMENT_NODE) {
      // Skip inputs/selects/textareas and contenteditable during translation
      const tag = node.tagName;
      if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT' || node.isContentEditable) return;

      // übersetze direkte Textknoten des Elements (shallow)
      for (const child of Array.from(node.childNodes)) {
        if (child.nodeType === Node.TEXT_NODE) __translateNode(child);
      }

      // übersetze häufige Attribute
      ['placeholder','title','aria-label','data-text','data-label','data-title'].forEach(attr => {
        if (node.hasAttribute && node.hasAttribute(attr)) {
          let v = node.getAttribute(attr);
          if (!v) return;
          for (const [german, translated] of Object.entries(window.translationMap || {})) {
            if (german && translated && german !== translated && v.includes(german)) {
              v = v.split(german).join(translated);
            }
          }
          node.setAttribute(attr, v);
        }
      });
    }
  }

  // Debounced MutationObserver processor to avoid heavy synchronous work
  const __translationObserver = new MutationObserver((mutations) => {
    if (aktuelleSprache === 'de' || window.__translationPaused) return;

    // Collect nodes to process, but debounce actual work
    const nodes = [];
    for (const m of mutations) {
      if (m.type === 'childList') {
        for (const n of Array.from(m.addedNodes)) {
          nodes.push(n);
        }
      } else if (m.type === 'attributes' && m.target) {
        nodes.push(m.target);
      }
    }

    if (nodes.length === 0) return;

    // Schedule work during idle time or shortly after
    const work = () => {
      try {
        for (const n of nodes) {
          __translateNode(n);
        }
      } catch (e) {
        console.error('translation observer work failed', e);
      }
    };

    if ('requestIdleCallback' in window) {
      try { requestIdleCallback(work, { timeout: 300 }); } catch (e) { setTimeout(work, 150); }
    } else {
      setTimeout(work, 150);
    }
  });

  // Beobachtung nicht sofort starten - wir aktivieren den Observer später
  window.__translationObserver = __translationObserver;
  window.__startTranslationObserver = function() {
    try {
      __translationObserver.observe(document.body, { childList: true, subtree: true, attributes: true, attributeFilter: ['placeholder','title','aria-label','data-text','data-label','data-title'] });
    } catch (e) {
      console.error('Start des TranslationObserver fehlgeschlagen:', e);
    }
  };

  // Pause translation while user interacts with form controls to avoid UI freezes
  window.__translationPaused = false;
  document.addEventListener('focusin', (e) => {
    const t = e.target;
    if (!t) return;
    const tag = t.tagName;
    if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT' || t.isContentEditable) {
      window.__translationPaused = true;
    }
  }, true);
  document.addEventListener('focusout', (e) => {
    const t = e.target;
    if (!t) return;
    const tag = t.tagName;
    if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT' || t.isContentEditable) {
      window.__translationPaused = false;
      // schedule a single re-run to catch up
      if (window.__startTranslationObserver) {
        setTimeout(() => {
          try {
            // Run a light pass
            if (typeof applyTranslations === 'function') applyTranslations();
            if (typeof translatePageText === 'function') translatePageText();
          } catch (e) { console.error('Error during post-focus translations', e); }
        }, 120);
      }
    }
  }, true);
}

function getWaehrungsSymbol() {
  return waehrungsSymbole[aktuelleWaehrung] || '€';
}

function aendereWaehrung() {
  const select = document.getElementById('waehrungSelect');
  aktuelleWaehrung = select.value;
  localStorage.setItem('waehrung', aktuelleWaehrung);
  aktualisiereAlleWaehrungen();
}

// Ändert das ausgewählte Land und passt Steuern an
function aendereLand() {
  const select = document.getElementById('landSelect');
  const land = select.value;
  localStorage.setItem('selectedCountry', land);
  if (window.firebaseSaveProfile && window.firebaseCurrentUser && window.firebaseCurrentUser.uid) {
    window.firebaseSaveProfile(window.firebaseCurrentUser.uid, { land: land }).catch((err) => {
      console.error('Firebase Profil-Update fehlgeschlagen', err);
    });
  }
  
  const daten = getLandSteuerdaten();
  
  // Zeige Hinweis wenn vorhanden
  const taxInfoRow = document.getElementById('taxInfoRow');
  const taxInfoHintText = document.getElementById('taxInfoHintText');
  if (daten.hinweis && taxInfoRow && taxInfoHintText) {
    taxInfoRow.style.display = 'flex';
    taxInfoHintText.textContent = 'ℹ️ ' + daten.hinweis;
  } else if (taxInfoRow) {
    taxInfoRow.style.display = 'none';
  }
  
  // Update Währung automatisch basierend auf Land
  if (daten.waehrung) {
    const waehrungSelect = document.getElementById('waehrungSelect');
    if (waehrungSelect && waehrungSelect.value !== daten.waehrung) {
      // Prüfe ob Währung verfügbar ist
      const optionExists = Array.from(waehrungSelect.options).some(opt => opt.value === daten.waehrung);
      if (optionExists) {
        waehrungSelect.value = daten.waehrung;
        aendereWaehrung();
      }
    }
  }
  
  aktualisiereNachLandWechsel();
}


function aktualisiereAlleWaehrungen() {
  const symbol = getWaehrungsSymbol();
  const landDaten = getLandSteuerdaten();
  const numberLocale = getNumberLocale();
  const freibetragText = landDaten.freibetrag.toLocaleString(numberLocale);
  
  // Aktualisiere alle Währungsanzeigen
  document.querySelectorAll('.input-unit').forEach(el => {
    if (el.textContent === '€' || el.textContent === '$' || el.textContent === '£') {
      el.textContent = symbol;
    }
  });
  
  // Aktualisiere statische Texte
  const freibetragEl = document.getElementById('jahresFreibetrag');
  if (freibetragEl) freibetragEl.textContent = freibetragText + ' ' + symbol;
  
  const freibetragLimitEl = document.getElementById('freibetragLimit');
  if (freibetragLimitEl) freibetragLimitEl.textContent = '/ ' + freibetragText + ' ' + symbol;
  
  const freibetragTextEl = document.getElementById('freibetragText');
  if (freibetragTextEl) freibetragTextEl.textContent = freibetragText + ' ' + symbol;
  
  const homeFreibetragEl = document.getElementById('homeFreibetrag');
  if (homeFreibetragEl) homeFreibetragEl.textContent = freibetragText + ' ' + symbol;
  
  // Aktualisiere Berechnungen neu
  berechneTrading();
  berechneSpar();
  aktualisiereFreibetrag();
  updateNachkaufPreview();
  updateTeilverkaufPreview();
}

function ladeWaehrung() {
  const gespeicherteWaehrung = localStorage.getItem('waehrung') || 'EUR';
  aktuelleWaehrung = gespeicherteWaehrung;
  document.getElementById('waehrungSelect').value = gespeicherteWaehrung;
  aktualisiereAlleWaehrungen();
}

function ladeLand() {
  const gespeichertesLand = localStorage.getItem('selectedCountry') || 'DE';
  const landSelect = document.getElementById('landSelect');
  if (landSelect) {
    landSelect.value = gespeichertesLand;
  }
  const registerLandSelect = document.getElementById('registerCountrySelect');
  if (registerLandSelect) {
    registerLandSelect.value = gespeichertesLand;
  }
  
  // Zeige Hinweis für ausgewähltes Land
  const daten = getLandSteuerdaten();
  const taxInfoRow = document.getElementById('taxInfoRow');
  const taxInfoText = document.getElementById('taxInfoText');
  if (daten.hinweis && taxInfoRow && taxInfoText) {
    taxInfoRow.style.display = 'flex';
    taxInfoText.textContent = 'ℹ️ ' + daten.hinweis;
  }
  
  // Zeige/Verstecke Freibetrag-Bereiche basierend auf Land
  const hasFreibetrag = daten.freibetrag > 0;
  const hasTax = daten.steuersatz > 0;
  
  const freibetragCard = document.getElementById('freibetragCard');
  if (freibetragCard) freibetragCard.style.display = hasFreibetrag ? 'block' : 'none';
  
  const freibetragDetailsBox = document.getElementById('freibetragDetailsBox');
  if (freibetragDetailsBox) freibetragDetailsBox.style.display = hasFreibetrag ? 'block' : 'none';
  
  // Steuersatz-Box anzeigen/verstecken
  const steuersatzDetailsBox = document.getElementById('steuersatzDetailsBox');
  if (steuersatzDetailsBox) steuersatzDetailsBox.style.display = hasTax ? 'block' : 'none';
  
  const steuernHeading = document.getElementById('steuernHeading');
  if (steuernHeading) {
    steuernHeading.style.display = hasTax ? 'block' : 'none';
    steuernHeading.textContent = 'STEUERN (' + daten.name.toUpperCase() + ')';
  }
  
  const homeFreibetragStat = document.getElementById('homeFreibetragStat');
  if (homeFreibetragStat) homeFreibetragStat.style.display = hasFreibetrag ? 'block' : 'none';
  
  aktualisiereNachLandWechsel();
}

function oeffneLoginModal() {
  document.getElementById('loginModal').classList.add('active');
  document.getElementById('loginFehler').style.display = 'none';
  document.getElementById('loginErfolg').style.display = 'none';
}

function wechsleLoginTab(modus) {
  istLoginModus = (modus === 'login');
  
  // Update Tabs
  document.getElementById('loginTabBtn').classList.toggle('active', istLoginModus);
  document.getElementById('registerTabBtn').classList.toggle('active', !istLoginModus);
  
  // Update Button Text with translation
  document.getElementById('loginSubmitBtn').textContent = istLoginModus ? t('loginSubmit') : t('registerSubmit');
  
  // Update Modal Title with translation
  document.getElementById('loginModalTitle').textContent = istLoginModus ? t('loginTab') : t('registerTab');
  
  // Zeige/Verstecke Registrierungsfelder
  document.getElementById('registerHinweis').style.display = istLoginModus ? 'none' : 'block';
  document.getElementById('countrySelectLabel').style.display = istLoginModus ? 'none' : 'block';
  
  // Reset Nachrichten
  document.getElementById('loginFehler').style.display = 'none';
  document.getElementById('loginErfolg').style.display = 'none';
}

async function login() {
  const email = document.getElementById('loginEmail').value.trim();
  const passwort = document.getElementById('loginPassword').value;
  const fehlerEl = document.getElementById('loginFehler');
  const erfolgEl = document.getElementById('loginErfolg');
  
  fehlerEl.style.display = 'none';
  erfolgEl.style.display = 'none';
  
  // Validierung
  if (!email || !passwort) {
    fehlerEl.textContent = t('fillAllFields');
    fehlerEl.style.display = 'block';
    return;
  }
  
  if (!email.includes('@') || !email.includes('.')) {
    fehlerEl.textContent = t('validEmail');
    fehlerEl.style.display = 'block';
    return;
  }

  if (!window.firebaseLogin || !window.firebaseRegister) {
    fehlerEl.textContent = 'Firebase ist noch nicht bereit. Bitte Seite neu laden.';
    fehlerEl.style.display = 'block';
    return;
  }
  
  if (istLoginModus) {
    // Login
    try {
      await window.firebaseLogin(email, passwort);
      erfolgEl.textContent = t('loginSuccess');
      erfolgEl.style.display = 'block';
      
      setTimeout(() => {
        closeModal('loginModal');
        aktualisiereLoginStatus();
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
      }, 800);
    } catch (err) {
      const code = err && err.code ? err.code : '';
      if (code === 'auth/user-not-found' || code === 'auth/invalid-credential') {
        fehlerEl.textContent = t('noAccountFound');
      } else if (code === 'auth/wrong-password') {
        fehlerEl.textContent = t('wrongPassword');
      } else if (code === 'auth/invalid-email') {
        fehlerEl.textContent = t('validEmail');
      } else {
        fehlerEl.textContent = 'Anmeldung fehlgeschlagen.';
      }
      fehlerEl.style.display = 'block';
    }
    
  } else {
    // Registrierung
    
    // Prüfe ob Nutzungsbedingungen akzeptiert wurden
    const acceptTermsCheckbox = document.getElementById('acceptTerms');
    if (!acceptTermsCheckbox || !acceptTermsCheckbox.checked) {
      fehlerEl.textContent = t('acceptTermsRequired');
      fehlerEl.style.display = 'block';
      return;
    }
    
    if (passwort.length < 6) {
      fehlerEl.textContent = t('passwordMinLength');
      fehlerEl.style.display = 'block';
      return;
    }
    
    // Neuen User erstellen
    const selectedCountry = document.getElementById('registerCountrySelect').value || 'DE';
    try {
      await window.firebaseRegister(email, passwort, { land: selectedCountry });
      localStorage.setItem('selectedCountry', selectedCountry);
      
      // Waehrung basierend auf Land setzen
      const landDaten = laenderSteuerdaten[selectedCountry];
      if (landDaten && landDaten.waehrung) {
        localStorage.setItem('waehrung', landDaten.waehrung);
      }
      
      erfolgEl.textContent = t('registerSuccess');
      erfolgEl.style.display = 'block';
      
      setTimeout(() => {
        closeModal('loginModal');
        aktualisiereLoginStatus();
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
      }, 1200);
    } catch (err) {
      const code = err && err.code ? err.code : '';
      if (code === 'auth/email-already-in-use') {
        fehlerEl.textContent = t('accountExists');
      } else if (code === 'auth/invalid-email') {
        fehlerEl.textContent = t('validEmail');
      } else if (code === 'auth/weak-password') {
        fehlerEl.textContent = t('passwordMinLength');
      } else {
        fehlerEl.textContent = 'Registrierung fehlgeschlagen.';
      }
      fehlerEl.style.display = 'block';
    }
  }
}

async function abmelden() {
  if (!confirm(t('logoutConfirm'))) {
    return;
  }
  if (window.firebaseLogout) {
    try {
      await window.firebaseLogout();
    } catch (err) {
      console.error('Logout fehlgeschlagen', err);
    }
  }
  aktualisiereLoginStatus();
}

function aktualisiereLoginStatus() {
  const aktuellerUser = window.firebaseCurrentUser;
  const loginBtn = document.getElementById('loginBtn');
  const userBtn = document.getElementById('userBtn');
  const userEmail = document.getElementById('userEmail');
  const saveBtn = document.getElementById('savePositionBtn');
  
  if (aktuellerUser) {
    // Angemeldet
    loginBtn.style.display = 'none';
    userBtn.style.display = 'flex';
    userEmail.textContent = (aktuellerUser.email || '').split('@')[0];
    if (saveBtn) {
      const svg = saveBtn.querySelector('svg');
      saveBtn.textContent = t('saveTrade');
      if (svg) saveBtn.prepend(svg);
      saveBtn.style.opacity = '1';
    }
  } else {
    // Nicht angemeldet
    loginBtn.style.display = 'block';
    userBtn.style.display = 'none';
    if (saveBtn) {
      const svg = saveBtn.querySelector('svg');
      saveBtn.textContent = t('loginToSave');
      if (svg) saveBtn.prepend(svg);
      saveBtn.style.opacity = '0.85';
    }
  }
}

function starteApp() {
  // Ä–ffne das Anmelde-/Registrierungsfenster
  oeffneLoginModal();
}

// Init
document.addEventListener('DOMContentLoaded', function() {
  loadTheme();
  ladeWaehrung();
  ladeSprache();
  ladeLand(); // Gespeichertes Land laden
  
  // Wende Übersetzungen an
  if (typeof translatePageText === 'function') translatePageText();
  if (typeof aggressiveTranslateAllText === 'function') aggressiveTranslateAllText();
  
  berechneTrading();
  berechneSpar();
  ladeFreibetrag();
  ladeGebuehren();
  aktualisiereLoginStatus();
  startLaunchCountdownBanner();
  applyPrelaunchProUI();
  
  // Kurze Verzögerung, damit alle Elemente sicher geladen sind
  setTimeout(function() {
    zeigeGespeichertePositionen();
  }, 100);
});
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, collection, getDocs, deleteDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAd4B0gt6D1cgErq-up419M8ARDejI57zQ",
      authDomain: "calculo-79290.firebaseapp.com",
      projectId: "calculo-79290",
      storageBucket: "calculo-79290.firebasestorage.app",
      messagingSenderId: "989206420527",
      appId: "1:989206420527:web:b653befd74ccf19bf0fada"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    window.firebaseAuth = auth;
    window.firebaseDb = db;
    window.firebaseCurrentUser = null;

    window.firebaseLogin = async (email, password) => signInWithEmailAndPassword(auth, email, password);

    window.firebaseRegister = async (email, password, profile) => {
      const cred = await createUserWithEmailAndPassword(auth, email, password);
      const uid = cred.user.uid;
      await setDoc(doc(db, 'users', uid), {
        email: cred.user.email || email,
        land: (profile && profile.land) ? profile.land : 'DE',
        createdAt: serverTimestamp(),
        updatedAt: serverTimestamp()
      }, { merge: true });
      return cred;
    };

    window.firebaseLogout = async () => signOut(auth);

    window.firebaseLoadProfile = async (uid) => {
      const snap = await getDoc(doc(db, 'users', uid));
      return snap.exists() ? snap.data() : null;
    };

    window.firebaseSaveProfile = async (uid, data) => {
      const payload = Object.assign({}, data, { updatedAt: serverTimestamp() });
      await setDoc(doc(db, 'users', uid), payload, { merge: true });
    };

    window.firebaseSavePosition = async (uid, position) => {
      const id = String(position.id);
      const payload = Object.assign({}, position, { id: position.id, updatedAt: serverTimestamp() });
      if (!position.createdAt) {
        payload.createdAt = serverTimestamp();
      }
      await setDoc(doc(db, 'users', uid, 'positions', id), payload, { merge: true });
    };

    window.firebaseLoadPositions = async (uid) => {
      const q = query(collection(db, 'users', uid, 'positions'), orderBy('createdAt', 'desc'));
      const snap = await getDocs(q);
      return snap.docs.map((docSnap) => Object.assign({ docId: docSnap.id }, docSnap.data()));
    };

    window.firebaseDeletePosition = async (uid, posId) => {
      await deleteDoc(doc(db, 'users', uid, 'positions', String(posId)));
    };

    window.firebaseDeleteAllPositions = async (uid) => {
      const col = collection(db, 'users', uid, 'positions');
      const snap = await getDocs(col);
      const deletes = snap.docs.map((docSnap) => deleteDoc(docSnap.ref));
      await Promise.all(deletes);
    };

    onAuthStateChanged(auth, async (user) => {
      window.firebaseCurrentUser = user || null;
      if (user) {
        try {
          const profile = await window.firebaseLoadProfile(user.uid);
          if (profile && profile.land) {
            localStorage.setItem('selectedCountry', profile.land);
          }
          if (typeof window.ladeLand === 'function') {
            window.ladeLand();
          }
        } catch (err) {
          console.error('Firebase profile load failed', err);
        }
      }
      if (typeof window.aktualisiereLoginStatus === 'function') {
        window.aktualisiereLoginStatus();
      }
      if (typeof window.zeigeGespeichertePositionen === 'function') {
        window.zeigeGespeichertePositionen();
      }
    });
  </script>
</body>
</html>




